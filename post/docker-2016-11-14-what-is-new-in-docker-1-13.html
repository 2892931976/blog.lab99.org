<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Docker 1.13 新增功能 · 大桥下的蜗牛</title><meta name="description" content="无善无恶心之体，有善有恶意之动，知善知恶是良知，为善去恶是格物。"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">主页</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   博客</a></li><li class="nav-list-item"><a href="https://github.com/twang2218" target="_blank" class="nav-link">github</a></li><li class="nav-list-item"><a href="https://coding.net/u/twang2218" target="_blank" class="nav-link">coding</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/post/docker-2016-11-14-what-is-new-in-docker-1-13.html" class="post-title-link">Docker 1.13 新增功能</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/docker/" class="post-tag-link">docker</a></li><li class="post-tag-item"><a href="/tags/blog/" class="post-tag-link">blog</a></li></ul><div class="post-time">2016年11月14日 星期一</div></div><div class="post-content"><link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#qian-yan">&#x524D;&#x8A00;</a><ul>
<li><a href="#top-10-xin-zeng-gong-neng">Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#docker-jing-xiang-gou-jian">Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;</a><ul>
<li><a href="#cong-yi-you-jing-xiang-qu-de-huan-cun">&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;</a></li>
<li><a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan">&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;</a></li>
</ul>
</li>
<li><a href="#an-zhuang">&#x5B89;&#x88C5;</a><ul>
<li><a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti">&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898;</a></li>
<li><a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi">&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;</a></li>
</ul>
</li>
<li><a href="#wang-luo">&#x7F51;&#x7EDC;</a><ul>
<li><a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo">&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC;</a></li>
<li><a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou">&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</a></li>
<li><a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;</a></li>
<li><a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-jie-dian">&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9;</a></li>
<li><a href="#yun-xu-service-vip-ke-yi-bei-ping">&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code></a></li>
</ul>
</li>
<li><a href="#cha-jian">&#x63D2;&#x4EF6;</a><ul>
<li><a href="#cha-jian-gong-neng-zheng-shi-qi-yong">&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;</a></li>
</ul>
</li>
<li><a href="#ming-ling-xing">&#x547D;&#x4EE4;&#x884C;</a><ul>
<li><a href="#shi-yan-checkpoint-gong-neng">&#x8BD5;&#x9A8C; <code>checkpoint</code> &#x529F;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#yun-xing-shi">&#x8FD0;&#x884C;&#x65F6;</a><ul>
<li><a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu">&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570;</a></li>
<li><a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e">&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;</a></li>
<li><a href="#zeng-jia-docker-system-ming-ling">&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</a></li>
<li><a href="#ti-sheng-overlay2-de-you-xian-ji">&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7;</a></li>
<li><a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
</ul>
</li>
<li><a href="#swarm-mode">Swarm Mode</a><ul>
<li><a href="#zheng-shi-zhi-chi-docker-stack">&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code></a></li>
<li><a href="#tian-jia-secret-guan-li">&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406;</a></li>
<li><a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi">&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;</a></li>
<li><a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng">&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</a></li>
<li><a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi">&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;</a></li>
<li><a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force">&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></a></li>
</ul>
</li>
<li><a href="#fei-qi">&#x5E9F;&#x5F03;</a></li>
</ul>
<!-- tocstop -->
<h1 id="qian-yan"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00; <a href="#qian-yan" class="header-anchor">#</a></h1><p><code>Docker 1.13</code> &#x9A6C;&#x4E0A;&#x5C31;&#x8981;&#x53D1;&#x5E03;&#x4E86;&#x3002;&#x4ECE; 7 &#x6708; 29 &#x65E5;&#x53D1;&#x5E03; <code>1.12</code> &#x53D1;&#x5E03;&#x4EE5;&#x6765;&#xFF0C;&#x5DF2;&#x7ECF;&#x8FC7;&#x53BB; 4 &#x4E2A;&#x591A;&#x6708;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D3B;&#x8DC3;&#x7684; Docker &#x793E;&#x533A;&#x6765;&#x8BF4;&#xFF0C;&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x90FD; <code>1.13</code> &#x90FD;&#x65B0;&#x589E;&#x4E86;&#x4EC0;&#x4E48;&#x5185;&#x5BB9;&#x5427;&#x3002;</p>
<p><code>1.13</code> &#x6709;<a href="https://github.com/docker/docker/milestone/56" target="_blank" rel="external">&#x4E00;&#x5343;&#x4E8C;&#x767E;&#x591A;&#x4E2A; issue/pull request</a>&#xFF0C;&#x56DB;&#x5343;&#x591A;&#x4E2A; commits&#xFF0C;&#x662F;&#x5386;&#x53F2;&#x4E0A;&#x6700;&#x9AD8;&#x7684;&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5C0F;&#x7248;&#x672C;&#x53D8;&#x5316;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x5927;&#x91CF;&#x7684;&#x66F4;&#x65B0;&#x3002;</p>
<p><em>&#x8981;&#x60F3;&#x6D4B;&#x8BD5; <code>1.13.0</code> &#x7684;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8D77;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x8FD0;&#x884C;&#xFF1A;<code>curl -fsSL https://test.docker.com/ | sh</code>&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7684;&#x6D4B;&#x8BD5;&#x7248;&#x672C;&#x3002;</em></p>
<h2 id="top-10-xin-zeng-gong-neng"><a href="#Top-10-&#x65B0;&#x589E;&#x529F;&#x80FD;" class="headerlink" title="Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;"></a>Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD; <a href="#top-10-xin-zeng-gong-neng" class="header-anchor">#</a></h2><ul>
<li>1&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x670D;&#x52A1;&#x6808; <code>docker stack</code></li>
<li>2&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x63D2;&#x4EF6;&#xFF1A;<code>docker plugin</code></li>
<li>3&#x3001;&#x6DFB;&#x52A0;&#x5728; Swarm &#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7BA1;&#x7406;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF1A;<code>docker secret</code></li>
<li>4&#x3001;&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</li>
<li>5&#x3001;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x8FDB;&#x884C;&#x670D;&#x52A1;&#x90E8;&#x7F72;</li>
<li>6&#x3001;&#x6DFB;&#x52A0; <code>docker service</code> &#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</li>
<li>7&#x3001;&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></li>
<li>8&#x3001;&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</li>
<li>9&#x3001;&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;</li>
<li>10&#x3001;&#x89E3;&#x51B3;&#x4E2D;&#x56FD; <code>GFW</code> &#x5899;&#x6389; <code>docker-engine</code> <code>apt</code>/<code>yum</code> &#x6E90;&#x7684;&#x95EE;&#x9898;</li>
</ul>
<h1 id="docker-jing-xiang-gou-jian"><a href="#Docker-&#x955C;&#x50CF;&#x6784;&#x5EFA;" class="headerlink" title="Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;"></a>Docker &#x955C;&#x50CF;&#x6784;&#x5EFA; <a href="#docker-jing-xiang-gou-jian" class="header-anchor">#</a></h1><h2 id="cong-yi-you-jing-xiang-qu-de-huan-cun"><a href="#&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;" class="headerlink" title="&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;"></a>&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58; <a href="#cong-yi-you-jing-xiang-qu-de-huan-cun" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5145;&#x5206;&#x5229;&#x7528;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#x7279;&#x6027;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x907F;&#x514D;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#x662F;&#x66FE;&#x7ECF;&#x5728;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x8FC7;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x5728; CI &#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x6784;&#x5EFA;&#x65F6;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x800C;&#x8BE5;&#x673A;&#x5668;&#x6CA1;&#x6709;&#x6784;&#x5EFA;&#x8FC7;&#x8BE5;&#x955C;&#x50CF;&#xFF0C;&#x56E0;&#x6B64;&#x7F13;&#x5B58;&#x603B;&#x662F;&#x7528;&#x4E0D;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#x6D6A;&#x8D39;&#x5728;&#x4E86;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#x4E0A;&#x4E86;&#x3002;</p>
<p>&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x4E3A; <code>docker build</code> &#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x53C2;&#x6570; <code>--cache-from</code>&#xFF0C;&#x5229;&#x7528;&#x955C;&#x50CF;&#x4E2D;&#x7684; History &#x6765;&#x5224;&#x65AD;&#x8BE5;&#x5C42;&#x662F;&#x5426;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#x4E00;&#x81F4;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x5148;&#x4E0B;&#x8F7D;&#x83B7;&#x53D6;&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x7684;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ docker pull mongo:3.2</div><div class="line">3.2: Pulling from library/mongo</div><div class="line">386a066<span class="built_in">cd</span>84a: Pull complete</div><div class="line">524267bc200a: Pull complete</div><div class="line">476d61c7c43a: Pull complete</div><div class="line">0750d0e28b90: Pull complete</div><div class="line">4bedd83d0855: Pull complete</div><div class="line">b3b5d21a0eda: Pull complete</div><div class="line">7354b6c26240: Pull complete</div><div class="line">db792d386b51: Pull complete</div><div class="line">a867bd77950c: Pull complete</div><div class="line">Digest: sha256:532a19da83ee0e4e2a2ec6bc4212<span class="built_in">fc</span>4af26357c040675d5c2629a4e4c4563cef</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> mongo:3.2</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x540E;&#x7684; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x4E0A; <code>--cache-from mongo:3.2</code> &#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5982;&#x679C;&#x662F;&#x5DF2;&#x7ECF;&#x5728; <code>mongo:3.2</code> &#x4E2D;&#x5B58;&#x5728;&#x5E76;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x7684;&#x5C42;&#xFF0C;&#x5C31;&#x4F1A;&#x7528; <code>mongo:3.2</code> &#x4E2D;&#x7684;&#x8BE5;&#x5C42;&#x505A;&#x7F13;&#x5B58;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ docker build --cache-from mongo:3.2 -t mongo:3.2.1 .</div><div class="line">Sending build context to Docker daemon 4.608 kB</div><div class="line">Step 1/18 : FROM debian:jessie</div><div class="line"> ---&gt; 73e72bf822ca</div><div class="line">Step 2/18 : RUN groupadd -r mongodb &amp;&amp; useradd -r -g mongodb mongodb</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; 0f6297900a5e</div><div class="line">Step 3/18 : RUN apt-get update 	&amp;&amp; apt-get install -y --no-install-recommends 		numactl 	&amp;&amp; rm -rf /var/lib/apt/lists/*</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; a465f2e906<span class="built_in">fc</span></div><div class="line">Step 4/18 : ENV GOSU_VERSION 1.7</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; d448ddca2126</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="ya-bian-squash-jing-xiang-shi-yan-jie-duan"><a href="#&#x538B;&#x6241;-squash-&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;" class="headerlink" title="&#x538B;&#x6241;(squash)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;"></a>&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09; <a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E;&#x603B;&#x662F;&#x628A; <code>Dockerfile</code> &#x5F53;&#x505A; <code>bash</code> &#x6587;&#x4EF6;&#x6765;&#x7528;&#x7684;&#x4EBA;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5F88;&#x5FEB;&#x7531;&#x4E8E;&#x592A;&#x591A;&#x7684; <code>RUN</code> &#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x6709;&#x7279;&#x522B;&#x591A;&#x7684;&#x5C42;&#xFF0C;&#x955C;&#x50CF;&#x8D85;&#x7EA7;&#x81C3;&#x80BF;&#xFF0C;&#x800C;&#x4E14;&#x751A;&#x81F3;&#x4F1A;&#x78B0;&#x5230;&#x8D85;&#x51FA;&#x6700;&#x5927;&#x5C42;&#x6570;&#x9650;&#x5236;&#x7684;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E9B;&#x4EBA;&#x5F80;&#x5F80;&#x4E0D;&#x4ECE;&#x81EA;&#x8EAB;&#x627E;&#x95EE;&#x9898;&#xFF0C;&#x53CD;&#x800C;&#x53BB;&#x5BFB;&#x627E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#xFF0C;&#x6BD4;&#x5982;&#x5BFC;&#x51FA;&#x955C;&#x50CF;&#x505A;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5BFC;&#x5165;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x5F88;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x5BFC;&#x81F4;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x5931;&#x8D25;&#x5916;&#xFF0C;&#x8FD8;&#x5BFC;&#x81F4; <code>docker history</code> &#x4E22;&#x5931;&#xFF0C;&#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x53D8;&#x4E3A;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x3002;&#x5176;&#x5B9E;&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x9075;&#x5FAA; <code>Dockerfile</code> &#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x591A;&#x4E2A;&#x547D;&#x4EE4;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A; <code>RUN</code>&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A; <code>RUN</code> &#x8981;&#x7CBE;&#x5FC3;&#x8BBE;&#x8BA1;&#xFF0C;&#x786E;&#x4FDD;&#x5B89;&#x88C5;&#x6784;&#x5EFA;&#x6700;&#x540E;&#x8FDB;&#x884C;&#x6E05;&#x7406;&#x3002;&#x8FD9;&#x6837;&#x624D;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x955C;&#x50CF;&#x4F53;&#x79EF;&#xFF0C;&#x4EE5;&#x53CA;&#x6700;&#x5927;&#x5316;&#x7684;&#x5229;&#x7528;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x3002;</p>
<p>&#x5728; Docker 1.13 &#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x8FD9;&#x7FA4;&#x7528;&#x6237;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; <code>--squash</code> &#x53C2;&#x6570;&#x7ED9; <code>docker build</code>&#xFF0C;&#x5176;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;&#x5C06; <code>Dockerfile</code> &#x4E2D;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x538B;&#x7F29;&#x4E3A;&#x4E00;&#x5C42;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x4E0E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x4FDD;&#x7559;&#x4E86; <code>docker history</code>&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5982;&#x4E0B;&#x7684; <code>Dockerfile</code>&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> busybox</div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> hello &gt; /hello</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> world &gt;&gt; /hello</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> touch remove_me /remove_me</span></div><div class="line"><span class="keyword">ENV</span> HELLO world</div><div class="line"><span class="keyword">RUN</span><span class="bash"> rm /remove_me</span></div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6B63;&#x5E38;&#x7684;&#x6784;&#x5EFA;&#x7684;&#x8BDD;&#xFF0C;&#x6BD4;&#x5982; <code>docker build -t my-not-squash .</code>&#xFF0C;&#x5176; <code>history</code> &#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="built_in">history</span> my-not-squash</div><div class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</div><div class="line">305297a526e2        About a minute ago   /bin/sh -c rm /remove_me                        0 B</div><div class="line">60b8e896d443        About a minute ago   /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></div><div class="line">a21f3c75b6b0        About a minute ago   /bin/sh -c touch remove_me /remove_me           0 B</div><div class="line">038bca5b58cb        About a minute ago   /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 12 B</div><div class="line">f81b1006f556        About a minute ago   /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  6 B</div><div class="line">e02e811dd08f        5 weeks ago          /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></div><div class="line">&lt;missing&gt;           5 weeks ago          /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></div></pre></td></tr></table></figure>
<p>&#x800C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7528; <code>--squash</code> &#x6784;&#x5EFA;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t mysquash --squash .</div></pre></td></tr></table></figure>
<p>&#x5176; <code>history</code> &#x5219;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="built_in">history</span> mysquash</div><div class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</div><div class="line">a557e397ff56        15 seconds ago                                                      12 B                merge sha256:305297a526e218e77f1b4b273442f8ac6283e2907e6513ff36e9048aa130dea6 to sha256:e02e811dd08fd49e7f6032625495118e63f597eb150403d02e3238af1df240ba</div><div class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c rm /remove_me                        0 B</div><div class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></div><div class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c touch remove_me /remove_me           0 B</div><div class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 0 B</div><div class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  0 B</div><div class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></div><div class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x5C42;&#x7684;&#x5C42;ID&#x90FD; <code>&lt;missing&gt;</code> &#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x591A;&#x4E86;&#x4E00;&#x5C42; <code>merge</code>&#x3002;</p>
<p><strong>&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x89E3;&#x51B3;&#x61D2;&#x60F0;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x64B0;&#x5199; Dockerfile &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F9D;&#x65E7;&#x9700;&#x8981;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4E0D;&#x8981;&#x8BD5;&#x56FE;&#x7528;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x53BB;&#x538B;&#x7F29;&#x955C;&#x50CF;&#x3002;</strong></p>
<h1 id="an-zhuang"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5; <a href="#an-zhuang" class="header-anchor">#</a></h1><h2 id="jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti"><a href="#&#x89E3;&#x51B3;-GFW-&#x5F71;&#x54CD;-Docker-&#x5B89;&#x88C5;&#x95EE;&#x9898;" class="headerlink" title="&#x89E3;&#x51B3; GFW &#x5F71;&#x54CD; Docker &#x5B89;&#x88C5;&#x95EE;&#x9898;"></a>&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898; <a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti" class="header-anchor">#</a></h2><p>&#x5B98;&#x65B9;&#x7684; <code>apt</code>/<code>yum</code> &#x6E90;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>AWS</code> &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x5B89;&#x5168;&#x4F7F;&#x7528;&#x4E86; <code>HTTPS</code>&#xFF0C;&#x56E0;&#x6B64;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x5F88;&#x4E50;&#x4E8E;&#x5E72;&#x6270;&#x5927;&#x5BB6;&#x4F7F;&#x7528;&#x3002;&#x6CA1;&#x529E;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5404;&#x4E2A;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7EB7;&#x7EB7;&#x5EFA;&#x7ACB;&#x81EA;&#x5DF1;&#x5B98;&#x65B9;&#x6E90;&#x955C;&#x50CF;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x3001;DaoCloud&#x3001;Azura &#x7B49;&#x7B49;&#xFF0C;&#x5E76;&#x4E14;&#x81EA;&#x5DF1;&#x505A;&#x4E86;&#x4E2A;&#x4FEE;&#x8BA2;&#x7248;&#x7684; <code>https://get.docker.com</code> &#x7684;&#x811A;&#x672C;&#x6765;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x5B98;&#x65B9;&#x7684; <code>https://get.docker.com</code> &#x5C06;&#x652F;&#x6301; <code>--mirror</code> &#x53C2;&#x6570;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x6E90;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x6301;&#x5FAE;&#x8F6F;&#x7684; Azure &#x4E91;&#xFF0C;&#xFF08;<a href="https://github.com/docker/docker/pull/28858" target="_blank" rel="external">&#x6216;&#x963F;&#x91CC;&#x4E91;&#xFF1F;</a>&#xFF09;&#x3002;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL https://get.docker.com/ | sh</div></pre></td></tr></table></figure>
<p>&#x66FF;&#x6362;&#x4E3A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL https://get.docker.com/ | sh <span class="_">-s</span> -- --mirror AzureChinaCloud</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x662F;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x8BDD;&#xFF0C;&#x5C06; <code>AzureChinaCloud</code> &#x66FF;&#x6362;&#x4E3A; <code>Aliyun</code>&#x3002;</p>
<p><em>&#x6B64;&#x65F6;&#xFF0C;<a href="https://get.docker.com/" target="_blank" rel="external">https://get.docker.com/</a> &#x5C1A;&#x672A;&#x66F4;&#x65B0;&#xFF0C;&#x6240;&#x4EE5;&#x6682;&#x65F6;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5728; 1.13 &#x6B63;&#x5F0F;&#x53D1;&#x5E03;&#x540E;&#xFF0C;&#x5373;&#x53EF;&#x4F7F;&#x7528;&#x3002;</em></p>
<h2 id="zeng-jia-geng-duo-de-xi-tong-zhi-chi"><a href="#&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;" class="headerlink" title="&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;"></a>&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301; <a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi" class="header-anchor">#</a></h2><p>&#x5728;&#x8FD9;&#x6B21;&#x53D1;&#x5E03;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <code>Ubuntu 16.10</code> &#x7684;&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x800C;&#x4E14;&#x5BF9; <code>Ubuntu</code> &#x7CFB;&#x7EDF;&#x589E;&#x52A0;&#x4E86; <code>PPC64LE</code> &#x548C; <code>s390x</code> &#x6784;&#x67B6;&#x7684;&#x5B89;&#x88C5;&#x5305;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x4E86; <code>VMWare Photon OS</code> &#x7CFB;&#x7EDF;&#x7684; <code>RPM</code> &#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x4EE5;&#x53CA;&#x5728; <code>https://get.docker.com</code> &#x7684;&#x652F;&#x6301;&#x3002;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x4E86; <code>Fedora 25</code>&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x7ED3;&#x675F;&#xFF0C;&#x800C;&#x88AB;&#x79FB;&#x9664;&#x652F;&#x6301;&#xFF0C;&#x6BD4;&#x5982; <code>Ubuntu 15.10</code>&#x3001;<code>Fedora 22</code> &#x90FD;&#x4E0D;&#x5728;&#x652F;&#x6301;&#x4E86;&#x3002;</p>
<h1 id="wang-luo"><a href="#&#x7F51;&#x7EDC;" class="headerlink" title="&#x7F51;&#x7EDC;"></a>&#x7F51;&#x7EDC; <a href="#wang-luo" class="header-anchor">#</a></h1><h2 id="yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo"><a href="#&#x5141;&#x8BB8;-docker-run-&#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684;-swarm-mode-&#x7684;&#x7F51;&#x7EDC;" class="headerlink" title="&#x5141;&#x8BB8; docker run &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684;&#x7F51;&#x7EDC;"></a>&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC; <a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo" class="header-anchor">#</a></h2><p>&#x5728; Docker 1.12 &#x53D1;&#x5E03;&#x65B0;&#x7684; Swarm Mode &#x4E4B;&#x540E;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x95EE;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; <code>docker run</code> &#x8FDE;&#x5165;&#x670D;&#x52A1;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E2D;&#x53BB;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#xFF0C;&#x56E0;&#x4E3A; <code>swarm</code> &#x7684; <code>overaly</code> &#x662F;&#x4E3A;&#x4E86; <code>swarm service</code> &#x51C6;&#x5907;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x66F4;&#x5065;&#x58EE;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker run</code>&#xFF0C;&#x4F1A;&#x7834;&#x574F;&#x4E86;&#x8FD9;&#x91CC;&#x9762;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5927;&#x5BB6;&#x9700;&#x6C42;&#x5F88;&#x591A;&#xFF0C;&#x4E8E;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x6298;&#x8877;&#x7684;&#x529E;&#x6CD5;&#x3002;1.13 &#x5141;&#x8BB8;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BBE;&#x5B9A;&#x8BE5;&#x7F51;&#x7EDC;&#x4E3A; <code>attachable</code>&#xFF0C;&#x5141;&#x8BB8;&#x4E4B;&#x540E;&#x7684; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x5230;&#x8BE5;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0D;&#x5141;&#x8BB8;&#x4E4B;&#x540E; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker network create <span class="_">-d</span> overlay mynet1</div><div class="line">xmgoco2vfrtp0ggc5r0p5z4mg</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5141;&#x8BB8; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x4F7F;&#x7528; 1.13 &#x65B0;&#x52A0;&#x5165;&#x7684; <code>--attachable</code> &#x53C2;&#x6570;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker network create <span class="_">-d</span> overlay --attachable mynet2</div><div class="line">yvcyhoc6ni0436jux9azc4cjt</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x4E00;&#x4E2A; <code>web</code> &#x670D;&#x52A1;&#xFF0C;&#x8FDE;&#x5165;&#x8FD9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ docker service create \</div><div class="line">    --name web \</div><div class="line">    --network mynet1 \</div><div class="line">    --network mynet2 \</div><div class="line">    nginx</div><div class="line">vv91wd7166y80lbl833rugl2z</div></pre></td></tr></table></figure>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528; <code>docker run</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker run -it --rm --network mynet1 busybox</div><div class="line">docker: Error response from daemon: Could not attach to network mynet1: rpc error: code = 7 desc = network mynet1 not manually attachable.</div></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E; <code>mynet1</code> &#x4E0D;&#x5141;&#x8BB8;&#x624B;&#x52A8; <code>attach</code> &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x62A5;&#x9519;&#x4E86;&#x3002;</p>
<p>&#x5728; 1.12 &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F1A;&#x62A5;&#x544A;&#x8BE5;&#x7F51;&#x7EDC;&#x65E0;&#x6CD5;&#x7ED9; <code>docker run</code> &#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker: Error response from daemon: swarm-scoped network (mynet1) is not compatible with `docker create` or `docker run`. This network can only be used by a docker service.</div><div class="line">See <span class="string">&apos;docker run --help&apos;</span>.</div></pre></td></tr></table></figure>
<p><strong>&#x4E0D;&#x8FC7;&#xFF0C;<code>--attachable</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;&#x7F51;&#x7EDC;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x6253;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x7F3A;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;&#x7528;&#x6237;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#x3002;</strong></p>
<h2 id="yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou"><a href="#&#x5141;&#x8BB8;-docker-service-create-&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;" class="headerlink" title="&#x5141;&#x8BB8; docker service create &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;"></a>&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3; <a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;<code>docker service create</code> &#x4E2D;&#x7684; <code>--publish</code> &#x5C06;&#x6539;&#x4E3A; <code>--port</code>&#xFF08;&#x7F29;&#x5199;&#x8FD8;&#x662F; <code>-p</code> &#x4E0D;&#x53D8;&#xFF09;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5BF9;&#x6620;&#x5C04;&#x5F00;&#x653E;&#x7AEF;&#x53E3;&#x6709;&#x4E86;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x539F;&#x6765;&#x7684; <code>--publish 1234:1234</code> &#x7684;&#x683C;&#x5F0F;&#x5DF2;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x5728; 1.12 &#x4E2D;&#xFF0C;<code>docker service create</code> &#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x53C2;&#x6570; <code>--publish 80:80</code> &#x8FD9;&#x7C7B;&#x5F62;&#x5F0F;&#x6620;&#x5C04;<strong>&#x8FB9;&#x754C;(ingress)&#x7F51;&#x7EDC;</strong>&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6620;&#x5C04;&#x4F1A;&#x4EAB;&#x53D7;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4EE5;&#x53CA; routing mesh&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x53E6;&#x4E00;&#x79CD;&#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF0C;&#x88AB;&#x79F0;&#x4E3A; <code>host</code> &#x6A21;&#x5F0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7528;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x6620;&#x5C04;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x53EA;&#x4F1A;&#x6620;&#x5C04;&#x4E8E;&#x5BB9;&#x5668;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x3002;&#x8FD9;&#x5C31;&#x548C;&#x4E00;&#x4EE3; Swarm &#x4E2D;&#x4E00;&#x6837;&#x4E86;&#x3002;&#x867D;&#x7136;&#x5931;&#x53BB;&#x4E86;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9A;&#x4E86;&#x6620;&#x5C04;&#x70B9;&#xFF0C;&#x6709;&#x7684;&#x65F6;&#x5019;&#x66F4;&#x65B9;&#x4FBF;&#x7BA1;&#x7406;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x65B0;&#x7684; <code>--port</code> &#x7684;&#x53C2;&#x6570;&#x5F62;&#x5F0F;&#x548C; <code>--mount</code> &#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x53C2;&#x6570;&#x503C;&#x4E3A; <code>,</code> &#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x952E;&#x503C;&#x95F4;&#x4EE5; <code>=</code> &#x7B49;&#x53F7;&#x5206;&#x9694;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301; 4 &#x9879;&#x5185;&#x5BB9;&#xFF1A;</p>
<ul>
<li><code>protocol</code>&#xFF1A; &#x652F;&#x6301; <code>tcp</code> &#x6216;&#x8005; <code>udp</code></li>
<li><code>mode</code>&#xFF1A; &#x652F;&#x6301; <code>ingress</code> &#x6216;&#x8005; <code>host</code></li>
<li><code>target</code>&#xFF1A; &#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
<li><code>published</code>&#xFF1A; &#x6620;&#x5C04;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
</ul>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E0E; <code>-p 8080:80</code> &#x7B49;&#x6548;&#x7684; <code>--port</code> &#x9009;&#x9879;&#x4E3A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">--port protocol=tcp,mode=ingress,published=8080,target=80</div></pre></td></tr></table></figure>
<p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; <code>-p 8080:80</code>&#xFF0C;&#x4F46;&#x662F;&#x65B0;&#x7684;&#x9009;&#x9879;&#x683C;&#x5F0F;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x80FD;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F7F;&#x7528; 1.13 &#x5F00;&#x59CB;&#x52A0;&#x5165;&#x7684; <code>host</code> &#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ubuntu@d1:~$ docker service create --name web \</div><div class="line">    --port mode=host,published=80,target=80 \</div><div class="line">    nginx</div></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ubuntu@d1:~$ docker node ls</div><div class="line">ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS</div><div class="line">ntjybj51u6zp44akeawuf3i05    d2        Ready   Active</div><div class="line">tp7icvjzvxla2n18j3nztgjz6    d3        Ready   Active</div><div class="line">vyf3mgcj3uonrnh5xxquasp38 *  d1        Ready   Active        Leader</div><div class="line">ubuntu@d1:~$ docker service ps web</div><div class="line">NAME                IMAGE         NODE  DESIRED STATE  CURRENT STATE               ERROR  PORTS</div><div class="line">web.1.ey0mw8o8h2tx  nginx:latest  d3    Running        Running about a minute ago</div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x96C6;&#x7FA4;&#x6709;3&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x5C31;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x8DD1;&#x5230;&#x4E86; <code>d3</code> &#x4E0A;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x4EE5;&#x524D;&#x7684;&#x4F7F;&#x7528;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x7F51;&#x7EDC; <code>ingress</code> &#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#x90FD;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;<code>host</code> &#x6A21;&#x5F0F;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x53EA;&#x6620;&#x5C04;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC; <code>curl d1</code> &#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x4EC0;&#x4E48;&#x770B;&#x4E0D;&#x5230;&#x7F51;&#x9875;&#xFF0C;&#x800C; <code>curl d3</code> &#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@d1:~$ curl localhost</div><div class="line">curl: (7) Failed to connect to localhost port 80: Connection refused</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">root@d3:~$ curl localhost</div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><a href="#iptables-&#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;" class="headerlink" title="iptables &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;"></a><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD; <a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue" class="header-anchor">#</a></h2><p>&#x4ECE;&#x9ED8;&#x8BA4;&#x5141;&#x8BB8;&#x6539;&#x4E3A;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x5BB9;&#x5668;&#x5916;&#x9732;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<h2 id="zai-docker-network-inspect-li-xian-shi-lian-ru-jie-dian"><a href="#&#x5728;-docker-network-inspect-&#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9;" class="headerlink" title="&#x5728; docker network inspect &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9;"></a>&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9; <a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-jie-dian" class="header-anchor">#</a></h2><p>Show peer nodes in docker network inspect for swarm overlay networks #28078</p>
<h2 id="yun-xu-service-vip-ke-yi-bei-ping"><a href="#&#x5141;&#x8BB8;-service-VIP-&#x53EF;&#x4EE5;&#x88AB;-ping" class="headerlink" title="&#x5141;&#x8BB8; service VIP &#x53EF;&#x4EE5;&#x88AB; ping"></a>&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code> <a href="#yun-xu-service-vip-ke-yi-bei-ping" class="header-anchor">#</a></h2><p>&#x5728; 1.12 &#x7684;&#x4E8C;&#x4EE3; Swarm &#x6392;&#x969C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x8DE8;&#x8282;&#x70B9;&#x7684;&#x670D;&#x52A1; VIP &#x4E0D;&#x53EF;&#x4EE5; <code>ping</code>&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x641E;&#x4E0D;&#x61C2;&#x662F; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E0D;&#x901A;&#x5462;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x6CA1;&#x8D77;&#x6765;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6709;&#x95EE;&#x9898;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728; 1.13 &#x89E3;&#x51B3;&#x4E86;&#xFF0C;VIP &#x53EF;&#x4EE5;&#x968F;&#x4FBF; <code>ping</code>&#xFF0C;&#x8DE8;&#x5BBF;&#x4E3B;&#x4E5F;&#x6CA1;&#x5173;&#x7CFB;&#x3002;</p>
<h1 id="cha-jian"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6; <a href="#cha-jian" class="header-anchor">#</a></h1><h2 id="cha-jian-gong-neng-zheng-shi-qi-yong"><a href="#&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;" class="headerlink" title="&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;"></a>&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528; <a href="#cha-jian-gong-neng-zheng-shi-qi-yong" class="header-anchor">#</a></h2><p>&#x5728; 1.12 &#x5F15;&#x5165;&#x4E86;&#x63D2;&#x4EF6;&#x6982;&#x5FF5;&#x540E;&#xFF0C;&#x4F5C;&#x4E3A;&#x8BD5;&#x9A8C;&#x7279;&#x6027;&#x5F97;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5173;&#x6CE8;&#x3002;&#x5305;&#x62EC;&#x670D;&#x52A1;&#x7AEF;&#x7684; <a href="https://store.docker.com/" target="_blank" rel="external">Docker Store</a> &#x5F00;&#x59CB;&#x51C6;&#x5907;&#x4E0A;&#x7EBF;&#xFF0C;&#x4EE5;&#x53CA;&#x7B2C;&#x4E09;&#x65B9;&#x7684;&#x63D2;&#x4EF6;&#x7684;&#x5F00;&#x53D1;&#x3002;&#x73B0;&#x5728; 1.13 &#x63D2;&#x4EF6;&#x4F5C;&#x4E3A;&#x6B63;&#x5F0F;&#x529F;&#x80FD;&#x63D0;&#x4F9B;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$ docker plugin</div><div class="line"></div><div class="line">Usage:	docker plugin COMMAND</div><div class="line"></div><div class="line">Manage plugins</div><div class="line"></div><div class="line">Options:</div><div class="line">      --help   Print usage</div><div class="line"></div><div class="line">Commands:</div><div class="line">  create      Create a plugin from a rootfs and config</div><div class="line">  <span class="built_in">disable</span>     Disable a plugin</div><div class="line">  <span class="built_in">enable</span>      Enable a plugin</div><div class="line">  inspect     Display detailed information on one or more plugins</div><div class="line">  install     Install a plugin</div><div class="line">  ls          List plugins</div><div class="line">  push        Push a plugin to a registry</div><div class="line">  rm          Remove one or more plugins</div><div class="line">  <span class="built_in">set</span>         Change settings <span class="keyword">for</span> a plugin</div><div class="line"></div><div class="line">Run <span class="string">&apos;docker plugin COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p>&#x76F8;&#x6BD4;&#x4E8E; 1.12 &#x7684;&#x8BD5;&#x9A8C;&#x7248;&#x672C;&#x800C;&#x8A00;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <code>docker plugin create</code> &#x547D;&#x4EE4;&#xFF0C;&#x6307;&#x5B9A; <code>rootfs</code> &#x548C; <code>config.json</code> &#x5373;&#x53EF;&#x521B;&#x5EFA;&#x63D2;&#x4EF6;&#x3002;</p>
<h1 id="ming-ling-xing"><a href="#&#x547D;&#x4EE4;&#x884C;" class="headerlink" title="&#x547D;&#x4EE4;&#x884C;"></a>&#x547D;&#x4EE4;&#x884C; <a href="#ming-ling-xing" class="header-anchor">#</a></h1><h2 id="shi-yan-checkpoint-gong-neng"><a href="#&#x8BD5;&#x9A8C;-checkpoint-&#x529F;&#x80FD;" class="headerlink" title="&#x8BD5;&#x9A8C; checkpoint &#x529F;&#x80FD;"></a>&#x8BD5;&#x9A8C; <code>checkpoint</code> &#x529F;&#x80FD; <a href="#shi-yan-checkpoint-gong-neng" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x5C06;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x4FDD;&#x5B58; checkpoint&#xFF0C;&#x5728;&#x5C06;&#x6765;&#x53EF;&#x4EE5; restore&#x3002;&#x56E0;&#x6B64;&#x5F15;&#x5165; <code>docker checkpoint</code> &#x547D;&#x4EE4;&#x3002;</p>
<p>(experimental) Implement checkpoint and restore #22049</p>
<h1 id="yun-xing-shi"><a href="#&#x8FD0;&#x884C;&#x65F6;" class="headerlink" title="&#x8FD0;&#x884C;&#x65F6;"></a>&#x8FD0;&#x884C;&#x65F6; <a href="#yun-xing-shi" class="header-anchor">#</a></h1><h2 id="bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu"><a href="#&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;-experimental-&#x53C2;&#x6570;" class="headerlink" title="&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; --experimental &#x53C2;&#x6570;"></a>&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570; <a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu" class="header-anchor">#</a></h2><p>&#x4EE5;&#x524D;&#x6211;&#x4EEC;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x6D4B;&#x8BD5;&#x5F53;&#x524D;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x5FC5;&#x987B;&#x6DFB;&#x52A0;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x6E90;&#xFF0C;&#x91CD;&#x88C5; <code>docker</code>&#x3002;&#x8FD9;&#x7ED9;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x5E26;&#x6765;&#x4E86;&#x56F0;&#x96BE;&#x3002;&#x73B0;&#x5728;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x4E0D;&#x5728;&#x5206;&#x4E3A;&#x4E24;&#x7EC4;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6784;&#x5EFA;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x76F4;&#x63A5;&#x5728; <code>dockerd</code> &#x540E;&#x6DFB;&#x52A0; <code>--experimental</code> &#x5373;&#x53EF;&#x3002;</p>
<h2 id="zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e"><a href="#&#x5728;-overlay2-&#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E;-xfs-&#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;" class="headerlink" title="&#x5728; overlay2 &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; xfs &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;"></a>&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D; <a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e" class="header-anchor">#</a></h2><p>&#x5728; 1.13 &#x4E4B;&#x524D;&#xFF0C;&#x53EA;&#x6709;&#x5757;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9A71;&#x52A8;&#xFF08;&#x5982; <code>devicemapper</code>, <code>xfs</code>, <code>zfs</code>&#x7B49;&#xFF09;&#x652F;&#x6301;&#x78C1;&#x76D8;&#x914D;&#x989D;&#x80FD;&#x529B;&#xFF0C;&#x800C;&#x6240;&#x6709; <code>Union FS</code> &#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x914D;&#x989D;&#x3002;&#x73B0;&#x5728;&#x9488;&#x5BF9;&#x4F7F;&#x7528; <code>XFS</code> &#x4E3A;&#x540E;&#x7AEF;&#x7684; <code>overlay2</code> &#x9A71;&#x52A8;&#x652F;&#x6301;&#x4E86;&#x78C1;&#x76D8;&#x914D;&#x989D;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x5C06;&#x6765;&#x79FB;&#x690D;&#x5230; <code>AUFS</code>&#x3002;</p>
<h2 id="zeng-jia-docker-system-ming-ling"><a href="#&#x589E;&#x52A0;-docker-system-&#x547D;&#x4EE4;" class="headerlink" title="&#x589E;&#x52A0; docker system &#x547D;&#x4EE4;"></a>&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4; <a href="#zeng-jia-docker-system-ming-ling" class="header-anchor">#</a></h2><p>&#x5F88;&#x591A;&#x4EBA;&#x5728;&#x4EE5;&#x524D;&#x641E;&#x4E0D;&#x61C2;&#x81EA;&#x5DF1;&#x7684;&#x955C;&#x50CF;&#x5230;&#x5E95;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3001;&#x5BB9;&#x5668;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#xFF0C;&#x5377;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3002;&#x600E;&#x4E48;&#x5220;&#x9664;&#x4E0D;&#x7528;&#x7684;&#x4E1C;&#x897F;&#x4EE5;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>system</code> &#x547D;&#x4EE4;&#x6765;&#x5E2E;&#x52A9;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ docker system</div><div class="line"></div><div class="line">Usage:	docker system COMMAND</div><div class="line"></div><div class="line">Manage Docker</div><div class="line"></div><div class="line">Options:</div><div class="line">     --help   Print usage</div><div class="line"></div><div class="line">Commands:</div><div class="line"> df          Show docker disk usage</div><div class="line"> events      Get real time events from the server</div><div class="line"> info        Display system-wide information</div><div class="line"> prune       Remove unused data</div><div class="line"></div><div class="line">Run <span class="string">&apos;docker system COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p><code>docker system df</code> &#x662F;&#x663E;&#x793A;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker system df</div><div class="line">TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE</div><div class="line">Images              3                   3                   700.3 MB            123 MB (17%)</div><div class="line">Containers          3                   3                   15 B                0 B (0%)</div><div class="line">Local Volumes       1                   1                   219.4 MB            0 B (0%)</div></pre></td></tr></table></figure>
<p>&#x663E;&#x793A;&#x7684;&#x5217;&#x8868;&#x4E2D;&#x5217;&#x51FA;&#x4E86;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x672C;&#x5730;&#x5377;&#x6240;&#x5360;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x80FD;&#x56DE;&#x6536;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x955C;&#x50CF;&#x6709; 123MB &#x7684;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x56DE;&#x6536;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;<code>docker</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>prune</code> &#x547D;&#x4EE4;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li><code>docker image prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;</li>
<li><code>docker container prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5BB9;&#x5668;</li>
<li><code>docker volume prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5377;</li>
<li><code>docker network prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x7F51;&#x7EDC;</li>
<li><code>docker system prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x5377;&#x3001;&#x7F51;&#x7EDC;</li>
</ul>
<p>&#x8FD8;&#x8BB0;&#x5F97;&#x4E4B;&#x524D;&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x6240;&#x7528;&#x7684; <code>docker rmi $(docker images -f dangling=true -aq)</code> &#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#x4E48;&#xFF1F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730; <code>docker image prune</code> &#x5373;&#x53EF;&#x5220;&#x9664;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x4ECE;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x547D;&#x4EE4;&#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x4E86;&#x3002;&#x4E4B;&#x524D;&#x9ED8;&#x8BA4;&#x7684; <code>docker info</code>&#xFF0C;<code>docker ps</code>&#xFF0C;<code>docker rm</code>&#xFF0C;<code>docker run</code> &#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5BF9;&#x5E94;&#x7684; <code>docker image</code>, <code>docker container</code>, <code>docker system</code> &#x4E0B;&#x4E86;&#x3002;&#x76EE;&#x524D;&#x4E4B;&#x524D;&#x7684;&#x547D;&#x4EE4;&#x4F9D;&#x65E7;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x4F1A;&#x7EE7;&#x7EED;&#x4FDD;&#x6301;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x662F;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x7684;&#x7248;&#x672C;&#x4E86;&#x3002;</p>
<h2 id="ti-sheng-overlay2-de-you-xian-ji"><a href="#&#x63D0;&#x5347;-overlay2-&#x7684;&#x4F18;&#x5148;&#x7EA7;" class="headerlink" title="&#x63D0;&#x5347; overlay2 &#x7684;&#x4F18;&#x5148;&#x7EA7;"></a>&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7; <a href="#ti-sheng-overlay2-de-you-xian-ji" class="header-anchor">#</a></h2><p>&#x7531;&#x4E8E; <code>overlay2</code> &#x5728; 4.+ &#x5185;&#x6838;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;&#x8D8B;&#x4E8E;&#x7A33;&#x5B9A;&#xFF0C;&#x56E0;&#x6B64;&#x5C06;&#x5176;&#x4F18;&#x5148;&#x7EA7;&#x63D0;&#x5230; <code>devicemapper</code> &#x4E4B;&#x4E0A;&#xFF08;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#x7684;&#x4F9D;&#x65E7;&#x662F; <code>aufs</code>&#xFF09;</p>
<h2 id="docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><a href="#docker-exec-t-&#x81EA;&#x52A8;&#x6DFB;&#x52A0;-TERM-&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="headerlink" title="docker exec -t &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;"></a><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF; <a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528; <code>vi</code>&#x3001;<code>htop</code> &#x4E4B;&#x7C7B;&#x5DE5;&#x5177;&#x7684;&#x4EBA;&#x6765;&#x8BF4;&#x662F;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x7684;&#x3002;&#x4E4B;&#x524D;&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5B9A;&#x4E49; <code>TERM</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x9700;&#x8981;&#x7EC8;&#x7AEF;&#x9875;&#x9762;&#x5E03;&#x5C40;&#x7684;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x53EF;&#x80FD;&#x4F1A;&#x4E0D;&#x6B63;&#x5E38;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ htop</div><div class="line">Error opening terminal: unknown.</div></pre></td></tr></table></figure>
<p>&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x4E3A; <code>docker exec -t</code> &#x9009;&#x9879;&#x6DFB;&#x52A0;&#x4E86;&#x7EE7;&#x627F;&#x81EA;&#x5F53;&#x524D;&#x7684; <code>TERM</code> &#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;&#x7C7B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x3002;</p>
<h1 id="swarm-mode"><a href="#Swarm-Mode" class="headerlink" title="Swarm Mode"></a>Swarm Mode <a href="#swarm-mode" class="header-anchor">#</a></h1><h2 id="zheng-shi-zhi-chi-docker-stack"><a href="#&#x6B63;&#x5F0F;&#x652F;&#x6301;-docker-stack" class="headerlink" title="&#x6B63;&#x5F0F;&#x652F;&#x6301; docker stack"></a>&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code> <a href="#zheng-shi-zhi-chi-docker-stack" class="header-anchor">#</a></h2><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code>&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x76F4;&#x63A5;&#x4ECE; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x4E8C;&#x4EE3; Swarm &#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x3002;</p>
<p>1.12 &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F; Swarm Mode&#x3002;&#x7531;&#x4E8E;&#x57FA;&#x7840;&#x7406;&#x5FF5;&#x53D8;&#x5316;&#x5F88;&#x5927;&#xFF0C;&#x56E0;&#x6B64;&#x5148;&#x884C;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x57FA;&#x672C;&#x7684;&#x670D;&#x52A1;(<code>service</code>)&#xFF0C;&#x4F46;&#x662F;&#x9488;&#x5BF9;&#x5E94;&#x7528;/&#x670D;&#x52A1;&#x6808;(<code>stack</code>)&#x6CA1;&#x6709;&#x6210;&#x719F;&#x7684;&#x65B9;&#x6848;&#x3002;&#x53EA;&#x662F;&#x8BD5;&#x884C;&#x4F7F;&#x7528; <code>DAB</code> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x3002;&#x4F46;&#x662F; <code>DAB</code> &#x662F; <code>JSON</code> &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x64B0;&#x5199;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#x3002;&#x76F8;&#x5BF9;&#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x7684; <code>docker-compose.yml</code> &#x5374;&#x65E0;&#x6CD5;&#x5728; <code>docker stack</code> &#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;&#x53EA;&#x53EF;&#x4EE5;&#x7528; <code>docker-compose bundle</code> &#x547D;&#x4EE4;&#x5C06; <code>docker-compose.yml</code> &#x8F6C;&#x6362;&#x4E3A; <code>.dab</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x62FF;&#x5230;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x7528;&#x4E0D;&#x4E86;&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#xFF0C;&#x5927;&#x5927;&#x65B9;&#x4FBF;&#x4E86;&#x4E60;&#x60EF;&#x4E86; <code>docker compose</code> &#x7684;&#x7528;&#x6237;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x6982;&#x5FF5;&#x5DEE;&#x5F02;&#xFF0C;&#x539F;&#x6709;&#x7684; <code>docker-compose.yml</code> <code>v2</code> &#x683C;&#x5F0F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>v3</code> &#x683C;&#x5F0F;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F; <code>v3</code> &#x548C; <code>v2</code> &#x683C;&#x5F0F;&#x5DEE;&#x8DDD;&#x4E0D;&#x5927;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x663E;&#x7136;&#x7B2C;&#x4E00;&#x884C;&#x7684; <code>version: &apos;2&apos;</code> &#x9700;&#x8981;&#x6362;&#x6210; <code>version: &apos;3&apos;</code>&#xFF0C;&#x5176;&#x6B21;&#xFF0C;&#x670D;&#x52A1;&#x91CC;&#x7684; <code>build</code> &#x663E;&#x7136;&#x7528;&#x4E0D;&#x4E86;&#x4E86;&#x3002;&#x4EE5;&#x6211;&#x5199;&#x7684; LNMP &#x4E3A;&#x4F8B;&#xFF0C;&#x6539;&#x6210; <code>v3</code> &#x683C;&#x5F0F;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x662F;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">&apos;3&apos;</span></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">    nginx:</span></div><div class="line"><span class="attr">        image:</span> <span class="string">&quot;twang2218/lnmp-nginx:v1.2&quot;</span></div><div class="line"><span class="attr">        ports:</span></div><div class="line"><span class="bullet">            -</span> <span class="string">&quot;80:80&quot;</span></div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> frontend</div><div class="line"><span class="attr">        depends_on:</span></div><div class="line"><span class="bullet">            -</span> php</div><div class="line"><span class="attr">    php:</span></div><div class="line"><span class="attr">        image:</span> <span class="string">&quot;twang2218/lnmp-php:v1.2&quot;</span></div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> frontend</div><div class="line"><span class="bullet">            -</span> backend</div><div class="line"><span class="attr">        environment:</span></div><div class="line"><span class="attr">            MYSQL_PASSWORD:</span> Passw0rd</div><div class="line"><span class="attr">        depends_on:</span></div><div class="line"><span class="bullet">            -</span> mysql</div><div class="line"><span class="attr">    mysql:</span></div><div class="line"><span class="attr">        image:</span> mysql:<span class="number">5.7</span></div><div class="line"><span class="attr">        volumes:</span></div><div class="line"><span class="attr">            - mysql-data:</span>/var/lib/mysql</div><div class="line"><span class="attr">        environment:</span></div><div class="line"><span class="attr">            TZ:</span> <span class="string">&apos;Asia/Shanghai&apos;</span></div><div class="line"><span class="attr">            MYSQL_ROOT_PASSWORD:</span> Passw0rd</div><div class="line"><span class="attr">        command:</span> [<span class="string">&apos;mysqld&apos;</span>, <span class="string">&apos;--character-set-server=utf8&apos;</span>]</div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> backend</div><div class="line"><span class="attr">volumes:</span></div><div class="line"><span class="attr">    mysql-data:</span></div><div class="line"><span class="attr">networks:</span></div><div class="line"><span class="attr">    frontend:</span></div><div class="line"><span class="attr">    backend:</span></div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x5728; swarm &#x73AF;&#x5883;&#x90E8;&#x7F72;&#x8BE5;&#x670D;&#x52A1;&#x6808;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ docker stack deploy --compose-file docker-compose.yml lnmp</div><div class="line">Creating network lnmp_frontend</div><div class="line">Creating network lnmp_backend</div><div class="line">Creating network lnmp_default</div><div class="line">Creating service lnmp_mysql</div><div class="line">Creating service lnmp_nginx</div><div class="line">Creating service lnmp_php</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7528; <code>docker stack ls</code> &#x6216; <code>docker stack ps</code> &#x6765;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x6808;&#x72B6;&#x6001;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ docker stack ls</div><div class="line">NAME  SERVICES</div><div class="line">lnmp  3</div><div class="line">$ docker stack ps lnmp</div><div class="line">NAME                       IMAGE                      NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS</div><div class="line">lnmp_mysql.1.hfz88yeej0ve  mysql:5.7                  d2    Running        Running 9 seconds ago</div><div class="line">lnmp_php.1.kqk4xgr7ajn4    twang2218/lnmp-php:v1.2    d1    Running        Running 10 seconds ago</div><div class="line">lnmp_nginx.1.arrrnbuzgq9t  twang2218/lnmp-nginx:v1.2  d2    Running        Running 5 seconds ago</div></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F; <code>ingress</code> &#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x6620;&#x5C04;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6765;&#x67E5;&#x770B;&#x9875;&#x9762;&#xFF0C;&#x4EAB;&#x53D7;&#x4E8C;&#x4EE3; Swarm &#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x3002;</p>
<p>&#x5220;&#x6389; <code>stack</code>&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7B80;&#x5355;&#x5730; <code>docker stack rm lnmp</code> &#x5373;&#x53EF;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x547D;&#x540D;&#x5377;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5982;&#x9700;&#x5220;&#x9664;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7684;&#x53BB;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x8282;&#x70B9;&#x53BB; <code>docker volume rm</code> &#x5377;&#x3002;</p>
<h2 id="tian-jia-secret-guan-li"><a href="#&#x6DFB;&#x52A0;-secret-&#x7BA1;&#x7406;" class="headerlink" title="&#x6DFB;&#x52A0; secret &#x7BA1;&#x7406;"></a>&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406; <a href="#tian-jia-secret-guan-li" class="header-anchor">#</a></h2><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#x7BA1;&#x7406;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7B49;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">docker secret --help</div><div class="line"></div><div class="line">Usage:	docker secret COMMAND</div><div class="line"></div><div class="line">Manage Docker secrets</div><div class="line"></div><div class="line">Options:</div><div class="line">     --help   Print usage</div><div class="line"></div><div class="line">Commands:</div><div class="line"> create      Create a secret using stdin as content</div><div class="line"> inspect     Inspect a secret</div><div class="line"> ls          List secrets</div><div class="line"> rm          Remove a secret</div><div class="line"></div><div class="line">Run <span class="string">&apos;docker secret COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p><code>docker secret create</code> &#x4ECE;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x5165;&#x6307;&#x5B9A;&#x540D;&#x79F0;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="string">&quot;MySuperSecretPassword&quot;</span> | docker secret create mysql_password</div></pre></td></tr></table></figure>
<p>&#x5728;&#x5C06;&#x6765;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--secret</code> &#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x54EA;&#x4E9B; <code>secret</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$  docker service create --name privateweb --secret mysql_password nginx</div></pre></td></tr></table></figure>
<p>&#x6240;&#x6307;&#x5B9A;&#x7684; <code>secret</code> &#x4F1A;&#x4EE5;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x4E8E; <code>/var/run/secrets/</code> &#x76EE;&#x5F55;&#x4E0B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root@d5cec6381df8:/<span class="comment"># ls -al /var/run/secrets/</span></div><div class="line">total 8</div><div class="line">drwxrwxrwt 2 root root   60 Dec  6 03:16 .</div><div class="line">drwxr-xr-x 4 root root 4096 Dec  6 03:16 ..</div><div class="line">-r--r--r-- 1 root root   22 Dec  6 03:16 mysql_password</div></pre></td></tr></table></figure>
<p><code>secret</code> &#x7684;&#x6743;&#x9650;&#x662F; <code>444</code> &#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x975E; <code>root</code> &#x7528;&#x6237;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5176;&#x5185;&#x5BB9;&#xFF0C;&#x8BFB;&#x53D6;&#x6240;&#x9700;&#x7684;&#x5BC6;&#x7801;&#x6216;&#x8005;&#x5BC6;&#x94A5;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x975E; root &#x7528;&#x6237;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x5F88;&#x91CD;&#x8981;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@d5cec6381df8:/<span class="comment"># cat /var/run/secrets/mysql_password</span></div><div class="line">MySuperSecretPassword</div></pre></td></tr></table></figure>
<h2 id="tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi"><a href="#&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;"></a>&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301; <a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi" class="header-anchor">#</a></h2><p>Docker 1.10 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x7136;&#x540E;&#x5728; 1.11 &#x8FDB;&#x4E00;&#x6B65;&#x652F;&#x6301;&#x4E86; DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;1.12 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; VIP &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#x800C; 1.12 &#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86; <code>HEALTHCHECK</code> &#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x80FD;&#x529B;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E24;&#x7EC4;&#x529F;&#x80FD;&#x5728; 1.12 &#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#xFF0C;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5C31;&#x5DF2;&#x7ECF;&#x5C06;&#x6D41;&#x91CF;&#x5F00;&#x59CB;&#x5BFC;&#x6D41;&#x7ED9;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x90E8;&#x5206;&#x670D;&#x52A1;&#x4F1A;&#x8BBF;&#x95EE;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x5728; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5229;&#x7528; <code>Dockerfile</code> &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x529F;&#x80FD;&#xFF0C;&#x6765;&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5C1A;&#x672A;&#x5904;&#x4E8E;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5C06;&#x4E0D;&#x4F1A;&#x628A;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x7ED9;&#x8FD9;&#x4E2A;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5230;&#x5BB9;&#x5668;&#x786E;&#x5B9E;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x518D;&#x66F4;&#x65B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>
<h2 id="tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng"><a href="#&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;" class="headerlink" title="&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;"></a>&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD; <a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng" class="header-anchor">#</a></h2><p>&#x5F53; Docker 1.12 &#x63D0;&#x4F9B;&#x4E86; Swarm Mode &#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x540E;&#xFF0C;&#x5927;&#x5BB6;&#x90FD;&#x5F88;&#x5174;&#x594B;&#xFF0C;&#x5185;&#x7F6E;&#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x8BA9;&#x6301;&#x7EED;&#x53D1;&#x5E03;&#x53D8;&#x5F97;&#x66F4;&#x4E3A;&#x8F7B;&#x677E;&#x3002;1.12 &#x63D0;&#x4F9B;&#x4E86;&#x5F53;&#x670D;&#x52A1;&#x5347;&#x7EA7;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x8D85;&#x8FC7;&#x91CD;&#x8BD5;&#x6B21;&#x6570;&#x5219;&#x505C;&#x6B62;&#x5347;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x65B9;&#x4FBF;&#xFF0C;&#x907F;&#x514D;&#x8BA9;&#x9519;&#x8BEF;&#x7684;&#x5E94;&#x7528;&#x66FF;&#x4EE3;&#x73B0;&#x6709;&#x6B63;&#x5E38;&#x670D;&#x52A1;&#x3002;&#x4F46;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x867D;&#x7136;&#x63D0;&#x51FA;&#xFF0C;&#x4F46;&#x5E76;&#x672A;&#x80FD;&#x5728; 1.12 &#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x662F;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x540E;&#xFF0C;&#x5982;&#x4F55;&#x8BA9;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1F;&#x96BE;&#x9053;&#x662F;&#x518D;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x66F4;&#x65B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x66F4;&#x65B0;&#x7684;&#x662F;&#x65E7;&#x7248;&#x672C;&#x4E48;&#xFF1F;&#x90A3;&#x4E48;&#x65E7;&#x7248;&#x672C;&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#xFF1F;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5728;&#x81EA;&#x52A8;&#x5316;&#x5904;&#x7406;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5728; 1.13 &#x91CC;&#xFF0C;&#x5F00;&#x59CB;&#x652F;&#x6301; <code>docker service update --rollback</code> &#x529F;&#x80FD;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7531;&#x7BA1;&#x7406;&#x5458;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x5C06;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker service update \</div><div class="line">  --rollback \</div><div class="line">  --update-delay 0s \</div><div class="line">  my_web</div></pre></td></tr></table></figure>
<h2 id="tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi"><a href="#&#x6DFB;&#x52A0;&#x547D;&#x4EE4;-docker-service-logs-&#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;" class="headerlink" title="&#x6DFB;&#x52A0;&#x547D;&#x4EE4; docker service logs &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;"></a>&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7; <a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi" class="header-anchor">#</a></h2><p>Swarm Mode &#x542F;&#x52A8;&#x670D;&#x52A1;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x5F88;&#x9EBB;&#x70E6;&#x3002;&#x5728; <code>docker-compose</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker-compose logs &lt;&#x670D;&#x52A1;&#x540D;&gt;</code> &#x5373;&#x53EF;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;&#x662F;&#x8DD1;&#x5728;&#x4E0D;&#x540C;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x3002;&#x4F46;&#x662F; <code>docker service</code> &#x4E0D;&#x652F;&#x6301; <code>logs</code> &#x547D;&#x4EE4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x73B0;&#x5728;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;&#x9700;&#x8981; <code>docker service ps</code> &#x67E5;&#x770B;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x5728;&#x54EA;&#x4E9B;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4E00;&#x4E2A;&#x4E2A;&#x8FDB;&#x53BB;&#x5148; <code>docker ps</code> &#x627E;&#x5230;&#x5BB9;&#x5668; ID&#xFF0C;&#x7136;&#x540E;&#x5728; <code>docker logs &lt;&#x5BB9;&#x5668;ID&gt;</code> &#x67E5;&#x770B;&#x5177;&#x4F53;&#x65E5;&#x5FD7;&#x3002;&#x975E;&#x5E38;&#x7E41;&#x7410;&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86; <code>docker service logs</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x4EE5;&#x8FBE;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x662F;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x5728;&#x542F;&#x7528;&#x8BD5;&#x9A8C;&#x6A21;&#x5F0F;&#x540E;(<code>dockerd --experimental</code>)&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force"><a href="#&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879;-docker-service-update-force" class="headerlink" title="&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; docker service update --force"></a>&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code> <a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force" class="header-anchor">#</a></h2><p>&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528; <code>docker swarm mode</code> &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x78B0;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;&#xFF0C;&#x4FEE;&#x590D;&#x91CD;&#x542F;&#x8BE5;&#x8282;&#x70B9;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x539F;&#x6765;&#x8BE5;&#x8282;&#x70B9;&#x8DD1;&#x7684;&#x670D;&#x52A1;&#x88AB;&#x8C03;&#x5EA6;&#x5230;&#x4E86;&#x522B;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;swarm manager &#x7684;&#x4ECB;&#x5165;&#x4FDD;&#x8BC1;&#x4E86;&#x670D;&#x52A1;&#x7684;&#x53EF;&#x7528;&#x6027;&#x3002;&#x53EF;&#x662F;&#x8282;&#x70B9;&#x6062;&#x590D;&#x540E;&#xFF0C;&#x9664;&#x975E;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x4E2A;&#x522B;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E2A;&#x65B0;&#x4FEE;&#x590D;&#x7684;&#x8282;&#x70B9;&#x5C31;&#x4E00;&#x76F4;&#x95F2;&#x7740;&#xFF0C;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x6570;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5; swarm manager &#x4E0D;&#x4F1A;&#x4ECB;&#x5165;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;&#x96C6;&#x7FA4;&#x6269;&#x5BB9;&#x540E;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x65B0;&#x6269;&#x5BB9;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x6700;&#x521D;&#x90FD;&#x662F;&#x7A7A;&#x95F2;&#x7684;&#x3002;&#x5728; 1.12 &#x552F;&#x4E00;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6539;&#x70B9;&#x513F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#x4ECE;&#x800C;&#x89E6;&#x53D1; swarm &#x7684;&#x5347;&#x7EA7;&#x884C;&#x4E3A;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x597D;&#x529E;&#x6CD5;&#x3002;</p>
<p>&#x5728; 1.13&#xFF0C;&#x5F15;&#x5165;&#x4E86; <code>docker service update --force</code> &#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x5F3A;&#x5236;&#x89E6;&#x53D1;&#x518D;&#x53D1;&#x5E03;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F3A;&#x5236;&#x91CD;&#x65B0; <code>pull</code> &#x8BE5;&#x955C;&#x50CF;&#x3001;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#xFF0C;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x7531;&#x4E8E;&#x5404;&#x79CD;&#x7EF4;&#x62A4;&#x5BFC;&#x81F4;&#x7684;&#x96C6;&#x7FA4;&#x8D1F;&#x8F7D;&#x4E0D;&#x5E73;&#x8861;&#x7684;&#x60C5;&#x51B5;&#x5F97;&#x5230;&#x7F13;&#x89E3;&#xFF0C;&#x518D;&#x6B21;&#x5E73;&#x8861;&#x96C6;&#x7FA4;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x662F; <code>docker service update</code> &#x547D;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x9075;&#x5FAA;&#x6240;&#x6307;&#x5B9A;&#x7684; <code>--update-parallelism</code> &#x548C; <code>--update-delay</code> &#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x3002;</p>
<p>Add force option to service update #27596</p>
<h1 id="fei-qi"><a href="#&#x5E9F;&#x5F03;" class="headerlink" title="&#x5E9F;&#x5F03;"></a>&#x5E9F;&#x5F03; <a href="#fei-qi" class="header-anchor">#</a></h1><ul>
<li>&#x5E9F;&#x5F03; <code>docker daemon</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528; <code>dockerd</code> &#x53D6;&#x4EE3;&#x3002;&#x5176;&#x5B9E; 1.12 &#x5DF2;&#x7ECF;&#x6362;&#x4E86;</li>
<li>&#x79FB;&#x9664;&#x5BF9; Ubuntu 15.10&#x3001;Fedora 22 &#x7684;&#x652F;&#x6301;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x90FD; EOL &#x4E86;&#x3002;</li>
<li>&#x5E9F;&#x5F03; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>MAINTAINER</code> &#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x7528; <code>LABEL maintainer=&lt;...&gt;</code> &#x4EE3;&#x66FF;</li>
</ul>
</div></article><div class="pagination"><a href="/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html" class="pagination-prev">PREV</a><a href="/post/docker-2016-08-12-video-windows-server-and-docker.html" class="pagination-next">NEXT</a></div><div class="comments"><div data-thread-key="post/docker-2016-11-14-what-is-new-in-docker-1-13.html" data-title="Docker 1.13 新增功能" data-url="http://blog.lab99.org/post/docker-2016-11-14-what-is-new-in-docker-1-13.html" class="ds-thread"></div></div></div><aside class="sidebar"><h3>分类标签</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sonatype/">Sonatype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coreos/">coreos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-summit/">docker summit</a></li></ul><h3>最新文章</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html">视频笔记：为容器定制的持久化存储方案 - Infinit - Quentin Hocquet</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-11-14-what-is-new-in-docker-1-13.html">Docker 1.13 新增功能</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-08-12-video-windows-server-and-docker.html">视频笔记： Windows Server 和 Docker - John Starks</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-08-08-video-docker-ops-docker-networking-deep-dive-considerations-and-troubleshooting.html">视频笔记：Docker 运维 - Docker Networking 进阶指南 - Madhu Venugopal</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-07-26-video-docker-for-ops-docker-storage-and-volumes-deep-dive-and-considerations.html">视频笔记：Docker 运维 - Docker Storage 和 Volumes 进阶指南 - Brian Goff</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-07-21-video-green-font-black-background-docker-security-by-example.html">视频笔记：绿字黑屏 - Docker 安全示例 - Diogo Mónica</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-07-14-faq.html">Docker 问答录</a></li><li class="post-list-item"><a class="post-list-link" href="/post/docker-2016-07-12-video-moby-cool-hack-session-dockercon.html">视频笔记：Moby 的 Cool Hack session</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><P>© 2016 <a href="/">王涛</P></div><div class="power"><p><a href="http://pinggod.com/">Sean Sun</a>, 
<a href="https://hexo.io">Hexo</a>, 
<a href="https://github.com/">GitHub</a>, 
<a href="https://jekyllrb.com/">Jekyll</a></p></div></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80785538-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?ee75cf08ad330aa99f8540efa2570970";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>var duoshuoQuery = {short_name:"twang2218-coding"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script></body></html>