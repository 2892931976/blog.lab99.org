<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>大桥下的蜗牛</title>
  
  <link href="//atom.xml" rel="self"/>
  
  <link href="http://blog.lab99.org/"/>
  <updated>2016-12-08T07:31:43.846Z</updated>
  <id>http://blog.lab99.org/</id>
  
  <author>
    <name>王涛</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>视频笔记：为容器定制的持久化存储方案 - Infinit - Quentin Hocquet</title>
    <link href="http://blog.lab99.org/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html"/>
    <id>http://blog.lab99.org/post/docker-2016-12-07-video-persistent-storage-tailored-for-containers.html</id>
    <published>2016-12-06T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.846Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#rong-qi-he-cun-chu">&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8;</a></li>
<li><a href="#infinit-cun-chu-ping-tai">Infinit &#x5B58;&#x50A8;&#x5E73;&#x53F0;</a></li>
<li><a href="#infinit-shi-wan-quan-fen-bu-shi-de">Infinit &#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684;</a></li>
<li><a href="#ru-he-zuo-dao-de">&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;</a></li>
<li><a href="#shen-ru-dht-blocks">&#x6DF1;&#x5165;&#xFF1A;DHT Blocks</a></li>
<li><a href="#shen-ru-wen-jian-xi-tong-ceng">&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;</a></li>
<li><a href="#shen-ru-consensus">&#x6DF1;&#x5165;&#xFF1A;Consensus</a></li>
<li><a href="#shen-ru-overlay">&#x6DF1;&#x5165;&#xFF1A;Overlay</a></li>
</ul>
<!-- tocstop -->
<p>&#x89C6;&#x9891;&#x7B14;&#x8BB0;&#xFF1A;&#x4E3A;&#x5BB9;&#x5668;&#x5B9A;&#x5236;&#x7684;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x65B9;&#x6848; - Infinit - Quentin Hocquet</p>
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Persistent storage tailored for containers<br>by Quentin Hocquet<br>@ mefyl<br>CTO @ Infinit<br>&#x5728; Docker Distributed System Summit 2016 &#x4E0A;&#x7684;&#x8BB2;&#x5EA7;<br>2016-10-10</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/k0m-XwCoxo0" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=k0m-XwCoxo0" target="_blank" rel="external">https://www.youtube.com/watch?v=k0m-XwCoxo0</a></p>
<p>&#x89C6;&#x9891;&#x94FE;&#x63A5;&#xFF1A;<a href="https://www.youtube.com/watch?v=k0m-XwCoxo0" target="_blank" rel="external">https://www.youtube.com/watch?v=k0m-XwCoxo0</a></p>
<p>&#x5E7B;&#x706F;&#x94FE;&#x63A5;&#xFF1A;<a href="http://www.slideshare.net/Docker/persistent-storage-tailored-for-containers" target="_blank" rel="external">http://www.slideshare.net/Docker/persistent-storage-tailored-for-containers</a></p>
<h1 id="rong-qi-he-cun-chu"><a href="#&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8;" class="headerlink" title="&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8;"></a>&#x5BB9;&#x5668;&#x548C;&#x5B58;&#x50A8; <a href="#rong-qi-he-cun-chu" class="header-anchor">#</a></h1><p>&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x5FEB;&#x6377;&#x3001;&#x53EF;&#x6269;&#x5C55;&#x3001;&#x5F88;&#x7075;&#x6D3B;</p>
<ul>
<li>&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x7684;&#x542F;&#x52A8;&#x3001;&#x505C;&#x6B62;</li>
<li>&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x548C;&#x5BB9;&#x6613;&#x7684;&#x6A2A;&#x5411;&#x6269;&#x5C55;</li>
<li>&#x7EDF;&#x4E00;&#x7684;&#x5F00;&#x53D1;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;</li>
<li>&#x800C;&#x4E14;&#x8FD8;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#x7684;&#x5B9A;&#x5236;&#x5404;&#x79CD;&#x9700;&#x6C42;</li>
</ul>
<p>&#x4F46;&#x662F;&#x5BB9;&#x5668;&#x66F4;&#x503E;&#x5411;&#x4E8E;<strong>&#x65E0;&#x72B6;&#x6001;&#x5316;</strong>&#xFF0C;&#x5BF9;&#x4E8E;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x4E16;&#x754C;&#x91CC;&#x66F4;&#x5BB9;&#x6613;&#x4F7F;&#x7528;&#x3002;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x670D;&#x52A1;&#x6709;&#x72B6;&#x6001;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;<strong>&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;</strong>&#x3002;</p>
<p>&#x7406;&#x60F3;&#x5316;&#x7684;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#xFF1A;</p>
<ul>
<li>&#x53EF;&#x4EE5;&#x50CF;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x5BB9;&#x6613;&#x7684;&#x521B;&#x5EFA;&#x3001;&#x542F;&#x52A8;</li>
<li>&#x53EF;&#x4EE5;&#x8DDF;&#x5BB9;&#x5668;&#x7684;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x6269;&#x5C55;</li>
<li>&#x5E94;&#x8BE5;&#x548C;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4EE5;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x5DE5;&#x4F5C;</li>
<li>&#x800C;&#x4E14;&#x5E94;&#x8BE5;&#x548C;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x9700;&#x6C42;</li>
</ul>
<h1 id="infinit-cun-chu-ping-tai"><a href="#Infinit-&#x5B58;&#x50A8;&#x5E73;&#x53F0;" class="headerlink" title="Infinit &#x5B58;&#x50A8;&#x5E73;&#x53F0;"></a>Infinit &#x5B58;&#x50A8;&#x5E73;&#x53F0; <a href="#infinit-cun-chu-ping-tai" class="header-anchor">#</a></h1><p>Infinit &#x5B58;&#x50A8;&#x5728;&#x8BBE;&#x8BA1;&#x521D;&#x671F;&#x5C31;&#x8003;&#x8651;&#x4E86;&#x5BB9;&#x5668;&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;&#x3002;&#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x79CD; API&#xFF0C;&#x4ECE; POSIX &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;Object &#xFF08;&#x5982;AWS S3&#xFF0C;OpenStack Swift&#xFF09;&#x5230; Block &#xFF08;iSCSI&#xFF09;&#x3002;&#x5B83;&#x5C06;&#x6240;&#x6709;&#x8282;&#x70B9;&#x7684;&#x672C;&#x5730;&#x5B58;&#x50A8;&#x805A;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x6210;&#x4E3A;&#x7EDF;&#x4E00;&#x7684;&#x5B58;&#x50A8;&#x6C60;&#x3002;</p>
<h1 id="infinit-shi-wan-quan-fen-bu-shi-de"><a href="#Infinit-&#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684;" class="headerlink" title="Infinit &#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684;"></a>Infinit &#x662F;&#x5B8C;&#x5168;&#x5206;&#x5E03;&#x5F0F;&#x7684; <a href="#infinit-shi-wan-quan-fen-bu-shi-de" class="header-anchor">#</a></h1><p>&#x6CA1;&#x6709; Leader&#xFF0C;&#x6CA1;&#x6709; follower&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x5E73;&#x7B49;&#x7684;&#x3002;</p>
<ul>
<li>&#x5728;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x548C;&#x4E00;&#x4E07;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x4E00;&#x6837;</li>
<li>&#x6CA1;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF0C;&#x6CA1;&#x6709;&#x74F6;&#x9888;</li>
<li>&#x8282;&#x70B9;&#x5F88;&#x5BB9;&#x6613;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x5BB9;&#x91CF;&#x8FD8;&#x662F;&#x901F;&#x5EA6;</li>
<li>&#x62E5;&#x6709;&#x9762;&#x5411;&#x5F00;&#x53D1;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7EDF;&#x4E00;&#x7684; API</li>
<li>&#x6BCF;&#x4E2A;&#x8BBE;&#x7F6E;&#x90FD;&#x53EF;&#x4EE5;&#x5B9A;&#x5236;</li>
</ul>
<p>&#x56E0;&#x6B64; Infinit &#x53EF;&#x4EE5;&#xFF1A;</p>
<ul>
<li>&#x548C;&#x5BB9;&#x5668;&#x4E00;&#x6837;&#x8F7B;&#x677E;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x8FD0;&#x884C;&#x3002;</li>
<li>&#x53EF;&#x4EE5;&#x4F34;&#x968F;&#x5BB9;&#x5668;&#x6C60;&#x7684;&#x6269;&#x5BB9;&#x800C;&#x6269;&#x5BB9;</li>
<li>&#x786E;&#x4FDD;&#x5F00;&#x53D1;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E00;&#x81F4;</li>
<li>&#x5BF9;&#x4E8E;&#x5404;&#x79CD;&#x9700;&#x6C42;&#x90FD;&#x53EF;&#x914D;&#x7F6E;&#xFF1A;&#x52A0;&#x5BC6;&#x3001;&#x5197;&#x4F59;&#x3001;&#x538B;&#x7F29;&#x7B49;</li>
</ul>
<h1 id="ru-he-zuo-dao-de"><a href="#&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F;"></a>&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF1F; <a href="#ru-he-zuo-dao-de" class="header-anchor">#</a></h1><p>Infinit &#x7684;&#x57FA;&#x672C;&#x539F;&#x5219;&#xFF1A;</p>
<ul>
<li>&#x5C06;&#x6240;&#x6709;&#x8282;&#x70B9;&#x81F3;&#x4E8E;<strong>&#x4E00;&#x4E2A; overlay network</strong> &#x4E0B;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x548C;&#x8DEF;&#x7531;</li>
<li>&#x5C06;&#x6570;&#x636E;&#x4EE5;&#x5757;(block)&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x4E8E;<strong>Distribute Hashtable (DHT)</strong> &#xFF08;&#x53EF;&#x4EE5;&#x89C6;&#x4E3A;&#x5206;&#x5E03;&#x5F0F;&#x952E;&#x503C;&#x5E93;&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x5757;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;</li>
<li>&#x4F7F;&#x7528;<strong>&#x5BC6;&#x7801;&#x5B66;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</strong>&#x6765;&#x6267;&#x884C;&#x4EFB;&#x4F55; Leader &#x7684;&#x547D;&#x4EE4;</li>
<li>&#x4F7F;&#x7528;<strong><a href="https://zh.wikipedia.org/wiki/%E5%B0%8D%E7%A8%B1#.E9.82.8F.E8.BC.AF.E4.B8.AD.E7.9A.84.E5.B0.8D.E7.A8.B1" target="_blank" rel="external">symmetrical operations</a></strong>&#x6765;&#x786E;&#x4FDD;&#x7A33;&#x5B9A;&#x6027;&#x548C;&#x7075;&#x6D3B;&#x6027;</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x7684; overlay network &#x5E76;&#x975E; docker overlay network&#xFF0C;&#x800C;&#x662F;&#x6307;&#x5C06;&#x4E0A;&#x5343;&#x8282;&#x70B9;&#x8054;&#x7CFB;&#x8D77;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x67E5;&#x8BE2;&#x3001;&#x53D1;&#x73B0;&#x3001;&#x8DEF;&#x7531;&#x7684;&#x4E00;&#x7EC4;&#x7B97;&#x6CD5;&#x548C;&#x5B9E;&#x73B0;&#x3002;</p>
<p><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.58.889&amp;rep=rep1&amp;type=pdf" target="_blank" rel="external">&#x5BC6;&#x7801;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</a>&#x975E;&#x5E38;&#x5F3A;&#x5927;&#xFF0C;&#x5229;&#x7528;&#x5BC6;&#x94A5;&#x673A;&#x5236;&#xFF0C;&#x786E;&#x4FDD;&#x80FD;&#x8BBF;&#x95EE;&#x8BE5; Block &#x7684;&#x8282;&#x70B9;&#xFF0C;&#x5FC5;&#x7136;&#x62E5;&#x6709;&#x5BC6;&#x94A5;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x7136;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x53CA;&#x89E3;&#x5BC6;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x53BB;&#x8BE2;&#x95EE;&#x7B2C;&#x4E09;&#x65B9;&#x673A;&#x6784;&#x83B7;&#x5F97;&#x6743;&#x9650;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x662F; symmetirc &#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;&#x4E86;&#x5BC6;&#x7801;&#x5B66;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x7684;&#x5757;&#x5FC5;&#x987B;&#x81EA;&#x7B7E;&#x540D;&#x4EE5;&#x53CA;&#x52A0;&#x5BC6;&#x3002;</p>
<h1 id="shen-ru-dht-blocks"><a href="#&#x6DF1;&#x5165;&#xFF1A;DHT-Blocks" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;DHT Blocks"></a>&#x6DF1;&#x5165;&#xFF1A;DHT Blocks <a href="#shen-ru-dht-blocks" class="header-anchor">#</a></h1><p>DHT Blocks &#x5206;&#x4E3A;&#x4E24;&#x5927;&#x7C7B; <code>Mutable blocks</code> &#x548C; <code>Immutable blocks</code>&#x3002;</p>
<p>&#x53EF;&#x53D8;&#x66F4;&#x7684;&#x5757;(<code>mutable block</code>)&#xFF1A;</p>
<ul>
<li>&#x8FD9;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x4EA7;&#x751F;&#x51B2;&#x7A81;</li>
<li>&#x800C;&#x4E14;&#x5F88;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x8FC7;&#x671F;&#x548C;&#x5931;&#x6548;&#xFF0C;&#x9700;&#x8981;&#x7ECF;&#x5E38;&#x68C0;&#x67E5;</li>
<li>&#x5F88;&#x96BE;&#x53BB;&#x9A8C;&#x8BC1;&#x4EE5;&#x53CA;&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;</li>
</ul>
<p>&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x5757;(<code>immutable block</code>)&#xFF1A;</p>
<ul>
<li>&#x4E0D;&#x4F1A;&#x6709;&#x51B2;&#x7A81;</li>
<li>&#x4E0D;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x53EF;&#x4EE5;&#x4E00;&#x76F4;&#x7F13;&#x5B58;</li>
<li>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x53BB;&#x9A8C;&#x8BC1;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x5757;&#x662F; addressable &#x7684;&#xFF1A;<code>address = hash (content)</code></li>
</ul>
<p><strong>&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x5757;</strong> &#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x83B7;&#x53D6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x7528; LRU &#x7F13;&#x5B58;&#x3002;</p>
<p>&#x7531;&#x4E8E; <code>Immutable Block</code> &#x7684;&#x7279;&#x6027;&#x5F88;&#x8D5E;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8BBE;&#x8BA1; Infinit &#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x4F7F;&#x7528; <code>Immutable Block</code>&#x3002;</p>
<h1 id="shen-ru-wen-jian-xi-tong-ceng"><a href="#&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;"></a>&#x6DF1;&#x5165;&#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42; <a href="#shen-ru-wen-jian-xi-tong-ceng" class="header-anchor">#</a></h1><p>&#x6587;&#x4EF6;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5E26;&#x5143;&#x6570;&#x636E;&#x7684; <code>Mutable Block</code> &#x548C;&#x4E00;&#x4E2A; <code>Immutable Block</code> &#x7EC4;&#x6210;&#x7684;<code>FAT (File Allocation Table)</code>&#x3002;</p>
<p>&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x4F7F;&#x7528; <code>Immutable Block</code> &#x8FDB;&#x884C;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x7F13;&#x5B58;&#x3002;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x6587;&#x4EF6;&#x53D8;&#x66F4;&#xFF0C;&#x4F1A;&#x5148;&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;&#x66FF;&#x4EE3;&#x7684; <code>Immutable Block</code>&#xFF0C;&#x7ED3;&#x675F;&#x540E;&#x53EA;&#x9700;&#x8981;&#x5F88;&#x77ED;&#x6682;&#x7684;&#x4FEE;&#x6539; <code>inode</code>&#xFF0C;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x7248;&#x672C;&#x66FF;&#x6362;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x8F7B;&#x6613;&#x7684;&#x786E;&#x4FDD;&#x539F;&#x5B50;&#x8BFB;&#x5199;&#x3002;</p>
<p>POSIX &#x7684; API &#x662F;&#x987A;&#x5E8F;&#x7684;&#xFF0C;&#x800C; Infinit &#x662F;&#x9AD8;&#x5EA6;&#x5E76;&#x884C;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x63D0;&#x4F9B;&#x4E86;&#x76EE;&#x5F55;&#x9884;&#x8BFB;&#x3001;&#x4EE5;&#x53CA;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#x9884;&#x8BFB;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x540E;&#x53F0;&#x4EE5;&#x9AD8;&#x5EA6;&#x5E76;&#x884C;&#x6279;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#x83B7;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x964D;&#x4F4E;&#x524D;&#x53F0;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x3002;</p>
<h1 id="shen-ru-consensus"><a href="#&#x6DF1;&#x5165;&#xFF1A;Consensus" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;Consensus"></a>&#x6DF1;&#x5165;&#xFF1A;Consensus <a href="#shen-ru-consensus" class="header-anchor">#</a></h1><p>&#x7531;&#x4E8E;&#x662F;&#x57FA;&#x4E8E; Block &#x7684; Consensus&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A; Block &#x90FD;&#x6709;&#x4E00;&#x7EC4; Quorum&#xFF0C;&#x4F7F;&#x7528; Paxos &#x7B97;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x5BFC;&#x81F4;&#x6CA1;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF0C;&#x800C;&#x4E14;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A; Block &#x7684; quorum &#x90FD;&#x4E0D;&#x540C;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5355;&#x4E00;&#x74F6;&#x9888;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x4F7F;&#x7528; Raft&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x4E86;&#x66F4;&#x590D;&#x6742;&#x7684; Multipaxos &#x7684;&#x7B97;&#x6CD5;&#x3002;</p>
<h1 id="shen-ru-overlay"><a href="#&#x6DF1;&#x5165;&#xFF1A;Overlay" class="headerlink" title="&#x6DF1;&#x5165;&#xFF1A;Overlay"></a>&#x6DF1;&#x5165;&#xFF1A;Overlay <a href="#shen-ru-overlay" class="header-anchor">#</a></h1><p>overlay &#x5C42;&#x662F; Infinit &#x5E73;&#x53F0;&#x4E2D;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x5B9A;&#x5236;&#x70B9;&#xFF1A;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x7B97;&#x6CD5;&#x7684;&#x9009;&#x62E9;&#xFF1A;</p>
<ul>
<li>&#x51E0;&#x5343;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x8BDD;&#xFF1A;<a href="https://github.com/papers-we-love/papers-we-love/blob/master/distributed_systems/kelips-building-an-efficient-and-stable-p2p-dht-through-increased-memory-and-background-overhead.pdf" target="_blank" rel="external"><code>kelips</code></a>, <a href="https://pdos.csail.mit.edu/~petar/papers/maymounkov-kademlia-lncs.pdf" target="_blank" rel="external"><code>kademlia</code></a>, <a href="https://pdos.csail.mit.edu/papers/chord:sigcomm01/chord_sigcomm.pdf" target="_blank" rel="external"><code>chord</code></a>,</li>
<li>&#x51E0;&#x767E;&#x4E2A;&#x8282;&#x70B9;&#x51E0;&#x5341;&#x4E2A;TB &#x7684;&#x8BDD;&#xFF1A;<code>global knowledge</code>, <code>Kouncil</code></li>
</ul>
<p>&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4F4D;&#x7F6E;&#xFF1A;<code>rack-aware</code> &#x673A;&#x67B6;&#xFF0C;<code>zone-aware</code> &#x533A;&#x57DF;&#xFF0C;<code>reliability-aware</code> &#x53EF;&#x9760;&#x6027;&#x3001;<code>ensure local</code> &#x672C;&#x5730;&#x5B58;&#x50A8;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="docker summit" scheme="http://blog.lab99.org/tags/docker-summit/"/>
    
  </entry>
  
  <entry>
    <title>Docker 1.13 新增功能</title>
    <link href="http://blog.lab99.org/post/docker-2016-11-14-what-is-new-in-docker-1-13.html"/>
    <id>http://blog.lab99.org/post/docker-2016-11-14-what-is-new-in-docker-1-13.html</id>
    <published>2016-11-13T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.846Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#qian-yan">&#x524D;&#x8A00;</a><ul>
<li><a href="#top-10-xin-zeng-gong-neng">Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#docker-jing-xiang-gou-jian">Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;</a><ul>
<li><a href="#cong-yi-you-jing-xiang-qu-de-huan-cun">&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;</a></li>
<li><a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan">&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;</a></li>
</ul>
</li>
<li><a href="#an-zhuang">&#x5B89;&#x88C5;</a><ul>
<li><a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti">&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898;</a></li>
<li><a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi">&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;</a></li>
</ul>
</li>
<li><a href="#wang-luo">&#x7F51;&#x7EDC;</a><ul>
<li><a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo">&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC;</a></li>
<li><a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou">&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</a></li>
<li><a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;</a></li>
<li><a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-jie-dian">&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9;</a></li>
<li><a href="#yun-xu-service-vip-ke-yi-bei-ping">&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code></a></li>
</ul>
</li>
<li><a href="#cha-jian">&#x63D2;&#x4EF6;</a><ul>
<li><a href="#cha-jian-gong-neng-zheng-shi-qi-yong">&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;</a></li>
</ul>
</li>
<li><a href="#ming-ling-xing">&#x547D;&#x4EE4;&#x884C;</a><ul>
<li><a href="#shi-yan-checkpoint-gong-neng">&#x8BD5;&#x9A8C; <code>checkpoint</code> &#x529F;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#yun-xing-shi">&#x8FD0;&#x884C;&#x65F6;</a><ul>
<li><a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu">&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570;</a></li>
<li><a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e">&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;</a></li>
<li><a href="#zeng-jia-docker-system-ming-ling">&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</a></li>
<li><a href="#ti-sheng-overlay2-de-you-xian-ji">&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7;</a></li>
<li><a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;</a></li>
</ul>
</li>
<li><a href="#swarm-mode">Swarm Mode</a><ul>
<li><a href="#zheng-shi-zhi-chi-docker-stack">&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code></a></li>
<li><a href="#tian-jia-secret-guan-li">&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406;</a></li>
<li><a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi">&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;</a></li>
<li><a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng">&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</a></li>
<li><a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi">&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;</a></li>
<li><a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force">&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></a></li>
</ul>
</li>
<li><a href="#fei-qi">&#x5E9F;&#x5F03;</a></li>
</ul>
<!-- tocstop -->
<h1 id="qian-yan"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00; <a href="#qian-yan" class="header-anchor">#</a></h1><p><code>Docker 1.13</code> &#x9A6C;&#x4E0A;&#x5C31;&#x8981;&#x53D1;&#x5E03;&#x4E86;&#x3002;&#x4ECE; 7 &#x6708; 29 &#x65E5;&#x53D1;&#x5E03; <code>1.12</code> &#x53D1;&#x5E03;&#x4EE5;&#x6765;&#xFF0C;&#x5DF2;&#x7ECF;&#x8FC7;&#x53BB; 4 &#x4E2A;&#x591A;&#x6708;&#x4E86;&#xFF0C;&#x5BF9;&#x4E8E;&#x6D3B;&#x8DC3;&#x7684; Docker &#x793E;&#x533A;&#x6765;&#x8BF4;&#xFF0C;&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x90FD; <code>1.13</code> &#x90FD;&#x65B0;&#x589E;&#x4E86;&#x4EC0;&#x4E48;&#x5185;&#x5BB9;&#x5427;&#x3002;</p>
<p><code>1.13</code> &#x6709;<a href="https://github.com/docker/docker/milestone/56" target="_blank" rel="external">&#x4E00;&#x5343;&#x4E8C;&#x767E;&#x591A;&#x4E2A; issue/pull request</a>&#xFF0C;&#x56DB;&#x5343;&#x591A;&#x4E2A; commits&#xFF0C;&#x662F;&#x5386;&#x53F2;&#x4E0A;&#x6700;&#x9AD8;&#x7684;&#x3002;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5C0F;&#x7248;&#x672C;&#x53D8;&#x5316;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x5927;&#x91CF;&#x7684;&#x66F4;&#x65B0;&#x3002;</p>
<p><em>&#x8981;&#x60F3;&#x6D4B;&#x8BD5; <code>1.13.0</code> &#x7684;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8D77;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x8FD0;&#x884C;&#xFF1A;<code>curl -fsSL https://test.docker.com/ | sh</code>&#xFF0C;&#x8FD9;&#x6837;&#x4F1A;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7684;&#x6D4B;&#x8BD5;&#x7248;&#x672C;&#x3002;</em></p>
<h2 id="top-10-xin-zeng-gong-neng"><a href="#Top-10-&#x65B0;&#x589E;&#x529F;&#x80FD;" class="headerlink" title="Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD;"></a>Top 10 &#x65B0;&#x589E;&#x529F;&#x80FD; <a href="#top-10-xin-zeng-gong-neng" class="header-anchor">#</a></h2><ul>
<li>1&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x670D;&#x52A1;&#x6808; <code>docker stack</code></li>
<li>2&#x3001;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x63D2;&#x4EF6;&#xFF1A;<code>docker plugin</code></li>
<li>3&#x3001;&#x6DFB;&#x52A0;&#x5728; Swarm &#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7BA1;&#x7406;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x670D;&#x52A1;&#xFF1A;<code>docker secret</code></li>
<li>4&#x3001;&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4;</li>
<li>5&#x3001;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x8FDB;&#x884C;&#x670D;&#x52A1;&#x90E8;&#x7F72;</li>
<li>6&#x3001;&#x6DFB;&#x52A0; <code>docker service</code> &#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;</li>
<li>7&#x3001;&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code></li>
<li>8&#x3001;&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;</li>
<li>9&#x3001;&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684; <code>overlay</code> &#x7F51;&#x7EDC;</li>
<li>10&#x3001;&#x89E3;&#x51B3;&#x4E2D;&#x56FD; <code>GFW</code> &#x5899;&#x6389; <code>docker-engine</code> <code>apt</code>/<code>yum</code> &#x6E90;&#x7684;&#x95EE;&#x9898;</li>
</ul>
<h1 id="docker-jing-xiang-gou-jian"><a href="#Docker-&#x955C;&#x50CF;&#x6784;&#x5EFA;" class="headerlink" title="Docker &#x955C;&#x50CF;&#x6784;&#x5EFA;"></a>Docker &#x955C;&#x50CF;&#x6784;&#x5EFA; <a href="#docker-jing-xiang-gou-jian" class="header-anchor">#</a></h1><h2 id="cong-yi-you-jing-xiang-qu-de-huan-cun"><a href="#&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;" class="headerlink" title="&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58;"></a>&#x4ECE;&#x5DF2;&#x6709;&#x955C;&#x50CF;&#x53D6;&#x5F97;&#x7F13;&#x5B58; <a href="#cong-yi-you-jing-xiang-qu-de-huan-cun" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5145;&#x5206;&#x5229;&#x7528;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#x7279;&#x6027;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x907F;&#x514D;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;&#x4E0D;&#x8FC7;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7684;&#x524D;&#x63D0;&#x6761;&#x4EF6;&#x662F;&#x66FE;&#x7ECF;&#x5728;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x8FC7;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x5728; CI &#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x6784;&#x5EFA;&#x65F6;&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x5206;&#x914D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x800C;&#x8BE5;&#x673A;&#x5668;&#x6CA1;&#x6709;&#x6784;&#x5EFA;&#x8FC7;&#x8BE5;&#x955C;&#x50CF;&#xFF0C;&#x56E0;&#x6B64;&#x7F13;&#x5B58;&#x603B;&#x662F;&#x7528;&#x4E0D;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x91CF;&#x7684;&#x65F6;&#x95F4;&#x6D6A;&#x8D39;&#x5728;&#x4E86;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x8FC7;&#x7684;&#x5C42;&#x4E0A;&#x4E86;&#x3002;</p>
<p>&#x5728; <code>1.13</code> &#x4E2D;&#xFF0C;&#x4E3A; <code>docker build</code> &#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x53C2;&#x6570; <code>--cache-from</code>&#xFF0C;&#x5229;&#x7528;&#x955C;&#x50CF;&#x4E2D;&#x7684; History &#x6765;&#x5224;&#x65AD;&#x8BE5;&#x5C42;&#x662F;&#x5426;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#x4E00;&#x81F4;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x91CD;&#x590D;&#x6784;&#x5EFA;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x5148;&#x4E0B;&#x8F7D;&#x83B7;&#x53D6;&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x7684;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ docker pull mongo:3.2</div><div class="line">3.2: Pulling from library/mongo</div><div class="line">386a066<span class="built_in">cd</span>84a: Pull complete</div><div class="line">524267bc200a: Pull complete</div><div class="line">476d61c7c43a: Pull complete</div><div class="line">0750d0e28b90: Pull complete</div><div class="line">4bedd83d0855: Pull complete</div><div class="line">b3b5d21a0eda: Pull complete</div><div class="line">7354b6c26240: Pull complete</div><div class="line">db792d386b51: Pull complete</div><div class="line">a867bd77950c: Pull complete</div><div class="line">Digest: sha256:532a19da83ee0e4e2a2ec6bc4212<span class="built_in">fc</span>4af26357c040675d5c2629a4e4c4563cef</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> mongo:3.2</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x66F4;&#x65B0;&#x540E;&#x7684; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x4E0A; <code>--cache-from mongo:3.2</code> &#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5982;&#x679C;&#x662F;&#x5DF2;&#x7ECF;&#x5728; <code>mongo:3.2</code> &#x4E2D;&#x5B58;&#x5728;&#x5E76;&#x6CA1;&#x6709;&#x4FEE;&#x6539;&#x7684;&#x5C42;&#xFF0C;&#x5C31;&#x4F1A;&#x7528; <code>mongo:3.2</code> &#x4E2D;&#x7684;&#x8BE5;&#x5C42;&#x505A;&#x7F13;&#x5B58;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ docker build --cache-from mongo:3.2 -t mongo:3.2.1 .</div><div class="line">Sending build context to Docker daemon 4.608 kB</div><div class="line">Step 1/18 : FROM debian:jessie</div><div class="line"> ---&gt; 73e72bf822ca</div><div class="line">Step 2/18 : RUN groupadd -r mongodb &amp;&amp; useradd -r -g mongodb mongodb</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; 0f6297900a5e</div><div class="line">Step 3/18 : RUN apt-get update 	&amp;&amp; apt-get install -y --no-install-recommends 		numactl 	&amp;&amp; rm -rf /var/lib/apt/lists/*</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; a465f2e906<span class="built_in">fc</span></div><div class="line">Step 4/18 : ENV GOSU_VERSION 1.7</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; d448ddca2126</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="ya-bian-squash-jing-xiang-shi-yan-jie-duan"><a href="#&#x538B;&#x6241;-squash-&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;" class="headerlink" title="&#x538B;&#x6241;(squash)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09;"></a>&#x538B;&#x6241;(<code>squash</code>)&#x955C;&#x50CF;&#xFF08;&#x5B9E;&#x9A8C;&#x9636;&#x6BB5;&#xFF09; <a href="#ya-bian-squash-jing-xiang-shi-yan-jie-duan" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E;&#x603B;&#x662F;&#x628A; <code>Dockerfile</code> &#x5F53;&#x505A; <code>bash</code> &#x6587;&#x4EF6;&#x6765;&#x7528;&#x7684;&#x4EBA;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5F88;&#x5FEB;&#x7531;&#x4E8E;&#x592A;&#x591A;&#x7684; <code>RUN</code> &#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x6709;&#x7279;&#x522B;&#x591A;&#x7684;&#x5C42;&#xFF0C;&#x955C;&#x50CF;&#x8D85;&#x7EA7;&#x81C3;&#x80BF;&#xFF0C;&#x800C;&#x4E14;&#x751A;&#x81F3;&#x4F1A;&#x78B0;&#x5230;&#x8D85;&#x51FA;&#x6700;&#x5927;&#x5C42;&#x6570;&#x9650;&#x5236;&#x7684;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E9B;&#x4EBA;&#x5F80;&#x5F80;&#x4E0D;&#x4ECE;&#x81EA;&#x8EAB;&#x627E;&#x95EE;&#x9898;&#xFF0C;&#x53CD;&#x800C;&#x53BB;&#x5BFB;&#x627E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#xFF0C;&#x6BD4;&#x5982;&#x5BFC;&#x51FA;&#x955C;&#x50CF;&#x505A;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5BFC;&#x5165;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#x5F88;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x9664;&#x4E86;&#x5BFC;&#x81F4;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x5931;&#x8D25;&#x5916;&#xFF0C;&#x8FD8;&#x5BFC;&#x81F4; <code>docker history</code> &#x4E22;&#x5931;&#xFF0C;&#x5BFC;&#x81F4;&#x955C;&#x50CF;&#x53D8;&#x4E3A;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x3002;&#x5176;&#x5B9E;&#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x9075;&#x5FAA; <code>Dockerfile</code> &#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x591A;&#x4E2A;&#x547D;&#x4EE4;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A; <code>RUN</code>&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A; <code>RUN</code> &#x8981;&#x7CBE;&#x5FC3;&#x8BBE;&#x8BA1;&#xFF0C;&#x786E;&#x4FDD;&#x5B89;&#x88C5;&#x6784;&#x5EFA;&#x6700;&#x540E;&#x8FDB;&#x884C;&#x6E05;&#x7406;&#x3002;&#x8FD9;&#x6837;&#x624D;&#x53EF;&#x4EE5;&#x964D;&#x4F4E;&#x955C;&#x50CF;&#x4F53;&#x79EF;&#xFF0C;&#x4EE5;&#x53CA;&#x6700;&#x5927;&#x5316;&#x7684;&#x5229;&#x7528;&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x3002;</p>
<p>&#x5728; Docker 1.13 &#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x8FD9;&#x7FA4;&#x7528;&#x6237;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; <code>--squash</code> &#x53C2;&#x6570;&#x7ED9; <code>docker build</code>&#xFF0C;&#x5176;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5982;&#x4E0A;&#x6240;&#x8BF4;&#xFF0C;&#x5C06; <code>Dockerfile</code> &#x4E2D;&#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x538B;&#x7F29;&#x4E3A;&#x4E00;&#x5C42;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x4E0E;&#x65C1;&#x95E8;&#x5DE6;&#x9053;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x4FDD;&#x7559;&#x4E86; <code>docker history</code>&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5982;&#x4E0B;&#x7684; <code>Dockerfile</code>&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> busybox</div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> hello &gt; /hello</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> world &gt;&gt; /hello</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> touch remove_me /remove_me</span></div><div class="line"><span class="keyword">ENV</span> HELLO world</div><div class="line"><span class="keyword">RUN</span><span class="bash"> rm /remove_me</span></div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6B63;&#x5E38;&#x7684;&#x6784;&#x5EFA;&#x7684;&#x8BDD;&#xFF0C;&#x6BD4;&#x5982; <code>docker build -t my-not-squash .</code>&#xFF0C;&#x5176; <code>history</code> &#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="built_in">history</span> my-not-squash</div><div class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</div><div class="line">305297a526e2        About a minute ago   /bin/sh -c rm /remove_me                        0 B</div><div class="line">60b8e896d443        About a minute ago   /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></div><div class="line">a21f3c75b6b0        About a minute ago   /bin/sh -c touch remove_me /remove_me           0 B</div><div class="line">038bca5b58cb        About a minute ago   /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 12 B</div><div class="line">f81b1006f556        About a minute ago   /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  6 B</div><div class="line">e02e811dd08f        5 weeks ago          /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></div><div class="line">&lt;missing&gt;           5 weeks ago          /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></div></pre></td></tr></table></figure>
<p>&#x800C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7528; <code>--squash</code> &#x6784;&#x5EFA;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t mysquash --squash .</div></pre></td></tr></table></figure>
<p>&#x5176; <code>history</code> &#x5219;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="built_in">history</span> mysquash</div><div class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</div><div class="line">a557e397ff56        15 seconds ago                                                      12 B                merge sha256:305297a526e218e77f1b4b273442f8ac6283e2907e6513ff36e9048aa130dea6 to sha256:e02e811dd08fd49e7f6032625495118e63f597eb150403d02e3238af1df240ba</div><div class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c rm /remove_me                        0 B</div><div class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c <span class="comment">#(nop)  ENV HELLO=world              0 B</span></div><div class="line">&lt;missing&gt;           15 seconds ago      /bin/sh -c touch remove_me /remove_me           0 B</div><div class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> world &gt;&gt; /hello                 0 B</div><div class="line">&lt;missing&gt;           16 seconds ago      /bin/sh -c <span class="built_in">echo</span> hello &gt; /hello                  0 B</div><div class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD [&quot;sh&quot;]                   0 B</span></div><div class="line">&lt;missing&gt;           5 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:ced3aa7577c8f97...   1.09 MB</span></div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x5C42;&#x7684;&#x5C42;ID&#x90FD; <code>&lt;missing&gt;</code> &#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x591A;&#x4E86;&#x4E00;&#x5C42; <code>merge</code>&#x3002;</p>
<p><strong>&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x89E3;&#x51B3;&#x61D2;&#x60F0;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x64B0;&#x5199; Dockerfile &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F9D;&#x65E7;&#x9700;&#x8981;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4E0D;&#x8981;&#x8BD5;&#x56FE;&#x7528;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x53BB;&#x538B;&#x7F29;&#x955C;&#x50CF;&#x3002;</strong></p>
<h1 id="an-zhuang"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5; <a href="#an-zhuang" class="header-anchor">#</a></h1><h2 id="jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti"><a href="#&#x89E3;&#x51B3;-GFW-&#x5F71;&#x54CD;-Docker-&#x5B89;&#x88C5;&#x95EE;&#x9898;" class="headerlink" title="&#x89E3;&#x51B3; GFW &#x5F71;&#x54CD; Docker &#x5B89;&#x88C5;&#x95EE;&#x9898;"></a>&#x89E3;&#x51B3; <code>GFW</code> &#x5F71;&#x54CD; <code>Docker</code> &#x5B89;&#x88C5;&#x95EE;&#x9898; <a href="#jie-jue-gfw-ying-xiang-docker-an-zhuang-wen-ti" class="header-anchor">#</a></h2><p>&#x5B98;&#x65B9;&#x7684; <code>apt</code>/<code>yum</code> &#x6E90;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>AWS</code> &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x4E86;&#x786E;&#x4FDD;&#x5B89;&#x5168;&#x4F7F;&#x7528;&#x4E86; <code>HTTPS</code>&#xFF0C;&#x56E0;&#x6B64;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x5F88;&#x4E50;&#x4E8E;&#x5E72;&#x6270;&#x5927;&#x5BB6;&#x4F7F;&#x7528;&#x3002;&#x6CA1;&#x529E;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5404;&#x4E2A;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7EB7;&#x7EB7;&#x5EFA;&#x7ACB;&#x81EA;&#x5DF1;&#x5B98;&#x65B9;&#x6E90;&#x955C;&#x50CF;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x3001;DaoCloud&#x3001;Azura &#x7B49;&#x7B49;&#xFF0C;&#x5E76;&#x4E14;&#x81EA;&#x5DF1;&#x505A;&#x4E86;&#x4E2A;&#x4FEE;&#x8BA2;&#x7248;&#x7684; <code>https://get.docker.com</code> &#x7684;&#x811A;&#x672C;&#x6765;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x5B98;&#x65B9;&#x7684; <code>https://get.docker.com</code> &#x5C06;&#x652F;&#x6301; <code>--mirror</code> &#x53C2;&#x6570;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7528;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x6E90;&#xFF0C;&#x76EE;&#x524D;&#x652F;&#x6301;&#x5FAE;&#x8F6F;&#x7684; Azure &#x4E91;&#xFF0C;&#xFF08;<a href="https://github.com/docker/docker/pull/28858" target="_blank" rel="external">&#x6216;&#x963F;&#x91CC;&#x4E91;&#xFF1F;</a>&#xFF09;&#x3002;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF0C;&#x5C06;&#x539F;&#x6765;&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL https://get.docker.com/ | sh</div></pre></td></tr></table></figure>
<p>&#x66FF;&#x6362;&#x4E3A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL https://get.docker.com/ | sh <span class="_">-s</span> -- --mirror AzureChinaCloud</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x662F;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x8BDD;&#xFF0C;&#x5C06; <code>AzureChinaCloud</code> &#x66FF;&#x6362;&#x4E3A; <code>Aliyun</code>&#x3002;</p>
<p><em>&#x6B64;&#x65F6;&#xFF0C;<a href="https://get.docker.com/" target="_blank" rel="external">https://get.docker.com/</a> &#x5C1A;&#x672A;&#x66F4;&#x65B0;&#xFF0C;&#x6240;&#x4EE5;&#x6682;&#x65F6;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5728; 1.13 &#x6B63;&#x5F0F;&#x53D1;&#x5E03;&#x540E;&#xFF0C;&#x5373;&#x53EF;&#x4F7F;&#x7528;&#x3002;</em></p>
<h2 id="zeng-jia-geng-duo-de-xi-tong-zhi-chi"><a href="#&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;" class="headerlink" title="&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301;"></a>&#x589E;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x7CFB;&#x7EDF;&#x652F;&#x6301; <a href="#zeng-jia-geng-duo-de-xi-tong-zhi-chi" class="header-anchor">#</a></h2><p>&#x5728;&#x8FD9;&#x6B21;&#x53D1;&#x5E03;&#x4E2D;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <code>Ubuntu 16.10</code> &#x7684;&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x800C;&#x4E14;&#x5BF9; <code>Ubuntu</code> &#x7CFB;&#x7EDF;&#x589E;&#x52A0;&#x4E86; <code>PPC64LE</code> &#x548C; <code>s390x</code> &#x6784;&#x67B6;&#x7684;&#x5B89;&#x88C5;&#x5305;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x6B63;&#x5F0F;&#x652F;&#x6301;&#x4E86; <code>VMWare Photon OS</code> &#x7CFB;&#x7EDF;&#x7684; <code>RPM</code> &#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x4EE5;&#x53CA;&#x5728; <code>https://get.docker.com</code> &#x7684;&#x652F;&#x6301;&#x3002;&#x5E76;&#x4E14;&#x652F;&#x6301;&#x4E86; <code>Fedora 25</code>&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x7ED3;&#x675F;&#xFF0C;&#x800C;&#x88AB;&#x79FB;&#x9664;&#x652F;&#x6301;&#xFF0C;&#x6BD4;&#x5982; <code>Ubuntu 15.10</code>&#x3001;<code>Fedora 22</code> &#x90FD;&#x4E0D;&#x5728;&#x652F;&#x6301;&#x4E86;&#x3002;</p>
<h1 id="wang-luo"><a href="#&#x7F51;&#x7EDC;" class="headerlink" title="&#x7F51;&#x7EDC;"></a>&#x7F51;&#x7EDC; <a href="#wang-luo" class="header-anchor">#</a></h1><h2 id="yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo"><a href="#&#x5141;&#x8BB8;-docker-run-&#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684;-swarm-mode-&#x7684;&#x7F51;&#x7EDC;" class="headerlink" title="&#x5141;&#x8BB8; docker run &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; swarm mode &#x7684;&#x7F51;&#x7EDC;"></a>&#x5141;&#x8BB8; <code>docker run</code> &#x8FDE;&#x5165;&#x6307;&#x5B9A;&#x7684; <code>swarm mode</code> &#x7684;&#x7F51;&#x7EDC; <a href="#yun-xu-docker-run-lian-ru-zhi-ding-de-swarm-mode-de-wang-luo" class="header-anchor">#</a></h2><p>&#x5728; Docker 1.12 &#x53D1;&#x5E03;&#x65B0;&#x7684; Swarm Mode &#x4E4B;&#x540E;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x95EE;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x8BA9; <code>docker run</code> &#x8FDE;&#x5165;&#x670D;&#x52A1;&#x7684; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E2D;&#x53BB;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#xFF0C;&#x56E0;&#x4E3A; <code>swarm</code> &#x7684; <code>overaly</code> &#x662F;&#x4E3A;&#x4E86; <code>swarm service</code> &#x51C6;&#x5907;&#x7684;&#xFF0C;&#x76F8;&#x5BF9;&#x66F4;&#x5065;&#x58EE;&#xFF0C;&#x800C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker run</code>&#xFF0C;&#x4F1A;&#x7834;&#x574F;&#x4E86;&#x8FD9;&#x91CC;&#x9762;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5927;&#x5BB6;&#x9700;&#x6C42;&#x5F88;&#x591A;&#xFF0C;&#x4E8E;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x6298;&#x8877;&#x7684;&#x529E;&#x6CD5;&#x3002;1.13 &#x5141;&#x8BB8;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BBE;&#x5B9A;&#x8BE5;&#x7F51;&#x7EDC;&#x4E3A; <code>attachable</code>&#xFF0C;&#x5141;&#x8BB8;&#x4E4B;&#x540E;&#x7684; <code>docker run</code> &#x7684;&#x5BB9;&#x5668;&#x8FDE;&#x63A5;&#x5230;&#x8BE5;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0D;&#x5141;&#x8BB8;&#x4E4B;&#x540E; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker network create <span class="_">-d</span> overlay mynet1</div><div class="line">xmgoco2vfrtp0ggc5r0p5z4mg</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5141;&#x8BB8; <code>attach</code> &#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x4F7F;&#x7528; 1.13 &#x65B0;&#x52A0;&#x5165;&#x7684; <code>--attachable</code> &#x53C2;&#x6570;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker network create <span class="_">-d</span> overlay --attachable mynet2</div><div class="line">yvcyhoc6ni0436jux9azc4cjt</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x4E00;&#x4E2A; <code>web</code> &#x670D;&#x52A1;&#xFF0C;&#x8FDE;&#x5165;&#x8FD9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ docker service create \</div><div class="line">    --name web \</div><div class="line">    --network mynet1 \</div><div class="line">    --network mynet2 \</div><div class="line">    nginx</div><div class="line">vv91wd7166y80lbl833rugl2z</div></pre></td></tr></table></figure>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7528; <code>docker run</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x8FDE;&#x5165;&#x7B2C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker run -it --rm --network mynet1 busybox</div><div class="line">docker: Error response from daemon: Could not attach to network mynet1: rpc error: code = 7 desc = network mynet1 not manually attachable.</div></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E; <code>mynet1</code> &#x4E0D;&#x5141;&#x8BB8;&#x624B;&#x52A8; <code>attach</code> &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x62A5;&#x9519;&#x4E86;&#x3002;</p>
<p>&#x5728; 1.12 &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F1A;&#x62A5;&#x544A;&#x8BE5;&#x7F51;&#x7EDC;&#x65E0;&#x6CD5;&#x7ED9; <code>docker run</code> &#x4F7F;&#x7528;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker: Error response from daemon: swarm-scoped network (mynet1) is not compatible with `docker create` or `docker run`. This network can only be used by a docker service.</div><div class="line">See <span class="string">&apos;docker run --help&apos;</span>.</div></pre></td></tr></table></figure>
<p><strong>&#x4E0D;&#x8FC7;&#xFF0C;<code>--attachable</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;&#x7F51;&#x7EDC;&#x7684;&#x5B89;&#x5168;&#x6A21;&#x578B;&#x6253;&#x5F00;&#x4E86;&#x4E00;&#x4E2A;&#x7F3A;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;&#x7528;&#x6237;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x77E5;&#x9053;&#x81EA;&#x5DF1;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#x3002;</strong></p>
<h2 id="yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou"><a href="#&#x5141;&#x8BB8;-docker-service-create-&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;" class="headerlink" title="&#x5141;&#x8BB8; docker service create &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;"></a>&#x5141;&#x8BB8; <code>docker service create</code> &#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3; <a href="#yun-xu-docker-service-create-ying-she-su-zhu-duan-kou-er-bu-shi-bian-jie-fu-zai-jun-heng-wang-luo-duan-kou" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;<code>docker service create</code> &#x4E2D;&#x7684; <code>--publish</code> &#x5C06;&#x6539;&#x4E3A; <code>--port</code>&#xFF08;&#x7F29;&#x5199;&#x8FD8;&#x662F; <code>-p</code> &#x4E0D;&#x53D8;&#xFF09;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5BF9;&#x6620;&#x5C04;&#x5F00;&#x653E;&#x7AEF;&#x53E3;&#x6709;&#x4E86;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x539F;&#x6765;&#x7684; <code>--publish 1234:1234</code> &#x7684;&#x683C;&#x5F0F;&#x5DF2;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x5728; 1.12 &#x4E2D;&#xFF0C;<code>docker service create</code> &#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x53C2;&#x6570; <code>--publish 80:80</code> &#x8FD9;&#x7C7B;&#x5F62;&#x5F0F;&#x6620;&#x5C04;<strong>&#x8FB9;&#x754C;(ingress)&#x7F51;&#x7EDC;</strong>&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x6620;&#x5C04;&#x4F1A;&#x4EAB;&#x53D7;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4EE5;&#x53CA; routing mesh&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x589E;&#x52A0;&#x53E6;&#x4E00;&#x79CD;&#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF0C;&#x88AB;&#x79F0;&#x4E3A; <code>host</code> &#x6A21;&#x5F0F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x7528;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x6620;&#x5C04;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x53EA;&#x4F1A;&#x6620;&#x5C04;&#x4E8E;&#x5BB9;&#x5668;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x3002;&#x8FD9;&#x5C31;&#x548C;&#x4E00;&#x4EE3; Swarm &#x4E2D;&#x4E00;&#x6837;&#x4E86;&#x3002;&#x867D;&#x7136;&#x5931;&#x53BB;&#x4E86;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4F46;&#x662F;&#x786E;&#x5B9A;&#x4E86;&#x6620;&#x5C04;&#x70B9;&#xFF0C;&#x6709;&#x7684;&#x65F6;&#x5019;&#x66F4;&#x65B9;&#x4FBF;&#x7BA1;&#x7406;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x65B0;&#x7684; <code>--port</code> &#x7684;&#x53C2;&#x6570;&#x5F62;&#x5F0F;&#x548C; <code>--mount</code> &#x5DEE;&#x4E0D;&#x591A;&#x3002;&#x53C2;&#x6570;&#x503C;&#x4E3A; <code>,</code> &#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x952E;&#x503C;&#x95F4;&#x4EE5; <code>=</code> &#x7B49;&#x53F7;&#x5206;&#x9694;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301; 4 &#x9879;&#x5185;&#x5BB9;&#xFF1A;</p>
<ul>
<li><code>protocol</code>&#xFF1A; &#x652F;&#x6301; <code>tcp</code> &#x6216;&#x8005; <code>udp</code></li>
<li><code>mode</code>&#xFF1A; &#x652F;&#x6301; <code>ingress</code> &#x6216;&#x8005; <code>host</code></li>
<li><code>target</code>&#xFF1A; &#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
<li><code>published</code>&#xFF1A; &#x6620;&#x5C04;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x53F7;</li>
</ul>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E0E; <code>-p 8080:80</code> &#x7B49;&#x6548;&#x7684; <code>--port</code> &#x9009;&#x9879;&#x4E3A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">--port protocol=tcp,mode=ingress,published=8080,target=80</div></pre></td></tr></table></figure>
<p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; <code>-p 8080:80</code>&#xFF0C;&#x4F46;&#x662F;&#x65B0;&#x7684;&#x9009;&#x9879;&#x683C;&#x5F0F;&#x589E;&#x52A0;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x53EF;&#x80FD;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4F7F;&#x7528; 1.13 &#x5F00;&#x59CB;&#x52A0;&#x5165;&#x7684; <code>host</code> &#x6620;&#x5C04;&#x6A21;&#x5F0F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ubuntu@d1:~$ docker service create --name web \</div><div class="line">    --port mode=host,published=80,target=80 \</div><div class="line">    nginx</div></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ubuntu@d1:~$ docker node ls</div><div class="line">ID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS</div><div class="line">ntjybj51u6zp44akeawuf3i05    d2        Ready   Active</div><div class="line">tp7icvjzvxla2n18j3nztgjz6    d3        Ready   Active</div><div class="line">vyf3mgcj3uonrnh5xxquasp38 *  d1        Ready   Active        Leader</div><div class="line">ubuntu@d1:~$ docker service ps web</div><div class="line">NAME                IMAGE         NODE  DESIRED STATE  CURRENT STATE               ERROR  PORTS</div><div class="line">web.1.ey0mw8o8h2tx  nginx:latest  d3    Running        Running about a minute ago</div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x96C6;&#x7FA4;&#x6709;3&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x670D;&#x52A1;&#x5C31;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x8DD1;&#x5230;&#x4E86; <code>d3</code> &#x4E0A;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x4EE5;&#x524D;&#x7684;&#x4F7F;&#x7528;&#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x7F51;&#x7EDC; <code>ingress</code> &#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#x90FD;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;<code>host</code> &#x6A21;&#x5F0F;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x53EA;&#x6620;&#x5C04;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x5BBF;&#x4E3B;&#x7684;&#x7AEF;&#x53E3;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC; <code>curl d1</code> &#x7684;&#x8BDD;&#xFF0C;&#x5E94;&#x8BE5;&#x4EC0;&#x4E48;&#x770B;&#x4E0D;&#x5230;&#x7F51;&#x9875;&#xFF0C;&#x800C; <code>curl d3</code> &#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x9875;&#x9762;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@d1:~$ curl localhost</div><div class="line">curl: (7) Failed to connect to localhost port 80: Connection refused</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">root@d3:~$ curl localhost</div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue"><a href="#iptables-&#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;" class="headerlink" title="iptables &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;"></a><code>iptables</code> &#x7684;&#x8F6C;&#x53D1;&#x89C4;&#x5219;&#x5C06;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD; <a href="#iptables-de-zhuan-fa-gui-ze-jiang-mo-ren-ju-jue" class="header-anchor">#</a></h2><p>&#x4ECE;&#x9ED8;&#x8BA4;&#x5141;&#x8BB8;&#x6539;&#x4E3A;&#x9ED8;&#x8BA4;&#x62D2;&#x7EDD;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x5BB9;&#x5668;&#x5916;&#x9732;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<h2 id="zai-docker-network-inspect-li-xian-shi-lian-ru-jie-dian"><a href="#&#x5728;-docker-network-inspect-&#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9;" class="headerlink" title="&#x5728; docker network inspect &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9;"></a>&#x5728; <code>docker network inspect</code> &#x91CC;&#x663E;&#x793A;&#x8FDE;&#x5165;&#x8282;&#x70B9; <a href="#zai-docker-network-inspect-li-xian-shi-lian-ru-jie-dian" class="header-anchor">#</a></h2><p>Show peer nodes in docker network inspect for swarm overlay networks #28078</p>
<h2 id="yun-xu-service-vip-ke-yi-bei-ping"><a href="#&#x5141;&#x8BB8;-service-VIP-&#x53EF;&#x4EE5;&#x88AB;-ping" class="headerlink" title="&#x5141;&#x8BB8; service VIP &#x53EF;&#x4EE5;&#x88AB; ping"></a>&#x5141;&#x8BB8; <code>service</code> <code>VIP</code> &#x53EF;&#x4EE5;&#x88AB; <code>ping</code> <a href="#yun-xu-service-vip-ke-yi-bei-ping" class="header-anchor">#</a></h2><p>&#x5728; 1.12 &#x7684;&#x4E8C;&#x4EE3; Swarm &#x6392;&#x969C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x8DE8;&#x8282;&#x70B9;&#x7684;&#x670D;&#x52A1; VIP &#x4E0D;&#x53EF;&#x4EE5; <code>ping</code>&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x5F88;&#x591A;&#x65F6;&#x5019;&#x641E;&#x4E0D;&#x61C2;&#x662F; <code>overlay</code> &#x7F51;&#x7EDC;&#x4E0D;&#x901A;&#x5462;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x6CA1;&#x8D77;&#x6765;&#xFF1F;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6709;&#x95EE;&#x9898;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728; 1.13 &#x89E3;&#x51B3;&#x4E86;&#xFF0C;VIP &#x53EF;&#x4EE5;&#x968F;&#x4FBF; <code>ping</code>&#xFF0C;&#x8DE8;&#x5BBF;&#x4E3B;&#x4E5F;&#x6CA1;&#x5173;&#x7CFB;&#x3002;</p>
<h1 id="cha-jian"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6; <a href="#cha-jian" class="header-anchor">#</a></h1><h2 id="cha-jian-gong-neng-zheng-shi-qi-yong"><a href="#&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;" class="headerlink" title="&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528;"></a>&#x63D2;&#x4EF6;&#x529F;&#x80FD;&#x6B63;&#x5F0F;&#x542F;&#x7528; <a href="#cha-jian-gong-neng-zheng-shi-qi-yong" class="header-anchor">#</a></h2><p>&#x5728; 1.12 &#x5F15;&#x5165;&#x4E86;&#x63D2;&#x4EF6;&#x6982;&#x5FF5;&#x540E;&#xFF0C;&#x4F5C;&#x4E3A;&#x8BD5;&#x9A8C;&#x7279;&#x6027;&#x5F97;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x5173;&#x6CE8;&#x3002;&#x5305;&#x62EC;&#x670D;&#x52A1;&#x7AEF;&#x7684; <a href="https://store.docker.com/" target="_blank" rel="external">Docker Store</a> &#x5F00;&#x59CB;&#x51C6;&#x5907;&#x4E0A;&#x7EBF;&#xFF0C;&#x4EE5;&#x53CA;&#x7B2C;&#x4E09;&#x65B9;&#x7684;&#x63D2;&#x4EF6;&#x7684;&#x5F00;&#x53D1;&#x3002;&#x73B0;&#x5728; 1.13 &#x63D2;&#x4EF6;&#x4F5C;&#x4E3A;&#x6B63;&#x5F0F;&#x529F;&#x80FD;&#x63D0;&#x4F9B;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">$ docker plugin</div><div class="line"></div><div class="line">Usage:	docker plugin COMMAND</div><div class="line"></div><div class="line">Manage plugins</div><div class="line"></div><div class="line">Options:</div><div class="line">      --help   Print usage</div><div class="line"></div><div class="line">Commands:</div><div class="line">  create      Create a plugin from a rootfs and config</div><div class="line">  <span class="built_in">disable</span>     Disable a plugin</div><div class="line">  <span class="built_in">enable</span>      Enable a plugin</div><div class="line">  inspect     Display detailed information on one or more plugins</div><div class="line">  install     Install a plugin</div><div class="line">  ls          List plugins</div><div class="line">  push        Push a plugin to a registry</div><div class="line">  rm          Remove one or more plugins</div><div class="line">  <span class="built_in">set</span>         Change settings <span class="keyword">for</span> a plugin</div><div class="line"></div><div class="line">Run <span class="string">&apos;docker plugin COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p>&#x76F8;&#x6BD4;&#x4E8E; 1.12 &#x7684;&#x8BD5;&#x9A8C;&#x7248;&#x672C;&#x800C;&#x8A00;&#xFF0C;&#x589E;&#x52A0;&#x4E86; <code>docker plugin create</code> &#x547D;&#x4EE4;&#xFF0C;&#x6307;&#x5B9A; <code>rootfs</code> &#x548C; <code>config.json</code> &#x5373;&#x53EF;&#x521B;&#x5EFA;&#x63D2;&#x4EF6;&#x3002;</p>
<h1 id="ming-ling-xing"><a href="#&#x547D;&#x4EE4;&#x884C;" class="headerlink" title="&#x547D;&#x4EE4;&#x884C;"></a>&#x547D;&#x4EE4;&#x884C; <a href="#ming-ling-xing" class="header-anchor">#</a></h1><h2 id="shi-yan-checkpoint-gong-neng"><a href="#&#x8BD5;&#x9A8C;-checkpoint-&#x529F;&#x80FD;" class="headerlink" title="&#x8BD5;&#x9A8C; checkpoint &#x529F;&#x80FD;"></a>&#x8BD5;&#x9A8C; <code>checkpoint</code> &#x529F;&#x80FD; <a href="#shi-yan-checkpoint-gong-neng" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x5C06;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x4FDD;&#x5B58; checkpoint&#xFF0C;&#x5728;&#x5C06;&#x6765;&#x53EF;&#x4EE5; restore&#x3002;&#x56E0;&#x6B64;&#x5F15;&#x5165; <code>docker checkpoint</code> &#x547D;&#x4EE4;&#x3002;</p>
<p>(experimental) Implement checkpoint and restore #22049</p>
<h1 id="yun-xing-shi"><a href="#&#x8FD0;&#x884C;&#x65F6;" class="headerlink" title="&#x8FD0;&#x884C;&#x65F6;"></a>&#x8FD0;&#x884C;&#x65F6; <a href="#yun-xing-shi" class="header-anchor">#</a></h1><h2 id="bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu"><a href="#&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;-experimental-&#x53C2;&#x6570;" class="headerlink" title="&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; --experimental &#x53C2;&#x6570;"></a>&#x4E0D;&#x5728;&#x5206;&#x522B;&#x6784;&#x5EFA;&#x8BD5;&#x9A8C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>--experimental</code> &#x53C2;&#x6570; <a href="#bu-zai-fen-bie-gou-jian-shi-yan-ke-zhi-xing-wen-jian-zhi-jie-shi-yong-experimental-can-shu" class="header-anchor">#</a></h2><p>&#x4EE5;&#x524D;&#x6211;&#x4EEC;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x6D4B;&#x8BD5;&#x5F53;&#x524D;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x5FC5;&#x987B;&#x6DFB;&#x52A0;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x6E90;&#xFF0C;&#x91CD;&#x88C5; <code>docker</code>&#x3002;&#x8FD9;&#x7ED9;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x5206;&#x652F;&#x5E26;&#x6765;&#x4E86;&#x56F0;&#x96BE;&#x3002;&#x73B0;&#x5728;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x4E0D;&#x5728;&#x5206;&#x4E3A;&#x4E24;&#x7EC4;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6784;&#x5EFA;&#xFF0C;&#x5408;&#x5E76;&#x4E3A;&#x4E00;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x6D4B;&#x8BD5;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x76F4;&#x63A5;&#x5728; <code>dockerd</code> &#x540E;&#x6DFB;&#x52A0; <code>--experimental</code> &#x5373;&#x53EF;&#x3002;</p>
<h2 id="zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e"><a href="#&#x5728;-overlay2-&#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E;-xfs-&#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;" class="headerlink" title="&#x5728; overlay2 &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; xfs &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D;"></a>&#x5728; <code>overlay2</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#x4F7F;&#x7528;&#x4E8E; <code>xfs</code> &#x65F6;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x78C1;&#x76D8;&#x914D;&#x989D; <a href="#zai-overlay2-cun-chu-qu-dong-shi-yong-yu-xfs-shi-ke-yi-tian-jia-ci-pan-pei-e" class="header-anchor">#</a></h2><p>&#x5728; 1.13 &#x4E4B;&#x524D;&#xFF0C;&#x53EA;&#x6709;&#x5757;&#x8BBE;&#x5907;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9A71;&#x52A8;&#xFF08;&#x5982; <code>devicemapper</code>, <code>xfs</code>, <code>zfs</code>&#x7B49;&#xFF09;&#x652F;&#x6301;&#x78C1;&#x76D8;&#x914D;&#x989D;&#x80FD;&#x529B;&#xFF0C;&#x800C;&#x6240;&#x6709; <code>Union FS</code> &#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x914D;&#x989D;&#x3002;&#x73B0;&#x5728;&#x9488;&#x5BF9;&#x4F7F;&#x7528; <code>XFS</code> &#x4E3A;&#x540E;&#x7AEF;&#x7684; <code>overlay2</code> &#x9A71;&#x52A8;&#x652F;&#x6301;&#x4E86;&#x78C1;&#x76D8;&#x914D;&#x989D;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5728;&#x5C06;&#x6765;&#x79FB;&#x690D;&#x5230; <code>AUFS</code>&#x3002;</p>
<h2 id="zeng-jia-docker-system-ming-ling"><a href="#&#x589E;&#x52A0;-docker-system-&#x547D;&#x4EE4;" class="headerlink" title="&#x589E;&#x52A0; docker system &#x547D;&#x4EE4;"></a>&#x589E;&#x52A0; <code>docker system</code> &#x547D;&#x4EE4; <a href="#zeng-jia-docker-system-ming-ling" class="header-anchor">#</a></h2><p>&#x5F88;&#x591A;&#x4EBA;&#x5728;&#x4EE5;&#x524D;&#x641E;&#x4E0D;&#x61C2;&#x81EA;&#x5DF1;&#x7684;&#x955C;&#x50CF;&#x5230;&#x5E95;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3001;&#x5BB9;&#x5668;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#xFF0C;&#x5377;&#x5360;&#x4E86;&#x591A;&#x5C11;&#x7A7A;&#x95F4;&#x3002;&#x600E;&#x4E48;&#x5220;&#x9664;&#x4E0D;&#x7528;&#x7684;&#x4E1C;&#x897F;&#x4EE5;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>system</code> &#x547D;&#x4EE4;&#x6765;&#x5E2E;&#x52A9;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ docker system</div><div class="line"></div><div class="line">Usage:	docker system COMMAND</div><div class="line"></div><div class="line">Manage Docker</div><div class="line"></div><div class="line">Options:</div><div class="line">     --help   Print usage</div><div class="line"></div><div class="line">Commands:</div><div class="line"> df          Show docker disk usage</div><div class="line"> events      Get real time events from the server</div><div class="line"> info        Display system-wide information</div><div class="line"> prune       Remove unused data</div><div class="line"></div><div class="line">Run <span class="string">&apos;docker system COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p><code>docker system df</code> &#x662F;&#x663E;&#x793A;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker system df</div><div class="line">TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE</div><div class="line">Images              3                   3                   700.3 MB            123 MB (17%)</div><div class="line">Containers          3                   3                   15 B                0 B (0%)</div><div class="line">Local Volumes       1                   1                   219.4 MB            0 B (0%)</div></pre></td></tr></table></figure>
<p>&#x663E;&#x793A;&#x7684;&#x5217;&#x8868;&#x4E2D;&#x5217;&#x51FA;&#x4E86;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x672C;&#x5730;&#x5377;&#x6240;&#x5360;&#x7528;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x80FD;&#x56DE;&#x6536;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x955C;&#x50CF;&#x6709; 123MB &#x7684;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x56DE;&#x6536;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;<code>docker</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4; <code>prune</code> &#x547D;&#x4EE4;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<ul>
<li><code>docker image prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;</li>
<li><code>docker container prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5BB9;&#x5668;</li>
<li><code>docker volume prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x5377;</li>
<li><code>docker network prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x7F51;&#x7EDC;</li>
<li><code>docker system prune</code>&#xFF1A;&#x5220;&#x9664;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x5377;&#x3001;&#x7F51;&#x7EDC;</li>
</ul>
<p>&#x8FD8;&#x8BB0;&#x5F97;&#x4E4B;&#x524D;&#x5220;&#x9664;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x6240;&#x7528;&#x7684; <code>docker rmi $(docker images -f dangling=true -aq)</code> &#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#x4E48;&#xFF1F;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730; <code>docker image prune</code> &#x5373;&#x53EF;&#x5220;&#x9664;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x4ECE;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x547D;&#x4EE4;&#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x4E86;&#x3002;&#x4E4B;&#x524D;&#x9ED8;&#x8BA4;&#x7684; <code>docker info</code>&#xFF0C;<code>docker ps</code>&#xFF0C;<code>docker rm</code>&#xFF0C;<code>docker run</code> &#x90FD;&#x5F00;&#x59CB;&#x5F52;&#x7C7B;&#x4E8E;&#x5BF9;&#x5E94;&#x7684; <code>docker image</code>, <code>docker container</code>, <code>docker system</code> &#x4E0B;&#x4E86;&#x3002;&#x76EE;&#x524D;&#x4E4B;&#x524D;&#x7684;&#x547D;&#x4EE4;&#x4F9D;&#x65E7;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x4F1A;&#x7EE7;&#x7EED;&#x4FDD;&#x6301;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x3002;&#x4F46;&#x662F;&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5404;&#x4E2A;&#x5B50;&#x547D;&#x4EE4;&#x7684;&#x7248;&#x672C;&#x4E86;&#x3002;</p>
<h2 id="ti-sheng-overlay2-de-you-xian-ji"><a href="#&#x63D0;&#x5347;-overlay2-&#x7684;&#x4F18;&#x5148;&#x7EA7;" class="headerlink" title="&#x63D0;&#x5347; overlay2 &#x7684;&#x4F18;&#x5148;&#x7EA7;"></a>&#x63D0;&#x5347; <code>overlay2</code> &#x7684;&#x4F18;&#x5148;&#x7EA7; <a href="#ti-sheng-overlay2-de-you-xian-ji" class="header-anchor">#</a></h2><p>&#x7531;&#x4E8E; <code>overlay2</code> &#x5728; 4.+ &#x5185;&#x6838;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;&#x8D8B;&#x4E8E;&#x7A33;&#x5B9A;&#xFF0C;&#x56E0;&#x6B64;&#x5C06;&#x5176;&#x4F18;&#x5148;&#x7EA7;&#x63D0;&#x5230; <code>devicemapper</code> &#x4E4B;&#x4E0A;&#xFF08;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#x7684;&#x4F9D;&#x65E7;&#x662F; <code>aufs</code>&#xFF09;</p>
<h2 id="docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang"><a href="#docker-exec-t-&#x81EA;&#x52A8;&#x6DFB;&#x52A0;-TERM-&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="headerlink" title="docker exec -t &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF;"></a><code>docker exec -t</code> &#x81EA;&#x52A8;&#x6DFB;&#x52A0; TERM &#x73AF;&#x5883;&#x53D8;&#x91CF; <a href="#docker-exec-t-zi-dong-tian-jia-term-huan-jing-bian-liang" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x4F7F;&#x7528; <code>vi</code>&#x3001;<code>htop</code> &#x4E4B;&#x7C7B;&#x5DE5;&#x5177;&#x7684;&#x4EBA;&#x6765;&#x8BF4;&#x662F;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x7684;&#x3002;&#x4E4B;&#x524D;&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x5B9A;&#x4E49; <code>TERM</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x9700;&#x8981;&#x7EC8;&#x7AEF;&#x9875;&#x9762;&#x5E03;&#x5C40;&#x7684;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x53EF;&#x80FD;&#x4F1A;&#x4E0D;&#x6B63;&#x5E38;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ htop</div><div class="line">Error opening terminal: unknown.</div></pre></td></tr></table></figure>
<p>&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x4E3A; <code>docker exec -t</code> &#x9009;&#x9879;&#x6DFB;&#x52A0;&#x4E86;&#x7EE7;&#x627F;&#x81EA;&#x5F53;&#x524D;&#x7684; <code>TERM</code> &#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;&#x7C7B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x3002;</p>
<h1 id="swarm-mode"><a href="#Swarm-Mode" class="headerlink" title="Swarm Mode"></a>Swarm Mode <a href="#swarm-mode" class="header-anchor">#</a></h1><h2 id="zheng-shi-zhi-chi-docker-stack"><a href="#&#x6B63;&#x5F0F;&#x652F;&#x6301;-docker-stack" class="headerlink" title="&#x6B63;&#x5F0F;&#x652F;&#x6301; docker stack"></a>&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code> <a href="#zheng-shi-zhi-chi-docker-stack" class="header-anchor">#</a></h2><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x6B63;&#x5F0F;&#x652F;&#x6301; <code>docker stack</code>&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x76F4;&#x63A5;&#x4ECE; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x4E8C;&#x4EE3; Swarm &#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x3002;</p>
<p>1.12 &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x4E5F;&#x5C31;&#x662F; Swarm Mode&#x3002;&#x7531;&#x4E8E;&#x57FA;&#x7840;&#x7406;&#x5FF5;&#x53D8;&#x5316;&#x5F88;&#x5927;&#xFF0C;&#x56E0;&#x6B64;&#x5148;&#x884C;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x57FA;&#x672C;&#x7684;&#x670D;&#x52A1;(<code>service</code>)&#xFF0C;&#x4F46;&#x662F;&#x9488;&#x5BF9;&#x5E94;&#x7528;/&#x670D;&#x52A1;&#x6808;(<code>stack</code>)&#x6CA1;&#x6709;&#x6210;&#x719F;&#x7684;&#x65B9;&#x6848;&#x3002;&#x53EA;&#x662F;&#x8BD5;&#x884C;&#x4F7F;&#x7528; <code>DAB</code> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x3002;&#x4F46;&#x662F; <code>DAB</code> &#x662F; <code>JSON</code> &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x64B0;&#x5199;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#x3002;&#x76F8;&#x5BF9;&#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x7684; <code>docker-compose.yml</code> &#x5374;&#x65E0;&#x6CD5;&#x5728; <code>docker stack</code> &#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;&#x53EA;&#x53EF;&#x4EE5;&#x7528; <code>docker-compose bundle</code> &#x547D;&#x4EE4;&#x5C06; <code>docker-compose.yml</code> &#x8F6C;&#x6362;&#x4E3A; <code>.dab</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x62FF;&#x5230;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x7528;&#x4E0D;&#x4E86;&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5141;&#x8BB8;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#xFF0C;&#x5927;&#x5927;&#x65B9;&#x4FBF;&#x4E86;&#x4E60;&#x60EF;&#x4E86; <code>docker compose</code> &#x7684;&#x7528;&#x6237;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x6982;&#x5FF5;&#x5DEE;&#x5F02;&#xFF0C;&#x539F;&#x6709;&#x7684; <code>docker-compose.yml</code> <code>v2</code> &#x683C;&#x5F0F;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>v3</code> &#x683C;&#x5F0F;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F; <code>v3</code> &#x548C; <code>v2</code> &#x683C;&#x5F0F;&#x5DEE;&#x8DDD;&#x4E0D;&#x5927;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x663E;&#x7136;&#x7B2C;&#x4E00;&#x884C;&#x7684; <code>version: &apos;2&apos;</code> &#x9700;&#x8981;&#x6362;&#x6210; <code>version: &apos;3&apos;</code>&#xFF0C;&#x5176;&#x6B21;&#xFF0C;&#x670D;&#x52A1;&#x91CC;&#x7684; <code>build</code> &#x663E;&#x7136;&#x7528;&#x4E0D;&#x4E86;&#x4E86;&#x3002;&#x4EE5;&#x6211;&#x5199;&#x7684; LNMP &#x4E3A;&#x4F8B;&#xFF0C;&#x6539;&#x6210; <code>v3</code> &#x683C;&#x5F0F;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x662F;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">&apos;3&apos;</span></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">    nginx:</span></div><div class="line"><span class="attr">        image:</span> <span class="string">&quot;twang2218/lnmp-nginx:v1.2&quot;</span></div><div class="line"><span class="attr">        ports:</span></div><div class="line"><span class="bullet">            -</span> <span class="string">&quot;80:80&quot;</span></div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> frontend</div><div class="line"><span class="attr">        depends_on:</span></div><div class="line"><span class="bullet">            -</span> php</div><div class="line"><span class="attr">    php:</span></div><div class="line"><span class="attr">        image:</span> <span class="string">&quot;twang2218/lnmp-php:v1.2&quot;</span></div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> frontend</div><div class="line"><span class="bullet">            -</span> backend</div><div class="line"><span class="attr">        environment:</span></div><div class="line"><span class="attr">            MYSQL_PASSWORD:</span> Passw0rd</div><div class="line"><span class="attr">        depends_on:</span></div><div class="line"><span class="bullet">            -</span> mysql</div><div class="line"><span class="attr">    mysql:</span></div><div class="line"><span class="attr">        image:</span> mysql:<span class="number">5.7</span></div><div class="line"><span class="attr">        volumes:</span></div><div class="line"><span class="attr">            - mysql-data:</span>/var/lib/mysql</div><div class="line"><span class="attr">        environment:</span></div><div class="line"><span class="attr">            TZ:</span> <span class="string">&apos;Asia/Shanghai&apos;</span></div><div class="line"><span class="attr">            MYSQL_ROOT_PASSWORD:</span> Passw0rd</div><div class="line"><span class="attr">        command:</span> [<span class="string">&apos;mysqld&apos;</span>, <span class="string">&apos;--character-set-server=utf8&apos;</span>]</div><div class="line"><span class="attr">        networks:</span></div><div class="line"><span class="bullet">            -</span> backend</div><div class="line"><span class="attr">volumes:</span></div><div class="line"><span class="attr">    mysql-data:</span></div><div class="line"><span class="attr">networks:</span></div><div class="line"><span class="attr">    frontend:</span></div><div class="line"><span class="attr">    backend:</span></div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x5728; swarm &#x73AF;&#x5883;&#x90E8;&#x7F72;&#x8BE5;&#x670D;&#x52A1;&#x6808;&#x7684;&#x8BDD;&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ docker stack deploy --compose-file docker-compose.yml lnmp</div><div class="line">Creating network lnmp_frontend</div><div class="line">Creating network lnmp_backend</div><div class="line">Creating network lnmp_default</div><div class="line">Creating service lnmp_mysql</div><div class="line">Creating service lnmp_nginx</div><div class="line">Creating service lnmp_php</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x7528; <code>docker stack ls</code> &#x6216; <code>docker stack ps</code> &#x6765;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x6808;&#x72B6;&#x6001;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ docker stack ls</div><div class="line">NAME  SERVICES</div><div class="line">lnmp  3</div><div class="line">$ docker stack ps lnmp</div><div class="line">NAME                       IMAGE                      NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS</div><div class="line">lnmp_mysql.1.hfz88yeej0ve  mysql:5.7                  d2    Running        Running 9 seconds ago</div><div class="line">lnmp_php.1.kqk4xgr7ajn4    twang2218/lnmp-php:v1.2    d1    Running        Running 10 seconds ago</div><div class="line">lnmp_nginx.1.arrrnbuzgq9t  twang2218/lnmp-nginx:v1.2  d2    Running        Running 5 seconds ago</div></pre></td></tr></table></figure>
<p>&#x7531;&#x4E8E;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F; <code>ingress</code> &#x8FB9;&#x754C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7F51;&#x7EDC;&#x6620;&#x5C04;&#x7684; <code>80</code> &#x7AEF;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x6765;&#x67E5;&#x770B;&#x9875;&#x9762;&#xFF0C;&#x4EAB;&#x53D7;&#x4E8C;&#x4EE3; Swarm &#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#x3002;</p>
<p>&#x5220;&#x6389; <code>stack</code>&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7B80;&#x5355;&#x5730; <code>docker stack rm lnmp</code> &#x5373;&#x53EF;&#x3002;&#x4E0D;&#x8FC7;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x547D;&#x540D;&#x5377;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5982;&#x9700;&#x5220;&#x9664;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x7684;&#x53BB;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x6240;&#x5728;&#x8282;&#x70B9;&#x53BB; <code>docker volume rm</code> &#x5377;&#x3002;</p>
<h2 id="tian-jia-secret-guan-li"><a href="#&#x6DFB;&#x52A0;-secret-&#x7BA1;&#x7406;" class="headerlink" title="&#x6DFB;&#x52A0; secret &#x7BA1;&#x7406;"></a>&#x6DFB;&#x52A0; <code>secret</code> &#x7BA1;&#x7406; <a href="#tian-jia-secret-guan-li" class="header-anchor">#</a></h2><p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;Docker &#x63D0;&#x4F9B;&#x4E86;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x7684; <code>secret</code> &#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x5730;&#x5728;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#x7BA1;&#x7406;&#x5BC6;&#x7801;&#x3001;&#x5BC6;&#x94A5;&#x7B49;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">docker secret --help</div><div class="line"></div><div class="line">Usage:	docker secret COMMAND</div><div class="line"></div><div class="line">Manage Docker secrets</div><div class="line"></div><div class="line">Options:</div><div class="line">     --help   Print usage</div><div class="line"></div><div class="line">Commands:</div><div class="line"> create      Create a secret using stdin as content</div><div class="line"> inspect     Inspect a secret</div><div class="line"> ls          List secrets</div><div class="line"> rm          Remove a secret</div><div class="line"></div><div class="line">Run <span class="string">&apos;docker secret COMMAND --help&apos;</span> <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p><code>docker secret create</code> &#x4ECE;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x8BFB;&#x53D6;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x5165;&#x6307;&#x5B9A;&#x540D;&#x79F0;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="string">&quot;MySuperSecretPassword&quot;</span> | docker secret create mysql_password</div></pre></td></tr></table></figure>
<p>&#x5728;&#x5C06;&#x6765;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--secret</code> &#x9009;&#x9879;&#x6765;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x54EA;&#x4E9B; <code>secret</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$  docker service create --name privateweb --secret mysql_password nginx</div></pre></td></tr></table></figure>
<p>&#x6240;&#x6307;&#x5B9A;&#x7684; <code>secret</code> &#x4F1A;&#x4EE5;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#x6302;&#x8F7D;&#x4E8E; <code>/var/run/secrets/</code> &#x76EE;&#x5F55;&#x4E0B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root@d5cec6381df8:/<span class="comment"># ls -al /var/run/secrets/</span></div><div class="line">total 8</div><div class="line">drwxrwxrwt 2 root root   60 Dec  6 03:16 .</div><div class="line">drwxr-xr-x 4 root root 4096 Dec  6 03:16 ..</div><div class="line">-r--r--r-- 1 root root   22 Dec  6 03:16 mysql_password</div></pre></td></tr></table></figure>
<p><code>secret</code> &#x7684;&#x6743;&#x9650;&#x662F; <code>444</code> &#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x975E; <code>root</code> &#x7528;&#x6237;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5176;&#x5185;&#x5BB9;&#xFF0C;&#x8BFB;&#x53D6;&#x6240;&#x9700;&#x7684;&#x5BC6;&#x7801;&#x6216;&#x8005;&#x5BC6;&#x94A5;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x975E; root &#x7528;&#x6237;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x5F88;&#x91CD;&#x8981;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@d5cec6381df8:/<span class="comment"># cat /var/run/secrets/mysql_password</span></div><div class="line">MySuperSecretPassword</div></pre></td></tr></table></figure>
<h2 id="tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi"><a href="#&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301;"></a>&#x6DFB;&#x52A0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x548C;DNS&#x8BB0;&#x5F55;&#x5BF9;&#x65B0;&#x589E;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x652F;&#x6301; <a href="#tian-jia-fu-zai-jun-heng-he-dns-ji-lu-dui-xin-zeng-de-jian-kang-jian-cha-de-zhi-chi" class="header-anchor">#</a></h2><p>Docker 1.10 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x7136;&#x540E;&#x5728; 1.11 &#x8FDB;&#x4E00;&#x6B65;&#x652F;&#x6301;&#x4E86; DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;1.12 &#x5F00;&#x59CB;&#x5F15;&#x5165;&#x4E86; VIP &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#x800C; 1.12 &#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86; <code>HEALTHCHECK</code> &#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x7684;&#x80FD;&#x529B;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E24;&#x7EC4;&#x529F;&#x80FD;&#x5728; 1.12 &#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#xFF0C;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5C31;&#x5DF2;&#x7ECF;&#x5C06;&#x6D41;&#x91CF;&#x5F00;&#x59CB;&#x5BFC;&#x6D41;&#x7ED9;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x4E2D;&#x90E8;&#x5206;&#x670D;&#x52A1;&#x4F1A;&#x8BBF;&#x95EE;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x5728; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5229;&#x7528; <code>Dockerfile</code> &#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x529F;&#x80FD;&#xFF0C;&#x6765;&#x68C0;&#x67E5;&#x5BB9;&#x5668;&#x5065;&#x5EB7;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5C1A;&#x672A;&#x5904;&#x4E8E;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA; DNS &#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5C06;&#x4E0D;&#x4F1A;&#x628A;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x7ED9;&#x8FD9;&#x4E2A;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5230;&#x5BB9;&#x5668;&#x786E;&#x5B9E;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x518D;&#x66F4;&#x65B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EE5;&#x53CA;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>
<h2 id="tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng"><a href="#&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;" class="headerlink" title="&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD;"></a>&#x6DFB;&#x52A0;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x56DE;&#x6EDA;&#x7684;&#x529F;&#x80FD; <a href="#tian-jia-gun-dong-sheng-ji-hui-gun-de-gong-neng" class="header-anchor">#</a></h2><p>&#x5F53; Docker 1.12 &#x63D0;&#x4F9B;&#x4E86; Swarm Mode &#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x540E;&#xFF0C;&#x5927;&#x5BB6;&#x90FD;&#x5F88;&#x5174;&#x594B;&#xFF0C;&#x5185;&#x7F6E;&#x7684;&#x6EDA;&#x52A8;&#x5347;&#x7EA7;&#x8BA9;&#x6301;&#x7EED;&#x53D1;&#x5E03;&#x53D8;&#x5F97;&#x66F4;&#x4E3A;&#x8F7B;&#x677E;&#x3002;1.12 &#x63D0;&#x4F9B;&#x4E86;&#x5F53;&#x670D;&#x52A1;&#x5347;&#x7EA7;&#x51FA;&#x73B0;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x8D85;&#x8FC7;&#x91CD;&#x8BD5;&#x6B21;&#x6570;&#x5219;&#x505C;&#x6B62;&#x5347;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x65B9;&#x4FBF;&#xFF0C;&#x907F;&#x514D;&#x8BA9;&#x9519;&#x8BEF;&#x7684;&#x5E94;&#x7528;&#x66FF;&#x4EE3;&#x73B0;&#x6709;&#x6B63;&#x5E38;&#x670D;&#x52A1;&#x3002;&#x4F46;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x867D;&#x7136;&#x63D0;&#x51FA;&#xFF0C;&#x4F46;&#x5E76;&#x672A;&#x80FD;&#x5728; 1.12 &#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x662F;&#x51FA;&#x6545;&#x969C;&#x540E;&#x56DE;&#x6EDA;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x540E;&#xFF0C;&#x5982;&#x4F55;&#x8BA9;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1F;&#x96BE;&#x9053;&#x662F;&#x518D;&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x66F4;&#x65B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x66F4;&#x65B0;&#x7684;&#x662F;&#x65E7;&#x7248;&#x672C;&#x4E48;&#xFF1F;&#x90A3;&#x4E48;&#x65E7;&#x7248;&#x672C;&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E2A;&#x7248;&#x672C;&#xFF1F;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x5728;&#x81EA;&#x52A8;&#x5316;&#x5904;&#x7406;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5728; 1.13 &#x91CC;&#xFF0C;&#x5F00;&#x59CB;&#x652F;&#x6301; <code>docker service update --rollback</code> &#x529F;&#x80FD;&#xFF0C;&#x5F53;&#x53D1;&#x751F;&#x6545;&#x969C;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7531;&#x7BA1;&#x7406;&#x5458;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x5C06;&#x670D;&#x52A1;&#x56DE;&#x6EDA;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker service update \</div><div class="line">  --rollback \</div><div class="line">  --update-delay 0s \</div><div class="line">  my_web</div></pre></td></tr></table></figure>
<h2 id="tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi"><a href="#&#x6DFB;&#x52A0;&#x547D;&#x4EE4;-docker-service-logs-&#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;" class="headerlink" title="&#x6DFB;&#x52A0;&#x547D;&#x4EE4; docker service logs &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7;"></a>&#x6DFB;&#x52A0;&#x547D;&#x4EE4; <code>docker service logs</code> &#x4EE5;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x65E5;&#x5FD7; <a href="#tian-jia-ming-ling-docker-service-logs-yi-cha-kan-fu-wu-ri-zhi" class="header-anchor">#</a></h2><p>Swarm Mode &#x542F;&#x52A8;&#x670D;&#x52A1;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x9EBB;&#x70E6;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x5F88;&#x9EBB;&#x70E6;&#x3002;&#x5728; <code>docker-compose</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5; <code>docker-compose logs &lt;&#x670D;&#x52A1;&#x540D;&gt;</code> &#x5373;&#x53EF;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;&#x662F;&#x8DD1;&#x5728;&#x4E0D;&#x540C;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x3002;&#x4F46;&#x662F; <code>docker service</code> &#x4E0D;&#x652F;&#x6301; <code>logs</code> &#x547D;&#x4EE4;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x73B0;&#x5728;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x6BD4;&#x8F83;&#x9EBB;&#x70E6;&#xFF0C;&#x9700;&#x8981; <code>docker service ps</code> &#x67E5;&#x770B;&#x5404;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x5728;&#x54EA;&#x4E9B;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4E00;&#x4E2A;&#x4E2A;&#x8FDB;&#x53BB;&#x5148; <code>docker ps</code> &#x627E;&#x5230;&#x5BB9;&#x5668; ID&#xFF0C;&#x7136;&#x540E;&#x5728; <code>docker logs &lt;&#x5BB9;&#x5668;ID&gt;</code> &#x67E5;&#x770B;&#x5177;&#x4F53;&#x65E5;&#x5FD7;&#x3002;&#x975E;&#x5E38;&#x7E41;&#x7410;&#x3002;</p>
<p>&#x4ECE; 1.13 &#x5F00;&#x59CB;&#xFF0C;&#x5B9E;&#x9A8C;&#x6027;&#x7684;&#x63D0;&#x4F9B;&#x4E86; <code>docker service logs</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528;&#x4EE5;&#x8FBE;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x662F;&#x8BD5;&#x9A8C;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x5728;&#x542F;&#x7528;&#x8BD5;&#x9A8C;&#x6A21;&#x5F0F;&#x540E;(<code>dockerd --experimental</code>)&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force"><a href="#&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879;-docker-service-update-force" class="headerlink" title="&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; docker service update --force"></a>&#x589E;&#x52A0;&#x5F3A;&#x5236;&#x518D;&#x53D1;&#x5E03;&#x9009;&#x9879; <code>docker service update --force</code> <a href="#zeng-jia-qiang-zhi-zai-fa-bu-xuan-xiang-docker-service-update-force" class="header-anchor">#</a></h2><p>&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528; <code>docker swarm mode</code> &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x78B0;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x6389;&#x4E86;&#xFF0C;&#x4FEE;&#x590D;&#x91CD;&#x542F;&#x8BE5;&#x8282;&#x70B9;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x539F;&#x6765;&#x8BE5;&#x8282;&#x70B9;&#x8DD1;&#x7684;&#x670D;&#x52A1;&#x88AB;&#x8C03;&#x5EA6;&#x5230;&#x4E86;&#x522B;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x3002;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF0C;swarm manager &#x7684;&#x4ECB;&#x5165;&#x4FDD;&#x8BC1;&#x4E86;&#x670D;&#x52A1;&#x7684;&#x53EF;&#x7528;&#x6027;&#x3002;&#x53EF;&#x662F;&#x8282;&#x70B9;&#x6062;&#x590D;&#x540E;&#xFF0C;&#x9664;&#x975E;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x4E2A;&#x522B;&#x7684;&#x8282;&#x70B9;&#x6302;&#x6389;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E2A;&#x65B0;&#x4FEE;&#x590D;&#x7684;&#x8282;&#x70B9;&#x5C31;&#x4E00;&#x76F4;&#x95F2;&#x7740;&#xFF0C;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x526F;&#x672C;&#x6570;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5; swarm manager &#x4E0D;&#x4F1A;&#x4ECB;&#x5165;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5728;&#x96C6;&#x7FA4;&#x6269;&#x5BB9;&#x540E;&#xFF0C;&#x95EE;&#x9898;&#x5C31;&#x66F4;&#x52A0;&#x660E;&#x663E;&#xFF0C;&#x65B0;&#x6269;&#x5BB9;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x6700;&#x521D;&#x90FD;&#x662F;&#x7A7A;&#x95F2;&#x7684;&#x3002;&#x5728; 1.12 &#x552F;&#x4E00;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6539;&#x70B9;&#x513F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF0C;&#x4ECE;&#x800C;&#x89E6;&#x53D1; swarm &#x7684;&#x5347;&#x7EA7;&#x884C;&#x4E3A;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x597D;&#x529E;&#x6CD5;&#x3002;</p>
<p>&#x5728; 1.13&#xFF0C;&#x5F15;&#x5165;&#x4E86; <code>docker service update --force</code> &#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x672A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x5F3A;&#x5236;&#x89E6;&#x53D1;&#x518D;&#x53D1;&#x5E03;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F3A;&#x5236;&#x91CD;&#x65B0; <code>pull</code> &#x8BE5;&#x955C;&#x50CF;&#x3001;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#xFF0C;&#x91CD;&#x65B0;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x8BA9;&#x7531;&#x4E8E;&#x5404;&#x79CD;&#x7EF4;&#x62A4;&#x5BFC;&#x81F4;&#x7684;&#x96C6;&#x7FA4;&#x8D1F;&#x8F7D;&#x4E0D;&#x5E73;&#x8861;&#x7684;&#x60C5;&#x51B5;&#x5F97;&#x5230;&#x7F13;&#x89E3;&#xFF0C;&#x518D;&#x6B21;&#x5E73;&#x8861;&#x96C6;&#x7FA4;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x662F; <code>docker service update</code> &#x547D;&#x4EE4;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x4F1A;&#x9075;&#x5FAA;&#x6240;&#x6307;&#x5B9A;&#x7684; <code>--update-parallelism</code> &#x548C; <code>--update-delay</code> &#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#x66F4;&#x65B0;&#x3002;</p>
<p>Add force option to service update #27596</p>
<h1 id="fei-qi"><a href="#&#x5E9F;&#x5F03;" class="headerlink" title="&#x5E9F;&#x5F03;"></a>&#x5E9F;&#x5F03; <a href="#fei-qi" class="header-anchor">#</a></h1><ul>
<li>&#x5E9F;&#x5F03; <code>docker daemon</code> &#x547D;&#x4EE4;&#xFF0C;&#x7528; <code>dockerd</code> &#x53D6;&#x4EE3;&#x3002;&#x5176;&#x5B9E; 1.12 &#x5DF2;&#x7ECF;&#x6362;&#x4E86;</li>
<li>&#x79FB;&#x9664;&#x5BF9; Ubuntu 15.10&#x3001;Fedora 22 &#x7684;&#x652F;&#x6301;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E24;&#x4E2A;&#x90FD; EOL &#x4E86;&#x3002;</li>
<li>&#x5E9F;&#x5F03; <code>Dockerfile</code> &#x4E2D;&#x7684; <code>MAINTAINER</code> &#x6307;&#x4EE4;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x7528; <code>LABEL maintainer=&lt;...&gt;</code> &#x4EE3;&#x66FF;</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#qian-yan&quot;&gt;&amp;#x524D;&amp;#x8A00;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#top-10-xin-zen
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="blog" scheme="http://blog.lab99.org/tags/blog/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记： Windows Server 和 Docker - John Starks</title>
    <link href="http://blog.lab99.org/post/docker-2016-08-12-video-windows-server-and-docker.html"/>
    <id>http://blog.lab99.org/post/docker-2016-08-12-video-windows-server-and-docker.html</id>
    <published>2016-08-11T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#ji-ben-gai-nian">&#x57FA;&#x672C;&#x6982;&#x5FF5;</a><ul>
<li><a href="#shi-me-shi-docker-on-windows">&#x4EC0;&#x4E48;&#x662F; Docker on Windows</a></li>
<li><a href="#yan-shi">&#x6F14;&#x793A;</a></li>
<li><a href="#zen-me-zuo-dao-de">&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F;</a></li>
<li><a href="#gou-jia">&#x6784;&#x67B6;</a><ul>
<li><a href="#compute-service">Compute Service</a></li>
<li><a href="#windows-server-containers-gou-jia">Windows Server Containers &#x6784;&#x67B6;</a></li>
<li><a href="#windows-rong-qi-li-mian-bao-han-de-dong-xi">Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F;</a></li>
</ul>
</li>
<li><a href="#ji-chu-jing-xiang">&#x57FA;&#x7840;&#x955C;&#x50CF;</a></li>
</ul>
</li>
<li><a href="#windows-server-container-shi-xian-jia-gou">Windows Server Container &#x5B9E;&#x73B0;&#x67B6;&#x6784;</a><ul>
<li><a href="#ming-ming-kong-jian">&#x547D;&#x540D;&#x7A7A;&#x95F4;</a><ul>
<li><a href="#object-namespace">Object namespace</a></li>
</ul>
</li>
<li><a href="#wen-jian-xi-tong">&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li>
<li><a href="#zhu-ce-biao">&#x6CE8;&#x518C;&#x8868;</a></li>
</ul>
</li>
<li><a href="#hyper-v-rong-qi-jia-gou">Hyper-V &#x5BB9;&#x5668;&#x67B6;&#x6784;</a><ul>
<li><a href="#making-it-work">Making it work</a></li>
<li><a href="#cloning">Cloning</a></li>
</ul>
</li>
<li><a href="#wen-da">&#x95EE;&#x7B54;</a><ul>
<li><a href="#wei-ruan-zhe-chong-hyper-v-de-ji-zhu-shi-bu-shi-ke-yi-yong-lai-pao-linux">&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD; Hyper-V &#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1; Linux &#xFF1F;</a></li>
<li><a href="#ni-men-zhi-qian-ti-dao-de-compute-service-shi-you-liao-gong-kai-de-api-liao-me">&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684; Compute Service &#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684; API &#x4E86;&#x4E48;&#xFF1F;</a></li>
<li><a href="#wo-men-xu-yao-zai-windows-docker-zhong-shi-yong-overlay-network-lai-zhi-chi-swarm-ni-men-shi-me-shi-hou-neng-gou-zhi-chi-overlay-network">&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows Docker &#x4E2D;&#x4F7F;&#x7528; overlay network &#x6765;&#x652F;&#x6301; Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301; overlay network&#xFF1F;</a></li>
<li><a href="#docker-for-windows-he-ni-men-zhe-li-jie-shao-de-docker-on-windows-zhong-de-hyper-v-rong-qi-de-hua-cong-ji-zhu-ceng-mian-shang-you-shi-me-bu-tong"><code>Docker for Windows</code> &#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684; <code>Docker on Windows</code> &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668; &#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;</a></li>
<li><a href="#zai-di-yi-ban-zhong-ni-men-you-na-xie-docker-gong-neng-bu-zhi-chi">&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p><code>DockerCon16</code></p>
<p>Windows Server &amp; Docker<br>(The Internals Behind Bringing Docker and Containers to Windows)<br>by John Starks &amp; Taylor Brown<br>Principal Leads in Windows, Microsoft</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/85nCF5S8Qok" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=85nCF5S8Qok" target="_blank" rel="external">https://www.youtube.com/watch?v=85nCF5S8Qok</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=v03145c99ec&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/v03145c99ec.html" target="_blank" rel="external">http://v.qq.com/x/page/v03145c99ec.html</a></p>
<h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>Taylor Brown &#x662F;&#x5FAE;&#x8F6F; Windows &#x670D;&#x52A1;&#x5668;&#x90E8;&#x5206;&#x7684; Principal Leads Program Manager&#x3002;</p>
<p>&#x5DF2;&#x7ECF;&#x548C; Docker &#x56E2;&#x961F;&#x5408;&#x4F5C;&#x4E24;&#x5E74;&#x4E86;&#x3002;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x5FAE;&#x8F6F;&#x56E2;&#x961F;&#x98DE;&#x5230;Docker&#x603B;&#x90E8;&#xFF0C;&#x7136;&#x540E;&#x95EE;&#xFF0C;&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x8BA9;Docker &#x547D;&#x4EE4;&#x884C;&#x652F;&#x6301;&#x5FAE;&#x8F6F;&#x505A;&#x7684;&#x5BB9;&#x5668;API&#xFF1F;&#x5F53;&#x65F6;&#xFF0C;Solomon Hykes (CTO) &#x5728;&#x4F1A;&#x8BAE;&#x5BA4;&#x91CC;&#x5C31;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x662F;&#x5F00;&#x6E90;&#x7684;&#x5440;&#xFF0C;&#x4F60;&#x4EEC;&#x60F3;&#x505A;&#x4EC0;&#x4E48;&#x6539;&#x53D8;&#x7684;&#x8BDD;&#xFF0C;&#x81EA;&#x5DF1;&#x6539;&#x5457;&#x3002;&#x7136;&#x540E;&#x5FAE;&#x8F6F;&#x56E2;&#x961F;&#x4E00;&#x8138;&#x832B;&#x7136;&#x2026;&#x2026;&#x1F633; &#xFF08;<em>&#x663E;&#x7136;&#x8FD9;&#x5E2E;&#x4EBA;&#x5B8C;&#x5168;&#x4E0D;&#x7406;&#x89E3;&#x5F00;&#x6E90;&#x793E;&#x533A;&#x7684;&#x6982;&#x5FF5;</em>&#xFF09;&#x3002;&#x4E24;&#x5E74;&#x4E4B;&#x540E;&#xFF0C;&#x786E;&#x5B9E;&#x53D1;&#x73B0;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x5730;&#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x975E;&#x5E38;&#x6709;&#x8DA3;&#x5473;&#xFF0C;&#x5B8C;&#x6210;&#x4E86;&#x5F88;&#x591A;&#x529F;&#x80FD;&#x3002;</p>
<p>John Starks &#x662F;&#x5FAE;&#x8F6F;&#x7684;&#x5BB9;&#x5668;&#x90E8;&#x5206;&#x7684;&#x4E3B;&#x8981;&#x6784;&#x67B6;&#x5E08;&#x4E4B;&#x4E00;&#x3002;</p>
<h1 id="ji-ben-gai-nian"><a href="#&#x57FA;&#x672C;&#x6982;&#x5FF5;" class="headerlink" title="&#x57FA;&#x672C;&#x6982;&#x5FF5;"></a>&#x57FA;&#x672C;&#x6982;&#x5FF5; <a href="#ji-ben-gai-nian" class="header-anchor">#</a></h1><h2 id="shi-me-shi-docker-on-windows"><a href="#&#x4EC0;&#x4E48;&#x662F;-Docker-on-Windows" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Docker on Windows"></a>&#x4EC0;&#x4E48;&#x662F; Docker on Windows <a href="#shi-me-shi-docker-on-windows" class="header-anchor">#</a></h2><p>&#x4E0D;&#x8981;&#x548C; <code>Docker for Windows</code> &#x5F04;&#x6DF7;&#x4E86;&#x3002;<code>Docker for Windows</code> &#x662F;&#x5728; Windows &#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Linux &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x91CC;&#x9762;&#x8DD1; Linux Docker&#x3002;</p>
<p>&#x800C; <code>Docker on Windows</code> &#x662F;&#x5C06; Docker &#x5F15;&#x64CE;&#x79FB;&#x690D;&#x5230; Windows&#xFF0C;&#x63D0;&#x4F9B; Docker API&#xFF0C; &#x76F4;&#x63A5;&#x5728; Windows &#x7CFB;&#x7EDF;&#x4E0A;&#x901A;&#x8FC7;&#x79FB;&#x690D;&#x540E;&#x7684; Docker Engine&#xFF0C;&#x6765;&#x8FD0;&#x884C;Windows&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x91CC;&#x9762;&#x8DD1;&#x7684;&#x662F; Windows &#x7A0B;&#x5E8F;&#xFF0C;&#x8FD0;&#x884C;&#x4E8E; Windows &#x5185;&#x6838;&#xFF08;&#x800C;&#x4E0D;&#x662F;Linux&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x4E8E;Linux&#x5185;&#x6838;&#xFF09;&#x3002;&#x7531;&#x4E8E;&#x4F7F;&#x7528; Docker API&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301; Compose, Swarm &#x7B49;&#x3002;</p>
<p><code>Docker on Windows</code> &#x4E0D;&#x662F;&#x5FAE;&#x8F6F;&#x7684; fork&#xFF0C;&#x800C;&#x662F;&#x5C31;&#x5728; GitHub &#x7684;<code>docker/docker</code> &#x7684; <code>master</code> &#x5206;&#x652F;&#x91CC;&#x3002;</p>
<p>&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x628A; <code>Docker on Windows</code> &#x96C6;&#x6210;&#x5230; <code>Docker for Windows</code> &#x4E2D;&#x53BB;&#x3002;</p>
<p>&#x79FB;&#x690D;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x5F88;&#x591A; Linux (<em>&#x5B58;&#x5728;&#x5F88;&#x591A;&#x5E74;&#x7684;</em>)&#x7279;&#x6027;&#x5728; Windows &#x4E0A;&#x90FD;&#x6CA1;&#x6709;&#x7C7B;&#x4F3C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x73B0;&#x6539; Windows &#x5185;&#x6838;&#x624D;&#x80FD;&#x7EE7;&#x7EED;&#x79FB;&#x690D;&#x3002;&#x6240;&#x4EE5;&#x8FC7;&#x53BB;&#x7684; Windows &#x65E0;&#x6CD5;&#x8FD0;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x6539;&#x4E86;&#x5185;&#x6838;&#x540E;&#x7684;&#x8FD8;&#x6CA1;&#x53D1;&#x5E03;&#x7684; Windows Server 2016 &#x4EE5;&#x53CA;&#x6700;&#x65B0;&#x7248;&#x7684; Windows 10&#x3002;</p>
<p>&#xFF08;<em>&#x6CE8;&#xFF1A;&#x975E;&#x5E38;&#x6000;&#x7591;&#x8FD9;&#x79CD;&#x4E34;&#x65F6;&#x6539;&#x7684;&#x4E1C;&#x897F;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;Linux &#x8FD9;&#x7C7B;&#x4E1C;&#x897F;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x8FD1;10&#x5E74;&#x4E86;&#xFF0C;&#x4E0D;&#x65AD;&#x5730;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#x548C;&#x5B8C;&#x5584;&#xFF0C;&#x73B0;&#x5728;&#x5F88;&#x7A33;&#x5B9A;&#x3002;&#x5FAE;&#x8F6F;&#x7684;&#x8FD9;&#x4E1C;&#x897F;&#xFF0C;&#x73B0;&#x6539;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x50CF; Linux &#x4E16;&#x754C;&#x90A3;&#x6837;&#x5E7F;&#x6CDB;&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x6D4B;&#x8BD5;&#xFF0C;&#x5C31;&#x7B97;&#x5B9E;&#x73B0;&#x4E86;&#x4E5F;&#x4E0D;&#x5927;&#x9760;&#x8C31;&#x3002;</em>)</p>
<p>&#x4E00;&#x5B9A;&#x8981;&#x533A;&#x522B;&#x5F00;&#xFF0C;&#x8FD9;&#x662F;&#x5728; Windows &#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C; Windows &#x5BB9;&#x5668;&#xFF0C;&#x91CC;&#x9762;&#x8DD1;&#x7684;&#x662F; Windows &#x7A0B;&#x5E8F;&#x3002;&#x800C;&#x4E0D;&#x662F;&#x8FD0;&#x884C; Linux &#x5BB9;&#x5668;&#xFF0C;&#x91CC;&#x9762;&#x8DD1; Linux &#x7A0B;&#x5E8F;&#x3002;(<em>&#x6CE8;&#xFF1A;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4ECA;&#x5929; Docker Hub &#x4E0A;&#x7684;&#x5927;&#x90E8;&#x5206;&#x955C;&#x50CF;&#xFF0C;&#x5305;&#x62EC;&#x6240;&#x6709;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#xFF0C;&#x90FD;&#x7528;&#x4E0D;&#x4E86;&#x3002;&#x90A3;&#x4E9B;&#x90FD;&#x662F;&#x4E3A; Linux &#x5BB9;&#x5668;&#x51C6;&#x5907;&#x7684;&#x3002;</em>)</p>
<p>&#x5982;&#x679C;&#x73B0;&#x5728;&#x60F3;&#x5C1D;&#x8BD5;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x94FE;&#x63A5;&#xFF1A; <a href="http://aka.ms/containers" target="_blank" rel="external">http://aka.ms/containers</a></p>
<h2 id="yan-shi"><a href="#&#x6F14;&#x793A;" class="headerlink" title="&#x6F14;&#x793A;"></a>&#x6F14;&#x793A; <a href="#yan-shi" class="header-anchor">#</a></h2><p>&#x5728;&#x4E00;&#x4E2A; <code>CMD</code> &#x7A97;&#x53E3;&#x91CC;&#xFF0C;&#x76F4;&#x63A5;&#x7528; <code>dockerd</code> &#x547D;&#x4EE4;&#x8D77;&#x4E86;&#x4E00;&#x4E2A; Docker Engine&#x3002;</p>
<p>&#x5728;&#x53E6;&#x4E00;&#x4E2A; <code>CMD</code> &#x7A97;&#x53E3;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982; <code>docker images</code> &#x4E4B;&#x7C7B;&#x7684;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x6CE8;&#x610F;&#x89C6;&#x9891;&#x91CC;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;&#x2026;&#x2026;&#x1F605;</em>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --rm demo cmd /c <span class="built_in">echo</span> Hello, DockerCon1</div></pre></td></tr></table></figure>
<p>&#x2026;&#x2026;&#x7B49;&#x5F85;&#x4E86;&#x5927;&#x7EA6;3&#x79D2;&#x591A;&#x540E;&#xFF0C;&#x7EC8;&#x4E8E;&#x8F93;&#x51FA;&#x4E86; <code>Hello, DockerCon1</code>&#x2026;&#x2026;<em>&#x8BF4;&#x597D;&#x7684;&#x79D2;&#x8D77;&#x5462;&#xFF1F;</em></p>
<h2 id="zen-me-zuo-dao-de"><a href="#&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F;"></a>&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;&#xFF1F; <a href="#zen-me-zuo-dao-de" class="header-anchor">#</a></h2><p>&#x6539;&#x5457;&#x3002;</p>
<ul>
<li>&#x5728; Windows &#x7CFB;&#x7EDF;&#x5C42;&#x9762;&#xFF0C;&#x589E;&#x52A0;namespace, &#x589E;&#x52A0; Resource Controls(&#x6A21;&#x62DF; cgroups&#xFF09;&#xFF0C;&#x589E;&#x52A0; Union FS&#x3002;</li>
<li>&#x6539;&#x9020; Docker &#x672C;&#x8EAB;&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x9ED8;&#x8BA4; *nix &#x7684;&#x4E1C;&#x897F;&#x901A;&#x7528;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;fork, console, network &#x63D2;&#x4EF6;&#x7B49;&#x7B49;</li>
<li>&#x6539;&#x9020; Windows &#x4EE5;&#x9002;&#x5E94;&#x5BB9;&#x5668;&#x3002;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5FAE;&#x8F6F;&#x8FD9;&#x5E2E;&#x8D27;&#x6253;&#x7B97;&#x91CD;&#x590D;&#x9020;&#x8F6E;&#x5B50;&#xFF0C;&#x60F3;&#x6309;&#x81EA;&#x5DF1;&#x7684;&#x601D;&#x8DEF;&#x8BBE;&#x8BA1;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#xFF0C;&#x7ED3;&#x679C;&#x78B0;&#x4E86;&#x5F88;&#x591A;&#x9489;&#x5B50;&#x540E;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x505A;&#x6CD5;&#x8C8C;&#x4F3C;&#x4E0D;&#x5927;&#x5BF9;&#x2026;&#x2026;&#x548C;Docker &#x7684;&#x4EA4;&#x6D41;&#x4E2D;&#xFF0C;&#x9010;&#x6B65;&#x7684;&#x53D1;&#x73B0;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4FEE;&#x6B63;&#x81EA;&#x5DF1;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x8DEF;&#x3002;</li>
</ul>
<h2 id="gou-jia"><a href="#&#x6784;&#x67B6;" class="headerlink" title="&#x6784;&#x67B6;"></a>&#x6784;&#x67B6; <a href="#gou-jia" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E; Linux &#x800C;&#x8A00;&#xFF0C;&#x6784;&#x67B6;&#x4E0A;&#x4ECE;&#x4E0B;&#x5F80;&#x4E0A;&#x662F;&#xFF0C; Linux &#x5185;&#x6838;&#x4E0A;&#xFF0C;&#x8FD0;&#x884C; <code>containerd</code> =&gt; <code>runC</code> =&gt; <code>libcontainerd</code> =&gt; <code>Docker Engine</code> =&gt; <code>REST API</code></p>
<p>&#x800C; Windows &#x4ECE; <code>libcontainerd</code> &#x5F80;&#x4E0A;&#x6784;&#x67B6;&#x4E0A;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x4E3B;&#x8981;&#x53D8;&#x5316;&#x5728;&#x4E0B;&#x5C42;&#x3002;&#x5185;&#x6838;&#x652F;&#x6301;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E; <code>cgroups</code>, <code>namespace</code>, <code>Union FS</code> &#x4E4B;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x5176;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>Compute Service</code> &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x8BE5;&#x670D;&#x52A1;&#x66FF;&#x4EE3; <code>containerd</code> &#x548C; <code>runc</code> &#x6765;&#x7ED9; <code>libcontinerd</code> &#x63D0;&#x4F9B;&#x652F;&#x6301;&#x3002;</p>
<h3 id="compute-service"><a href="#Compute-Service" class="headerlink" title="Compute Service"></a>Compute Service <a href="#compute-service" class="header-anchor">#</a></h3><p>&#x7531;&#x4E8E;&#x73B0;&#x5728;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x8FD9;&#x4E9B;&#x65B0;&#x52A0;&#x5165;&#x7684;&#x529F;&#x80FD;&#x8FD8;&#x5904;&#x4E8E;&#x5FEB;&#x901F;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#xFF0C;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x63D0;&#x4F9B;&#x7A33;&#x5B9A;&#x7684;&#x5E95;&#x5C42; API&#xFF0C;&#x6240;&#x4EE5;&#x52A0;&#x5165;&#x4E00;&#x5C42;&#x66F4;&#x9AD8;&#x5C42;&#x9762;&#x7684; API&#xFF0C;&#x7ED9;&#x5BB9;&#x5668;&#xFF0C;&#x65B9;&#x4FBF;&#x5BB9;&#x5668;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x91CC;&#x7684; <code>Compute Service</code> &#x53EF;&#x4EE5;&#x5927;&#x81F4;&#x7406;&#x89E3;&#x4E3A; <code>containerd</code> on Windows&#x3002;</p>
<p>&#x8D1F;&#x8D23;&#x7BA1;&#x7406;&#x5BB9;&#x5668;&#xFF0C;&#x8D77;&#x3001;&#x505C;&#x3001;&#x91CD;&#x542F;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x52A1;&#x3002;&#x5C06;&#x5E95;&#x5C42;&#x7684;&#x7EC6;&#x8282;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x6709; Compute Service &#x7684; C#, Go &#x8BED;&#x8A00;&#x5C01;&#x88C5;&#x7684;&#x8C03;&#x7528;&#x5E93;&#x4E86;&#x3002;</p>
<h3 id="windows-server-containers-gou-jia"><a href="#Windows-Server-Containers-&#x6784;&#x67B6;" class="headerlink" title="Windows Server Containers &#x6784;&#x67B6;"></a>Windows Server Containers &#x6784;&#x67B6; <a href="#windows-server-containers-gou-jia" class="header-anchor">#</a></h3><p>&#x548C; Linux &#x4E0A;&#x4E00;&#x6837;&#xFF0C;&#x5BB9;&#x5668;&#x548C;&#x5BBF;&#x4E3B;&#x7CFB;&#x7EDF;&#x5171;&#x4EAB;&#x5185;&#x6838;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x91CC;&#x662F;&#x5171;&#x4EAB; Windows &#x5185;&#x6838;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x4ED4;&#x7EC6;&#x89C2;&#x5BDF;&#x89C6;&#x9891;&#x4E2D;&#x7684;&#x67B6;&#x6784;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x548C; Linux &#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x7406;&#x5FF5;&#x4E0D;&#x540C;&#x3002;Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#xFF0C;&#x5305;&#x62EC;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x90A3;&#x4E00;&#x7FA4;&#x8FDB;&#x7A0B;&#xFF0C;&#x4EE5;&#x53CA;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x662F; Linux &#x6240;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x3002;</p>
<h3 id="windows-rong-qi-li-mian-bao-han-de-dong-xi"><a href="#Windows-&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F;" class="headerlink" title="Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F;"></a>Windows &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5305;&#x542B;&#x7684;&#x4E1C;&#x897F; <a href="#windows-rong-qi-li-mian-bao-han-de-dong-xi" class="header-anchor">#</a></h3><p>Linux &#x4E16;&#x754C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x8FDB;&#x7A0B;&#x76F4;&#x63A5;&#x53D1; <code>syscall</code>&#xFF0C;&#x5185;&#x6838;&#x5E2E;&#x4F60;&#x8C03;&#x5EA6;&#x505A;&#x4E8B;&#x60C5;&#x3002;</p>
<p>&#x800C; Windows &#x7684;&#x67B6;&#x6784;&#x8981;&#x81C3;&#x80BF;&#x7684;&#x591A;&#x3002;Windows &#x5E76;&#x4E0D;&#x66B4;&#x9732;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x7528;&#x4E00;&#x7FA4; DLL &#xFF08;&#x6BD4;&#x5982; <code>kernel32.dll</code> &#x7B49;) &#x5C06;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x5C01;&#x88C5;&#x8D77;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x63D0;&#x4F9B;&#x4E00;&#x7EC4; Windows API &#x7ED9;&#x5E94;&#x7528;&#x8C03;&#x7528;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5728; Windows &#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x4E00;&#x7FA4; DLL &#x670D;&#x52A1;&#xFF0C;&#x7701;&#x4E0D;&#x6389;&#x2026;&#x2026;</p>
<p>&#x540C;&#x6837;&#xFF0C;Windows &#x8981;&#x8DD1;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF0C;&#x6709;&#x592A;&#x591A;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x7684;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x5373;&#x4F7F;&#x5E94;&#x7528;&#x611F;&#x89C9;&#x4E0D;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x95F4;&#x4F9D;&#x8D56;&#x7684;RPC&#x90FD;&#x88AB; Win32 API &#x6240;&#x63A9;&#x76D6;&#x4E86;&#xFF0C;Windows &#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7D27;&#x8026;&#x5408;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5BFC;&#x81F4;&#x8FD9;&#x4E9B;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x670D;&#x52A1;&#x4E5F;&#x7701;&#x4E0D;&#x6389;&#x3002;&#x5373;&#x4F7F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x8DD1;&#x8FD9;&#x4E48;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x8DD1;&#x8D77;&#x6765;&#xFF0C;&#x5426;&#x5219;&#x5373;&#x4F7F;&#x6700;&#x7B80;&#x5355;&#x7684; DNS &#x67E5;&#x8BE2;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x4E3A;&#x670D;&#x52A1;&#x4E0D;&#x5B58;&#x5728;&#x800C;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5728; Windows &#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x50CF; Linux &#x90A3;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x60F3;&#x7684;&#x53EA;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x5F88;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x505A;&#x4E8B;&#x60C5;&#x3002;&#x4F60;&#x5FC5;&#x987B;&#x628A;&#x8FD9;&#x4E00;&#x5927;&#x5806;&#x4E1C;&#x897F;&#x6254;&#x5230;&#x5BB9;&#x5668;&#x91CC;&#xFF0C;&#x4E00;&#x5927;&#x5806;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x8DD1;&#x8D77;&#x6765;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<p>&#x6BCF;&#x6B21;&#x542F;&#x52A8; Windows &#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x8DDF;&#x542F;&#x52A8;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#x4E00;&#x6837;&#xFF0C;&#x5148;&#x542F;&#x52A8; <code>smss</code> &#xFF08;<em>&#x76F8;&#x5F53;&#x4E8E; Linux/Unix &#x4E16;&#x754C;&#x7684;<code>init</code>&#x2026;&#x2026;&#x1F613;</em>)&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x542F;&#x52A8;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#xFF0C;&#x6700;&#x540E;&#x624D;&#x662F;&#x8C03;&#x7528;&#x4F60;&#x8BA9;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5728; Windows &#x4E2D;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709; <code>FROM scratch</code> &#x8FD9;&#x4E1C;&#x897F;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x5FC5;&#x987B;&#x5728;&#x91CC;&#x9762;&#x51C6;&#x5907;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x6240;&#x6709;&#x8FD9;&#x4E00;&#x5927;&#x7FA4;&#x4E1C;&#x897F;&#x3002;</p>
<p><em>&#x6CE8;&#xFF1A;&#x5F88;&#x591A;&#x4EBA;&#x9519;&#x8BEF;&#x7684;&#x628A; Docker &#x5F53;&#x865A;&#x62DF;&#x673A;&#x7528;&#xFF0C;&#x8FD8;&#x5728;&#x91CC;&#x9762;&#x8DD1; <code>supervisord</code> &#x4E4B;&#x7C7B;&#x7684;&#x6765;&#x60F3;&#x529E;&#x6CD5;&#x652F;&#x6301;&#x670D;&#x52A1;&#xFF0C;&#x6700;&#x540E;&#x5F62;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x8D85;&#x81C3;&#x80BF;&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#xFF0C;&#x6027;&#x80FD;&#x3001;&#x7A33;&#x5B9A;&#x6027;&#x90FD;&#x4E0D;&#x597D;&#x3002;&#x5FAE;&#x8F6F;&#x7684;&#x8FD9;&#x4E2A; Windows Container &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x53CD;&#x9762;&#x6559;&#x6750;&#x3002;</em></p>
<h2 id="ji-chu-jing-xiang"><a href="#&#x57FA;&#x7840;&#x955C;&#x50CF;" class="headerlink" title="&#x57FA;&#x7840;&#x955C;&#x50CF;"></a>&#x57FA;&#x7840;&#x955C;&#x50CF; <a href="#ji-chu-jing-xiang" class="header-anchor">#</a></h2><p>&#x5FAE;&#x8F6F;&#x53D1;&#x5E03;&#x7684;&#x955C;&#x50CF;&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7684;&#x57FA;&#x7840;&#x955C;&#x50CF;&#xFF1A;</p>
<ul>
<li><code>windowsservercore</code>: &#x6BD4;&#x8F83;&#x5927;(<strong>9.3GB</strong>) (<em>&#x6CE8;&#xFF1A;&#x6655;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x80FD;&#x4EC5;&#x4EC5;&#x53EB;&#x6BD4;&#x8F83;&#x5927;&#x4E48;&#xFF1F;&#xFF1F;&#xFF1F;</em>)&#xFF0C;&#x9AD8;&#x5EA6;&#x517C;&#x5BB9;</li>
<li><code>nanoserver</code>: &#x8D85;&#x5C0F;&#xFF0C;&#x8D85;&#x5FEB;&#xFF0C;&#x4E0D;&#x8FC7;&#x66F4;&#x5C11;&#x7684;API&#x652F;&#x6301;&#x3002;(<em>&#x6CE8;&#xFF1A;&#x9760;&#xFF0C;&#x4F60;&#x5BB6;&#x7BA1; 600MB~810MB &#x7684;&#x955C;&#x50CF;&#x53EB;&#x505A;&#x8D85;&#x5C0F;&#x7684;&#x955C;&#x50CF;&#xFF1F;&#xFF1F;&#xFF1F;&#x8FD8;&#x662F;&#x529F;&#x80FD;&#x53D7;&#x9650;&#x7248;&#xFF1F;&#xFF1F;</em>)</li>
</ul>
<p>&#x4ED6;&#x4EEC;&#x4E3A;&#x4E86;&#x505A;&#x8FD9;&#x4E2A;<strong>&#x8D85;&#x5C0F;</strong> &#x7684;&#x955C;&#x50CF;&#xFF0C;&#x53BB;&#x9664;&#x4E86;&#x5F88;&#x591A;Windows&#x670D;&#x52A1;&#x5668;&#x91CC;&#x4E0D;&#x5927;&#x7528;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6BD4;&#x5982;&#x53BB;&#x9664;&#x4E86;&#x4F20;&#x771F;&#x670D;&#x52A1;&#x2026;&#x2026;&#x6655;&#xFF0C;&#x4EC0;&#x4E48;&#x5E74;&#x4EE3;&#x4E86;&#x8FD9;&#x4E2A;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x6807;&#x914D;&#x5440;&#xFF1F;</p>
<p>&#x5230;&#x73B0;&#x5728;&#x4E3A;&#x6B62;&#x8FD8;&#x4E0D;&#x80FD; <code>docker pull</code> &#x5462;&#xFF0C;&#x4E0D;&#x8FC7;&#x5F88;&#x5FEB;&#x4F1A;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x4F1A;&#x76F4;&#x63A5;&#x4ECE;&#x5FAE;&#x8F6F;&#x670D;&#x52A1;&#x5668;&#x4E0B;&#x8F7D;&#x3002;</p>
<p>&#x6F14;&#x793A;&#x4E86;&#x4E00;&#x4E0B;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E24;&#x4E2A;&#x955C;&#x50CF;&#x8D77;&#x4E2A; <code>cmd</code>&#xFF0C;<strong>&#x8D85;&#x5C0F;</strong> &#x955C;&#x50CF;&#x5927;&#x6982;&#x7528;&#x4E86;2&#x79D2;&#x591A;&#xFF0C;<code>windowsservercore</code> &#x90A3;&#x4E2A;&#x5927;&#x6982;&#x7528;&#x4E86;3&#x79D2;&#x591A;&#x2026;&#x2026;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it --rm nanoserver cmd</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it --rm windowsservercore cmd</div></pre></td></tr></table></figure>
<p>&#x8FDB;&#x5165; <code>cmd</code> &#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x5217;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x4E24;&#x4E2A;&#x955C;&#x50CF;&#x5DEE;&#x5F02;&#xFF0C;&#x76F8;&#x6BD4;&#x4E8E; <code>windowsservercore</code> &#x800C;&#x8A00;&#xFF0C;<code>nanoserver</code> &#x4E2D;&#x7684;&#x670D;&#x52A1;&#x5B9E;&#x5728;&#x662F;&#x5C11;&#x592A;&#x591A;&#x4E86;&#x2026;&#x2026;&#xFF08;&#x4E0D;&#x8FC7;&#x4F9D;&#x65E7;&#x5F88;&#x591A;&#x5F88;&#x591A;&#x2026;&#x2026;&#xFF09;</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">powershell get-service</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x67E5;&#x770B;&#x8FDB;&#x7A0B;</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">powershell get-process</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668; (Task Manager) &#x91CC;&#x770B;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x662F;&#x771F;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x6838;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>
<h1 id="windows-server-container-shi-xian-jia-gou"><a href="#Windows-Server-Container-&#x5B9E;&#x73B0;&#x67B6;&#x6784;" class="headerlink" title="Windows Server Container &#x5B9E;&#x73B0;&#x67B6;&#x6784;"></a>Windows Server Container &#x5B9E;&#x73B0;&#x67B6;&#x6784; <a href="#windows-server-container-shi-xian-jia-gou" class="header-anchor">#</a></h1><h2 id="ming-ming-kong-jian"><a href="#&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x547D;&#x540D;&#x7A7A;&#x95F4; <a href="#ming-ming-kong-jian" class="header-anchor">#</a></h2><p>&#x5185;&#x90E8;&#x5E76;&#x4E0D;&#x79F0;&#x5176;&#x4E3A; <code>namespace</code>&#xFF0C;&#x800C;&#x662F;&#x79F0;&#x4E4B;&#x4E3A; <code>silo</code> (&#x8C37;&#x4ED3;&#x6216;&#x8005;&#x5BFC;&#x5F39;&#x53D1;&#x5C04;&#x4E95;&#xFF09;</p>
<p>&#x8FD9;&#x4E1C;&#x897F;&#x662F;&#x5BF9; Windows &#x7684; <code>Job object</code> &#x7684;&#x6269;&#x5C55;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x7EC4;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E00;&#x7EC4;&#x53D7;&#x9650;&#x8FDB;&#x7A0B;&#xFF0C;&#x65B0;&#x7684;&#x5185;&#x6838;&#x63D0;&#x4F9B;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x80FD;&#x529B;&#x3002;</p>
<p>&#x65B0;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x652F;&#x6301;&#x4E86;&#xFF1A;</p>
<ul>
<li>&#x6CE8;&#x518C;&#x8868;</li>
<li>&#x8FDB;&#x7A0B; ID, &#x4F1A;&#x8BDD;</li>
<li>Object namespace</li>
<li>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li>
<li>&#x7F51;&#x7EDC;&#x90E8;&#x5206;</li>
</ul>
<h3 id="object-namespace"><a href="#Object-namespace" class="headerlink" title="Object namespace"></a>Object namespace <a href="#object-namespace" class="header-anchor">#</a></h3><p>&#x7CFB;&#x7EDF;&#x7EA7;&#x7684; namespace&#xFF0C;&#x662F;&#x5BF9;&#x7528;&#x6237;&#x9690;&#x85CF;&#x7684;&#x3002;&#x5176;&#x5B9E;&#x5728; Windows &#x4E2D;&#xFF0C;&#x4E5F;&#x662F;&#x5B58;&#x5728;&#x7C7B;&#x4F3C;&#x4E8E; Linux &#x4E2D;&#x7684; <code>/</code> &#x7684;&#x6982;&#x5FF5;&#x7684;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5728; NT &#x5185;&#x6838;&#x773C;&#x91CC;&#xFF0C;<code>C:\Windows</code> &#x6620;&#x5C04;&#x5230; <code>\DosDevices\C:\Windows</code> &#x4E0B;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x6240;&#x6709;&#x7684;&#x8BBE;&#x5907;&#x6240;&#x9700;&#x7684; entry point&#xFF0C; &#x5982;&#xFF1A;</p>
<ul>
<li><code>\DosDevices\C:</code> &#xFF1A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li>
<li><code>\Registry</code> &#xFF1A; &#x6CE8;&#x518C;&#x8868;</li>
<li><code>\Device\Tcp</code> &#xFF1A; TCP &#x901A;&#x8BAF;</li>
</ul>
<p>&#x800C; <code>silo</code> &#x53EF;&#x4EE5;&#x6A21;&#x4EFF; Linux &#x91CC;&#x9762; <code>chroot</code> &#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x6765;&#x6539;&#x53D8;&#x4E0A;&#x8FF0; entry point &#x7684; root &#x4F4D;&#x7F6E;&#x3002;</p>
<ul>
<li><code>\Silos\foo\DosDevices\C:</code></li>
<li><code>\Silos\bar\DosDevices\C:</code></li>
</ul>
<p>&#x6F14;&#x793A;&#x4E86;&#x4E00;&#x4E0B;&#x67E5;&#x770B;&#x4E0A;&#x8FF0;&#x7684;&#x8DEF;&#x5F84;&#x3002;Windows &#x9A71;&#x52A8;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x4E2D;&#x6709;&#x4E00;&#x4E2A; <code>objdir.exe</code> &#x7684;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x770B;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x5206;&#x522B;&#x5728;&#x5BBF;&#x4E3B;&#x548C; <code>nanoserver</code> &#x5BB9;&#x5668;&#x4E2D;&#x6267;&#x884C; <code>objdir \</code>&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x3002;&#x7136;&#x540E;&#x7528; <code>objdir \GLOBAL??</code>&#xFF0C;&#x5206;&#x522B;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x5BBF;&#x4E3B;&#x673A;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5BB9;&#x5668;&#x5185;&#x5C11;&#x4E86;&#x5F88;&#x591A;&#x5F88;&#x591A;&#x4E1C;&#x897F; &#xFF08;20 vs 133)&#x3002;</p>
<p>&#x5728;&#x5BBF;&#x4E3B;&#x4E0A;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6620;&#x5C04;&#x3002;<code>objdir \Silos\460\GLOBAL??</code>&#xFF0C;&#x8FD9;&#x6837;&#x663E;&#x793A;&#x7684;&#x5C31;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;20&#x6761;&#x4FE1;&#x606F;&#x3002;</p>
<h2 id="wen-jian-xi-tong"><a href="#&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; <a href="#wen-jian-xi-tong" class="header-anchor">#</a></h2><p>&#x5C31;&#x548C;&#x524D;&#x9762;&#x8BF4;&#x7684; Windows &#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x4E00;&#x6837;&#xFF0C;Windows &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E5F;&#x975E;&#x5E38;&#x590D;&#x6742;&#x3002;&#x968F;&#x7740;&#x4E0D;&#x65AD;&#x7684;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x7279;&#x6027;&#x8FDB;&#x53BB;&#xFF0C;Transactions, File IDs, USN journal &#x7B49;&#x7B49;&#xFF0C;&#x800C;Windows&#x7A0B;&#x5E8F;&#x5F88;&#x591A;&#x4F9D;&#x8D56;&#x4E8E;&#x8FD9;&#x4E9B;&#x7279;&#x6027;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x5982;&#x679C;&#x8981;&#x57FA;&#x4E8E;&#x6B64;&#x53BB;&#x505A;&#x4E00;&#x4E2A; Linux &#x4E16;&#x754C;&#x4E2D;&#x7684; AUFS&#xFF0C;&#x6216;&#x8005; Overlay FS&#xFF0C;&#x4F46;&#x662F;&#x652F;&#x6301;&#x4E0A;&#x9762;&#x8FD9;&#x4E9B; NTFS &#x7279;&#x6027;&#x7684;&#xFF0C;&#x6781;&#x4E3A;&#x56F0;&#x96BE;&#x3002;</p>
<p>&#x4E8E;&#x662F;&#x5728; Windows Container v1 &#x4E2D;&#xFF0C;&#x91C7;&#x7528;&#x4E86;&#x7C7B;&#x4F3C;&#x4E8E; <code>Device Mapper</code> &#x7684;&#x529E;&#x6CD5; (<em>&#x6CE8;&#xFF1A;Really?? &#x751A;&#x591A; bug &#x7684;&#x90A3;&#x4E2A; Device Mapper&#xFF1F;&#xFF1F;</em>) &#xFF0C;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5757;&#x8BBE;&#x5907;&#x662F;&#x865A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x662F; <code>&#x865A;&#x62DF;&#x5757;&#x8BBE;&#x5907;</code> + <code>&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x7684;NTFS &#x5206;&#x533A;</code> &#x7684;&#x65B9;&#x5F0F;&#x3002;&#x4F7F;&#x7528; symlink &#x5230;&#x5BBF;&#x4E3B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5404;&#x5C42;&#xFF0C;&#x8FD9;&#x6837;&#x8BA9;&#x5757;&#x8BBE;&#x5907;&#x4E0D;&#x4F1A;&#x8FC7;&#x4E8E;&#x81C3;&#x80BF;&#x3002;</p>
<h2 id="zhu-ce-biao"><a href="#&#x6CE8;&#x518C;&#x8868;" class="headerlink" title="&#x6CE8;&#x518C;&#x8868;"></a>&#x6CE8;&#x518C;&#x8868; <a href="#zhu-ce-biao" class="header-anchor">#</a></h2><p>&#x6CE8;&#x518C;&#x8868;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x7531;&#x4E8E;&#x5B83;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6240;&#x4EE5;&#x9488;&#x5BF9;&#x6CE8;&#x518C;&#x8868;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x662F;&#x771F;&#x7684;&#x505A;&#x4E86;&#x4E00;&#x4E2A; Union FS &#x5728;&#x4E0A;&#x9762;&#x3002;</p>
<p>&#x4E3A;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x4FDD;&#x5B58;&#x4E00;&#x6574;&#x5957;&#x6CE8;&#x518C;&#x8868;&#x7684;clone&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x8FD9;&#x662F; Windows &#x7279;&#x6709;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x6C61;&#x67D3; Docker &#x4EE3;&#x7801;&#xFF0C;&#x4ED6;&#x4EEC;&#x628A;&#x6CE8;&#x518C;&#x8868;&#x8FD9;&#x4E2A;&#x7279;&#x4F8B;&#x5BF9; Docker &#x9690;&#x85CF;&#x4E86;&#x3002;&#x56E0;&#x6B64;&#x4ECE; Docker &#x89C6;&#x89D2;&#x770B;&#x6CE8;&#x518C;&#x8868;&#x7684;&#x6539;&#x53D8;&#x5C31;&#x662F;&#x6587;&#x4EF6;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;<code>docker diff</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x770B;&#x5230;&#x6CE8;&#x518C;&#x8868;&#x6587;&#x4EF6;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x3002;</p>
<h1 id="hyper-v-rong-qi-jia-gou"><a href="#Hyper-V-&#x5BB9;&#x5668;&#x67B6;&#x6784;" class="headerlink" title="Hyper-V &#x5BB9;&#x5668;&#x67B6;&#x6784;"></a>Hyper-V &#x5BB9;&#x5668;&#x67B6;&#x6784; <a href="#hyper-v-rong-qi-jia-gou" class="header-anchor">#</a></h1><p>Hyper-V &#x7684;&#x5BB9;&#x5668;&#x6784;&#x67B6;&#x5C31;&#x548C; Docker &#x975E;&#x5E38;&#x4E0D;&#x540C;&#x4E86;&#x3002;&#x8FD9;&#x91CC;&#x7B49;&#x4E8E;&#x662F;&#x8DD1;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x6838;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x52A8;&#x673A;&#x662F;&#x56E0;&#x4E3A;&#x89C9;&#x5F97;&#x6709;&#x4E9B;&#x5E94;&#x7528;&#x9700;&#x8981;&#x66F4;&#x597D;&#x7684;&#x9694;&#x79BB;&#x3002;&#x6BD4;&#x5982;&#x591A;&#x79DF;&#x6237;&#x4F7F;&#x7528;&#x3001;&#x907F;&#x514D;&#x63D0;&#x6743;&#x9650;&#x6F0F;&#x6D1E;&#x3001;&#x6709;&#x4E9B;&#x7279;&#x522B;&#x7684;&#x89C4;&#x5B9A;&#x8BF4;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x5FC5;&#x987B;&#x8FD0;&#x884C;&#x4E8E;vm&#x4E2D;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5FAE;&#x8F6F;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x7528;VM&#x6765;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x5FAE;&#x8F6F;&#x53EF;&#x4E0D;&#x5F97;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x60F3;&#x6CD5;&#x4E48;&#xFF0C;&#x4ED6;&#x4EEC;&#x5DF2;&#x7ECF;&#x628A;&#x5BB9;&#x5668;&#x6574;&#x7684;&#x8DDF;&#x4E2A;VM&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#x2026;&#x2026;</em>&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x65B9;&#x6CD5;&#x662F;&#x8BB2;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x72EC;&#x7ACB;&#x7684;&#x8FD0;&#x884C;&#x4E8E;&#x4E00;&#x4E2A; VM &#x4E2D;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#x7684;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --isolation=hyperv</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5BB9;&#x5668;&#x5C31;&#x8FD0;&#x884C;&#x4E8E; Hyper-V &#x865A;&#x62DF;&#x673A;&#x91CC;&#x4E86;&#x3002;</p>
<p>&#x800C; Windows 10 &#x7684;&#x7CFB;&#x7EDF;&#x91CC;&#xFF0C;&#x9ED8;&#x8BA4;&#x5C31;&#x662F;&#x5982;&#x6B64;&#x3002;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x90A3;&#x4E9B;&#x7D27;&#x8026;&#x5408;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x8BA9; Windows &#x670D;&#x52A1;&#x5668;&#x7684;&#x5BB9;&#x5668;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x6838;&#x7248;&#x672C;&#x4E0D;&#x4E00;&#x81F4;&#x7136;&#x540E;&#x51FA;&#x9519;&#x2026;&#x2026;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x8DD1;&#x4E2A;VM&#x6765;&#x8FD0;&#x884C;&#x670D;&#x52A1;&#x5668;&#x5185;&#x6838;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5230;&#x91CC;&#x9762;&#x8DD1;&#x4E2A;Docker&#x2026;&#x2026;</p>
<p>&#x8FD0;&#x884C;&#x4E8E; Windows Server Container &#x7684;&#x955C;&#x50CF;&#x548C;&#x8FD0;&#x884C;&#x4E8E; Hyper-V VM &#x7684;&#x955C;&#x50CF;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x8FD9;&#x662F;&#x597D;&#x4E8B;&#x60C5;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x4E24;&#x4E2A;&#x7248;&#x672C;&#x955C;&#x50CF;&#x3002;</p>
<h2 id="making-it-work"><a href="#Making-it-work" class="headerlink" title="Making it work"></a>Making it work <a href="#making-it-work" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#x662F;&#x8BA9;VM&#x5C3D;&#x53EF;&#x80FD;&#x53D8;&#x5C0F;&#xFF0C;&#x5E76;&#x4E14;&#x65E0;&#x72B6;&#x6001;&#x3002;&#x867D;&#x7136;&#x4E0D;&#x662F;&#x6700;&#x5C0F;&#x7684;Windows&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5C0F;&#xFF0C;&#x800C;&#x4E14;&#x6570;&#x636E;&#x6539;&#x53D8;&#x4E0D;&#x6301;&#x4E45;&#x5316;&#x5B58;&#x50A8;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x70B9;&#x548C; Moby &#x5F88;&#x50CF;</em>)</p>
<p>&#x5B58;&#x50A8;&#x662F;&#x57FA;&#x4E8E; SMB&#x7684;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x548C; moby 1.12 &#x76EE;&#x524D;&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x5F88;&#x50CF;</em>&#xFF09;&#xFF0C; &#x4E0D;&#x8FC7;&#x6CA1;&#x6709;&#x771F;&#x6B63;&#x7684;&#x8D70;&#x7F51;&#x7EDC;&#xFF0C;&#x800C;&#x662F;&#x8D70;&#x7684; <code>VMBus</code> &#xFF08;&#x7C7B;&#x4F3C;&#x4E8E; kvm &#x4E2D;&#x7684;<code>virtio</code>&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x6837;&#x7684;&#x597D;&#x5904;&#x662F;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x5BBF;&#x4E3B;&#x8D1F;&#x8D23;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x6587;&#x4EF6;&#x7F13;&#x5B58;&#x5171;&#x4EAB;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x591A;&#x5B9E;&#x4F8B;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8DE8;&#x5BB9;&#x5668;&#x5982;&#x679C;&#x6709;&#x91CD;&#x590D;&#x6587;&#x4EF6;&#x5C42;&#x7684;&#x8BDD;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E0D;&#x662F;&#x591A;&#x526F;&#x672C;&#xFF0C;&#x800C;&#x662F;&#x5355;&#x526F;&#x672C;&#xFF0C;&#x8282;&#x7EA6;&#x5185;&#x5B58;&#x63D0;&#x9AD8;IO&#x6548;&#x7387;&#x3002;</p>
<p>&#x7F51;&#x7EDC;&#x548C;&#x6240;&#x6709;VM&#x4E00;&#x6837;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5305;&#x62EC;&#x4E4B;&#x524D;&#x4E0D;&#x8D70;&#x865A;&#x62DF;&#x673A;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x6838;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4E5F;&#x90FD;&#x662F;&#x4F7F;&#x7528;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x5B9E;&#x73B0;&#x7684;&#x3002;(<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x70B9;&#x548C; Linux &#x4E0B;&#x7684; Docker &#x4E0D;&#x540C;</em>)</p>
<h2 id="cloning"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning <a href="#cloning" class="header-anchor">#</a></h2><p>&#x5373;&#x4F7F;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x542F;&#x52A8;&#x4E00;&#x4E2A; Hyper-V &#x7684;&#x5BB9;&#x5668;&#x4E5F;&#x662F;&#x5F88;&#x6162;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x82B1;40&#x591A;&#x79D2;&#x7684;&#x65F6;&#x95F4;&#x624D;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x597D;&#x53BB;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x4E8E;&#x662F;&#x60F3;&#x4E86;&#x4E2A;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#x8FD9;&#x4E2A; Hyper-V &#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B83;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x72B6;&#x6001;&#x4FDD;&#x7559;&#xFF0C;&#x4EE5;&#x540E;&#x6BCF;&#x6B21;&#x5728;&#x8FD0;&#x884C; Hyper-V &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;Clone&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x7136;&#x540E; Copy-on-Write&#xFF0C;&#x8FD9;&#x6837;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x5C31;&#x5F88;&#x5FEB;&#x4E86;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x4E0D;&#x5C31;&#x662F;Linux fork&#x4E48;&#x2026;&#x2026;</em>)&#x3002;</p>
<p>&#x4F7F;&#x7528; <code>--isolation</code> &#x6765;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Hyper-V &#x865A;&#x62DF;&#x673A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --rm --isolation=hyperv demo cmd /c <span class="built_in">echo</span> Help I am trapped <span class="keyword">in</span> a VM</div></pre></td></tr></table></figure>
<p>&#x5927;&#x7EA6;10&#x79D2;&#x540E;&#xFF0C;&#x51FA;&#x7ED3;&#x679C;&#x4E86;&#x2026;&#x2026;&#x1F613;</p>
<p>&#x5982;&#x679C;&#x8FD9;&#x65F6;&#x53BB;&#x770B;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x4E24;&#x4E2A;&#x5947;&#x602A;&#x7684;&#x6CA1;&#x6709;&#x540D;&#x5B57;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x7B2C;&#x4E00;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x5E76;Freeze &#x7684; Hyper-V &#x5BB9;&#x5668;&#x8FDB;&#x7A0B;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x9000;&#x51FA;&#x5BB9;&#x5668;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x53C8;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x5947;&#x602A;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>Taylor &#x9A6C;&#x4E0A;&#x8865;&#x5145;&#x8BF4;&#x6211;&#x4EEC;&#x4F1A;&#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x5730;&#x2026;&#x2026;&#x7136;&#x540E;&#xFF0C;John &#x8BF4;&#xFF0C;3&#x5468;&#x524D;&#x4ED6;&#x53BB;&#x5EA6;&#x5047;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x542C;&#x4ED6;&#x4EEC;&#x8BF4;&#x8981;&#x4FEE;&#x590D;&#x4E86;&#xFF0C;&#x4ECA;&#x5929;&#x8FD8;&#x6CA1;&#x4FEE;&#x590D;&#x2026;&#x2026;</p>
<p>&#x7EE7;&#x7EED;&#x6F14;&#x793A;&#xFF0C;&#x6309;&#x7167;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x4F1A;&#x5FEB;&#x4E00;&#x4E9B;&#x2026;&#x2026;6&#x79D2;&#x2026;&#x2026;</p>
<h1 id="wen-da"><a href="#&#x95EE;&#x7B54;" class="headerlink" title="&#x95EE;&#x7B54;"></a>&#x95EE;&#x7B54; <a href="#wen-da" class="header-anchor">#</a></h1><h2 id="wei-ruan-zhe-chong-hyper-v-de-ji-zhu-shi-bu-shi-ke-yi-yong-lai-pao-linux"><a href="#&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD;-Hyper-V-&#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1;-Linux-&#xFF1F;" class="headerlink" title="&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD; Hyper-V &#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1; Linux &#xFF1F;"></a>&#x5FAE;&#x8F6F;&#x8FD9;&#x79CD; Hyper-V &#x7684;&#x6280;&#x672F;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8DD1; Linux &#xFF1F; <a href="#wei-ruan-zhe-chong-hyper-v-de-ji-zhu-shi-bu-shi-ke-yi-yong-lai-pao-linux" class="header-anchor">#</a></h2><p>John &#x8BF4;&#xFF0C;&#x5443;&#xFF0C;&#x5148;&#x8BA9; Taylor &#x4ECE;&#x653F;&#x6CBB;&#x89D2;&#x5EA6;&#x56DE;&#x7B54;&#x4E00;&#x4E0B;&#x5427; &#x1F60A;&#x2026;&#x2026;&#x3002;Taylor &#x8FD9;&#x9700;&#x8981;&#x770B;&#x7528;&#x6237;&#x7684;&#x53CD;&#x9988;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x66F4;&#x591A;&#x7684;&#x7528;&#x6237;&#x9700;&#x6C42;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x5C31;&#x4F1A;&#x7ED9;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x66F4;&#x591A;&#x7684;&#x538B;&#x529B;&#x53BB;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x3002;</p>
<p>John &#x8865;&#x5145;&#x8BF4;&#xFF0C;&#x8FD9;&#x79CD;&#x60F3;&#x6CD5;&#x542C;&#x8D77;&#x6765;&#x5F88;&#x8D5E;&#xFF0C;&#x6211;&#x975E;&#x5E38;&#x5E0C;&#x671B;&#x5FAE;&#x8F6F;&#x80FD;&#x8BA9;&#x6211;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#x3002;</p>
<h2 id="ni-men-zhi-qian-ti-dao-de-compute-service-shi-you-liao-gong-kai-de-api-liao-me"><a href="#&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;-Compute-Service-&#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684;-API-&#x4E86;&#x4E48;&#xFF1F;" class="headerlink" title="&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684; Compute Service &#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684; API &#x4E86;&#x4E48;&#xFF1F;"></a>&#x4F60;&#x4EEC;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684; Compute Service &#x662F;&#x6709;&#x4E86;&#x516C;&#x5F00;&#x7684; API &#x4E86;&#x4E48;&#xFF1F; <a href="#ni-men-zhi-qian-ti-dao-de-compute-service-shi-you-liao-gong-kai-de-api-liao-me" class="header-anchor">#</a></h2><p>&#x6211;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x4E86;2&#x4E2A;GitHub&#x7684;repo&#xFF0C;&#x5206;&#x522B;&#x662F; C# &#x548C; Go &#x5305;&#x88C5;&#x7684;&#x8FD9;&#x4E2A; API&#xFF0C;&#x8FD9;&#x662F;&#x4E34;&#x65F6;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x90FD;&#x653E;&#x5230; MSDN &#x4E2D;&#x53BB;&#x3002;Taylor &#x8865;&#x5145;&#x8BF4;&#xFF0C;&#x6700;&#x7EC8;&#x5FAE;&#x8F6F;&#x672A;&#x6765;&#x5341;&#x51E0;&#x5E74;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x5173;&#x4E8E;docker &#x4E1C;&#x897F;&#x90FD;&#x4F1A;&#x653E;&#x5230; <a href="https://dockers.microsoft.com" target="_blank" rel="external">https://dockers.microsoft.com</a> &#x4E2D;&#x53BB;&#x3002;</p>
<h2 id="wo-men-xu-yao-zai-windows-docker-zhong-shi-yong-overlay-network-lai-zhi-chi-swarm-ni-men-shi-me-shi-hou-neng-gou-zhi-chi-overlay-network"><a href="#&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows-Docker-&#x4E2D;&#x4F7F;&#x7528;-overlay-network-&#x6765;&#x652F;&#x6301;-Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301;-overlay-network&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows Docker &#x4E2D;&#x4F7F;&#x7528; overlay network &#x6765;&#x652F;&#x6301; Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301; overlay network&#xFF1F;"></a>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;Windows Docker &#x4E2D;&#x4F7F;&#x7528; overlay network &#x6765;&#x652F;&#x6301; Swarm&#xFF0C;&#x4F60;&#x4EEC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x652F;&#x6301; overlay network&#xFF1F; <a href="#wo-men-xu-yao-zai-windows-docker-zhong-shi-yong-overlay-network-lai-zhi-chi-swarm-ni-men-shi-me-shi-hou-neng-gou-zhi-chi-overlay-network" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x4E3B;&#x8981;&#x7684;&#x6CE8;&#x610F;&#x529B;&#x662F;&#x5148;&#x8BA9; Docker Engine &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x8003;&#x8651; Swarm, Compose &#x8FD9;&#x4E9B;&#x80FD;&#x529B;&#x3002;</p>
<h2 id="docker-for-windows-he-ni-men-zhe-li-jie-shao-de-docker-on-windows-zhong-de-hyper-v-rong-qi-de-hua-cong-ji-zhu-ceng-mian-shang-you-shi-me-bu-tong"><a href="#Docker-for-Windows-&#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684;-Docker-on-Windows-&#x4E2D;&#x7684;-Hyper-V-&#x5BB9;&#x5668;-&#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;" class="headerlink" title="Docker for Windows &#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684; Docker on Windows &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668; &#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;"></a><code>Docker for Windows</code> &#x548C;&#x4F60;&#x4EEC;&#x8FD9;&#x91CC;&#x4ECB;&#x7ECD;&#x7684; <code>Docker on Windows</code> &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668; &#x7684;&#x8BDD;&#xFF0C;&#x4ECE;&#x6280;&#x672F;&#x5C42;&#x9762;&#x4E0A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F; <a href="#docker-for-windows-he-ni-men-zhe-li-jie-shao-de-docker-on-windows-zhong-de-hyper-v-rong-qi-de-hua-cong-ji-zhu-ceng-mian-shang-you-shi-me-bu-tong" class="header-anchor">#</a></h2><p>&#x6211;&#x60F3;&#x6709;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x6709;&#x673A;&#x4F1A;&#x5171;&#x4EAB;&#x3002;&#x5F53;&#x7136;&#x65B9;&#x5F0F;&#x4E0A;&#x4E0D;&#x540C;&#xFF0C;<code>Docker for Windows</code> &#x4E2D;&#x7684;&#x662F;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Hyper-V &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x91CC;&#x9762;&#x8DD1;&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x3002;&#x800C; <code>Docker on Windows</code> &#x4E2D;&#x7684; Hyper-V &#x5BB9;&#x5668;&#x662F;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; Hyper-V &#x865A;&#x62DF;&#x673A;&#x3002;</p>
<h2 id="zai-di-yi-ban-zhong-ni-men-you-na-xie-docker-gong-neng-bu-zhi-chi"><a href="#&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B;-Docker-&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;" class="headerlink" title="&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;"></a>&#x5728;&#x7B2C;&#x4E00;&#x7248;&#x4E2D;&#xFF0C;&#x4F60;&#x4EEC;&#x6709;&#x54EA;&#x4E9B; Docker &#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F; <a href="#zai-di-yi-ban-zhong-ni-men-you-na-xie-docker-gong-neng-bu-zhi-chi" class="header-anchor">#</a></h2><p>&#x7B80;&#x5355;&#x5730;&#x8BF4;&#xFF0C;&#x6240;&#x6709; Linux &#x7279;&#x5B9A;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x90A3;&#x5269;&#x4E0B;&#x6765;&#x7684;&#x8FD8;&#x591A;&#x4E48;&#xFF1F;&#xFF1F;</em>)&#xFF0C;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x73B0;&#x5728;&#x6B63;&#x5728;&#x8BD5;&#x56FE;&#x8BA9; <code>docker top</code> &#x80FD;&#x591F;&#x5DE5;&#x4F5C;&#xFF08;John &#x5F88;&#x8BE7;&#x5F02;&#x7684;&#x95EE;&#xFF0C;&#x771F;&#x7684;&#xFF1F;&#x6211;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x554A;&#xFF09;&#xFF0C;&#x56E0;&#x4E3A;&#x673A;&#x5236;&#x4E0A;&#x548C; Linux &#x5F88;&#x4E0D;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x50CF;&#x8FD9;&#x6837;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x5C31;&#x9700;&#x8981;&#x4E0D;&#x5C11;&#x5DE5;&#x4F5C;&#x53BB;&#x505A;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 运维 - Docker Networking 进阶指南 - Madhu Venugopal</title>
    <link href="http://blog.lab99.org/post/docker-2016-08-08-video-docker-ops-docker-networking-deep-dive-considerations-and-troubleshooting.html"/>
    <id>http://blog.lab99.org/post/docker-2016-08-08-video-docker-ops-docker-networking-deep-dive-considerations-and-troubleshooting.html</id>
    <published>2016-08-07T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#jie-shao">&#x4ECB;&#x7ECD;</a><ul>
<li><a href="#shi-me-shi-libnetwork">&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F;</a><ul>
<li><a href="#docker-wang-luo-hu-lian">Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE;</a></li>
<li><a href="#ding-yi-rong-qi-wang-luo-mo-xing">&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;</a></li>
<li><a href="#ti-gong-nei-zhi-ip-di-zhi-guan-li">&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;</a></li>
<li><a href="#ti-gong-nei-zhi-de-duo-su-zhu-wang-luo-hu-lian">&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;</a></li>
<li><a href="#ti-gong-nei-zhi-de-fu-wu-fa-xian-yi-ji-fu-zai-jun-heng">&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li>
<li><a href="#yun-xu-sheng-tai-xi-tong-kuo-zhan">&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55;</a></li>
</ul>
</li>
<li><a href="#docker-1-12-swarm-mode-de-xin-de-te-xing">Docker 1.12 Swarm Mode &#x7684;&#x65B0;&#x7684;&#x7279;&#x6027;</a></li>
<li><a href="#macvlan-qu-dong">Macvlan &#x9A71;&#x52A8;</a></li>
</ul>
</li>
<li><a href="#shen-ru">&#x6DF1;&#x5165;</a><ul>
<li><a href="#duo-rong-qi-wang-luo">&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;</a></li>
<li><a href="#wang-luo-kong-zhi-ceng-mian">&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762;</a></li>
<li><a href="#an-quan-shu-ju-ceng">&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42;</a></li>
<li><a href="#fu-wu-fa-xian">&#x670D;&#x52A1;&#x53D1;&#x73B0;</a></li>
<li><a href="#nei-zhi-fu-zai-jun-heng">&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li>
<li><a href="#mesh-lu-you">Mesh &#x8DEF;&#x7531;</a></li>
</ul>
</li>
<li><a href="#demo">Demo</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon16 - Docker for Ops - Docker for Ops - Docker Networking Deep Dive, Considerations and Troubleshooting<br>by Madhu Venugopal, Jana Radhakrishnan</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/Gwdo3fo6pZg" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=Gwdo3fo6pZg" target="_blank" rel="external">https://www.youtube.com/watch?v=Gwdo3fo6pZg</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=o0319rxyutt&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/o0319rxyutt.html" target="_blank" rel="external">http://v.qq.com/x/page/o0319rxyutt.html</a></p>
<h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x4ED6;&#x4EEC;&#x4E4B;&#x524D;&#x5DE5;&#x4F5C;&#x4E8E; SocketPlane&#xFF0C;2015&#x5E74;&#x521D;&#xFF0C;Docker &#x6536;&#x8D2D;&#x4E86; SocketPlane&#xFF0C;&#x6210;&#x4E3A;&#x4ECA;&#x5929; Docker Networking &#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<h1 id="jie-shao"><a href="#&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4ECB;&#x7ECD;"></a>&#x4ECB;&#x7ECD; <a href="#jie-shao" class="header-anchor">#</a></h1><p>by Madhu Venugopal</p>
<h2 id="shi-me-shi-libnetwork"><a href="#&#x4EC0;&#x4E48;&#x662F;-libnetwork&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; libnetwork&#xFF1F; <a href="#shi-me-shi-libnetwork" class="header-anchor">#</a></h2><h3 id="docker-wang-luo-hu-lian"><a href="#Docker-&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;" class="headerlink" title="Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE;"></a>Docker &#x7F51;&#x7EDC;&#x4E92;&#x8FDE; <a href="#docker-wang-luo-hu-lian" class="header-anchor">#</a></h3><p>&#x8BB8;&#x591A;&#x4EBA;&#x8BA4;&#x4E3A; <code>libnetwork</code> &#x53EA;&#x662F;&#x8D1F;&#x8D23; <code>vlan</code>, <code>vxlan</code> &#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x9A71;&#x52A8;&#x90E8;&#x5206;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#xFF0C;<code>libnetwork</code> &#x4E0D;&#x4EC5;&#x662F;&#x9A71;&#x52A8;&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x7F51;&#x7EDC;&#x5206;&#x7BA1;&#x7406;&#x5C42;&#x9762;&#x3001;&#x63A7;&#x5236;&#x5C42;&#x9762;&#x548C;&#x6570;&#x636E;&#x5C42;&#x9762;&#x3002;</p>
<p>&#x9A71;&#x52A8;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x5904;&#x7406;&#x6570;&#x636E;&#x5C42;&#x9762;&#xFF0C;&#x6240;&#x4EE5;&#x4ECA;&#x5929;&#x6709; <code>plugins</code> &#x63A5;&#x53E3;&#xFF0C;<code>overlay</code>, <code>bridge</code>&#xFF0C;&#x4EE5;&#x53CA;&#x65B0;&#x7684; <code>macvlan</code> &#x7B49;&#x591A;&#x79CD;&#x9A71;&#x52A8;&#x3002;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x5904;&#x7406;&#x6570;&#x636E;&#x5C42;&#x9762;&#x7684;&#x4E8B;&#x7269;&#x3002;</p>
<h3 id="ding-yi-rong-qi-wang-luo-mo-xing"><a href="#&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;" class="headerlink" title="&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B;"></a>&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x6A21;&#x578B; <a href="#ding-yi-rong-qi-wang-luo-mo-xing" class="header-anchor">#</a></h3><h3 id="ti-gong-nei-zhi-ip-di-zhi-guan-li"><a href="#&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;" class="headerlink" title="&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406;"></a>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;IP&#x5730;&#x5740;&#x7BA1;&#x7406; <a href="#ti-gong-nei-zhi-ip-di-zhi-guan-li" class="header-anchor">#</a></h3><p>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;IP&#xFF0C;&#x6307;&#x5B9A;&#x5B50;&#x7F51;&#xFF0C;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x8303;&#x56F4;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x5C06;<code>DHCP</code> pipe out&#x7ED9;&#x5916;&#x9762;&#x7684; <code>DHCP</code> &#x670D;&#x52A1;&#x5668;&#x6765;&#x7ED9;&#x5BB9;&#x5668;&#x5185;&#x5206;&#x914D;IP&#x5730;&#x5740;&#x3002;</p>
<h3 id="ti-gong-nei-zhi-de-duo-su-zhu-wang-luo-hu-lian"><a href="#&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;" class="headerlink" title="&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE;"></a>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8FDE; <a href="#ti-gong-nei-zhi-de-duo-su-zhu-wang-luo-hu-lian" class="header-anchor">#</a></h3><p>&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;&#x4E3B;&#x8981;&#x662F;&#x4E24;&#x4E2A;&#x5C42;&#x9762;&#xFF0C;&#x63A7;&#x5236;&#x5C42;&#x9762;&#x548C;&#x6570;&#x636E;&#x5C42;&#x9762;&#x3002;</p>
<p>&#x6570;&#x636E;&#x5C42;&#x9762;&#x73B0;&#x5728;&#x901A;&#x8FC7; <code>overlay</code> &#x9A71;&#x52A8;&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; plugin &#x63D0;&#x4F9B;&#x7684;&#x5176;&#x5B83;&#x9A71;&#x52A8;&#x3002;<br>&#x63A7;&#x5236;&#x5C42;&#x9762;&#x5728; <code>1.12</code> &#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>gossip</code> &#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5C42;&#x7684;&#x9A71;&#x52A8;&#xFF08;<code>macvlan</code>, <code>ipvlan</code>, &#x6216;&#x8005;&#x901A;&#x8FC7;&#x63D2;&#x4EF6;&#x673A;&#x5236;&#x652F;&#x6301;&#x7684; <code>ovs</code> &#x7B49;&#xFF09;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x79CD;&#x901A;&#x4FE1;&#x662F;&#x53EF;&#x6269;&#x5C55;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x5B89;&#x5168;&#x7684;&#xFF08;TLS&#xFF09;&#x3002;</p>
<h3 id="ti-gong-nei-zhi-de-fu-wu-fa-xian-yi-ji-fu-zai-jun-heng"><a href="#&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x63D0;&#x4F9B;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x4EE5;&#x53CA;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#ti-gong-nei-zhi-de-fu-wu-fa-xian-yi-ji-fu-zai-jun-heng" class="header-anchor">#</a></h3><p>&#x4ECE; <code>1.10</code> &#x540E;&#x5F15;&#x5165;&#x4E86; <code>DNS</code> &#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x670D;&#x52A1;&#x540D;&#x3001;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x7F51;&#x7EDC;&#x522B;&#x540D;&#x6765;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;&#x5728; <code>1.12</code> &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x57FA;&#x4E8E; <code>Virtual IP</code> &#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x4E4B;&#x524D;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>DNS&#x8F6E;&#x8BE2;</code>(<code>dnsrr</code>) &#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<h3 id="yun-xu-sheng-tai-xi-tong-kuo-zhan"><a href="#&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55;" class="headerlink" title="&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55;"></a>&#x5141;&#x8BB8;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x6269;&#x5C55; <a href="#yun-xu-sheng-tai-xi-tong-kuo-zhan" class="header-anchor">#</a></h3><h2 id="docker-1-12-swarm-mode-de-xin-de-te-xing"><a href="#Docker-1-12-Swarm-Mode-&#x7684;&#x65B0;&#x7684;&#x7279;&#x6027;" class="headerlink" title="Docker 1.12 Swarm Mode &#x7684;&#x65B0;&#x7684;&#x7279;&#x6027;"></a>Docker 1.12 Swarm Mode &#x7684;&#x65B0;&#x7684;&#x7279;&#x6027; <a href="#docker-1-12-swarm-mode-de-xin-de-te-xing" class="header-anchor">#</a></h2><ul>
<li>Cluster aware</li>
<li>&#x53BB;&#x4E2D;&#x5FC3;&#x5316;&#x7684;&#x63A7;&#x5236;&#x5C42;</li>
<li>&#x9AD8;&#x5EA6;&#x53EF;&#x6269;&#x5C55;</li>
</ul>
<p>&#x5728; <code>1.12</code> &#x4E2D;&#xFF0C;<code>CNM</code> (Container Networking Model) &#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x96C6;&#x7FA4;&#x6240;&#x9700;&#x7684;&#x7279;&#x6027;&#xFF1A;</p>
<ul>
<li>&#x591A;&#x5BBF;&#x4E3B;&#x4E92;&#x8FDE;&#x65E0;&#x9700;&#x5916;&#x7F6E;key-value store</li>
</ul>
<p>&#x5728; <code>1.9</code> ~ <code>1.11</code> &#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x4E92;&#x8054;&#xFF0C;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5916;&#x7F6E;&#x952E;&#x503C;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x5728; <code>1.12</code> &#x7684; Swarm Mode &#x4E0B;&#x4E0D;&#x9700;&#x8981;&#x4E86;&#x3002;</p>
<ul>
<li><code>1.12</code> &#x4E2D;&#x5F15;&#x5165;&#x4E86;&#x52A0;&#x5BC6;&#x7684;&#x6570;&#x636E;&#x5C42;&#x3001;&#x63A7;&#x5236;&#x5C42;</li>
<li>&#x670D;&#x52A1;&#x53D1;&#x73B0;</li>
<li>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF1A;<code>1.10</code> ~ <code>1.11</code> &#x53EF;&#x4EE5;&#x7528;<code>DNS&#x8F6E;&#x8BE2;</code>&#xFF1B;<code>1.12</code>&#x5F15;&#x5165;&#x4E86; <code>VIP</code>&#x3002;</li>
<li><code>1.12</code> &#x5F15;&#x5165;&#x4E86;Mesh&#x8DEF;&#x7531;</li>
</ul>
<h2 id="macvlan-qu-dong"><a href="#Macvlan-&#x9A71;&#x52A8;" class="headerlink" title="Macvlan &#x9A71;&#x52A8;"></a>Macvlan &#x9A71;&#x52A8; <a href="#macvlan-qu-dong" class="header-anchor">#</a></h2><ul>
<li>&#x4ECE; <code>1.11</code> &#x4F5C;&#x4E3A;&#x8BD5;&#x9A8C;&#x9A71;&#x52A8;&#x5F15;&#x5165;&#xFF0C;&#x73B0;&#x5728;&#x79BB;&#x5F00;&#x8BD5;&#x9A8C;&#x72B6;&#x6001;&#x4E86;</li>
<li>&#x548C;&#x4E0B;&#x5C42;&#x96C6;&#x6210;</li>
<li>&#x5C06;&#x5BB9;&#x5668;&#x7F6E;&#x4E8E;&#x73B0;&#x6709;<code>VLan</code>&#x73AF;&#x5883;</li>
</ul>
<p>&#x521B;&#x5EFA; macvlan &#x7F51;&#x7EDC;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker network create <span class="_">-d</span> macvlan \</div><div class="line">    --subnet=192.168.0.0/16 \</div><div class="line">    --ip-range=192.168.41.0/24 \</div><div class="line">    --aux-address=<span class="string">&quot;favorite_ip_ever=192.168.41.2&quot;</span> \</div><div class="line">    --gateway=192.168.41.1 \</div><div class="line">    -o parent=eth0.41 \</div><div class="line">    macnet41</div></pre></td></tr></table></figure>
<p>&#x67E5;&#x770B;IP&#x5730;&#x5740;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --net=macnet41 -it --rm alpine /bin/sh</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8FD9;&#x6837;&#x5B50;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x5C06;&#x4F1A;&#x76F4;&#x63A5;&#x9001;&#x5230;&#x4E0B;&#x5C42;<code>vlan</code>&#x3002;&#x8FD9;&#x662F;&#x76EE;&#x524D;&#x6700;&#x9AD8;&#x7F51;&#x7EDC;&#x6548;&#x7387;&#x7684;&#x9A71;&#x52A8;&#x3002;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;<code>NAT</code>&#xFF0C;&#x6CA1;&#x6709;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x901A;&#x8BAF;&#x76F4;&#x63A5;&#x901A;&#x8FC7;VLan&#x9001;&#x51FA;&#x3002;</p>
<p><code>Macvlan</code> &#x9A71;&#x52A8;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5229;&#x7528;&#x7684; Linux <code>macvlan</code> &#x5185;&#x6838;&#x9A71;&#x52A8;&#xFF0C;&#x8BE5;&#x9A71;&#x52A8;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x6838;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x5927;&#x7EA6;&#x4ECE; <code>Linux 3.2</code> &#x5F00;&#x59CB;&#x5C31;&#x5728;&#x5185;&#x6838;&#x91CC;&#x4E86;&#x3002;</p>
<p><em>&#x6CE8;&#xFF1A;&#x5B9E;&#x9645;&#x4E0A;&#x662F;2007&#x5E74; <code>2.6.23</code> &#x5C31;&#x52A0;&#x5165;&#x5185;&#x6838;&#x4E86;&#xFF0C;&#x540E;&#x6765;&#x5728; <code>2.6.33</code>, <code>3.9</code>, <code>3.16</code> &#x7B49;&#x4E2D;&#x8FDB;&#x884C;&#x8FC7;&#x6539;&#x8FDB;&#xFF0C;&#x800C;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x65B0;&#x7684; <code>ipvlan</code> &#x662F;&#x5728; Linux &#x5185;&#x6838; <code>3.19</code> &#x5F15;&#x5165;&#x7684;&#x3002;</em></p>
<h1 id="shen-ru"><a href="#&#x6DF1;&#x5165;" class="headerlink" title="&#x6DF1;&#x5165;"></a>&#x6DF1;&#x5165; <a href="#shen-ru" class="header-anchor">#</a></h1><p>by Jana Radhakrishnan</p>
<h2 id="duo-rong-qi-wang-luo"><a href="#&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;" class="headerlink" title="&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;"></a>&#x591A;&#x5BB9;&#x5668;&#x7F51;&#x7EDC; <a href="#duo-rong-qi-wang-luo" class="header-anchor">#</a></h2><ul>
<li>&#x57FA;&#x4E8E; VXLAN &#x7684;&#x6570;&#x636E;&#x8DEF;&#x5F84;&#x5E76;&#x672A;&#x6539;&#x53D8;</li>
<li>&#x65E0;&#x9700;&#x989D;&#x5916;&#x7684;&#x952E;&#x503C;&#x5E93;</li>
<li>&#x96C6;&#x4E2D;&#x8D44;&#x6E90;&#x5206;&#x914D;</li>
<li>&#x6539;&#x8FDB;&#x6027;&#x80FD;</li>
<li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;&#x6027;</li>
</ul>
<h2 id="wang-luo-kong-zhi-ceng-mian"><a href="#&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762;" class="headerlink" title="&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762;"></a>&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x9762; <a href="#wang-luo-kong-zhi-ceng-mian" class="header-anchor">#</a></h2><p>&#x63A7;&#x5236;&#x5C42;&#x9762;&#x57FA;&#x672C;&#x4E0A;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x8DEF;&#x7531;&#x534F;&#x8BAE;&#x3002;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x4F7F;&#x7528; <code>BGP</code>&#xFF0C;&#x867D;&#x7136; <code>BGP</code> &#x53EF;&#x4EE5;&#x652F;&#x6301;&#x975E;&#x5E38;&#x590D;&#x6742;&#x5927;&#x578B;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x95EE;&#x9898;&#x662F;&#x65E0;&#x6CD5;&#x5FEB;&#x901F;&#x6536;&#x655B;&#x3002;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x7F51;&#x7EDC;&#x800C;&#x8A00;&#xFF0C;&#x5FEB;&#x901F;&#x6536;&#x655B;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x57FA;&#x4E8E; <code>gossip</code> &#x534F;&#x8BAE;&#x3002;</p>
<p><a href="https://www.cs.cornell.edu/~asdas/research/dsn02-swim.pdf" target="_blank" rel="external">https://www.cs.cornell.edu/~asdas/research/dsn02-swim.pdf</a></p>
<ul>
<li>&#x57FA;&#x4E8E; Gossip &#x7684;&#x534F;&#x8BAE;</li>
<li>&#x63A7;&#x5236; <code>gossip</code> &#x5E7F;&#x64AD;&#x63A7;&#x5236;&#x5728;&#x67D0;&#x4E2A;&#x7F51;&#x7EDC; scope &#x5185;&#xFF08;&#x964D;&#x4F4E;&#x6D41;&#x91CF;&#x3001;&#x5FEB;&#x901F;&#x6536;&#x655B;&#xFF09;</li>
<li>&#x5FEB;&#x901F;&#x6536;&#x655B;</li>
<li>&#x9ED8;&#x8BA4;&#x5B89;&#x5168;<ul>
<li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li>
<li>swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li>
</ul>
</li>
<li>&#x9AD8;&#x53EF;&#x6269;&#x5C55;</li>
</ul>
<h2 id="an-quan-shu-ju-ceng"><a href="#&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42;" class="headerlink" title="&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42;"></a>&#x5B89;&#x5168;&#x6570;&#x636E;&#x5C42; <a href="#an-quan-shu-ju-ceng" class="header-anchor">#</a></h2><ul>
<li>&#x5728;&#x521B;&#x5EFA; <code>overlay</code> &#x7F51;&#x7EDC;&#x7684;&#x65F6;&#x5019;&#x4F5C;&#x4E3A;&#x9009;&#x9879;&#x63D0;&#x4F9B;&#xFF0C;&#x6CE8;&#xFF1A;<code>--opt secure</code></li>
<li>&#x4F7F;&#x7528; Linux &#x5185;&#x6838; <code>IPSec</code> &#x9A71;&#x52A8;</li>
<li>&#x6309;&#x9700;&#x901A;&#x9053;&#x8BBE;&#x7F6E;</li>
<li>Swarm &#x539F;&#x751F;&#x5BC6;&#x94A5;&#x4EA4;&#x6362;</li>
<li>&#x5B9A;&#x671F;&#x5BC6;&#x94A5;&#x8F6E;&#x6362;</li>
<li>&#x9AD8;&#x6027;&#x80FD;</li>
</ul>
<p>&#x6CE8;&#x610F;&#x542F;&#x7528;&#x540E;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x670D;&#x52A1;&#x81EA;&#x8EAB;&#x652F;&#x6301;&#x5B89;&#x5168;&#x901A;&#x8BAF;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5185;&#x7F6E;&#x7684;&#x5B89;&#x5168;&#x52A0;&#x5BC6;&#x673A;&#x5236;&#xFF1B;&#x800C;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x5B89;&#x5168;&#x52A0;&#x5BC6;&#x673A;&#x5236;&#x7684;&#x901A;&#x8BAF;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E14;&#x670D;&#x52A1;&#x7F6E;&#x4E8E;&#x516C;&#x7F51;&#x4E4B;&#x4E0A;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x5B89;&#x5168;&#x52A0;&#x5BC6;&#x901A;&#x9053;&#x3002;</p>
<h2 id="fu-wu-fa-xian"><a href="#&#x670D;&#x52A1;&#x53D1;&#x73B0;" class="headerlink" title="&#x670D;&#x52A1;&#x53D1;&#x73B0;"></a>&#x670D;&#x52A1;&#x53D1;&#x73B0; <a href="#fu-wu-fa-xian" class="header-anchor">#</a></h2><ul>
<li>&#x7531;&#x5185;&#x7F6E;&#x7684; DNS &#x63D0;&#x4F9B;&#xFF08;&#x4ECE; <code>1.10</code> &#x5F00;&#x59CB;&#xFF09;</li>
<li>&#x9AD8;&#x53EF;&#x7528;</li>
<li>&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x63A7;&#x5236;&#x5C42;&#x53BB;&#x5F97;&#x77E5;&#x72B6;&#x6001;</li>
<li>&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x53D1;&#x73B0;&#x670D;&#x52A1;(<code>service</code>)&#x548C;&#x4EFB;&#x52A1;(<code>task</code>)</li>
</ul>
<p>&#x9ED8;&#x8BA4;&#x4F7F;&#x7528; <code>docker service create</code> &#x521B;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5728;&#x8BF7;&#x6C42; DNS &#x89E3;&#x6790;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;&#x5176;&#x865A;&#x62DF;IP (<code>Virtual IP</code>)&#xFF0C;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684; <code>Endpoint</code> &#x662F; <code>vip</code>&#x3002;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x6307;&#x5B9A;&#x5176;&#x4E3A; <code>dnsrr</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; DNS &#x8F6E;&#x8BE2;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8BF7;&#x6C42; DNS &#x670D;&#x52A1;&#x65F6;&#x89E3;&#x6790;&#x5230;&#x7684;&#x5C31;&#x662F;&#x591A;&#x4E2A; DNS &#x8BB0;&#x5F55;&#xFF0C;&#x53CD;&#x5E94;&#x7684;&#x662F;&#x5BB9;&#x5668;&#x5B9E;&#x9645;&#x7684;IP&#x5730;&#x5740;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x5927;&#x90E8;&#x5206;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F7F;&#x7528; <code>vip</code> &#x6A21;&#x5F0F;&#xFF1B;&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x975E;&#x5E38;&#x5E0C;&#x671B;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#xFF08;&#x6BD4;&#x5982;&#x5229;&#x7528;DNS&#x7F13;&#x5B58;&#x4EC0;&#x4E48;&#x7684;&#xFF09;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>dnsrr</code> &#x6765;&#x8FD4;&#x56DE;&#x591A;&#x4E2A;IP&#x3002;</p>
<p>&#x76EE;&#x524D;&#x4F7F;&#x7528;&#x975E; FQDN&#xFF0C;&#x4E3B;&#x8981;&#x8003;&#x8651;&#x7684;&#x662F;&#x53EF;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>FQDN</code>&#xFF0C;&#x90A3;&#x4E48;&#x66F4;&#x6362;&#x73AF;&#x5883;&#x540E;&#xFF0C;<code>FQDN</code> &#x6539;&#x53D8;&#x4F1A;&#x5BFC;&#x81F4;&#x6269;&#x5C55;&#x6027;&#x53D8;&#x5DEE;&#x3002;&#x56E0;&#x6B64;&#x76EE;&#x524D; Docker&#x5B9E;&#x73B0;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x975E;<code>FQDN</code>&#x7684;&#x5F62;&#x5F0F;&#x7684;&#x670D;&#x52A1;&#x540D;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>
<p>&#x5185;&#x7F6E;&#x7684;DNS&#x8BF7;&#x6C42;&#x4F1A;&#x4F9D;&#x636E;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x53D1;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x89E3;&#x6790;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x53D1;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5185;&#x7F6E;DNS&#x4F1A;&#x77E5;&#x9053;&#x8BF7;&#x6C42;&#x662F;&#x4ECE;&#x8C01;&#x53D1;&#x6765;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x5B83;&#x6240;&#x5904;&#x4E8E;&#x54EA;&#x4E9B;&#x7F51;&#x7EDC;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x6839;&#x636E;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x8FD4;&#x56DE;&#x8BE5;&#x5BB9;&#x5668;&#x6240;&#x9700;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<h2 id="nei-zhi-fu-zai-jun-heng"><a href="#&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#nei-zhi-fu-zai-jun-heng" class="header-anchor">#</a></h2><p>&#x5728; <code>1.12</code> &#x4E2D;&#x5F15;&#x5165;&#x7684;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<p>&#x9996;&#x5148;&#x901A;&#x8FC7;<code>DNS</code>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>&#x865A;&#x62DF;IP</code>&#xFF0C;&#x8FD9;&#x4E2A;<code>&#x865A;&#x62DF;IP</code>&#x662F;&#x4E0D;&#x4F1A;&#x53D8;&#x5316;&#x7684;&#x3002;&#x8FD9;&#x4E2A;<code>&#x865A;&#x62DF;IP</code>&#x662F;&#x5728;&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x662F;&#x6240;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x5373;&#x4F7F;&#x670D;&#x52A1;update&#xFF0C;&#x8FD9;&#x4E2A;IP&#x4E5F;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#x5C42;&#x6846;&#x67B6;&#x662F;&#x5426;&#x9075;&#x5FAA;&#x4E86;<code>DNS TTL</code>&#x7684;&#x7EA6;&#x5B9A;&#x3002;&#x800C;&#x4F7F;&#x7528;<code>DNS-RR</code>&#xFF0C;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#x4F1A;&#x968F;&#x673A;&#x4E71;&#x5E8F;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x5DF2;&#x8FBE;&#x5230;&#x4E0D;&#x540C;&#x7684;IP&#x5730;&#x5740;&#xFF0C;&#x4F46;&#x662F;&#x5E94;&#x7528;&#x5C42;&#x7684;DNS&#x5B9E;&#x73B0;&#x7684;&#x7F3A;&#x9677;&#x53EF;&#x80FD;&#x4F1A;&#x65E0;&#x6CD5;&#x5229;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x6CA1;&#x9519;&#xFF0C;Java&#x540C;&#x5B66;&#xFF0C;&#x8BF4;&#x4F60;&#x5462;&#x2026;&#x2026;</em>&#xFF09;&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x4EBA;&#x79F0; <code>DNS-RR</code> &#x662F; <strong>poor man&#x2019;s load balancer</strong>&#x3002;</p>
<p><code>1.12</code> &#x5F15;&#x5165;&#x7684; <code>vip</code> &#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x662F;&#x57FA;&#x4E8E; Linux &#x5185;&#x6838;&#x7684; <code>ipvs</code> &#x9A71;&#x52A8;&#xFF0C;&#x662F;&#x975E;&#x5E38;&#x7A33;&#x5B9A;&#x7684;&#x4E00;&#x4E2A;&#x9A71;&#x52A8;&#xFF0C;&#x5B58;&#x5728;&#x4E8E;&#x5185;&#x6838;&#x5341;&#x591A;&#x5E74;&#x4E86;&#x3002;</p>
<p>&#x5728;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6CA1;&#x6709;&#x96C6;&#x4E2D;&#x5F0F;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x90FD;&#x5185;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x865A;&#x62DF;IP&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x548C;&#x5E94;&#x7528;&#x8BBF;&#x95EE;&#x865A;&#x62DF;IP&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x865A;&#x62DF;IP&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5668;&#x53BB;&#x51B3;&#x5B9A;&#x8BE5;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x54EA;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x56E0;&#x6B64;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5355;&#x70B9;&#x6545;&#x969C;&#x3002;</p>
<p>&#x5B9E;&#x73B0;&#x4E0A;&#xFF0C;&#x4F7F;&#x7528; <code>iptables</code> &#x53BB;trap <code>&#x865A;&#x62DF;ip</code>&#x7684;&#x8BBF;&#x95EE;&#xFF0C;&#x8F6C;&#x5230;&#x5185;&#x6838; <code>ipvs</code> &#x53BB;&#x9009;&#x62E9;&#x670D;&#x52A1;IP&#x5217;&#x8868;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#xFF0C;&#x7136;&#x540E;&#x8F6C;&#x53D1;&#x8BBF;&#x95EE;&#x3002;</p>
<h2 id="mesh-lu-you"><a href="#Mesh-&#x8DEF;&#x7531;" class="headerlink" title="Mesh &#x8DEF;&#x7531;"></a>Mesh &#x8DEF;&#x7531; <a href="#mesh-lu-you" class="header-anchor">#</a></h2><p>Mesh &#x8DEF;&#x7531;&#x540C;&#x6837;&#x4E5F;&#x662F;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x673A;&#x5236;</p>
<ul>
<li>&#x4E3A;&#x8FB9;&#x754C;&#x8DEF;&#x7531;&#x5185;&#x7F6E;&#x4E86; mesh &#x8DEF;&#x7531;</li>
<li>Worker &#x8282;&#x70B9;&#x4E5F;&#x53C2;&#x4E0E; <code>ingress</code> &#x7684; mesh &#x8DEF;&#x7531;</li>
<li>&#x6240;&#x6709;&#x7684;worker&#x8282;&#x70B9;&#x90FD;&#x63A5;&#x53D7;&#x6765;&#x81EA; <code>PublishedPort</code> &#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</li>
<li>&#x7AEF;&#x53E3;&#x8F6C;&#x63A5;&#x53D1;&#x751F;&#x5728;&#x5DE5;&#x4F5C;&#x8282;&#x70B9;</li>
<li>&#x4F7F;&#x7528;&#x7684;&#x662F;&#x548C;&#x4E4B;&#x524D;&#x6240;&#x8FF0;&#x7684;&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4E00;&#x6837;&#x7684;&#x673A;&#x5236;&#x53BB;&#x63A5;&#x53D7;&#x5916;&#x90E8;&#x8BF7;&#x6C42;</li>
</ul>
<p>&#x4F5C;&#x4E3A;&#x7528;&#x6237;&#xFF0C;&#x4F7F;&#x7528; mesh &#x8DEF;&#x7531;&#xFF0C;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53EA;&#x8981;&#x58F0;&#x660E;&#x4E86; <code>PublishedPort</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>--publish</code> &#x540E;&#xFF0C;&#x5404;&#x4E2A; worker &#x8282;&#x70B9;&#x5C31;&#x4F1A;&#x8FDB;&#x884C; mesh &#x8DEF;&#x7531;&#x3002;</p>
<h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x9996;&#x5148;&#x7528; <code>docker swarm init</code> &#x548C; <code>docker swarm join</code> &#x5EFA;&#x7ACB;&#x4E86; <code>1+2</code> &#x4E09;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x3002;</p>
<p>&#x7136;&#x540E;&#x67E5;&#x770B; <code>netns</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo ls /var/run/docker/netns</div><div class="line">1-9cycns5i9w    f681820dbdc5</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x662F; <code>overlay network</code> &#x6C99;&#x7BB1;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x662F; <code>ingress</code> &#x7684;&#x7F51;&#x7EDC;&#x3002;</p>
<p>&#x68C0;&#x67E5; <code>iptables</code> &#x89C4;&#x5219;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo iptables -t nat -nvL</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x9762;&#x7684; <code>DOCKER-INGRESS</code> chain&#x3002;&#x76EE;&#x524D;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x73B0;&#x5728;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">	--name sw \</div><div class="line">	-p 8080:80 \</div><div class="line">	--replicas 3 \</div><div class="line">	mrjana/simpleweb</div><div class="line">	simpleweb</div></pre></td></tr></table></figure>
<p>&#x518D;&#x6B21;&#x68C0;&#x67E5; <code>iptables</code> &#x4E2D;&#x7684; <code>DOCKER-INGRESS</code> chain&#x3002;&#x4F1A;&#x53D1;&#x73B0;&#x591A;&#x4E86;2&#x6761;&#x8BB0;&#x5F55;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x6307;&#x5B9A;&#x4E86;&#x76EE;&#x6807;&#x4E3A; <code>tcp dpt:8080</code> &#x7684;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x5230; <code>172.19.0.2:8080</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nsenter --net=/var/run/docker/netns/f681820dbdc5 bash</div></pre></td></tr></table></figure>
<p>&#x1F613;&#x2026;&#x2026;&#x5F88;&#x4E0D;&#x5E78;&#xFF0C;&#x8FD9;&#x673A;&#x5668;&#x6CA1;&#x88C5; <code>nsenter</code>&#xFF0C;&#x4E8E;&#x662F;&#x6362;&#x4E2A;&#x529E;&#x6CD5;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir /var/run/netns</div><div class="line">touch /var/run/netns/n</div><div class="line">mount -o <span class="built_in">bind</span> /var/run/docker/netns/f681820dbdc5 /var/run/netns/n</div><div class="line">ip netns <span class="built_in">exec</span> n bash</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x5C31;&#x8FDB;&#x5165;&#x8FD9;&#x4E2A; ingress &#x7684;&#x6C99;&#x7BB1;&#x4E86;(<code>netns</code>)&#xFF0C;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x6267;&#x884C; <code>ifconfig</code> &#x67E5;&#x770B;&#x5176;&#x63A5;&#x53E3;&#x4FE1;&#x606F;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -nvL</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t mangle -nvL</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ipvsadm -L</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x5728; <code>POSTROUTING</code> &#x90E8;&#x5206;&#x770B;&#x5230;&#x6539;&#x53D8;&#x4E86;&#x6E90;IP&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x5F53;&#x6570;&#x636E;&#x5305;&#x8FD4;&#x56DE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x7ECF;&#x8FC7; <code>ingress</code> &#x7F51;&#x7EDC;&#xFF0C;&#x7531; <code>ipvs</code> &#x6765;&#x51B3;&#x5B9A;&#x9001;&#x56DE;&#x5230;&#x54EA;&#x91CC;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x6211;&#x4EEC;&#x6539;&#x53D8;&#x4E86;&#x7AEF;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x9700;&#x8981;&#x4ECE;&#x8FD9;&#x91CC;&#x7ECF;&#x8FC7;&#x6765;&#x5C06;&#x7AEF;&#x53E3;&#x6362;&#x56DE;&#x6765;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 运维 - Docker Storage 和 Volumes 进阶指南 - Brian Goff</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-26-video-docker-for-ops-docker-storage-and-volumes-deep-dive-and-considerations.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-26-video-docker-for-ops-docker-storage-and-volumes-deep-dive-and-considerations.html</id>
    <published>2016-07-25T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#image-yu-container-cun-chu">Image &#x4E0E; Container &#x5B58;&#x50A8;</a><ul>
<li><a href="#wo-ying-gai-xuan-ze-na-ge-storage-driver">&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A; <code>storage driver</code>&#xFF1F;</a></li>
<li><a href="#ru-he-zhi-ding-storage-driver">&#x5982;&#x4F55;&#x6307;&#x5B9A; Storage Driver&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#persistent-storage">Persistent Storage</a><ul>
<li><a href="#docker-shi-wei-wu-zhuang-tai-ying-yong-zhun-bei-de">Docker &#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01;</a></li>
<li><a href="#wo-yao-zen-me-zai-docker-li-xx">&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728; Docker &#x91CC; XX &#xFF1F;</a></li>
<li><a href="#storage-fei-chang-kun-nan">Storage &#x975E;&#x5E38;&#x56F0;&#x96BE;</a></li>
<li><a href="#create-a-volume">Create a volume</a></li>
<li><a href="#create-a-volume-nfs">Create a volume - NFS</a></li>
<li><a href="#create-a-volume-btrfs">Create a volume - BTRFS</a></li>
<li><a href="#create-a-volume-gluster">Create a volume - Gluster</a></li>
<li><a href="#create-a-volume-swarm-mode">Create a volume - Swarm Mode</a></li>
</ul>
</li>
<li><a href="#qa">QA</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon16 - Docker for Ops - Docker Storage and Volumes Deep Dive and Considerations<br>by Brian Goff, Core Engineer, @cpuguy83</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/X_q2l8hotAc" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=X_q2l8hotAc" target="_blank" rel="external">https://www.youtube.com/watch?v=X_q2l8hotAc</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=m03195b0m96&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/m03195b0m96.html" target="_blank" rel="external">http://v.qq.com/x/page/m03195b0m96.html</a></p>
<h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x5728; GitHub &#x4E0A;&#x53EB; <a href="https://github.com/cpuguy83" target="_blank" rel="external">cpuguy83</a>&#x3002;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528; Docker 3 &#x5E74;&#x4E86;&#x3002;&#x66FE;&#x7ECF;&#x90E8;&#x7F72;&#x5931;&#x8D25;&#xFF0C;&#x56E0;&#x4E3A;<code>yaml</code>&#x7684;&#x4F9D;&#x8D56;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x540E;&#x6765;&#x5F00;&#x59CB;&#x63A5;&#x89E6; Docker&#xFF0C;&#x751A;&#x81F3;&#x5B66;&#x4E60; Go&#xFF0C;&#x7136;&#x540E;&#x9010;&#x6B65;&#x7684;&#x53D8;&#x4E3A;&#x5F88;&#x6DF1;&#x5165;&#x7684; Docker &#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x3002;</p>
<h1 id="image-yu-container-cun-chu"><a href="#Image-&#x4E0E;-Container-&#x5B58;&#x50A8;" class="headerlink" title="Image &#x4E0E; Container &#x5B58;&#x50A8;"></a>Image &#x4E0E; Container &#x5B58;&#x50A8; <a href="#image-yu-container-cun-chu" class="header-anchor">#</a></h1><p>Docker &#x79F0;&#x5176;&#x4E3A; <code>Storage Driver</code> &#xFF0C;&#x5185;&#x90E8;&#x53EB;&#x5B83; <code>Graph Driver</code>&#x3002;</p>
<p>&#x6BCF;&#x6B21;&#x5F53; <code>docker pull</code> &#x6216; <code>docker run</code> &#x4E4B;&#x540E;&#xFF0C;Docker &#x4ECE; Hub &#x4E4B;&#x7C7B;&#x7684;&#x53D6;&#x56DE; Image&#xFF0C;&#x800C; <strong>Image &#x662F;&#x4E00;&#x5806;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;&#x7684;&#x96C6;&#x5408;</strong>&#x3002;<code>Storage Driver</code> &#x8D1F;&#x8D23;&#x628A;&#x8FD9;&#x4E9B;&#x5C42;&#x6574;&#x5408;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7ED9;&#x5BB9;&#x5668;&#x3002;</p>
<h2 id="wo-ying-gai-xuan-ze-na-ge-storage-driver"><a href="#&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A;-storage-driver&#xFF1F;" class="headerlink" title="&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A; storage driver&#xFF1F;"></a>&#x6211;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x54EA;&#x4E2A; <code>storage driver</code>&#xFF1F; <a href="#wo-ying-gai-xuan-ze-na-ge-storage-driver" class="header-anchor">#</a></h2><table>
<thead>
<tr>
<th>&#x5B58;&#x50A8;&#x9A71;&#x52A8;</th>
<th>&#x7C7B;&#x578B;</th>
<th>&#x5185;&#x6838;&#x652F;&#x6301;</th>
<th>&#x7A7A;&#x95F4;&#x914D;&#x989D;</th>
<th>&#x95EE;&#x9898;&#x6307;&#x6570;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AUFS</code></td>
<td>FS</td>
<td>No</td>
<td>No</td>
<td>1</td>
</tr>
<tr>
<td><code>BTRFS</code></td>
<td>Block</td>
<td>Yes</td>
<td>No</td>
<td>5</td>
</tr>
<tr>
<td><code>DeviceMapper</code></td>
<td>Block</td>
<td>Yes</td>
<td>Yes</td>
<td>6</td>
</tr>
<tr>
<td><code>Overlay</code></td>
<td>FS</td>
<td>Yes</td>
<td>No</td>
<td>5</td>
</tr>
<tr>
<td><code>Overlay2</code></td>
<td>FS</td>
<td>Yes</td>
<td>No</td>
<td>3</td>
</tr>
<tr>
<td><code>ZFS</code></td>
<td>Block</td>
<td>No</td>
<td>Yes</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><code>AUFS</code> &#x5B58;&#x5728;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x5230;&#x4ECA;&#x5929;&#x5DF2;&#x7ECF;&#x5F88;&#x7A33;&#x5B9A;&#x4E86;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BF9;&#x4E8E; docker &#x4F7F;&#x7528;&#x800C;&#x8A00;&#xFF0C;&#x4E0D;&#x5927;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x3002;</p>
<p><code>DeviceMapper</code>&#x662F;&#x6BD4;&#x8F83;&#x8001;&#x7684;&#x6280;&#x672F;&#x4E86;&#xFF0C;&#x603B;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x95EE;&#x9898;&#x3002;</p>
<p><code>Overlay</code> &#x7B2C;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x662F;&#x4F7F;&#x7528; <code>3.18</code> &#x4EE5;&#x4E0A;&#x7684;&#x5185;&#x6838;&#xFF0C;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#x6B20;&#x7F3A;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x5F88;&#x591A; <code>hard link</code>&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4; <code>inode</code> &#x8FC7;&#x591A;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5728; <code>4.0</code> &#x5185;&#x6838;&#x4EE5;&#x4E0A;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5728; <code>Docker 1.12</code> &#x6709;&#x4E86; <code>Overlay2</code> &#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p><code>ZFS</code> &#x5F88;&#x8001;&#x724C;&#x7684;&#x5B58;&#x50A8;&#x4ECB;&#x8D28;&#xFF0C;&#x5F88;&#x7A33;&#x5B9A;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7; Linux Kernel &#x662F;&#x4E0D;&#x4F1A;&#x652F;&#x6301;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6240;&#x6709;&#x7684; <code>Block</code> &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x90FD;&#x652F;&#x6301;<code>&#x78C1;&#x76D8;&#x914D;&#x989D;</code>&#xFF0C;&#x4F46;&#x662F; <code>FS</code> &#x7684;&#x90FD;&#x4E0D;&#x652F;&#x6301;&#x3002;<code>Docker 1.12</code> &#x4EE5;&#x540E;&#x652F;&#x6301; &#x914D;&#x989D; &#x4E86;&#x3002;</p>
<h2 id="ru-he-zhi-ding-storage-driver"><a href="#&#x5982;&#x4F55;&#x6307;&#x5B9A;-Storage-Driver&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x6307;&#x5B9A; Storage Driver&#xFF1F;"></a>&#x5982;&#x4F55;&#x6307;&#x5B9A; Storage Driver&#xFF1F; <a href="#ru-he-zhi-ding-storage-driver" class="header-anchor">#</a></h2><p><code>1.10</code> &#x4EE5;&#x540E;&#xFF0C;<code>Docker Daemon</code> &#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>JSON</code> &#x6587;&#x4EF6;&#x914D;&#x7F6E; <code>Docker Daemon</code> &#x4E86;&#x3002;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x6307;&#x5B9A; <code>storage driver</code>&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">&apos;{ &quot;storage-driver&quot;: &quot;overlay2&quot; }&apos;</span> &gt; /etc/docker/daemon.json</div></pre></td></tr></table></figure>
<p>&#x6539;&#x53D8; <code>storage driver</code> &#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x673A;&#x5668;&#x4E0A;&#x6240;&#x6709;&#x7684; <code>image</code>&#x3001;&#x5BB9;&#x5668;&#x90FD;&#x4E0D;&#x89C1;&#x4E86;&#xFF0C;&#x5F88;&#x591A;&#x4EBA; freaking out &#x4E86;&#x3002;&#x5176;&#x5B9E;&#x4E1C;&#x897F;&#x6CA1;&#x4E22;&#xFF0C;&#x8FD8;&#x5728;&#x90A3;&#x91CC;&#xFF0C;&#x4F46;&#x95EE;&#x9898;&#x662F; Docker &#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x53EA;&#x80FD;&#x652F;&#x6301;&#x4E00;&#x4E2A; Storage Driver&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x4E4B;&#x524D;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x628A; Storage driver &#x518D;&#x6362;&#x56DE;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x5BFC;&#x51FA;&#x3001;&#x4FDD;&#x5B58;&#x955C;&#x50CF;&#x5565;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x653E;&#x5230;&#x65B0;&#x7684; storage driver &#x4E2D;&#x53BB;&#x3002;</p>
<h1 id="persistent-storage"><a href="#Persistent-Storage" class="headerlink" title="Persistent Storage"></a>Persistent Storage <a href="#persistent-storage" class="header-anchor">#</a></h1><p>&#x5728; Docker &#x4E2D;&#x88AB;&#x79F0;&#x4E3A; <code>Volumes</code>&#xFF0C;&#x8FD9;&#x662F;&#x5728;&#x5BB9;&#x5668;&#x751F;&#x5B58;&#x5468;&#x671F;&#x4E4B;&#x5916;&#xFF0C;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x5730;&#x65B9;&#x3002;</p>
<h2 id="docker-shi-wei-wu-zhuang-tai-ying-yong-zhun-bei-de"><a href="#Docker-&#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01;" class="headerlink" title="Docker &#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01;"></a>Docker &#x662F;&#x4E3A;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x51C6;&#x5907;&#x7684;&#xFF01; <a href="#docker-shi-wei-wu-zhuang-tai-ying-yong-zhun-bei-de" class="header-anchor">#</a></h2><p><strong>&#x8FD9;&#x8BF4;&#x6CD5;&#x5176;&#x5B9E;&#x4E0D;&#x5BF9;</strong>&#x3002;</p>
<p>&#x4E25;&#x683C;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x786E;&#x5B9E;&#x66F4;&#x5BB9;&#x6613;&#x8FC1;&#x79FB;&#x5230; Docker &#x4E0A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B8C;&#x5168;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x5B58;&#x50A8;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x8BF4; Docker &#x5C31;&#x5C40;&#x9650;&#x4E8E;&#x65E0;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x4E86;&#x3002;</p>
<p>Brian &#x81EA;&#x5DF1;&#x6240;&#x5728;&#x516C;&#x53F8;&#x5C31;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x65E0;&#x72B6;&#x6001;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6240;&#x6709;&#x90FD;&#x5728; Docker &#x91CC;&#xFF0C;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x3001;Web apps&#x3001;Redis &#x5230;VPN tunnel&#x3002;</p>
<h2 id="wo-yao-zen-me-zai-docker-li-xx"><a href="#&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728;-Docker-&#x91CC;-XX-&#xFF1F;" class="headerlink" title="&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728; Docker &#x91CC; XX &#xFF1F;"></a>&#x6211;&#x8981;&#x600E;&#x4E48;&#x5728; Docker &#x91CC; XX &#xFF1F; <a href="#wo-yao-zen-me-zai-docker-li-xx" class="header-anchor">#</a></h2><p>&#x6BD4;&#x5982;&#x5982;&#x4F55;&#x5728; Docker &#x91CC;&#x5B58;&#x6570;&#x636E;&#x5E93;&#xFF1F;&#x5982;&#x4F55;&#x5907;&#x4EFD;&#x6570;&#x636E;&#xFF1F;&#x5982;&#x4F55;&#x8FC1;&#x79FB;&#x6570;&#x636E;&#xFF1F;</p>
<p>&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x7684;&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; Docker&#xFF0C;&#x8FD9;&#x4E9B;&#x4E8B;&#x60C5;&#x600E;&#x4E48;&#x505A;&#x7684;&#xFF1F;&#x56E0;&#x4E3A;Docker&#x975E;&#x5E38;&#x7684;&#x7B80;&#x5355;&#xFF0C;&#x5E73;&#x65F6;shell&#x4E0B;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x7684;&#xFF0C;Docker&#x5C31;&#x5982;&#x4F55;&#x64CD;&#x4F5C;&#x3002;&#x5E73;&#x65F6;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5982;&#x4F55;&#x505A;&#xFF0C;Docker&#x91CC;&#x9762;&#x5C31;&#x5982;&#x4F55;&#x505A;&#x3002;&#x4E00;&#x5207;&#x90FD;&#x5F88;&#x81EA;&#x7136;&#x3002;</p>
<p>Docker &#x5E76;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#x8BA1;&#x7B97;&#x73AF;&#x5883;&#x3002;</p>
<p>&#x5BB9;&#x5668;&#x7684;&#x610F;&#x4E49;&#x4E0D;&#x5728;&#x4E8E;&#x5BB9;&#x5668;&#x672C;&#x8EAB;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x610F;&#x4E49;&#x5728;&#x4E8E;&#x62BD;&#x8C61;&#x67B6;&#x6784;&#xFF0C;&#x5E76;&#x4E14;&#x5173;&#x6CE8;&#x4E8E;&#x5E94;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5173;&#x6CE8;&#x4E8E;&#x6784;&#x5EFA;&#x672C;&#x8EAB;&#x3002;</p>
<h2 id="storage-fei-chang-kun-nan"><a href="#Storage-&#x975E;&#x5E38;&#x56F0;&#x96BE;" class="headerlink" title="Storage &#x975E;&#x5E38;&#x56F0;&#x96BE;"></a>Storage &#x975E;&#x5E38;&#x56F0;&#x96BE; <a href="#storage-fei-chang-kun-nan" class="header-anchor">#</a></h2><p>Brian &#x95EE;&#x5927;&#x5BB6;&#x8C01;&#x4E22;&#x5931;&#x8FC7;&#x6570;&#x636E;&#xFF0C;&#x5373;&#x4F7F;&#x6709;&#x5907;&#x4EFD;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x5907;&#x4EFD;&#x7684;&#x8BBE;&#x5907;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x574F;&#x4E86;&#xFF0C;&#x4E4B;&#x524D;&#x6CA1;&#x6CE8;&#x610F;&#x5230;&#xFF1B;&#x6216;&#x8005;&#x4E4B;&#x524D;&#x4EE5;&#x4E3A;&#x5DE5;&#x4F5C;&#xFF0C;&#x7B49;&#x9700;&#x8981;&#x6062;&#x590D;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x4E0D;&#x80FD;&#x7528;&#x4E86;&#x3002;</p>
<h2 id="create-a-volume"><a href="#Create-a-volume" class="headerlink" title="Create a volume"></a>Create a volume <a href="#create-a-volume" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker volume create --name important_data</div><div class="line">docker run <span class="_">-d</span> -v important_data:/var/lib/postgresql/data --name pgdb postgres</div><div class="line">docker rm <span class="_">-f</span> pgdb</div><div class="line"><span class="comment"># &#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x8FD8;&#x5728;</span></div><div class="line">docker run <span class="_">-d</span> -v important_data:/var/lib/postgresql/data --name pgdb postgres</div></pre></td></tr></table></figure>
<h2 id="create-a-volume-nfs"><a href="#Create-a-volume-NFS" class="headerlink" title="Create a volume - NFS"></a>Create a volume - NFS <a href="#create-a-volume-nfs" class="header-anchor">#</a></h2><p><code>docker volume</code> &#x5176;&#x5B9E;&#x652F;&#x6301;&#x7ED1;&#x5B9A;&#x5F88;&#x591A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982; <code>NFS</code> &#x7684;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker volume create \</div><div class="line">    --name important_data \</div><div class="line">    --opt <span class="built_in">type</span>=nfs \</div><div class="line">    --opt device=1.2.3.4:/<span class="built_in">export</span>/path</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x4F60;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x5C31;&#x5728; <code>NFS</code>&#x4E86;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55; docker host &#x4E0A;&#x8FD0;&#x884C; <code>postgresql</code> &#x6570;&#x636E;&#x5E93;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F; <code>NFS</code>&#xFF1B;&#x4F60;&#x7684; <code>postgressql</code> &#x4F1A;&#x53D8;&#x5F97;&#x8D85;&#x6162;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F; <code>NFS</code>&#x2026;&#x2026;</p>
<h2 id="create-a-volume-btrfs"><a href="#Create-a-volume-BTRFS" class="headerlink" title="Create a volume - BTRFS"></a>Create a volume - BTRFS <a href="#create-a-volume-btrfs" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker volume create \</div><div class="line">    --name important_data</div><div class="line">    --opt <span class="built_in">type</span>=btrfs \</div><div class="line">    --opt device=/dev/sdb</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5C31;&#x652F;&#x6301; <code>snapshot</code>, <code>clone</code> &#x4E86;&#x3002;</p>
<h2 id="create-a-volume-gluster"><a href="#Create-a-volume-Gluster" class="headerlink" title="Create a volume - Gluster"></a>Create a volume - Gluster <a href="#create-a-volume-gluster" class="header-anchor">#</a></h2><p>Docker Volume &#x8FD8;&#x652F;&#x6301;&#x5927;&#x91CF;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x51E0;&#x4E4E;&#x5404;&#x79CD;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x90FD;&#x6709;&#x652F;&#x6301;&#x3002;&#x6BD4;&#x5982;&#x652F;&#x6301; <code>glusterfs</code> &#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker volume create \</div><div class="line">    --name important_data</div><div class="line">    --driver glusterfs</div></pre></td></tr></table></figure>
<h2 id="create-a-volume-swarm-mode"><a href="#Create-a-volume-Swarm-Mode" class="headerlink" title="Create a volume - Swarm Mode"></a>Create a volume - Swarm Mode <a href="#create-a-volume-swarm-mode" class="header-anchor">#</a></h2><p>&#x5728; 1.12 &#x96C6;&#x6210;&#x8FDB;&#x6765;&#x7684; <code>Docker Swarm Mode</code> &#x4E0B;&#x4F7F;&#x7528; Volume</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=important_data,target=/var/lib/postgresql/data,volume \</div><div class="line">    --driver=<span class="built_in">local</span> \</div><div class="line">    postgres</div></pre></td></tr></table></figure>
<blockquote>
<p>Docker is for anything you are crazy enough to try - Brian Goff</p>
</blockquote>
<ul>
<li>&#x4E0D;&#x8981;&#x6302;&#x8F7D;&#x5230;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x3002;</li>
<li>&#x4E0D;&#x8981;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#xFF08;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4EA4;&#x6D41;&#x6765;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#x6765;&#x4EA4;&#x6D41;&#xFF09;&#xFF0C;&#x6BD4;&#x5982; <code>volumes_from</code> &#x57FA;&#x672C;&#x662F;&#x4E2A;&#x5F88;&#x5DEE;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x8FD9;&#x5728;&#x96C6;&#x7FA4;&#x4E2D;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x7B49;&#x4E8E;&#x9501;&#x5B9A;&#x4E86;&#x8FD9;&#x4E2A;&#x5377;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0B;&#x53EF;&#x80FD;&#x80FD;&#x5DE5;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x67D0;&#x4E9B;&#x7CFB;&#x7EDF;&#x4E0B;&#x4F1A;&#x4EA7;&#x751F;&#x5D29;&#x6E83;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x6837;&#x4F1A;&#x4EA7;&#x751F;&#x5F88;&#x9EBB;&#x70E6;&#x7684; <code>race condition</code> &#x7684;&#x95EE;&#x9898;&#x3002;</li>
</ul>
<h1 id="qa"><a href="#QA" class="headerlink" title="QA"></a>QA <a href="#qa" class="header-anchor">#</a></h1><h4 id="q-docker-deng-yu-ti-gong-liao-yi-ge-tong-yi-de-juan-jie-kou-na-me-shi-bu-shi-ke-yi-shuo-qi-shi-bei-fen-geng-rong-yi-liao-wo-zhi-xu-yao-gao-su-it-guy-bei-fen-volume-jiu-wan-liao-er-bu-yong-guan-xin-ju-ti-shi-shi-me-shu-ju-zhi-lei-de"><a href="#Q-Docker-&#x7B49;&#x4E8E;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5377;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8BF4;&#x5176;&#x5B9E;&#x5907;&#x4EFD;&#x66F4;&#x5BB9;&#x6613;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9;-IT-guy-&#x5907;&#x4EFD;-Volume-&#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x800C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#xFF1F;" class="headerlink" title="Q: Docker &#x7B49;&#x4E8E;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5377;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8BF4;&#x5176;&#x5B9E;&#x5907;&#x4EFD;&#x66F4;&#x5BB9;&#x6613;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9; IT guy &#x5907;&#x4EFD; Volume &#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x800C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#xFF1F;"></a>Q: Docker &#x7B49;&#x4E8E;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5377;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x8BF4;&#x5176;&#x5B9E;&#x5907;&#x4EFD;&#x66F4;&#x5BB9;&#x6613;&#x4E86;&#xFF0C;&#x6211;&#x53EA;&#x9700;&#x8981;&#x544A;&#x8BC9; IT guy &#x5907;&#x4EFD; Volume &#x5C31;&#x5B8C;&#x4E86;&#xFF1F;&#x800C;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#x4E4B;&#x7C7B;&#x7684;&#xFF1F; <a href="#q-docker-deng-yu-ti-gong-liao-yi-ge-tong-yi-de-juan-jie-kou-na-me-shi-bu-shi-ke-yi-shuo-qi-shi-bei-fen-geng-rong-yi-liao-wo-zhi-xu-yao-gao-su-it-guy-bei-fen-volume-jiu-wan-liao-er-bu-yong-guan-xin-ju-ti-shi-shi-me-shu-ju-zhi-lei-de" class="header-anchor">#</a></h4><p>Docker&#x786E;&#x5B9E;&#x63D0;&#x4F9B;&#x4E86;&#x7EDF;&#x4E00;&#x7684;&#x63A5;&#x53E3;&#x8BBF;&#x95EE;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x57FA;&#x4E8E; VFS &#x673A;&#x5236;&#x7684;&#x3002;&#x5907;&#x4EFD;&#x53EF;&#x4EE5;&#x6709;&#x4E24;&#x79CD;&#x505A;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x9009;&#x62E9;&#x90A3;&#x4E9B;&#x652F;&#x6301;&#x5907;&#x4EFD;&#x673A;&#x5236;&#x7684; Storage&#xFF1B;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x624B;&#x52A8;&#x5907;&#x4EFD;&#xFF0C;&#x8D77;&#x4E2A;&#x5BB9;&#x5668;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x5377;&#x7136;&#x540E;&#x5907;&#x4EFD;&#x3002;&#x5173;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5907;&#x4EFD;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x73B0;&#x5728;&#x505A; Replication &#x975E;&#x5E38;&#x5BB9;&#x6613;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x8981;&#x63D0;&#x4F9B;HA&#xFF0C;&#x5C3D;&#x91CF;&#x901A;&#x8FC7; Replication&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x672C;&#x5730;&#x5907;&#x4EFD;&#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<h4 id="q-1-aufs-kai-shi-bei-yi-xie-fa-xing-ban-qu-diao-liao-na-me-jiang-lai-mo-ren-de-storage-driver-hui-shi-shi-me-2-spotify-ti-gong-liao-docker-gc-lai-qing-li-la-ji-yao-shi-docker-you-yuan-sheng-de-jie-jue-fang-an-hui-geng-hao-zhe-fang-mian-you-shi-me-ji-hua-mei-you"><a href="#Q-1-AUFS-&#x5F00;&#x59CB;&#x88AB;&#x4E00;&#x4E9B;&#x53D1;&#x884C;&#x7248;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x9ED8;&#x8BA4;&#x7684;-Storage-Driver&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;2-Spotify-&#x63D0;&#x4F9B;&#x4E86;-docker-gc-&#x6765;&#x6E05;&#x7406;&#x5783;&#x573E;&#xFF0C;&#x8981;&#x662F;-Docker-&#x6709;&#x539F;&#x751F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x6709;&#x4EC0;&#x4E48;&#x8BA1;&#x5212;&#x6CA1;&#x6709;&#xFF1F;" class="headerlink" title="Q: 1. AUFS &#x5F00;&#x59CB;&#x88AB;&#x4E00;&#x4E9B;&#x53D1;&#x884C;&#x7248;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x9ED8;&#x8BA4;&#x7684; Storage Driver&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;2. Spotify &#x63D0;&#x4F9B;&#x4E86; docker-gc &#x6765;&#x6E05;&#x7406;&#x5783;&#x573E;&#xFF0C;&#x8981;&#x662F; Docker &#x6709;&#x539F;&#x751F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x6709;&#x4EC0;&#x4E48;&#x8BA1;&#x5212;&#x6CA1;&#x6709;&#xFF1F;"></a>Q: 1. AUFS &#x5F00;&#x59CB;&#x88AB;&#x4E00;&#x4E9B;&#x53D1;&#x884C;&#x7248;&#x53BB;&#x6389;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x9ED8;&#x8BA4;&#x7684; Storage Driver&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;2. Spotify &#x63D0;&#x4F9B;&#x4E86; docker-gc &#x6765;&#x6E05;&#x7406;&#x5783;&#x573E;&#xFF0C;&#x8981;&#x662F; Docker &#x6709;&#x539F;&#x751F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x8FD9;&#x65B9;&#x9762;&#x6709;&#x4EC0;&#x4E48;&#x8BA1;&#x5212;&#x6CA1;&#x6709;&#xFF1F; <a href="#q-1-aufs-kai-shi-bei-yi-xie-fa-xing-ban-qu-diao-liao-na-me-jiang-lai-mo-ren-de-storage-driver-hui-shi-shi-me-2-spotify-ti-gong-liao-docker-gc-lai-qing-li-la-ji-yao-shi-docker-you-yuan-sheng-de-jie-jue-fang-an-hui-geng-hao-zhe-fang-mian-you-shi-me-ji-hua-mei-you" class="header-anchor">#</a></h4><p>&#x867D;&#x7136;&#x8BF4;&#x8981;&#x53BB;&#x6389; <code>AUFS</code>&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x591A;&#x6700;&#x540E;&#x6CA1;&#x6709;&#x53BB;&#x6389;&#xFF0C;&#x7279;&#x522B;&#x662F; <code>Ubuntu 16.04</code> &#x5185;&#x7F6E;&#x4E86; <code>AUFS</code>&#xFF0C;&#x8FD9;&#x4E2A;LTS&#x7248;&#x672C;&#x4F1A;&#x6301;&#x7EED;&#x5F88;&#x591A;&#x5E74;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x662F;&#x592A;&#x5927;&#x7684;&#x95EE;&#x9898;&#x3002;<code>Overlay</code> &#x662F;&#x5C06;&#x6765;&#x7684;&#x5E0C;&#x671B;&#xFF0C;&#x4F46;&#x662F;&#x73B0;&#x5728;&#x8FD8;&#x6709;&#x4E00;&#x4E9B; kernel bug&#x9700;&#x8981;&#x53BB;&#x5904;&#x7406;&#xFF0C;Brian &#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x5411;&#x4EBA;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x8FC7; <code>Overlay FS</code>&#xFF0C;&#x9664;&#x975E;&#x662F;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x3002;&#x4F46;&#x662F;&#x5E0C;&#x671B;&#x8FD9;&#x4E2A;&#x5C06;&#x6765;&#x80FD;&#x6210;&#x719F;&#x8D77;&#x6765;&#x3002;</p>
<p>&#x81F3;&#x4E8E;&#x5783;&#x573E;&#x56DE;&#x6536;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x7684;&#xFF0C;&#x4E00;&#x76F4;&#x5728;&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x5728; <code>Docker 1.10</code> &#x4E4B;&#x524D;&#x8FD9;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x597D;&#x5F88;&#x591A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x5728;&#x8003;&#x8651;&#x5177;&#x4F53;&#x600E;&#x4E48;&#x53BB;&#x505A;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#xFF0C;GC&#x8FD9;&#x4E1C;&#x897F;&#x653E;&#x5230;&#x54EA;&#x91CC;&#x90FD;&#x662F;&#x6BD4;&#x8F83;&#x96BE;&#x4EE5;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8981;&#x505A;&#x5C31;&#x5F97;&#x505A;&#x5BF9;&#xFF0C;&#x4E0D;&#x80FD;&#x628A;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x5373;&#x5C06;&#x8FD0;&#x884C;&#x7684; image &#x7ED9;&#x5220;&#x6389;&#x3002;</p>
<h4 id="q-dui-yu-swarm-mode-er-yan-tui-jian-shi-yong-shi-me-volume-driver-lai-gong-xiang-juan"><a href="#Q-&#x5BF9;&#x4E8E;-Swarm-Mode-&#x800C;&#x8A00;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4EC0;&#x4E48;-Volume-driver-&#x6765;&#x5171;&#x4EAB;&#x5377;&#xFF1F;" class="headerlink" title="Q: &#x5BF9;&#x4E8E; Swarm Mode &#x800C;&#x8A00;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4EC0;&#x4E48; Volume driver &#x6765;&#x5171;&#x4EAB;&#x5377;&#xFF1F;"></a>Q: &#x5BF9;&#x4E8E; Swarm Mode &#x800C;&#x8A00;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4EC0;&#x4E48; Volume driver &#x6765;&#x5171;&#x4EAB;&#x5377;&#xFF1F; <a href="#q-dui-yu-swarm-mode-er-yan-tui-jian-shi-yong-shi-me-volume-driver-lai-gong-xiang-juan" class="header-anchor">#</a></h4><p>&#x8FD9;&#x4F9D;&#x8D56;&#x4E8E;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;&#x6709;&#x4E00;&#x4E9B;&#x63D2;&#x4EF6;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x5757;&#x5B58;&#x50A8;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x6709;&#x5176;&#x7279;&#x5B9A;&#x7684;&#x4E91;&#x5B58;&#x50A8;&#x63D2;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x79C1;&#x6709;&#x4E91;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x63A8;&#x8350;&#x7528; <code>gluster</code>&#x6216;&#x8005;<code>ceph</code>&#x3002;</p>
<h4 id="q-docker-de-overlay-network-fei-chang-fang-bian-dui-yong-hu-tou-ming-ke-yi-zai-gan-zhi-bu-dao-de-qing-kuang-xia-shi-xian-ji-qun-kua-zhu-ji-fang-wen-na-me-jiang-lai-you-mei-you-ke-neng-zuo-yi-ge-lei-si-de-overlay-storage-de-dong-xi-ye-neng-gou-zhe-me-fang-bian-de-shi-yong-cun-chu"><a href="#Q-Docker-&#x7684;-Overlay-Network-&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x900F;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x8DE8;&#x4E3B;&#x673A;&#x8BBF;&#x95EE;&#x3002;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x6709;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x505A;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;-Overlay-Storage-&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x8FD9;&#x4E48;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#xFF1F;" class="headerlink" title="Q: Docker &#x7684; Overlay Network &#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x900F;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x8DE8;&#x4E3B;&#x673A;&#x8BBF;&#x95EE;&#x3002;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x6709;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x505A;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684; Overlay Storage &#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x8FD9;&#x4E48;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#xFF1F;"></a>Q: Docker &#x7684; Overlay Network &#x975E;&#x5E38;&#x65B9;&#x4FBF;&#xFF0C;&#x5BF9;&#x7528;&#x6237;&#x900F;&#x660E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x8DE8;&#x4E3B;&#x673A;&#x8BBF;&#x95EE;&#x3002;&#x90A3;&#x4E48;&#x5C06;&#x6765;&#x6709;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x505A;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684; Overlay Storage &#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x8FD9;&#x4E48;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#xFF1F; <a href="#q-docker-de-overlay-network-fei-chang-fang-bian-dui-yong-hu-tou-ming-ke-yi-zai-gan-zhi-bu-dao-de-qing-kuang-xia-shi-xian-ji-qun-kua-zhu-ji-fang-wen-na-me-jiang-lai-you-mei-you-ke-neng-zuo-yi-ge-lei-si-de-overlay-storage-de-dong-xi-ye-neng-gou-zhe-me-fang-bian-de-shi-yong-cun-chu" class="header-anchor">#</a></h4><p><code>Storage is Hard</code>. &#x8FD9;&#x662F;&#x6211;&#x552F;&#x4E00;&#x80FD;&#x8BF4;&#x7684;&#x3002;&#x8FD9;&#x6B21;&#x5927;&#x4F1A;&#x5C55;&#x53F0;&#x4E0A;&#x6709;&#x4E00;&#x534A;&#x90FD;&#x662F; Storage &#x5382;&#x5546;&#xFF0C;&#x63A8;&#x8350;&#x53BB;&#x770B;&#x4E00;&#x4E0B;&#x4ED6;&#x4EEC;&#x7684;&#x6280;&#x672F;&#x3002;</p>
<h4 id="q-ru-guo-wo-you-ge-python-app-wo-xian-zai-xiang-yong-swarm-qu-scale-na-me-shu-ju-ku-zen-me-scale"><a href="#Q-&#x5982;&#x679C;&#x6211;&#x6709;&#x4E2A;-Python-app&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x60F3;&#x7528;-Swarm-&#x53BB;scale&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E93;&#x600E;&#x4E48;scale&#xFF1F;" class="headerlink" title="Q: &#x5982;&#x679C;&#x6211;&#x6709;&#x4E2A; Python app&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x60F3;&#x7528; Swarm &#x53BB;scale&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E93;&#x600E;&#x4E48;scale&#xFF1F;"></a>Q: &#x5982;&#x679C;&#x6211;&#x6709;&#x4E2A; Python app&#xFF0C;&#x6211;&#x73B0;&#x5728;&#x60F3;&#x7528; Swarm &#x53BB;scale&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E93;&#x600E;&#x4E48;scale&#xFF1F; <a href="#q-ru-guo-wo-you-ge-python-app-wo-xian-zai-xiang-yong-swarm-qu-scale-na-me-shu-ju-ku-zen-me-scale" class="header-anchor">#</a></h4><p>&#x9996;&#x5148;&#x662F;&#x4E0D;&#x8981;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x5E93;&#x5B58;&#x50A8;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x800C;&#x4F7F;&#x7528; <code>replicas</code>&#x3002;</p>
<h4 id="q-wo-men-zai-jie-jue-yi-ge-fen-fa-shu-ju-de-wen-ti-wo-men-xi-wang-feng-zhuang-shu-ju-ku-jin-jing-xiang-zhe-yang-yong-hu-qi-dong-jing-xiang-de-shi-hou-ke-yi-bu-yong-xia-zai-huo-zhe-sheng-cheng-zhe-xie-shu-ju-dan-shi-fen-fa-yi-ge-10gb-de-image-xian-ran-bu-zha-yang-you-shi-me-hao-jian-yi-me"><a href="#Q-&#x6211;&#x4EEC;&#x5728;&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C01;&#x88C5;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x542F;&#x52A8;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x4E0B;&#x8F7D;&#x6216;&#x8005;&#x751F;&#x6210;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x5206;&#x53D1;&#x4E00;&#x4E2A;10GB&#x7684;-image-&#x663E;&#x7136;&#x4E0D;&#x548B;&#x6837;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5EFA;&#x8BAE;&#x4E48;&#xFF1F;" class="headerlink" title="Q: &#x6211;&#x4EEC;&#x5728;&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C01;&#x88C5;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x542F;&#x52A8;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x4E0B;&#x8F7D;&#x6216;&#x8005;&#x751F;&#x6210;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x5206;&#x53D1;&#x4E00;&#x4E2A;10GB&#x7684; image &#x663E;&#x7136;&#x4E0D;&#x548B;&#x6837;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5EFA;&#x8BAE;&#x4E48;&#xFF1F;"></a>Q: &#x6211;&#x4EEC;&#x5728;&#x89E3;&#x51B3;&#x4E00;&#x4E2A;&#x5206;&#x53D1;&#x6570;&#x636E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C01;&#x88C5;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x542F;&#x52A8;&#x955C;&#x50CF;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x4E0B;&#x8F7D;&#x6216;&#x8005;&#x751F;&#x6210;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x5206;&#x53D1;&#x4E00;&#x4E2A;10GB&#x7684; image &#x663E;&#x7136;&#x4E0D;&#x548B;&#x6837;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5EFA;&#x8BAE;&#x4E48;&#xFF1F; <a href="#q-wo-men-zai-jie-jue-yi-ge-fen-fa-shu-ju-de-wen-ti-wo-men-xi-wang-feng-zhuang-shu-ju-ku-jin-jing-xiang-zhe-yang-yong-hu-qi-dong-jing-xiang-de-shi-hou-ke-yi-bu-yong-xia-zai-huo-zhe-sheng-cheng-zhe-xie-shu-ju-dan-shi-fen-fa-yi-ge-10gb-de-image-xian-ran-bu-zha-yang-you-shi-me-hao-jian-yi-me" class="header-anchor">#</a></h4><p>&#x9996;&#x5148;&#x662F;&#x4E0D;&#x63A8;&#x8350;&#x5C06;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x5230;&#x955C;&#x50CF;&#x91CC;&#xFF0C;&#x5E94;&#x8BE5;&#x8BBE;&#x6CD5;&#x662F;&#x5206;&#x53D1;&#x6570;&#x636E;&#x3002;&#x901A;&#x8FC7;<code>FTP</code>, <code>HTTP</code>, <code>S3</code> &#x4E4B;&#x7C7B;&#x7684;&#x5206;&#x53D1;&#x624B;&#x6BB5;&#x3002;</p>
<h4 id="q-ni-shuo-bu-yao-shi-yong-bang-ding-su-zhu-mu-lu-wo-de-li-jie-shi-bu-yao-bang-ding-te-ding-su-zhu-mu-lu-na-me-you-mei-you-bie-de-yuan-yin-bu-shi-yong-bang-ding-su-zhu-mu-lu-ni"><a href="#Q-&#x4F60;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x5462;&#xFF1F;" class="headerlink" title="Q: &#x4F60;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x5462;&#xFF1F;"></a>Q: &#x4F60;&#x8BF4;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6211;&#x7684;&#x7406;&#x89E3;&#x662F;&#x4E0D;&#x8981;&#x7ED1;&#x5B9A;&#x7279;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x522B;&#x7684;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x5462;&#xFF1F; <a href="#q-ni-shuo-bu-yao-shi-yong-bang-ding-su-zhu-mu-lu-wo-de-li-jie-shi-bu-yao-bang-ding-te-ding-su-zhu-mu-lu-na-me-you-mei-you-bie-de-yuan-yin-bu-shi-yong-bang-ding-su-zhu-mu-lu-ni" class="header-anchor">#</a></h4><p>&#x9996;&#x5148;&#x6211;&#x5E76;&#x4E0D;&#x8BA4;&#x4E3A;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x662F; Volume&#xFF0C;&#x6211;&#x7279;&#x610F;&#x56DE;&#x907F;&#x4E86;&#x5C06;&#x5176;&#x8BF4;&#x4E3A; Volume &#x7684;&#x505A;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x6709; Volume &#x5BF9;&#x8C61;&#xFF0C;&#x548C; Host Path&#xFF0C;&#x8FD9;&#x662F;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BD4;&#x5982;&#x73B0;&#x5728;&#x7684;&#x5982;&#x679C;-v&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x5230;&#x5BB9;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x4F1A;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x53BB;&#x6302;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x5B9E;&#x9645;&#x7684;&#x610F;&#x56FE;&#x662F;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x4F1A;&#x7ED1;&#x8FDB;&#x5BB9;&#x5668;&#xFF0C;&#x8BA9;&#x5BB9;&#x5668;&#x5185;&#x4EA7;&#x751F;&#x6DF7;&#x4E71;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x53EF;&#x9760;&#x6027;&#x7684;&#x95EE;&#x9898;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x800C;&#x662F;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7684;&#x505A;&#x6CD5;&#x7B49;&#x4E8E;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;Docker&#x63A7;&#x5236;&#x8303;&#x56F4;&#x5916;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x5728;&#x6784;&#x67B6;&#x4E0A;&#x6253;&#x4E86;&#x4E00;&#x4E2A;&#x6D1E;&#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<h4 id="q-shi-me-storage-driver-su-du-zui-kuai"><a href="#Q-&#x4EC0;&#x4E48;-Storage-driver-&#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF1F;" class="headerlink" title="Q: &#x4EC0;&#x4E48; Storage driver &#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF1F;"></a>Q: &#x4EC0;&#x4E48; Storage driver &#x901F;&#x5EA6;&#x6700;&#x5FEB;&#xFF1F; <a href="#q-shi-me-storage-driver-su-du-zui-kuai" class="header-anchor">#</a></h4><p>&#x73B0;&#x5728;&#x7684;&#x8BDD;&#xFF0C;<code>overlay2</code> &#x6700;&#x5FEB;&#xFF0C;&#x5B83;&#x6709;&#x5F88;&#x5DE7;&#x5999;&#x7684;&#x7F13;&#x5B58;&#x673A;&#x5236;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x8BA9;&#x4E0D;&#x540C;&#x7684;&#x5BB9;&#x5668;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;page&#x3002;</p>
<h4 id="q-ke-bu-ke-yi-jiang-device-chuan-jin-rong-qi-nei-ran-hou-zai-li-mian-chuang-jian-soft-raid-ran-hou-shi-yong-ta-men"><a href="#Q-&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x5C06;-device-&#x4F20;&#x8FDB;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x521B;&#x5EFA;-Soft-RAID&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#xFF1F;" class="headerlink" title="Q: &#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x5C06; device &#x4F20;&#x8FDB;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x521B;&#x5EFA; Soft RAID&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#xFF1F;"></a>Q: &#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x5C06; device &#x4F20;&#x8FDB;&#x5BB9;&#x5668;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x91CC;&#x9762;&#x521B;&#x5EFA; Soft RAID&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#xFF1F; <a href="#q-ke-bu-ke-yi-jiang-device-chuan-jin-rong-qi-nei-ran-hou-zai-li-mian-chuang-jian-soft-raid-ran-hou-shi-yong-ta-men" class="header-anchor">#</a></h4><p>&#x5728; <code>docker cli</code> &#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--device</code> &#x6765;&#x6307;&#x5B9A;&#x67D0;&#x4E2A; <code>device</code> &#x6216;&#x8005;&#x67D0;&#x4E2A;&#x76EE;&#x5F55;&#x7684; <code>device</code> &#x7ED9;&#x5BB9;&#x5668;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：绿字黑屏 - Docker 安全示例 - Diogo Mónica</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-21-video-green-font-black-background-docker-security-by-example.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-21-video-green-font-black-background-docker-security-by-example.html</id>
    <published>2016-07-20T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#jie-shao">&#x4ECB;&#x7ECD;</a></li>
<li><a href="#chuang-jian-digital-ocean-fu-wu-qi">&#x521B;&#x5EFA; Digital Ocean &#x670D;&#x52A1;&#x5668;</a></li>
<li><a href="#apparmor">AppArmor</a></li>
<li><a href="#bane">Bane</a></li>
<li><a href="#capabilities">Capabilities</a></li>
<li><a href="#zhi-du-wen-jian-xi-tong">&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li>
<li><a href="#user-namespace">user namespace</a></li>
<li><a href="#content-trust">Content Trust</a></li>
<li><a href="#dui-kang-fork-bomb">&#x5BF9;&#x6297; fork bomb</a><ul>
<li><a href="#kernel-memory">Kernel Memory</a></li>
</ul>
</li>
<li><a href="#wen-jian-xi-tong">&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon15 EU - Green Font, Black Background - Docker Security by Example<br>by Diogo M&#xF3;nica, Security Lead, Docker<br>(2015-12-04)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/blNIreAq6hc" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=blNIreAq6hc" target="_blank" rel="external">https://www.youtube.com/watch?v=blNIreAq6hc</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=k03143nuw7k&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/k03143nuw7k.html" target="_blank" rel="external">http://v.qq.com/x/page/k03143nuw7k.html</a></p>
<h1 id="jie-shao"><a href="#&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4ECB;&#x7ECD;"></a>&#x4ECB;&#x7ECD; <a href="#jie-shao" class="header-anchor">#</a></h1><p>Diogo M&#xF3;nica&#xFF0C;Docker &#x5B89;&#x5168; Lead&#xFF0C;&#x559C;&#x6B22; GPG &#x548C; Perl</p>
<p>&#x9996;&#x5148;&#x58F0;&#x660E;&#xFF0C;&#x9898;&#x76EE;&#x867D;&#x7136;&#x662F;&#x7EFF;&#x5B57;&#x9ED1;&#x5C4F;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6211;&#x7684;&#x5B57;&#x662F;&#x767D;&#x7684;&#xFF0C;&#x90A3;&#x79CD;&#x5C4F;&#x5E55;&#x4E71;&#x7FFB;&#x7684;&#x4E1C;&#x897F;&#x53EA;&#x6709;&#x597D;&#x83B1;&#x575E;&#x7535;&#x5F71;&#x4E2D;&#x624D;&#x6709;&#x3002;&#x5176;&#x6B21;&#x662F;&#x6574;&#x4E2A;&#x6F14;&#x793A;&#x6CA1;&#x6709; PPT&#xFF0C;&#x5168;&#x90E8;&#x4F9D;&#x8D56;&#x4E92;&#x8054;&#x7F51;&#xFF0C;&#x5982;&#x679C;&#x7F51;&#x65AD;&#x4E86;&#x2026;&#x2026;&#x90A3;&#x4F30;&#x8BA1;&#x662F;&#x5168; DockerCon &#x6700;&#x957F;&#x7684;&#x89E3;&#x7B54;session&#x4E86;&#x3002;</p>
<p>&#x800C;&#x4E14;&#xFF0C;&#x5168;&#x90E8;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x73B0;&#x573A;&#x5B8C;&#x6210;&#xFF0C;&#x4ECE;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7A7A;&#x767D;&#x865A;&#x62DF;&#x673A;&#x5F00;&#x59CB;&#x3002;</p>
<h1 id="chuang-jian-digital-ocean-fu-wu-qi"><a href="#&#x521B;&#x5EFA;-Digital-Ocean-&#x670D;&#x52A1;&#x5668;" class="headerlink" title="&#x521B;&#x5EFA; Digital Ocean &#x670D;&#x52A1;&#x5668;"></a>&#x521B;&#x5EFA; Digital Ocean &#x670D;&#x52A1;&#x5668; <a href="#chuang-jian-digital-ocean-fu-wu-qi" class="header-anchor">#</a></h1><p>&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; $10/month &#x7684;&#x4F26;&#x6566;&#x4F4D;&#x7F6E;&#x7684; Droplet&#xFF0C;Ubuntu 15.10</p>
<p>&#x521D;&#x59CB;&#x5316;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x5B89;&#x88C5;&#x5FC5;&#x8981;&#x8F6F;&#x4EF6;</span></div><div class="line">apt-get install vim tree curl golang-go</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x7F16;&#x8F91; <code>.bashrc</code> &#x914D;&#x7F6E; GOPATH &#x548C; PATH&#x3002;</p>
<p>&#x7136;&#x540E;&#x5B89;&#x88C5; <code>experimental</code> &#x5206;&#x652F;&#x7684; docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -ssL https://experimental.docker.com | sh</div></pre></td></tr></table></figure>
<p>&#x5B89;&#x88C5;&#x540E;&#xFF0C;&#x542F;&#x7528; Content Trust</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> DOCKER_CONTENT_TRUST=1</div></pre></td></tr></table></figure>
<h1 id="apparmor"><a href="#AppArmor" class="headerlink" title="AppArmor"></a>AppArmor <a href="#apparmor" class="header-anchor">#</a></h1><p>&#x8FD0;&#x884C;&#x4E00;&#x4E2A; Alpine &#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x4E14;&#x6267;&#x884C; <code>top</code> &#x547D;&#x4EE4;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run alpine top</div></pre></td></tr></table></figure>
<p>&#x6267;&#x884C;&#x540E;&#x4E00;&#x5207;&#x6B63;&#x5E38;&#xFF0C;&#x4F46;&#x662F; <code>Ctrl-C</code> &#x65E0;&#x6CD5;&#x9000;&#x51FA;&#x3002;&#x4E8E;&#x662F;&#x51B3;&#x5B9A;&#x91CD;&#x65B0;&#x767B;&#x5F55;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E76;&#x4E14; kill &#x6389;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker <span class="built_in">kill</span> &#x5BB9;&#x5668;&#x540D;</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x662F;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x62A5;&#x9519;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error response from daemon: Cannot <span class="built_in">kill</span> thirsty_pasteur: permission denied</div></pre></td></tr></table></figure>
<p> &#x4E8E;&#x662F;&#x5F00;&#x59CB;&#x68C0;&#x67E5;&#x65E5;&#x5FD7;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail /var/<span class="built_in">log</span>/syslog</div></pre></td></tr></table></figure>
<p>&#x5728;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;&#x770B;&#x5230;&#x4E86;&#x4E00;&#x884C;&#x8BF4; <code>apparmor=&quot;DENIED&quot;</code>&#xFF0C;&#x770B;&#x6765;&#x662F; AppArmor &#x963B;&#x6B62;&#x4E86;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x7EE7;&#x7EED; debug&#xFF0C;&#x4F7F;&#x7528; <code>aa-status</code> &#x53EF;&#x4EE5;&#x67E5;&#x770B; AppArmor &#x7684;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x4E2D;&#x4F1A;&#x5305;&#x542B;&#x6240;&#x4F7F;&#x7528;&#x7684; <code>profile</code>&#x3002;&#x5728;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6709;6&#x4E2A;profiles &#x662F; enforce&#x7684;&#xFF0C;14&#x4E2A;&#x662F;complain&#x7684;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x4E2A; enforce &#x7684;&#x662F; <code>docker-default</code>&#x3002;</p>
<p>&#x6253;&#x5F00; AppArmor &#x7684; docker &#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>/etc/apparmor.d/docker</code> &#x4EE5;&#x53CA; <code>/etc/apparmor.d/docker-engine</code>&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x662F; kill &#x64CD;&#x4F5C;&#x88AB;&#x7981;&#x6B62;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x80FD;&#x662F;&#x5173;&#x4E8E; signal &#x7684;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep signal docker-engine</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x5230; <code>docker-engine</code> &#x4E2D;&#x6709; <code>signal</code> &#x63A7;&#x5236;&#xFF0C;&#x800C; <code>docker</code> &#x4E2D;&#x6CA1;&#x6709;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x5C06; <code>docker-engine</code> &#x4E2D;&#x7684; <code>signal (receive) ...</code> &#x90A3;&#x4E00;&#x884C;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x5230;  <code>docker</code> &#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#xFF0C;&#x91CD;&#x8F7D;&#x8FD9;&#x4E2A; AppArmor&#xFF0C;<code>systemctl reload apparmor</code>&#x3002;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5; <code>docker kill</code> &#x6389;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#x3002;</p>
<h1 id="bane"><a href="#Bane" class="headerlink" title="Bane"></a>Bane <a href="#bane" class="header-anchor">#</a></h1><p>&#x7531;&#x4E8E; AppArmor &#x8BED;&#x6CD5;&#x770B;&#x7740;&#x5F88;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x4E8E;&#x662F;&#x6253;&#x7B97;&#x88C5;&#x4E2A; Go &#x63D2;&#x4EF6;&#x6765;&#x5E2E;&#x52A9;&#x505A;&#x5B89;&#x5168;&#x7BA1;&#x7406;&#x63A7;&#x5236;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">go get github.com/jfrazelle/bane</div><div class="line">go install github.com/jfrazelle/bane</div></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528; bane &#x5B9A;&#x4E49;&#x7684;&#x793A;&#x4F8B;&#x5B89;&#x5168;&#x89C4;&#x5219; <code>sample.toml</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ bane sample.toml</div><div class="line">Profile installed successfully you can now run the profile with</div><div class="line">`docker run --security-opt=<span class="string">&quot;apparmor:docker-nginx&quot;</span>`</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5C31;&#x751F;&#x6210;&#x4E86;&#x4E00;&#x4E2A; AppArmor profile&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x63D0;&#x793A;&#x4F7F;&#x7528; <code>--security-opt</code> &#x9009;&#x9879;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A; profile &#x4E86;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --security-opt=<span class="string">&quot;apparmor:docker-nginx&quot;</span> -it nginx bash</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;<code>ping</code> &#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x7F51;&#x7EDC;, &#x800C; <code>top</code>, <code>dash</code>, <code>sh</code> &#x4E5F;&#x90FD;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x751F;&#x6210;&#x7684; AppArmor profile &#x63A7;&#x5236;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<h1 id="capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities <a href="#capabilities" class="header-anchor">#</a></h1><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--cap-drop</code> &#x53C2;&#x6570;&#x6765;&#x53D6;&#x6D88;&#x6389;&#x67D0;&#x4E9B;&#x80FD;&#x529B;&#x3002;&#x6BD4;&#x5982;&#xFF0C;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it alpine sh</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5; ping, traceroute&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D6;&#x6D88;&#x5176;&#x7F51;&#x7EDC;&#x80FD;&#x529B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --cap-drop=NET_RAW -it alpine sh</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837; traceroute &#x5C31;&#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;&#x9664;&#x4E86; <code>NET_RAW</code> &#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x6709;&#x610F;&#x601D;&#x7684;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#xFF0C;&#x6BD4;&#x5982; <code>CHOWN</code>&#xFF0C;&#x8FD9;&#x6837;&#x7528;&#x6237;&#x5C31;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>chown</code> &#x547D;&#x4EE4;&#x4E86;&#x3002;</p>
<h1 id="zhi-du-wen-jian-xi-tong"><a href="#&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>&#x53EA;&#x8BFB;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; <a href="#zhi-du-wen-jian-xi-tong" class="header-anchor">#</a></h1><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53D8;&#x6210;&#x53EA;&#x8BFB;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --read-only -it alpine sh</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#xFF0C;<code>touch</code> &#x4E4B;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x90FD;&#x65E0;&#x6CD5;&#x7528;&#x4E86;&#x3002;</p>
<h1 id="user-namespace"><a href="#user-namespace" class="headerlink" title="user namespace"></a>user namespace <a href="#user-namespace" class="header-anchor">#</a></h1><p>&#x5F53;&#x524D;(<em>1.10&#x4E4B;&#x524D;</em>)&#xFF0C;docker &#x5185;&#x7684; <code>uid 0</code> &#x5C31;&#x662F;docker &#x5916;&#x7684; <code>uid 0</code>&#xFF0C;&#x76EE;&#x524D;&#x6CA1;&#x6709;&#x4F7F;&#x7528; user namespace&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x5185;&#x90E8;&#x548C;&#x5916;&#x90E8;&#x7684;UID&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x5185;&#x7684;<code>root</code>&#xFF0C;&#x5C31;&#x662F;&#x5BB9;&#x5668;&#x5916;&#x7684;root&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker run -it \</div><div class="line">    -v /bin:/data/bin \</div><div class="line">    alpine sh</div></pre></td></tr></table></figure>
<p>&#x90A3;&#x4E48;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x5185;&#x4FEE;&#x6539;&#x4E86; <code>/data/bin</code> &#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5BBF;&#x4E3B;&#x7684;&#x5BF9;&#x5E94;&#x4F4D;&#x7F6E;&#x7684;&#x6587;&#x4EF6;&#x5C31;&#x88AB;&#x6539;&#x52A8;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x5371;&#x9669;&#x7684;&#x3002;</p>
<p>&#x542F;&#x7528; user namespace &#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x901A;&#x8FC7;&#x4FEE;&#x6539; docker daemon &#x542F;&#x52A8;&#x53C2;&#x6570;&#x65E2;&#x53EF;&#x4EE5;&#xFF1A;</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">ExecStart</span>=/usr/bin/docker daemon --userns-remap=default -s overlay -H fd://</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x7684; <code>overlay</code> &#x662F;&#x4F7F;&#x7528; overlay fs&#xFF0C;&#x6CA1;&#x4EC0;&#x4E48;&#x7279;&#x522B;&#x7684;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8BA8;&#x538C; aufs &#x800C;&#x5DF2;&#x2026;&#x2026;</p>
<p>&#x7136;&#x540E;&#x91CD;&#x542F; docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl daemon-reload</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure>
<p>&#x9A8C;&#x8BC1;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x4F7F;&#x7528; docker info &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x65B0;&#x542F;&#x7528;&#x7684; overlayfs</span></div><div class="line">docker info</div><div class="line"></div><div class="line"><span class="comment"># &#x4F7F;&#x7528; ps &#x67E5;&#x770B; docker &#x914D;&#x7F6E;</span></div><div class="line">ps -ef | grep docker</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x914D;&#x7F6E;&#x751F;&#x6548;&#x4E86;&#x3002;</p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53BB; <code>/var/lib/docker/</code> &#x770B;&#x5230;&#x51E0;&#x4E2A;&#x65B0;&#x7684;&#x76EE;&#x5F55;&#xFF1A;<code>0.0</code> &#x548C; <code>10000.10000</code>&#x3002;</p>
<p>&#x524D;&#x9762;&#x7684; <code>0.0</code> &#x5C31;&#x662F;&#x4E4B;&#x524D; UID &#x4E3A; 0 &#x7684;namespace&#xFF0C;&#x800C; <code>10000.10000</code> &#x5219;&#x662F;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86; <code>userns-remap=default</code> &#x540E;&#x5EFA;&#x7ACB;&#x7684;&#x65B0;&#x7684; UID=10000&#x7684;namespace&#x3002;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x67E5;&#x770B;&#x5177;&#x4F53;&#x7684;uid,gid&#x7684;mapping&#x7684;&#x8303;&#x56F4;&#x53EF;&#x4EE5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cat /etc/subgid</div><div class="line">cat /etc/subuid</div></pre></td></tr></table></figure>
<p>&#x6240;&#x6709;&#x8BE5;namespace&#x7684;&#x955C;&#x50CF;&#x90FD;&#x4F1A;&#x88AB;&#x653E;&#x7F6E;&#x5728;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>repositories-overlay</code> &#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x76EE;&#x524D;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x6267;&#x884C;&#x4E86; <code>docker pull alpine</code> &#x540E;&#xFF0C;&#x5176;&#x955C;&#x50CF;&#x4FE1;&#x606F;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x6267;&#x884C;&#x521A;&#x624D; <code>-v /bin:/data/bin</code> &#x7684; <code>docker run</code> &#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#xFF0C;&#x867D;&#x7136; <code>id</code> &#x663E;&#x793A;&#x8FD8;&#x662F; <code>uid=0, root</code>&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5230; <code>/data/bin</code> &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x4FEE;&#x6539;&#x5176;&#x6587;&#x4EF6;&#x4E86;&#x3002;</p>
<h1 id="content-trust"><a href="#Content-Trust" class="headerlink" title="Content Trust"></a>Content Trust <a href="#content-trust" class="header-anchor">#</a></h1><p>&#x6700;&#x5F00;&#x59CB;&#x5B9A;&#x4E49;&#x4E86; <code>DOCKER_CONTENT_TRUST=1</code> &#xFF0C;&#x56E0;&#x6B64;&#x6240;&#x6709;&#x7684; <code>docker pull</code> &#x90FD;&#x4F1A;&#x9A8C;&#x8BC1;&#x6BCF;&#x4E00;&#x4E2A;&#x90E8;&#x5206;&#x662F;&#x5426;&#x53EF;&#x4FE1;&#x4EFB;&#x3002;&#x4E00;&#x5207;&#x90FD;&#x662F;&#x900F;&#x660E;&#x7684;&#xFF0C;&#x7528;&#x6237;&#x662F;&#x611F;&#x77E5;&#x4E0D;&#x5230;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#x3002;</p>
<p>&#x6E05;&#x7A7A;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x548C;&#x955C;&#x50CF;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker rm <span class="_">-f</span> $(docker ps <span class="_">-a</span> -q)</div><div class="line">docker rmi <span class="_">-f</span> $(docker images -q)</div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x7981;&#x7528; Content Trust&#xFF0C;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull --disable-content-trust alpine</div></pre></td></tr></table></figure>
<p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x52A0;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#xFF08;&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;&#x4E86;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF09;&#xFF0C;&#x5C31;&#x4F1A;&#x542F;&#x7528; Content Trust&#xFF0C;Docker &#x5C31;&#x4F1A;&#x4F7F;&#x7528; Notary &#x6765;&#x8FDB;&#x884C;&#x955C;&#x50CF;&#x7684;&#x9A8C;&#x8BC1;&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x540E;&#x9762;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x901A;&#x8FC7; Notary &#x5BF9;&#x955C;&#x50CF;&#x540D;&#x5B57; <code>alpine:latest</code> &#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x89E3;&#x6790;&#x4E3A;&#x4E00;&#x4E2A;&#x7ECF;&#x8FC7;&#x7B7E;&#x540D;&#x8BA4;&#x8BC1;&#x7684;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x800C; docker &#x5B9E;&#x9645;&#x4E0A; pull &#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x90A3;&#x4E2A;&#x955C;&#x50CF;&#x540D;&#x5B57;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker pull alpine@sha256:xxxxxxxx</div><div class="line">`</div></pre></td></tr></table></figure>
<p>docker &#x4F1A;&#x5BF9; pull &#x4E0B;&#x6765;&#x7684;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F; Markle Hash Tree &#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;&#x6570;&#x503C;&#x53EF;&#x4EE5;&#x6821;&#x9A8C;&#x955C;&#x50CF;&#x5168;&#x90E8;&#x5C42;&#x7684;&#x5B8C;&#x6574;&#x6027;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x5E26; Content Trust &#x540E;&#xFF0C;<code>repositories-overlay</code> &#x6587;&#x4EF6;&#x4E2D;&#x9664;&#x4E86;&#x9ED8;&#x8BA4;&#x7684; latest &#x5BF9;&#x5E94;&#x503C;&#x5916;&#xFF0C;&#x591A;&#x4E86;&#x4E00;&#x4E2A; sha256&#x7684;&#x6821;&#x9A8C;&#x6570;&#x503C;&#x3002;</p>
<p>&#x5728;&#x5B89;&#x88C5;&#x4E86; notary &#x7684;&#x673A;&#x5668;&#x4E0A;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">notary list docker.io/library/alpine</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>tree ~/.docker/trust/</code> &#x6765;&#x663E;&#x793A; Content Trust &#x7684;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x548C;&#x6570;&#x636E;&#x3002;</p>
<h1 id="dui-kang-fork-bomb"><a href="#&#x5BF9;&#x6297;-fork-bomb" class="headerlink" title="&#x5BF9;&#x6297; fork bomb"></a>&#x5BF9;&#x6297; fork bomb <a href="#dui-kang-fork-bomb" class="header-anchor">#</a></h1><p>&#x5E38;&#x89C1;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#xFF0C;&#x4FEE;&#x6539; <code>docker.service</code> &#x6587;&#x4EF6;&#xFF0C;&#x5C06; <code>LimitNPROC</code> &#x6539;&#x4E3A; <code>100</code>&#x3002;&#x53EF;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x662F;&#x6BCF;&#x7528;&#x6237;&#x7EA7;&#x522B;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4EE5;&#x4E3A;&#x6240;&#x6709;&#x7684;docker&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x53D7;&#x9650;&#xFF0C;&#x90A3;&#x4E48;&#x8981;&#x662F;&#x8DD1;1000&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x80FD;&#x8DD1;100&#x4E2A;&#x8FDB;&#x7A0B;&#x2026;&#x2026;</p>
<p>&#x6F14;&#x793A;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4E00;&#x4E2A; bash &#x547D;&#x4EE4;&#x8FDB;&#x884C; <code>fork bomb</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">:(){ :|: &amp; };:</div></pre></td></tr></table></figure>
<p>&#x8C8C;&#x4F3C;&#x5F88;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x9650;&#x5236;&#x4E86;&#x7528;&#x6237;&#x7684; <code>nproc</code> &#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x62C5;&#x5FC3; <code>fork bomb</code> &#x4E86;&#x3002;&#x53EF;&#x5B9E;&#x9645;&#x4E0A;&#x7531;&#x4E8E;&#x8FD9;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x8303;&#x56F4;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x800C;&#x662F;&#x6574;&#x4E2A;&#x7528;&#x6237;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x4E5F;&#x4F1A;&#x56E0;&#x4E3A;&#x4E4B;&#x524D;&#x7684;&#x8FD9;&#x4E2A; fork bomb &#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x5EFA;&#x7ACB;&#x65B0;&#x7684;&#x8FDB;&#x57CE;&#x4E86;&#x3002;</p>
<p>&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker run -itd -u daemon --ulimit nproc=3 ubuntu bash</div><div class="line">docker run -itd -u daemon --ulimit nproc=3 ubuntu bash</div><div class="line">docker run -itd -u daemon --ulimit nproc=3 ubuntu bash</div><div class="line">docker run -itd -u daemon --ulimit nproc=3 ubuntu bash</div></pre></td></tr></table></figure>
<p>&#x7B2C;&#x56DB;&#x4E2A;&#x5BB9;&#x5668;&#x4F1A;&#x51FA;&#x9519;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x7528;&#x6237;&#x8303;&#x56F4;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x524D;&#x4E09;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;bash&#x5DF2;&#x7ECF;&#x5360;&#x4E86;3&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x7B2C;4&#x4E2A;&#x5C31;&#x8D85;&#x51FA;&#x4E86;&#x9650;&#x5236;&#x4E86;&#x3002;</p>
<h2 id="kernel-memory"><a href="#Kernel-Memory" class="headerlink" title="Kernel Memory"></a>Kernel Memory <a href="#kernel-memory" class="header-anchor">#</a></h2><p>&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x9650;&#x5236; <code>kernel-memory</code>&#xFF0C;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it --kernel-memory=1m ubuntu bash</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x8FD9;&#x6B21;&#x8FD0;&#x884C; fork bomb &#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x4E3B;&#x673A;&#x8FD9;&#x5730;&#x6302;&#x4E86;&#x3002;&#x73B0;&#x5728;&#x6709;&#x4E24;&#x4E2A; PR &#x5173;&#x4E8E;&#x63A7;&#x5236;&#x5BB9;&#x5668;&#x5185; fork &#x6570;&#x91CF;&#x7684;&#xFF0C;&#x5C06;&#x4F1A;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<h1 id="wen-jian-xi-tong"><a href="#&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF; <a href="#wen-jian-xi-tong" class="header-anchor">#</a></h1><p>&#x6F14;&#x793A;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A; PHP &#x7F51;&#x7AD9;&#xFF0C;&#x5B58;&#x5728;&#x6267;&#x884C;&#x8FDC;&#x7A0B;&#x547D;&#x4EE4;&#x7684;&#x6F0F;&#x6D1E;&#x3002;&#x4E8E;&#x662F;&#x901A;&#x8FC7;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x6F0F;&#x6D1E;&#x5F00;&#x59CB;&#x7BE1;&#x6539;&#x4E3B;&#x673A;&#x6587;&#x4EF6;&#x3002;&#x5229;&#x7528;&#x4E86; <code>curl</code> &#x4E0B;&#x8F7D;&#x4E86;&#x4E2A;web shell&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7; <code>echo</code> &#x7BE1;&#x6539;&#x4E86; <code>index.html</code>&#x3002;</p>
<p>&#x597D;&#x4E86;&#xFF0C;&#x8FD0;&#x7EF4;&#x51CC;&#x6668;&#x63A5;&#x5230;&#x4E86;&#x7535;&#x8BDD;&#xFF0C;&#x8BF4;&#x7F51;&#x7AD9;&#x88AB;&#x9ED1;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x590D;&#x3002;&#x4E8E;&#x662F;&#x5148;&#x901A;&#x8FC7; <code>docker logs</code> &#x6CE8;&#x610F;&#x5230;&#x4E86;&#x4E00;&#x4E9B;&#x5947;&#x602A;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4EFB;&#x52A1;&#x7D27;&#x6025;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x7ED9;&#x4F60;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#x7684;&#x65F6;&#x95F4;&#x53BB;&#x5206;&#x6790;&#x5165;&#x4FB5;&#x8FC7;&#x7A0B;&#x3002;&#x4E8E;&#x662F;&#x9700;&#x8981;&#x5148;&#x4FEE;&#x590D;&#x3002;&#x5148;&#x770B;&#x770B;&#x5BB9;&#x5668;&#x81EA;&#x8FD0;&#x884C;&#x540E;&#x90FD;&#x4FEE;&#x6539;&#x4E86;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x597D;&#x4E86;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker diff &#x5BB9;&#x5668;&#x540D;</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5F88;&#x6E05;&#x6670;&#x7684;&#x663E;&#x793A;&#x4E86;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x88AB;&#x6DFB;&#x52A0;&#x4E86;&#x3002;&#x4E00;&#x773C;&#x5C31;&#x770B;&#x5230;&#x4E86; <code>shell.php</code> &#x6587;&#x4EF6;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x4FDD;&#x5B58;&#x73B0;&#x573A;&#xFF0C;&#x4F7F;&#x7528; <code>docker commit &#x5BB9;&#x5668;&#x540D;</code>&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x53D8;&#x5316;&#x7ED3;&#x679C;&#x7684;&#x955C;&#x50CF; ID&#x3002;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x53EF;&#x4EE5;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x9700;&#x8981;&#x6062;&#x590D;&#x7F51;&#x7AD9;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x7F51;&#x7AD9;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run <span class="_">-d</span> -p 80:80 --link db:db website</div></pre></td></tr></table></figure>
<p>&#x597D;&#x4E86;&#xFF0C;&#x7F51;&#x7AD9;&#x5C31;&#x6B64;&#x6062;&#x590D;&#x4E86;&#x3002;&#x4F7F;&#x7528; Docker &#x53EF;&#x4EE5;&#x8BA9;&#x6062;&#x590D;&#x5DE5;&#x4F5C;&#x5F02;&#x5E38;&#x8F7B;&#x677E;&#x3002;</p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x54CD;&#x5E94;&#x8FD9;&#x6B21;&#x5165;&#x4FB5;&#xFF0C;&#x770B;&#x770B;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#x3002;&#x521A;&#x624D;&#x6211;&#x4EEC;commit&#x4E86;&#x955C;&#x50CF;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5219;&#x9700;&#x8981;&#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x770B;&#x770B;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it xxxxxx bash</div></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528;&#x521A;&#x624D; <code>commit</code> &#x7684;&#x6821;&#x9A8C;&#x503C;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#xFF0C;&#x8FDB;&#x6765;&#x770B;&#x770B;&#x5230;&#x5E95;&#x53D1;&#x751F;&#x4E86;&#x4E9B;&#x4EC0;&#x4E48;&#x4E8B;&#x60C5;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x8981;&#x662F; docker &#x53EF;&#x4EE5;&#x5728;&#x6700;&#x5F00;&#x59CB;&#x963B;&#x6B62;&#x8FD9;&#x6B21;&#x5165;&#x4FB5;&#xFF0C;&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x3002;&#x53EF;&#x4EE5;&#x4E48;&#xFF1F;&#x53EF;&#x4EE5;&#x3002;&#x6BD4;&#x5982;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x7684; <code>--read-only</code> &#x53C2;&#x6570;&#xFF0C;&#x4F7F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53EA;&#x8BFB;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker run -p 80:80 \</div><div class="line">    --link db:db \</div><div class="line">    -v /tmp/apacherun:/var/run/apache2/ \</div><div class="line">    -v /tmp/apachelock:/var/lock/apache2/ \</div><div class="line">    --sig-proxy=<span class="literal">false</span> \</div><div class="line">    --read-only \</div><div class="line">    website</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="http://blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>Docker 问答录</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-14-faq.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-14-faq.html</id>
    <published>2016-07-13T19:43:23.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><h1 id="qian-yan"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00; <a href="#qian-yan" class="header-anchor">#</a></h1><blockquote>
<p>&#x8FD9;&#x662F;&#x6211;&#x5728;QQ&#x7FA4; <code>325486037</code> &#x91CC;&#xFF0C;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#x53CA;&#x5176;&#x89E3;&#x7B54;&#xFF0C;&#x5927;&#x591A;&#x662F;&#x521D;&#x5B66; Docker &#x65F6;&#x5E38;&#x89C1;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5176;&#x4E2D;&#x7684;&#x56DE;&#x7B54;&#xFF0C;&#x662F;&#x57FA;&#x4E8E;&#x6211;&#x5B66;&#x4E60;&#x548C;&#x4F7F;&#x7528;Docker&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x8BA4;&#x77E5;&#xFF0C;&#x591A;&#x6570;&#x662F;&#x9075;&#x5FAA; Docker &#x5B98;&#x65B9;&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x539F;&#x5219;&#x800C;&#x8FDB;&#x884C;&#x7684;&#x89E3;&#x7B54;&#x3002;&#x7531;&#x4E8E;&#x4E2A;&#x4EBA;&#x80FD;&#x529B;&#x6240;&#x9650;&#xFF0C;&#x56DE;&#x7B54;&#x53EF;&#x80FD;&#x4F1A;&#x7247;&#x9762;&#x6216;&#x9519;&#x8BEF;&#x3002;&#x5982;&#x53D1;&#x73B0;&#x9519;&#x8BEF;&#x540E;&#xFF0C;&#x6B22;&#x8FCE;&#x544A;&#x8BC9;&#x6211;&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x4FEE;&#x6B63;&#x8BE5;&#x6587;&#x6863;&#x907F;&#x514D;&#x8BEF;&#x5BFC;&#x4ED6;&#x4EBA;&#xFF0C;&#x6587;&#x6863;&#x4F1A;&#x4E0D;&#x5B9A;&#x671F;&#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;</p>
</blockquote>
<!-- toc -->
<ul>
<li><a href="#docker-pei-zhi-wen-ti">Docker &#x914D;&#x7F6E;&#x95EE;&#x9898;</a><ul>
<li><a href="#zen-me-xiu-gai-liao-etc-default-docker-hou-bu-qi-zuo-yong">&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86; <code>/etc/default/docker</code> &#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#docker-shi-yong-wen-ti">Docker &#x4F7F;&#x7528;&#x95EE;&#x9898;</a><ul>
<li><a href="#su-zhu-ru-guo-he-rong-qi-xi-tong-bu-tong-de-hua-na-bu-shi-he-xu-ni-ji-yi-yang-yi-ceng-ceng-de-diao-yong-na-me-docker-he-xu-ni-ji-huan-you-shi-me-chai-bie">&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;Docker&#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F;</a></li>
<li><a href="#ru-he-zai-docker-rong-qi-nei-shi-yong-docker-ming-ling-bi-ru-zai-jenkins-rong-qi-zhong">&#x5982;&#x4F55;&#x5728; Docker  &#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;(&#x6BD4;&#x5982;&#x5728; Jenkins &#x5BB9;&#x5668;&#x4E2D;)&#xFF1F;</a><ul>
<li><a href="#tian-jia-docker-ming-ling-xing">&#x6DFB;&#x52A0; Docker &#x547D;&#x4EE4;&#x884C;</a></li>
</ul>
</li>
<li><a href="#zen-me-gu-ding-rong-qi-ip-di-zhi-mei-ci-chong-qi-rong-qi-du-yao-bian-hua-ip-di-zhi-zen-me-ban">&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316;IP&#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li>
<li><a href="#ru-he-xiu-gai-rong-qi-de-etc-hosts-wen-jian">&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#xFF1F;</a></li>
<li><a href="#docker-rong-qi-ru-he-sui-xi-tong-yi-tong-qi-dong">Docker &#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F;</a></li>
<li><a href="#zen-me-ying-she-su-zhu-duan-kou-dockerfile-zhong-de-expose-he-docker-run-p-you-sha-qu-bie">&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;<code>Dockerfile</code> &#x4E2D;&#x7684;<code>EXPOSE</code>&#x548C; <code>docker run -p</code> &#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F;</a></li>
<li><a href="#wo-yao-ying-she-hao-ji-bai-ge-duan-kou-nan-dao-yao-yi-ge-ge-p-me">&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;<code>-p</code>&#x4E48;&#xFF1F;</a></li>
<li><a href="#vethxxxx-zhe-chong-xu-ni-wang-qia-he-rong-qi-de-dui-ying-guan-xi-cong-na-li-kan"><code>vethxxxx</code> &#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F;</a></li>
<li><a href="#rong-qi-ci-pan-ke-yi-xian-zhi-pei-e-me">&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F;</a></li>
<li><a href="#docker-stats-xian-shi-de-zhi-you-rong-qi-id-zen-me-cai-neng-xian-shi-rong-qi-ming-zi"><code>docker stats</code> &#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F;</a></li>
<li><a href="#rong-qi-nei-de-shu-ju-gai-bao-cun-zai-jing-xiang-li-huan-shi-wu-li-ji-li">&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F;</a></li>
<li><a href="#kan-dao-zong-shuo-yao-bao-chi-rong-qi-wu-zhuang-tai-na-shi-me-shi-wu-zhuang-tai">&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F;</a><ul>
<li><a href="#rong-qi-cun-chu-ceng-de-wu-zhuang-tai">&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001;</a></li>
<li><a href="#fu-wu-ceng-mian-de-wu-zhuang-tai">&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;</a></li>
</ul>
</li>
<li><a href="#dockerfile-zhong-de-volume-he-docker-run-v-yi-ji-compose-zhong-de-volumes-du-you-shi-me-qu-bie"><code>Dockerfile</code> &#x4E2D;&#x7684;<code>VOLUME</code>&#x548C;<code>docker run -v</code>&#xFF0C;&#x4EE5;&#x53CA;<code>Compose</code>&#x4E2D;&#x7684;<code>volumes</code>&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</a></li>
<li><a href="#duo-ge-docker-rong-qi-zhi-jian-gong-xiang-shu-ju-zen-me-ban-nfs">&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS&#xFF1F;</a></li>
<li><a href="#ji-ran-yi-ge-rong-qi-yi-ge-ying-yong-na-me-wo-xiang-zai-gai-rong-qi-zhong-yong-ji-hua-ren-wu-cron-zen-me-ban">&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1; cron &#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li>
<li><a href="#docker-pull-xia-lai-de-jing-xiang-wen-jian-du-zai-na"><code>docker pull</code> &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F;</a></li>
<li><a href="#docker-images-ming-ling-xian-shi-de-jing-xiang-zhan-liao-hao-da-de-kong-jian-zen-me-ban-mei-ci-du-shi-xia-zai-zhe-me-da-de-jing-xiang"><code>docker images</code> &#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F;</a></li>
<li><a href="#docker-images-a-hou-xian-shi-liao-hao-duo-none-de-jing-xiang-du-shi-shi-me-ya-neng-shan-me"><code>docker images -a</code> &#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A; <code>&lt;none&gt;</code> &#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F;</a><ul>
<li><a href="#yi-lai-jing-xiang">&#x4F9D;&#x8D56;&#x955C;&#x50CF;</a></li>
<li><a href="#diu-liao-biao-qian-de-jing-xiang">&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;</a></li>
</ul>
</li>
<li><a href="#wei-shi-me-docker-hub-de-jing-xiang-chi-cun-he-docker-images-bu-yi-zhi">&#x4E3A;&#x4EC0;&#x4E48; Docker Hub &#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C; <code>docker images</code> &#x4E0D;&#x4E00;&#x81F4;&#xFF1F;</a></li>
<li><a href="#docker-ri-zhi-du-zai-na-li-zen-me-shou-ji">Docker &#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F;</a></li>
<li><a href="#wo-yong-de-shi-a-li-yun-ubuntu-14-04-zhu-ji-nei-he-huan-shi-3-13-zen-me-ban">&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91; <code>Ubuntu 14.04</code> &#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;<code>3.13</code>&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li>
<li><a href="#ru-he-dong-tai-xiu-gai-nei-cun-xian-zhi">&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F;</a></li>
<li><a href="#jing-chang-zai-ge-chong-docker-ming-ling-li-kan-dao-label-label-shi-shi-me-gan-shi-me-yong-de">&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD; <code>Docker</code> &#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230; <code>--label</code>&#xFF0C;<code>label</code> &#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F;</a><ul>
<li><a href="#tian-jia-label-yi-ji-guo-lu">&#x6DFB;&#x52A0;<code>label</code>&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4;</a></li>
<li><a href="#ji-qun-diao-du-yue-shu">&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dockerfile-xiang-guan-wen-ti"><code>Dockerfile</code> &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#docker-commit-zen-me-yong-a"><code>docker commit</code> &#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F;</a></li>
<li><a href="#dockerfile-zen-me-xie"><code>Dockerfile</code> &#x600E;&#x4E48;&#x5199;&#xFF1F;</a></li>
<li><a href="#dockerfile-jiu-shi-shell-jiao-ben-ba-na-wo-dong-yi-xing-xing-ba-xu-yao-zhuang-de-dong-xi-du-xie-jin-qu-bu-jiu-xing-liao"><code>Dockerfile</code> &#x5C31;&#x662F; shell &#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002;</a></li>
<li><a href="#context-dao-di-shi-yi-ge-shi-me-gai-nian"><code>context</code> &#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F;</a></li>
<li><a href="#entrypoint-he-cmd-dao-di-you-shi-me-bu-tong"><code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;</a></li>
<li><a href="#na-dao-yi-ge-jing-xiang-ru-he-huo-de-jing-xiang-de-dockerfile">&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code> &#xFF1F;</a></li>
<li><a href="#zai-ni-de-lnmp-de-li-zi-zhong-php-de-dockerfile-li-mian-de-gou-jian-yi-lai-he-yun-xing-yi-lai-du-shi-shi-me-yi-si">&#x5728;&#x4F60;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP &#x7684; <code>Dockerfile</code> &#x91CC;&#x9762;&#x7684; &#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D; &#x548C; &#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D; &#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;</a></li>
<li><a href="#ying-yong-dai-ma-shi-ying-gai-gua-zai-su-zhu-mu-lu-huan-shi-fang-ru-jing-xiang-nei">&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#docker-compose-xiang-guan-wen-ti">Docker Compose &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#ni-na-ge-lnmp-li-zi-zhong-de-docker-compose-yml-zhong-you-hao-duo-networks-du-shi-shi-me-yi-si-a">&#x4F60;&#x90A3;&#x4E2A;<code>LNMP</code>&#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>docker-compose.yml</code> &#x4E2D;&#x6709;&#x597D;&#x591A; <code>networks</code>&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F;</a></li>
<li><a href="#shi-yong-compose-de-shi-hou-peng-dao-an-http-request-took-too-long-to-complete-cuo-wu-zen-me-ban">&#x4F7F;&#x7528; Compose &#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230; &#x201C;An HTTP request took too long to complete&#x2026;.&#x201D; &#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#docker-swarm-xiang-guan-wen-ti">Docker Swarm &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#docker-duo-su-zhu-wang-luo-zen-me-pei-zhi">Docker &#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F;</a></li>
<li><a href="#swarm-huan-jing-zhong-zen-me-zhi-ding-mou-ge-rong-qi-zai-zhi-ding-de-su-zhu-shang-yun-xing-ni">Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F;</a></li>
<li><a href="#wei-shi-me-swarm-ji-qun-de-overlay-network-kua-su-zhu-wu-fa-hu-fang">&#x4E3A;&#x4EC0;&#x4E48; Swarm &#x96C6;&#x7FA4;&#x7684; overlay network &#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F;</a></li>
<li><a href="#docker-er-dai-swarm-ji-swarm-mode-docker-service-create-bu-ke-yi-shi-yong-v-na-zen-me-shi-yong-juan-volume">Docker &#x4E8C;&#x4EE3;Swarm (&#x65E2; Swarm Mode)&#xFF0C;<code>docker service create</code> &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-v</code> &#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;(Volume)&#xFF1F;</a></li>
<li><a href="#dui-yu-liang-jie-dian-ji-qun-lai-shuo-replicas-2-he-mode-global-shi-bu-shi-yi-ge-yi-si">&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;<code>--replicas=2</code> &#x548C; <code>--mode=global</code> &#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#docker-machine-xiang-guan-wen-ti">Docker Machine &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#ru-he-zai-docker-toolbox-zhong-chuang-jian-de-default-xu-ni-ji-zhong-tian-jia-docker-opts-zhi-lei-de-pei-zhi">&#x5982;&#x4F55;&#x5728; Docker Toolbox &#x4E2D;&#x521B;&#x5EFA;&#x7684; <code>default</code> &#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;<code>DOCKER_OPTS</code>&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F;</a></li>
<li><a href="#docker-machine-chuang-jian-de-zhu-ji-zen-me-zhi-jie-ssh-jin-qu-gai-liao-root-mi-ma-hao-xiang-ye-mei-yong"><code>docker-machine</code> &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5; <code>ssh</code> &#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86; <code>root</code> &#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F;</a></li>
<li><a href="#docker-machine-shi-yong-d-generic-shi-zhi-ding-yong-hu-generic-ssh-user-hou-fa-xian-yao-sudo-mi-ma-jie-guo-bao-cuo-tui-chu-zhe-shi-zen-me-hui-shi"><code>docker-machine</code> &#x4F7F;&#x7528; <code>-d generic</code> &#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237; <code>--generic-ssh-user</code> &#x540E;&#x53D1;&#x73B0;&#x8981; <code>sudo</code> &#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#docker-registry-xiang-guan-wen-ti">Docker Registry &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#wo-docker-push-de-shi-hou-zen-me-bao-authentication-required-cuo-wu">&#x6211; <code>docker push</code> &#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5; <code>authentication required</code> &#x9519;&#x8BEF;&#xFF1F;</a></li>
<li><a href="#wo-zhu-ce-yong-hu-aaa-liao-zen-me-huan-shi-wu-fa-docker-push-bbb-xxx-a">&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237; <code>aaa</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5; <code>docker push bbb/xxx</code> &#x554A;&#xFF1F;</a></li>
<li><a href="#bu-guan-yong-a-wo-zhe-hui-docker-push-aaa-xxx-liao-zen-me-gao-su-wo-bu-cun-zai-a">&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE; <code>docker push aaa/xxx</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;</a></li>
<li><a href="#docker-push-dao-si-you-registry-zong-shi-bu-cheng-gong-zen-me-ban"><code>docker push</code> &#x5230;&#x79C1;&#x6709; registry &#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li>
<li><a href="#wo-docker-push-liao-hen-duo-jing-xiang-dao-si-you-de-registry-shang-zen-me-cai-neng-cha-kan-shang-mian-du-you-sha-huo-zhe-sou-suo">&#x6211; <code>docker push</code> &#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684; registry &#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F;</a></li>
<li><a href="#ru-he-shan-chu-si-you-registry-zhong-de-jing-xiang">&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709; registry &#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F;</a></li>
<li><a href="#shi-yong-guo-nei-jing-xiang-huan-shi-man-gong-si-nei-hao-duo-docker-zhu-ji-du-xu-yao-qu-chong-fu-xia-zai-jing-xiang-zha-ban">&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A; docker &#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F;</a></li>
<li><a href="#zi-ji-jia-de-registry-zen-me-ren-he-yong-hu-du-ke-yi-qu-dao-jing-xiang-zhe-bu-an-quan-a">&#x81EA;&#x5DF1;&#x67B6;&#x7684; <code>registry</code> &#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#centos-rhel-hong-mao-xi-tong-te-you-wen-ti">CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898;</a><ul>
<li><a href="#zai-centos-6-shang-an-zhuang-hou-zen-me-zui-gao-zhi-you-docker-1-7-zhe-ge-ban-ben">&#x5728; CentOS 6 &#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709; Docker 1.7 &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F;</a></li>
<li><a href="#gua-zai-su-zhu-mu-lu-jie-guo-permission-denied-mei-quan-xian">&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C; Permission denied&#xFF0C;&#x6CA1;&#x6743;&#x9650;</a></li>
<li><a href="#docker-de-var-lib-docker-devicemapper-zhan-yong-kong-jian-bu-duan-zeng-chang-zen-me-po">Docker&#x7684; <code>/var/lib/docker/devicemapper</code> &#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;, &#x600E;&#x4E48;&#x7834;&#xFF1F;</a></li>
<li><a href="#centos-7-de-nei-he-tai-lao-liao-3-10-shi-bu-shi-hen-duo-docker-gong-neng-bu-zhi-chi">CentOS 7 &#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86; 3.10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A;Docker&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;</a></li>
<li><a href="#centos-7-rhel-7-sheng-ji-1-12-hou-wu-fa-qi-dong-bao-cuo-unit-docker-socket-failed-to-load-no-such-file-or-directory">CentOS 7/RHEL 7 &#x5347;&#x7EA7; 1.12 &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x62A5;&#x9519; <code>Unit docker.socket failed to load: No such file or directory.</code></a></li>
</ul>
</li>
<li><a href="#mac-windows-xiang-guan-wen-ti">Mac / Windows &#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#wei-shi-me-zai-mac-xia-gua-zai-su-zhu-mu-lu-usr-local-nginx-bu-cheng-gong">&#x4E3A;&#x4EC0;&#x4E48;&#x5728;<code>Mac</code>&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;<code>/usr/local/nginx</code>&#x4E0D;&#x6210;&#x529F;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#wei-da-de-qiang-xiang-guan-wen-ti">&#x4F1F;&#x5927;&#x7684;&#x5899;&#x76F8;&#x5173;&#x95EE;&#x9898;</a><ul>
<li><a href="#docker-toolbox-compose-machine-zong-shi-xia-zai-bu-lai-zen-me-ban">Docker Toolbox/Compose/Machine &#x603B;&#x662F;&#x4E0B;&#x8F7D;&#x4E0D;&#x6765;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a></li>
<li><a href="#shi-zhi-jie-yong-yum-apt-get-an-zhuang-docker-ma">&#x662F;&#x76F4;&#x63A5;&#x7528; yum / apt-get &#x5B89;&#x88C5; Docker &#x5417;&#xFF1F;</a></li>
<li><a href="#docker-pull-hao-man-a-zen-me-ban">docker pull &#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F;</a><ul>
<li><a href="#ubuntu-14-04-pei-zhi">Ubuntu 14.04 &#x914D;&#x7F6E;</a></li>
<li><a href="#ubuntu-16-04-pei-zhi">Ubuntu 16.04 &#x914D;&#x7F6E;</a></li>
</ul>
</li>
<li><a href="#zhuang-wan-docker-toolbox-hou-fa-xian-xia-zai-jing-xiang-su-du-tai-man-shi-bu-shi-xu-yao-xiu-gai-shi-me-pei-zhi-wen-jian">&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#qi-ta-wen-ti">&#x5176;&#x5B83;&#x95EE;&#x9898;</a><ul>
<li><a href="#docker-zi-liao-hao-shao-a-wang-shang-de-ming-ling-zen-me-bu-neng-yong">Docker &#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F;</a></li>
<li><a href="#docker-1-8-yi-hou-ban-ben-du-you-shi-me-gai-jin-me">Docker 1.8&#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F;</a></li>
<li><a href="#kubernetes-zhe-ci-zha-nian-a">Kubernetes &#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;</a></li>
<li><a href="#wen-yi-ju-kubernetes-wei-sha-jiao-k8s">&#x95EE;&#x4E00;&#x53E5; Kubernetes &#x4E3A;&#x5565;&#x53EB; &#x201C;k8s&#x201D;&#xFF1F;</a></li>
<li><a href="#wo-de-pei-zhi-wen-jian-chuan-qun-wen-jian-liao-bang-mang-kan-kan-zhe-shi-wo-de-pei-zhi-sheng-lue-ji-qian-zi">&#x6211;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F20;&#x7FA4;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x5E2E;&#x5FD9;&#x770B;&#x770B;&#xFF1F;&#x8FD9;&#x662F;&#x6211;&#x7684;&#x914D;&#x7F6E;&#x2026;(&#x7701;&#x7565;&#x51E0;&#x5343;&#x5B57;)</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="docker-pei-zhi-wen-ti"><a href="#Docker-&#x914D;&#x7F6E;&#x95EE;&#x9898;" class="headerlink" title="Docker &#x914D;&#x7F6E;&#x95EE;&#x9898;"></a>Docker &#x914D;&#x7F6E;&#x95EE;&#x9898; <a href="#docker-pei-zhi-wen-ti" class="header-anchor">#</a></h1><h2 id="zen-me-xiu-gai-liao-etc-default-docker-hou-bu-qi-zuo-yong"><a href="#&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86;-etc-default-docker-&#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86; /etc/default/docker &#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F;"></a>&#x600E;&#x4E48;&#x4FEE;&#x6539;&#x4E86; <code>/etc/default/docker</code> &#x540E;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF1F; <a href="#zen-me-xiu-gai-liao-etc-default-docker-hou-bu-qi-zuo-yong" class="header-anchor">#</a></h2><p>&#x6539;&#x52A8;&#x771F;&#x7684;&#x751F;&#x6548;&#x4E86;&#x4E48;&#xFF1F;&#x5728;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E0B; <code>ps -ef | grep docker</code> &#x770B;&#x770B;&#xFF0C;&#x81EA;&#x5DF1;&#x505A;&#x7684;&#x90A3;&#x4E9B;&#x914D;&#x7F6E;&#x6709;&#x4E48;&#xFF1F;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x5C31;&#x8BF4;&#x660E;&#x6CA1;&#x6709;&#x751F;&#x6548;&#x3002;&#x90A3;&#x4E48;&#x5C31;&#x8981;&#x68C0;&#x67E5;&#x539F;&#x56E0;&#x4E86;&#xFF0C;&#x9664;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x5FD8;&#x8BB0;&#x4E86;&#x91CD;&#x542F; Docker &#x670D;&#x52A1;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x53EF;&#x80FD;&#x4FEE;&#x6539;&#x9519;&#x4E86;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6700;&#x8FD1;&#x4E24;&#x5E74;&#x5904;&#x4E8E; Upstart/SysinitV &#x5230; systemd &#x7684;&#x8FC7;&#x6E21;&#x671F;&#xFF0C;&#x6240;&#x4EE5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x7684;&#x65B9;&#x5F0F;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x8981;&#x770B;&#x81EA;&#x5DF1;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x4EE5;&#x53CA;&#x4EC0;&#x4E48;&#x7248;&#x672C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E; Upstart &#x7684;&#x7CFB;&#x7EDF;&#xFF08;Ubuntu 14.10&#x6216;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF0C;Debian 7&#x6216;&#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#xFF09;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x80FD;&#x5728;</p>
<ul>
<li>Ubuntu/Debian: <code>/etc/default/docker</code></li>
</ul>
<p>&#x800C;&#x5BF9;&#x4E8E; systemd &#x7684;&#x7CFB;&#x7EDF;(Ubuntu 15.04&#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;Debian 8&#x53CA;&#x4EE5;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;CentOS/RHEL 7)&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5219;&#x4E00;&#x822C;&#x5728; <code>/etc/systemd/system/</code> &#x4E0B;&#x7684; <code>docker.service</code> &#x4E2D;&#x3002;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x7528;&#x547D;&#x4EE4; <code>systemctl enable docker</code> &#x542F;&#x7528;&#x4E86; Docker &#x670D;&#x52A1;&#xFF0C;&#x90A3;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5E94;&#x8BE5;&#x5728;&#xFF1A;</p>
<ul>
<li><code>/etc/systemd/system/multi-user.target.wants/docker.service</code></li>
</ul>
<p>&#x5177;&#x4F53;&#x4F4D;&#x7F6E;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x4E14;&#x8981;&#x6CE8;&#x610F; Upstart &#x7684;&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x548C; systemd &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x4E5F;&#x4E0D;&#x540C;&#xFF0C;&#x4E0D;&#x8981;&#x6DF7;&#x6DC6;&#x4E71;&#x914D;&#xFF1A;</p>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<br><a href="https://docs.docker.com/engine/admin/configuring/#ubuntu" target="_blank" rel="external">https://docs.docker.com/engine/admin/configuring/#ubuntu</a><br><a href="https://docs.docker.com/engine/admin/systemd/" target="_blank" rel="external">https://docs.docker.com/engine/admin/systemd/</a></p>
<h1 id="docker-shi-yong-wen-ti"><a href="#Docker-&#x4F7F;&#x7528;&#x95EE;&#x9898;" class="headerlink" title="Docker &#x4F7F;&#x7528;&#x95EE;&#x9898;"></a>Docker &#x4F7F;&#x7528;&#x95EE;&#x9898; <a href="#docker-shi-yong-wen-ti" class="header-anchor">#</a></h1><h2 id="su-zhu-ru-guo-he-rong-qi-xi-tong-bu-tong-de-hua-na-bu-shi-he-xu-ni-ji-yi-yang-yi-ceng-ceng-de-diao-yong-na-me-docker-he-xu-ni-ji-huan-you-shi-me-chai-bie"><a href="#&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;Docker&#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F;" class="headerlink" title="&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;Docker&#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F;"></a>&#x5BBF;&#x4E3B;&#x5982;&#x679C;&#x548C;&#x5BB9;&#x5668;&#x7CFB;&#x7EDF;&#x4E0D;&#x540C;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E0D;&#x662F;&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x6837;&#xFF0C;&#x4E00;&#x5C42;&#x5C42;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;Docker&#x548C;&#x865A;&#x62DF;&#x673A;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5DEE;&#x522B;&#xFF1F; <a href="#su-zhu-ru-guo-he-rong-qi-xi-tong-bu-tong-de-hua-na-bu-shi-he-xu-ni-ji-yi-yang-yi-ceng-ceng-de-diao-yong-na-me-docker-he-xu-ni-ji-huan-you-shi-me-chai-bie" class="header-anchor">#</a></h2><p>&#x8981;&#x628A; Windows &#x548C; Linux &#x5206;&#x6E05;&#x695A;&#xFF0C;&#x66F4;&#x8981;&#x628A;&#x5185;&#x6838;(<code>kernel</code>)&#x548C;&#x7528;&#x6237;&#x7A7A;&#x95F4;(<code>userland</code>)&#x5206;&#x6E05;&#x695A;&#x3002;</p>
<p>&#x5BB9;&#x5668;&#x5185;&#x7684;&#x8FDB;&#x7A0B;&#x662F;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4E8E;<code>&#x5BBF;&#x4E3B;&#x5185;&#x6838;</code>&#x7684;&#xFF0C;&#x8FD9;&#x70B9;&#x548C;&#x5BBF;&#x4E3B;&#x8FDB;&#x7A0B;&#x4E00;&#x81F4;&#xFF0C;&#x53EA;&#x662F;&#x5BB9;&#x5668;&#x7684;<code>userland</code>&#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x7684;<code>userland</code>&#x7531;&#x5BB9;&#x5668;&#x955C;&#x50CF;&#x63D0;&#x4F9B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x955C;&#x50CF;&#x63D0;&#x4F9B;&#x4E86; <code>rootfs</code>&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x5BBF;&#x4E3B;&#x662F; <code>Ubuntu</code>&#xFF0C;&#x5BB9;&#x5668;&#x662F; <code>CentOS</code>&#x3002;<code>CentOS</code> &#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x4F1A;&#x76F4;&#x63A5;&#x5411; <code>Ubuntu</code> &#x5BBF;&#x4E3B;&#x5185;&#x6838;&#x53D1;&#x9001; <code>syscall</code>&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x76F4;&#x63A5;&#x6216;&#x95F4;&#x63A5;&#x7684;&#x4F7F;&#x7528;&#x4EFB;&#x4F55; <code>Ubuntu</code> &#x7684;<code>userland</code>&#x7684;&#x5E93;&#x3002;</p>
<p>&#x8FD9;&#x70B9;&#x548C;&#x865A;&#x62DF;&#x673A;&#x6709;&#x672C;&#x8D28;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x662F;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x73B0;&#x6709;&#x7CFB;&#x7EDF;&#x4E0A;&#x865A;&#x62DF;&#x4E00;&#x5957;&#x7269;&#x7406;&#x8BBE;&#x5907;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x865A;&#x62DF;&#x73AF;&#x5883;&#x5185;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x73AF;&#x5883;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#xFF0C;&#x5728;&#x5185;&#x6838;&#x4E4B;&#x4E0A;&#x518D;&#x8DD1;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E76;&#x5728;&#x91CC;&#x9762;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x8FD8;&#x4EE5;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53BB;&#x8003;&#x8651;&#xFF0C;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;<code>CentOS</code> &#x7684;&#x8FDB;&#x7A0B;&#x53D1;&#x9001; <code>syscall</code> &#x5185;&#x6838;&#x8C03;&#x7528;&#xFF0C;&#x8BE5;&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x865A;&#x62DF;&#x673A;&#x5185;&#x7684; <code>CentOS</code> &#x7684;&#x5185;&#x6838;&#x63A5;&#x5230;&#xFF0C;&#x7136;&#x540E; <code>CentOS</code> &#x5185;&#x6838;&#x8BBF;&#x95EE;&#x865A;&#x62DF;&#x786C;&#x4EF6;&#x65F6;&#xFF0C;&#x7531;&#x865A;&#x62DF;&#x673A;&#x7684;&#x670D;&#x52A1;&#x8F6F;&#x4EF6;&#x622A;&#x83B7;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x5BBF;&#x4E3B;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>Ubuntu</code> &#x7684;&#x5185;&#x6838;&#x53CA;<code>userland</code>&#x7684;&#x5E93;&#x53BB;&#x6267;&#x884C;&#x3002;</p>
<p>&#x800C;&#x4E14;&#xFF0C;Linux &#x548C; Windows &#x5728;&#x8FD9;&#x70B9;&#x4E0A;&#x975E;&#x5E38;&#x4E0D;&#x540C;&#x3002;Linux &#x7684;&#x8FDB;&#x7A0B;&#x662F;&#x76F4;&#x63A5;&#x53D1; <code>syscall</code> &#x7684;&#xFF0C;&#x800C; Windows &#x5219;&#x628A; <code>syscall</code> &#x9690;&#x85CF;&#x4E8E;&#x4E00;&#x5C42;&#x5C42;&#x7684; <code>DLL</code> &#x670D;&#x52A1;&#x4E4B;&#x540E;&#xFF0C;&#x56E0;&#x6B64; Windows &#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5982;&#x679C;&#x8981;&#x6267;&#x884C;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x9700;&#x8981; Windows &#x5185;&#x6838;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x6765;&#x652F;&#x6491;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C; Windows &#x8981;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x5C06;&#x4E0D;&#x4F1A;&#x50CF; Linux &#x8FD9;&#x6837;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x800C;&#x662F;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x3002;&#x770B;&#x4E00;&#x4E0B;&#x5FAE;&#x8F6F;&#x79FB;&#x690D;&#x7684; Docker &#x5C31;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x4E86;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x628A; Docker &#x548C;&#x865A;&#x62DF;&#x673A;&#x5F04;&#x6DF7;&#xFF0C;Docker&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x800C;&#x5DF2;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x5229;&#x7528;&#x955C;&#x50CF;&#x63D0;&#x4F9B;&#x7684;<code>rootfs</code>&#x63D0;&#x4F9B;&#x4E86;&#x8C03;&#x7528;&#x6240;&#x9700;&#x7684;<code>userland</code>&#x5E93;&#x652F;&#x6301;&#xFF0C;&#x4F7F;&#x5F97;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x5728;&#x53D7;&#x63A7;&#x73AF;&#x5883;&#x4E0B;&#x8FD0;&#x884C;&#x800C;&#x5DF2;&#xFF0C;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x865A;&#x62DF;&#x51FA;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x51FA;&#x6765;&#x3002;</p>
<p>&#x53C2;&#x8003;&#xFF1A;</p>
<p><a href="https://www.docker.com/what-docker" target="_blank" rel="external">https://www.docker.com/what-docker</a></p>
<p><a href="/post/docker-2016-08-12-video-windows-server-and-docker.html">&#x89C6;&#x9891;&#x7B14;&#x8BB0;&#xFF1A; Windows Server &#x548C; Docker - John Starks</a></p>
<h2 id="ru-he-zai-docker-rong-qi-nei-shi-yong-docker-ming-ling-bi-ru-zai-jenkins-rong-qi-zhong"><a href="#&#x5982;&#x4F55;&#x5728;-Docker-&#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528;-docker-&#x547D;&#x4EE4;-&#x6BD4;&#x5982;&#x5728;-Jenkins-&#x5BB9;&#x5668;&#x4E2D;-&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5728; Docker  &#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; docker &#x547D;&#x4EE4;(&#x6BD4;&#x5982;&#x5728; Jenkins &#x5BB9;&#x5668;&#x4E2D;)&#xFF1F;"></a>&#x5982;&#x4F55;&#x5728; Docker  &#x5BB9;&#x5668;&#x5185;&#x4F7F;&#x7528; <code>docker</code> &#x547D;&#x4EE4;(&#x6BD4;&#x5982;&#x5728; Jenkins &#x5BB9;&#x5668;&#x4E2D;)&#xFF1F; <a href="#ru-he-zai-docker-rong-qi-nei-shi-yong-docker-ming-ling-bi-ru-zai-jenkins-rong-qi-zhong" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x4E0D;&#x8981;&#x5728; Docker &#x5BB9;&#x5668;&#x4E2D;&#x5B89;&#x88C5;&#x3001;&#x8FD0;&#x884C; Docker &#x5F15;&#x64CE;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684; Docker In Docker (DIND)&#xFF0C;&#x53C2;&#x8003;&#x6587;&#x7AE0;&#xFF1A;</p>
<p><a href="https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/" target="_blank" rel="external">https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/</a></p>
<p>&#x4E3A;&#x4E86;&#x8BA9;&#x5BB9;&#x5668;&#x5185;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>Docker Remote API</code> &#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5BBF;&#x4E3B;&#x7684; Docker Engine&#x3002;&#x53EF;&#x4EE5;&#x662F;&#x539F;&#x751F;&#x7684; Docker CLI &#xFF08;<code>docker</code> &#x547D;&#x4EE4;&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;<a href="https://docs.docker.com/engine/reference/api/remote_api_client_libraries/" target="_blank" rel="external">&#x5176;&#x5B83;&#x8BED;&#x8A00;&#x7684;&#x5E93;</a>&#x3002;</p>
<h3 id="tian-jia-docker-ming-ling-xing"><a href="#&#x6DFB;&#x52A0;-Docker-&#x547D;&#x4EE4;&#x884C;" class="headerlink" title="&#x6DFB;&#x52A0; Docker &#x547D;&#x4EE4;&#x884C;"></a>&#x6DFB;&#x52A0; Docker &#x547D;&#x4EE4;&#x884C; <a href="#tian-jia-docker-ming-ling-xing" class="header-anchor">#</a></h3><p>&#x4E0B;&#x9762;&#x4EE5;&#x5B9A;&#x5236; <code>jenkins</code> &#x955C;&#x50CF;&#x4E3A;&#x4F8B;&#xFF0C;&#x4F7F;&#x7528; <code>Dockerfile</code> &#x6DFB;&#x52A0; <code>docker</code> &#x547D;&#x4EE4;&#x884C;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8C03;&#x6574;&#x6743;&#x9650;&#x3002;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> jenkins:alpine</div><div class="line"></div><div class="line"><span class="comment"># &#x4E0B;&#x8F7D;&#x5B89;&#x88C5;Docker CLI</span></div><div class="line"><span class="keyword">USER</span> root</div><div class="line"><span class="keyword">RUN</span><span class="bash"> curl -O https://get.docker.com/builds/Linux/x86_64/docker-latest.tgz \</span></div><div class="line">    &amp;&amp; tar zxvf docker-latest.tgz \</div><div class="line">    &amp;&amp; cp docker/docker /usr/<span class="built_in">local</span>/bin/ \</div><div class="line">    &amp;&amp; rm -rf docker docker-latest.tgz</div><div class="line"></div><div class="line"><span class="comment"># &#x5C06; `jenkins` &#x7528;&#x6237;&#x7684;&#x7EC4; ID &#x6539;&#x4E3A;&#x5BBF;&#x4E3B; `docker` &#x7EC4;&#x7684;&#x7EC4;ID&#xFF0C;&#x4ECE;&#x800C;&#x5177;&#x6709;&#x6267;&#x884C; `docker` &#x547D;&#x4EE4;&#x7684;&#x6743;&#x9650;&#x3002;</span></div><div class="line">ARG DOCKER_GID=<span class="number">999</span></div><div class="line"><span class="keyword">USER</span> jenkins:${DOCKER_GID}</div></pre></td></tr></table></figure>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x4E86;&#x9759;&#x6001;&#x7F16;&#x8BD1;&#x7684; <code>docker</code> &#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x63D0;&#x53D6;&#x547D;&#x4EE4;&#x884C;&#x5B89;&#x88C5;&#x5230;&#x7CFB;&#x7EDF;&#x76EE;&#x5F55;&#x4E0B;&#x3002;&#x7136;&#x540E;&#x8C03;&#x6574;&#x4E86; <code>jenkins</code> &#x7528;&#x6237;&#x7684;&#x7EC4; ID&#xFF0C;&#x8C03;&#x6574;&#x4E3A;&#x5BBF;&#x4E3B; <code>docker</code> &#x7EC4;ID&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5176;&#x5177;&#x6709;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;&#x7684;&#x6743;&#x9650;&#x3002;</p>
<p>&#x7EC4; ID &#x4F7F;&#x7528;&#x4E86; <code>DOCKER_GID</code> &#x53C2;&#x6570;&#x6765;&#x5B9A;&#x4E49;&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x8FDB;&#x4E00;&#x6B65;&#x5B9A;&#x5236;&#x3002;&#x6784;&#x5EFA;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--build-arg</code> &#x6765;&#x6539;&#x53D8; <code>DOCKER_GID</code> &#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x8FD0;&#x884C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--user jenkins:1234</code> &#x6765;&#x6539;&#x53D8;&#x8FD0;&#x884C;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x3002;</p>
<p><em>&#x8FD9;&#x91CC;&#x7684;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>jenkins:alpine</code>&#xFF0C;&#x6362;&#x4E3A;&#x975E; <code>alpine</code> &#x7684;&#x955C;&#x50CF; <code>jenkins:latest</code> &#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</em></p>
<p>&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF08;&#x5047;&#x8BBE;&#x955C;&#x50CF;&#x540D;&#x4E3A; <code>jenkins-docker</code>&#xFF09;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker build -t jenkins-docker .</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x6784;&#x5EFA;&#x65F6;&#x8C03;&#x6574; <code>docker</code> &#x7EC4; ID&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--build-arg</code> &#x6765;&#x8986;&#x76D6;&#x53C2;&#x6570;&#x9ED8;&#x8BA4;&#x503C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker build -t jenkins-docker --build-arg DOCKER_GID=1234 .</div></pre></td></tr></table></figure>
<p>&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C06;&#x5BBF;&#x4E3B;&#x7684; <code>/var/run/docker.sock</code> &#x6587;&#x4EF6;&#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x540C;&#x6837;&#x4F4D;&#x7F6E;&#xFF0C;&#x4ECE;&#x800C;&#x8BA9;&#x5BB9;&#x5668;&#x5185;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" target="_blank" rel="external">unix socket</a> &#x8C03;&#x7528;&#x5BBF;&#x4E3B;&#x7684; Docker &#x5F15;&#x64CE;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x542F;&#x52A8; <code>jenkins</code>&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker run --name jenkins \</div><div class="line">    <span class="_">-d</span> \</div><div class="line">    -p 8080:8080 \</div><div class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</div><div class="line">    jenkins-docker</div></pre></td></tr></table></figure>
<p>&#x5728; <code>jenkins</code> &#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x5C31;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x6267;&#x884C; <code>docker</code> &#x547D;&#x4EE4;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker exec</code> &#x6765;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="built_in">exec</span> -it jenkins sh</div><div class="line">/ $ id</div><div class="line">uid=1000(jenkins) gid=999(ping) groups=999(ping)</div><div class="line">/ $ docker version</div><div class="line">Client:</div><div class="line"> Version:      1.12.3</div><div class="line"> API version:  1.24</div><div class="line"> Go version:   go1.6.3</div><div class="line"> Git commit:   6b644ec</div><div class="line"> Built:        Wed Oct 26 23:26:11 2016</div><div class="line"> OS/Arch:      linux/amd64</div><div class="line"></div><div class="line">Server:</div><div class="line"> Version:      1.13.0-rc2</div><div class="line"> API version:  1.25</div><div class="line"> Go version:   go1.7.3</div><div class="line"> Git commit:   1f9b3ef</div><div class="line"> Built:        Wed Nov 23 06:32:39 2016</div><div class="line"> OS/Arch:      linux/amd64</div><div class="line">/ $</div></pre></td></tr></table></figure>
<h2 id="zen-me-gu-ding-rong-qi-ip-di-zhi-mei-ci-chong-qi-rong-qi-du-yao-bian-hua-ip-di-zhi-zen-me-ban"><a href="#&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668;-IP-&#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316;IP&#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316;IP&#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x600E;&#x4E48;&#x56FA;&#x5B9A;&#x5BB9;&#x5668; IP &#x5730;&#x5740;&#xFF1F;&#x6BCF;&#x6B21;&#x91CD;&#x542F;&#x5BB9;&#x5668;&#x90FD;&#x8981;&#x53D8;&#x5316;IP&#x5730;&#x5740;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#zen-me-gu-ding-rong-qi-ip-di-zhi-mei-ci-chong-qi-rong-qi-du-yao-bian-hua-ip-di-zhi-zen-me-ban" class="header-anchor">#</a></h2><p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5BB9;&#x5668;IP&#x5730;&#x5740;&#x7684;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#xFF0C;&#x800C;&#x662F;&#x5BB9;&#x5668;&#x3002;&#x5176;&#x5730;&#x5740;&#x662F;&#x4F9B;&#x5BB9;&#x5668;&#x95F4;&#x901A;&#x8BAF;&#x7684;&#xFF0C;&#x5BB9;&#x5668;&#x95F4;&#x5219;&#x4E0D;&#x7528;ip&#x76F4;&#x63A5;&#x901A;&#x8BAF;&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x4E3B;&#x673A;&#x540D;&#x3001;&#x670D;&#x52A1;&#x540D;&#x3001;&#x7F51;&#x7EDC;&#x522B;&#x540D;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;<code>docker run</code> &#x5728;&#x4E0D;&#x6307;&#x5B9A;<code>--net</code>&#x65F6;&#x6240;&#x5728;&#x7684;&#x7F51;&#x7EDC;&#x662F;<code>default bridge</code>&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>--link</code> &#x53C2;&#x6570;&#x624D;&#x53EF;&#x4EE5;&#x8BA9;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x627E;&#x5230;&#x5BF9;&#x65B9;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x6709;&#x5C40;&#x9650;&#x6027;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>/etc/hosts</code> &#x9759;&#x6001;&#x6587;&#x4EF6;&#x6765;&#x8FDB;&#x884C;&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x6302;&#x4E86;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x542F;&#x52A8;IP&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x3002;&#x867D;&#x7136;&#x8BF4;&#x8FD9;&#x79CD;&#x6539;&#x53D8;Docker&#x662F;&#x53EF;&#x80FD;&#x66F4;&#x65B0;<code>/etc/hosts</code>&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6709;&#x8BF8;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x56E0;&#x4E3A;&#x7ADE;&#x4E89;&#x5192;&#x9669;&#x5BFC;&#x81F4; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x635F;&#x6BC1;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8FD8;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x5728;&#x53D6;&#x5F97; <code>/etc/hosts</code> &#x7684;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x540E;&#xFF0C;&#x4E0D;&#x518D;&#x53BB;&#x76D1;&#x89C6;&#x8BE5;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x53D8;&#x52A8;&#x3002;&#x79CD;&#x79CD;&#x539F;&#x56E0;&#x90FD;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x65E7;&#x7684;&#x4E3B;&#x673A;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x540D;&#x8BBF;&#x95EE;&#x5230;&#x65B0;&#x7684;&#x4E3B;&#x673A;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/" target="_blank" rel="external">https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/</a></p>
<p>&#x5982;&#x679C;&#x53EF;&#x80FD;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x8FC7;&#x65F6;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x7528;&#x4E0B;&#x9762;&#x8BF4;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x800C;&#x5BF9;&#x4E8E;&#x65B0;&#x7684;&#x73AF;&#x5883;&#xFF08;Docker 1.10&#x4EE5;&#x4E0A;&#xFF09;&#xFF0C;&#x5E94;&#x8BE5;&#x7ED9;&#x5BB9;&#x5668;&#x5EFA;&#x7ACB;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5BF9;&#x65B9;&#x5BB9;&#x5668;&#x7684;&#x5BB9;&#x5668;&#x540D;&#x3001;&#x670D;&#x52A1;&#x540D;&#x3001;&#x7F51;&#x7EDC;&#x522B;&#x540D;&#x6765;&#x627E;&#x5230;&#x5BF9;&#x65B9;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5E2E;&#x52A9;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x7684;&#x662F;Docker &#x5185;&#x7F6E;&#x7684;DNS&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x65E0;&#x8BBA;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x91CD;&#x542F;&#x3001;&#x66F4;&#x6362;IP&#xFF0C;&#x5185;&#x7F6E;&#x7684;DNS&#x90FD;&#x80FD;&#x6B63;&#x786E;&#x6307;&#x5B9A;&#x5230;&#x5BF9;&#x65B9;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks" target="_blank" rel="external">https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks</a></p>
<p>&#x5EFA;&#x8BAE;&#x53C2;&#x8003;&#x4E00;&#x4E0B;&#x6211;&#x5199;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#xFF1A;<br><a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="external">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p>
<h2 id="ru-he-xiu-gai-rong-qi-de-etc-hosts-wen-jian"><a href="#&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684;-etc-hosts-&#x6587;&#x4EF6;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684; /etc/hosts &#x6587;&#x4EF6;&#xFF1F;"></a>&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5BB9;&#x5668;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#xFF1F; <a href="#ru-he-xiu-gai-rong-qi-de-etc-hosts-wen-jian" class="header-anchor">#</a></h2><p>&#x5BB9;&#x5668;&#x5185;&#x7684; <code>/etc/hosts</code> &#x6587;&#x4EF6;&#x4E0D;&#x5E94;&#x8BE5;&#x88AB;&#x968F;&#x610F;&#x4FEE;&#x6539;&#xFF0C;&#x5982;&#x679C;&#x5FC5;&#x987B;&#x6307;&#x5B9A; host&#xFF0C;&#x5E94;&#x8BE5;&#x5728; <code>docker run</code> &#x65F6;&#x4F7F;&#x7528; <code>--add-host</code> &#x53C2;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x5728; <code>docker-compose.yml</code> &#x4E2D;&#x6DFB;&#x52A0; <code>extra_hosts</code> &#x9879;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x5728;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x5E94;&#x8BE5;&#x518D;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x771F;&#x7684;&#x9700;&#x8981;&#x4FEE;&#x6539; <code>/etc/hosts</code> &#x4E48;&#xFF1F;&#x5982;&#x679C;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5BB9;&#x5668;&#x95F4;&#x4E92;&#x76F8;&#x8BBF;&#x95EE;&#xFF0C;&#x5E94;&#x8BE5;&#x5EFA;&#x7ACB;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; Docker &#x5185;&#x7F6E;&#x7684; DNS &#x670D;&#x52A1;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E00;&#x4E0B;&#x6211;&#x5199;&#x7684;&#x8FD9;&#x4E2A; LNMP &#x591A;&#x5BB9;&#x5668;&#x4E92;&#x8FDE;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="external">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p>
<h2 id="docker-rong-qi-ru-he-sui-xi-tong-yi-tong-qi-dong"><a href="#Docker-&#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F;" class="headerlink" title="Docker &#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F;"></a>Docker &#x5BB9;&#x5668;&#x5982;&#x4F55;&#x968F;&#x7CFB;&#x7EDF;&#x4E00;&#x540C;&#x542F;&#x52A8;&#xFF1F; <a href="#docker-rong-qi-ru-he-sui-xi-tong-yi-tong-qi-dong" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">--restart=always</div></pre></td></tr></table></figure>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/run/#restart-policies-restart" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/run/#restart-policies-restart</a></p>
<h2 id="zen-me-ying-she-su-zhu-duan-kou-dockerfile-zhong-de-expose-he-docker-run-p-you-sha-qu-bie"><a href="#&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;Dockerfile-&#x4E2D;&#x7684;EXPOSE&#x548C;-docker-run-p-&#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F;" class="headerlink" title="&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;Dockerfile &#x4E2D;&#x7684;EXPOSE&#x548C; docker run -p &#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F;"></a>&#x600E;&#x4E48;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF1F;<code>Dockerfile</code> &#x4E2D;&#x7684;<code>EXPOSE</code>&#x548C; <code>docker run -p</code> &#x6709;&#x5565;&#x533A;&#x522B;&#xFF1F; <a href="#zen-me-ying-she-su-zhu-duan-kou-dockerfile-zhong-de-expose-he-docker-run-p-you-sha-qu-bie" class="header-anchor">#</a></h2><p>Docker&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>EXPOSE</code> &#xFF0C;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>PUBLISH</code> &#x3002;</p>
<ul>
<li><code>EXPOSE</code> &#x662F;&#x955C;&#x50CF;/&#x5BB9;&#x5668;&#x58F0;&#x660E;&#x8981;&#x66B4;&#x9732;&#x8BE5;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x4F9B;&#x5176;&#x4ED6;&#x5BB9;&#x5668;&#x4F7F;&#x7528;&#x3002;&#x8FD9;&#x79CD;&#x58F0;&#x660E;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x8BBE;&#x5B9A; <code>--icc=false</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x6807;&#x6CE8;&#xFF0C;&#x5E76;&#x4E0D;&#x5F3A;&#x5236;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6CA1;&#x6709;&#x58F0;&#x660E; <code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x5F3A;&#x5236; <code>--icc=false</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x6709; <code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x624D;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;</li>
<li><code>PUBLISH</code> &#x5219;&#x662F;&#x901A;&#x8FC7;&#x6620;&#x5C04;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#xFF0C;&#x5C06;&#x5BB9;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x516C;&#x5F00;&#x4E8E;&#x5916;&#x754C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5BBF;&#x4E3B;&#x4E4B;&#x5916;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;&#x5BBF;&#x4E3B;IP&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x8BE5;&#x6620;&#x5C04;&#x7AEF;&#x53E3;&#xFF0C;&#x8BBF;&#x95EE;&#x5230;&#x5BB9;&#x5668;&#x5BF9;&#x5E94;&#x7AEF;&#x53E3;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x670D;&#x52A1;&#x3002;</li>
</ul>
<p><code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x4E0D; <code>PUBLISH</code>&#xFF0C;&#x8FD9;&#x6837;&#x53EA;&#x6709;&#x5BB9;&#x5668;&#x95F4;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;&#x5BBF;&#x4E3B;&#x4E4B;&#x5916;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x3002;&#x800C; <code>PUBLISH</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x4E8B;&#x5148; <code>EXPOSE</code>&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4; <code>PUBLISH</code> &#x7B49;&#x4E8E;&#x540C;&#x65F6;&#x9690;&#x5F0F;&#x5B9A;&#x4E49;&#x4E86;&#x8BE5;&#x7AEF;&#x53E3;&#x8981; <code>EXPOSE</code>&#x3002;</p>
<p><code>docker run</code> &#x547D;&#x4EE4;&#x4E2D;&#x7684; <code>-p</code>, <code>-P</code> &#x53C2;&#x6570;&#xFF0C;&#x4EE5;&#x53CA; <code>docker-compose.yml</code> &#x4E2D;&#x7684;  <code>ports</code> &#x90E8;&#x5206;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5747;&#x662F;&#x6307; <code>PUBLISH</code>&#x3002;</p>
<p>&#x5C0F;&#x5199; <code>-p</code> &#x662F;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A; <code>[&#x5BBF;&#x4E3B;IP:]&lt;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&gt;:&lt;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;&gt;</code>&#xFF0C;&#x5176;&#x4E2D;&#x5BBF;&#x4E3B;&#x7AEF;&#x53E3;&#x548C;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;&#xFF0C;&#x65E2;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<code>1000-2000:1000-2000</code>&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x5BBF;&#x4E3B;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5BBF;&#x4E3B;IP&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5BBF;&#x4E3B;IP&#x65F6;&#xFF0C;&#x5B88;&#x62A4;&#x6240;&#x6709;&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x5927;&#x5199; <code>-P</code> &#x5219;&#x662F;&#x81EA;&#x52A8;&#x6620;&#x5C04;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x5B9A;&#x4E49; <code>EXPOSE</code> &#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x968F;&#x673A;&#x6620;&#x5C04;&#x5230;&#x5BBF;&#x4E3B;&#x7684;&#x67D0;&#x4E2A;&#x7AEF;&#x53E3;&#x3002;</p>
<h2 id="wo-yao-ying-she-hao-ji-bai-ge-duan-kou-nan-dao-yao-yi-ge-ge-p-me"><a href="#&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;-p&#x4E48;&#xFF1F;" class="headerlink" title="&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;-p&#x4E48;&#xFF1F;"></a>&#x6211;&#x8981;&#x6620;&#x5C04;&#x597D;&#x51E0;&#x767E;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x96BE;&#x9053;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;<code>-p</code>&#x4E48;&#xFF1F; <a href="#wo-yao-ying-she-hao-ji-bai-ge-duan-kou-nan-dao-yao-yi-ge-ge-p-me" class="header-anchor">#</a></h2><p>-p &#x662F;&#x53EF;&#x4EE5;&#x7528;&#x8303;&#x56F4;&#x7684;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-p 8001-8010:8001-8010</div></pre></td></tr></table></figure>
<h2 id="vethxxxx-zhe-chong-xu-ni-wang-qia-he-rong-qi-de-dui-ying-guan-xi-cong-na-li-kan"><a href="#vethxxxx-&#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F;" class="headerlink" title="vethxxxx &#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F;"></a><code>vethxxxx</code> &#x8FD9;&#x79CD;&#x865A;&#x62DF;&#x7F51;&#x5361;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4ECE;&#x54EA;&#x91CC;&#x770B;&#xFF1F; <a href="#vethxxxx-zhe-chong-xu-ni-wang-qia-he-rong-qi-de-dui-ying-guan-xi-cong-na-li-kan" class="header-anchor">#</a></h2><p><code>&#x5317;&#x4EAC;-ZZ-&#x867E;&#x7C73;</code>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x597D;&#x529E;&#x6CD5;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker network ls</div><div class="line">NETWORK ID          NAME                       DRIVER</div><div class="line">56f04389b8f0        dockerlnmp_backend         bridge</div><div class="line">094fcb269385        dockerlnmp_frontend        bridge</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>NETWORK ID</code>&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C; <code>ip a | grep veth</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ip a | grep veth</div><div class="line">12: veth22996d2@<span class="keyword">if</span>11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</div><div class="line">14: veth34ace9a@<span class="keyword">if</span>13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</div><div class="line">16: veth0bb3771@<span class="keyword">if</span>15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</div><div class="line">22: veth399b874@<span class="keyword">if</span>21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-094fcb269385 state UP group default</div><div class="line">24: vethf24a0a9@<span class="keyword">if</span>23: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-094fcb269385 state UP group default</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684; <code>br-56f04389b8f0</code> &#x4EE5;&#x53CA; <code>br-094fcb269385</code>&#xFF0C;<code>br-</code>&#x540E;&#x9762;&#x7684;&#x662F;&#x4E0A;&#x9762;&#x7684;<code>&#x7F51;&#x7EDC;id</code>&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x770B;&#x51FA; <code>veth</code> &#x548C; Docker &#x7F51;&#x7EDC;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x800C;&#x5BB9;&#x5668;&#x90FD;&#x662F;&#x8FDE;&#x63A5;&#x5230;&#x4E86;&#x67D0;&#x4E2A;Docker&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#xFF0C;&#x4ECE;&#x800C;&#x5C31;&#x6709;&#x4E86;&#x5BB9;&#x5668;&#x548C;<code>veth</code>&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x67D0;&#x4E2A;&#x7F51;&#x7EDC;&#x51FA;&#x73B0;&#x4E86;&#x591A;&#x4E2A; <code>veth</code> &#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF; <code>veth22996d2@if11</code> &#x540E;&#x9762;&#x7684; <code>if11</code> &#x8FD9;&#x90E8;&#x5206;&#xFF0C;&#x548C;&#x5BB9;&#x5668;&#x5185;&#x7684; <code>ip addr</code> &#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4E00;&#x822C; <code>&#x5947;-&#x5076;</code>&#x662F;&#x4E00;&#x5BF9;&#x3002;</p>
<h2 id="rong-qi-ci-pan-ke-yi-xian-zhi-pei-e-me"><a href="#&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F;" class="headerlink" title="&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F;"></a>&#x5BB9;&#x5668;&#x78C1;&#x76D8;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x914D;&#x989D;&#x4E48;&#xFF1F; <a href="#rong-qi-ci-pan-ke-yi-xian-zhi-pei-e-me" class="header-anchor">#</a></h2><p>&#x5BF9;&#x4E8E; <code>devicemapper</code>, <code>btrfs</code>, <code>zfs</code> &#x6765;&#x8BF4;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--storage-opt size=100G</code> &#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x9650;&#x5236; <code>rootfs</code> &#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker create -it --storage-opt size=120G fedora /bin/bash</div></pre></td></tr></table></figure>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/run/#/set-storage-driver-options-per-container" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/run/#/set-storage-driver-options-per-container</a></p>
<h2 id="docker-stats-xian-shi-de-zhi-you-rong-qi-id-zen-me-cai-neng-xian-shi-rong-qi-ming-zi"><a href="#docker-stats-&#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F;" class="headerlink" title="docker stats &#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F;"></a><code>docker stats</code> &#x663E;&#x793A;&#x7684;&#x53EA;&#x6709;&#x5BB9;&#x5668;ID&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x663E;&#x793A;&#x5BB9;&#x5668;&#x540D;&#x5B57;&#xFF1F; <a href="#docker-stats-xian-shi-de-zhi-you-rong-qi-id-zen-me-cai-neng-xian-shi-rong-qi-ming-zi" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker stats $(docker ps --format=<span class="string">&apos;{{.Names}}&apos;</span>)</div></pre></td></tr></table></figure>
<h2 id="rong-qi-nei-de-shu-ju-gai-bao-cun-zai-jing-xiang-li-huan-shi-wu-li-ji-li"><a href="#&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F;" class="headerlink" title="&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F;"></a>&#x5BB9;&#x5668;&#x5185;&#x7684;&#x6570;&#x636E;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x955C;&#x50CF;&#x91CC;&#x8FD8;&#x662F;&#x7269;&#x7406;&#x673A;&#x91CC;&#xFF1F; <a href="#rong-qi-nei-de-shu-ju-gai-bao-cun-zai-jing-xiang-li-huan-shi-wu-li-ji-li" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x6240;&#x8C13;&#x6570;&#x636E;&#x662F;&#x6307;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x90E8;&#x5206;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x4E0D;&#x5E94;&#x8BE5;&#x4FDD;&#x5B58;&#x4E8E;&#x955C;&#x50CF;&#x5185;&#x3002;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x57FA;&#x7840;&#x6587;&#x4EF6;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x800C;&#x53D8;&#x5316;&#x90E8;&#x5206;&#x4F7F;&#x7528;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x6216;&#x8005;&#x6570;&#x636E;&#x5377;&#x6765;&#x89E3;&#x51B3;&#x3002;</p>
<p>&#x5EFA;&#x8BAE;&#x770B;&#x4E00;&#x4E0B;&#x5B98;&#x7F51; <code>docker volume</code> &#x7684;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank" rel="external">https://docs.docker.com/engine/tutorials/dockervolumes/</a></p>
<h2 id="kan-dao-zong-shuo-yao-bao-chi-rong-qi-wu-zhuang-tai-na-shi-me-shi-wu-zhuang-tai"><a href="#&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F;" class="headerlink" title="&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F;"></a>&#x770B;&#x5230;&#x603B;&#x8BF4;&#x8981;&#x4FDD;&#x6301;&#x5BB9;&#x5668;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4EC0;&#x4E48;&#x662F;&#x65E0;&#x72B6;&#x6001;&#xFF1F; <a href="#kan-dao-zong-shuo-yao-bao-chi-rong-qi-wu-zhuang-tai-na-shi-me-shi-wu-zhuang-tai" class="header-anchor">#</a></h2><p>&#x8FD9;&#x91CC;&#x8BF4;&#x5230;&#x7684;&#x6709;&#x4E24;&#x4E2A;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;&#xFF1A;</p>
<h3 id="rong-qi-cun-chu-ceng-de-wu-zhuang-tai"><a href="#&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001;" class="headerlink" title="&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001;"></a>&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x65E0;&#x72B6;&#x6001; <a href="#rong-qi-cun-chu-ceng-de-wu-zhuang-tai" class="header-anchor">#</a></h3><p>&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x7684;&#x5B58;&#x50A8;&#x5C42;&#x662F;&#x6307;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x4E00;&#x822C;&#x662F;<code>Union FS</code>&#xFF0C;&#x5982; <code>AUFS</code>&#xFF0C;&#x6216;&#x8005;&#x662F;&#x4F7F;&#x7528;&#x5757;&#x8BBE;&#x5907;&#x7684;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#xFF08;&#x5982;<code>snapshot</code>&#xFF09;&#x8FDB;&#x884C;&#x6A21;&#x62DF;&#xFF0C;&#x5982; <code>devicemapper</code>&#x3002;</p>
<p>&#x5B58;&#x50A8;&#x5C42;&#x4E0D;&#x5E94;&#x8BE5;&#x6709;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x6709;&#x53D8;&#x5316;&#x90E8;&#x5206;&#x7528;<code>&#x5377;</code>&#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#x3002;&#x7531;&#x4E8E;&#x5377;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x548C;&#x5BB9;&#x5668;&#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x6D88;&#x4EA1;&#x91CD;&#x5EFA;&#xFF0C;&#x5377;&#x4E0D;&#x4F1A;&#x8DDF;&#x968F;&#x6D88;&#x4EA1;&#x3002;&#x6240;&#x4EE5;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x5220;&#x4E86;&#x91CD;&#x65B0;<code>run</code>&#xFF0C;&#x800C;&#x5176;&#x6302;&#x8F7D;&#x7684;<code>&#x5377;</code>&#x5219;&#x4F1A;&#x4FDD;&#x6301;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<h3 id="fu-wu-ceng-mian-de-wu-zhuang-tai"><a href="#&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;" class="headerlink" title="&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001;"></a>&#x670D;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x65E0;&#x72B6;&#x6001; <a href="#fu-wu-ceng-mian-de-wu-zhuang-tai" class="header-anchor">#</a></h3><p>&#x4F7F;&#x7528;&#x5377;&#x6301;&#x4E45;&#x5316;&#x5BB9;&#x5668;&#x72B6;&#x6001;&#xFF0C;&#x867D;&#x7136;&#x4ECE;&#x5B58;&#x50A8;&#x5C42;&#x7684;&#x89D2;&#x5EA6;&#x770B;&#xFF0C;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4ECE;&#x670D;&#x52A1;&#x5C42;&#x9762;&#x770B;&#xFF0C;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x662F;&#x6709;&#x72B6;&#x6001;&#x7684;&#x3002;</p>
<p>&#x4ECE;&#x670D;&#x52A1;&#x5C42;&#x9762;&#x4E0A;&#x8BF4;&#xFF0C;&#x4E5F;&#x5B58;&#x5728;&#x65E0;&#x72B6;&#x6001;&#x670D;&#x52A1;&#x3002;&#x5C31;&#x662F;&#x8BF4;&#x670D;&#x52A1;&#x672C;&#x8EAB;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x5165;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x3002;&#x6BD4;&#x5982;&#x524D;&#x7AEF; <code>nginx</code>&#xFF0C;&#x5B83;&#x4E0D;&#x9700;&#x8981;&#x5199;&#x5165;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#xFF08;&#x65E5;&#x5FD7;&#x8D70;Docker&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#xFF09;&#xFF0C;&#x4E2D;&#x95F4;&#x7684; <code>php</code>, <code>node.js</code> &#x7B49;&#x670D;&#x52A1;&#xFF0C;&#x53EF;&#x80FD;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x672C;&#x5730;&#x5B58;&#x50A8;&#xFF0C;&#x5B83;&#x4EEC;&#x6240;&#x9700;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5728; <code>redis</code>, <code>mysql</code>, <code>mongodb</code> &#x4E2D;&#x4E86;&#x3002;&#x8FD9;&#x7C7B;&#x670D;&#x52A1;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x5377;&#xFF0C;&#x4E5F;&#x4E0D;&#x53D1;&#x751F;&#x672C;&#x5730;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x5220;&#x9664;&#x3001;&#x91CD;&#x542F;&#x3001;&#x4E0D;&#x4FDD;&#x5B58;&#x81EA;&#x8EAB;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x4E0D;&#x5F71;&#x54CD;&#x670D;&#x52A1;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x662F;<code>&#x65E0;&#x72B6;&#x6001;&#x670D;&#x52A1;</code>&#x3002;&#x8FD9;&#x7C7B;&#x670D;&#x52A1;&#x7531;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4EEC;&#x7684;&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x66F4;&#x65B9;&#x4FBF;&#x3002;</p>
<p>&#x4E4B;&#x524D;&#x6CA1;&#x6709; <code>docker volume</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6709;&#x4E9B;&#x4EBA;&#x8BF4; Docker &#x53EA;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x65E0;&#x72B6;&#x6001;&#x670D;&#x52A1;&#xFF0C;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x53EA;&#x770B;&#x5230;&#x4E86;&#x5B58;&#x50A8;&#x5C42;&#x9700;&#x6C42;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x6CA1;&#x6709; <code>docker volume</code> &#x7684;&#x6301;&#x4E45;&#x5316;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x8FD9;&#x4E2A;&#x8BF4;&#x6CD5;&#x5DF2;&#x7ECF;&#x4E0D;&#x6210;&#x7ACB;&#xFF0C;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x6709;&#x72B6;&#x6001;&#xFF0C;&#x72B6;&#x6001;&#x6301;&#x4E45;&#x5316;&#x7528; <code>docker volume</code>&#x3002;</p>
<p>&#x5F53;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x6709;&#x72B6;&#x6001;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;<code>local</code>&#x5377;&#x9A71;&#x52A8;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;<code>&#x672C;&#x5730;&#x5B58;&#x50A8;</code>&#x8FDB;&#x884C;&#x72B6;&#x6001;&#x6301;&#x4E45;&#x5316;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5355;&#x673A;&#x670D;&#x52A1;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x518D;&#x8C03;&#x5EA6;&#x8FD0;&#x884C;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x662F;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x4F7F;&#x7528;<code>&#x672C;&#x5730;&#x5B58;&#x50A8;</code>&#x7684;&#x5377;&#xFF0C;&#x53EA;&#x53EF;&#x4EE5;&#x4E3A;&#x5F53;&#x524D;&#x4E3B;&#x673A;&#x63D0;&#x4F9B;&#x6301;&#x4E45;&#x5316;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x8DE8;&#x4E3B;&#x673A;&#x3002;</p>
<p>&#x4F46;&#x8FD9;&#x53EA;&#x662F;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684; <code>local</code> &#x9A71;&#x52A8;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528; <code>&#x672C;&#x5730;&#x5B58;&#x50A8;</code> &#x800C;&#x5DF2;&#x3002;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;/&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8DE8;&#x4E3B;&#x673A;&#x7684;&#x95EE;&#x9898;&#x3002;<code>docker volume</code> &#x81EA;&#x7136;&#x652F;&#x6301;&#x5F88;&#x591A;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x6BD4;&#x5982; <code>flocker</code>&#x3001;<code>glusterfs</code>&#x3001;<code>ceph</code>&#x3001;<code>ipfs</code> &#x7B49;&#x7B49;&#x3002;&#x5E38;&#x7528;&#x7684;&#x63D2;&#x4EF6;&#x5217;&#x8868;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins" target="_blank" rel="external">https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins</a></p>
<h2 id="dockerfile-zhong-de-volume-he-docker-run-v-yi-ji-compose-zhong-de-volumes-du-you-shi-me-qu-bie"><a href="#Dockerfile-&#x4E2D;&#x7684;VOLUME&#x548C;docker-run-v&#xFF0C;&#x4EE5;&#x53CA;Compose&#x4E2D;&#x7684;volumes&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;" class="headerlink" title="Dockerfile &#x4E2D;&#x7684;VOLUME&#x548C;docker run -v&#xFF0C;&#x4EE5;&#x53CA;Compose&#x4E2D;&#x7684;volumes&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;"></a><code>Dockerfile</code> &#x4E2D;&#x7684;<code>VOLUME</code>&#x548C;<code>docker run -v</code>&#xFF0C;&#x4EE5;&#x53CA;<code>Compose</code>&#x4E2D;&#x7684;<code>volumes</code>&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F; <a href="#dockerfile-zhong-de-volume-he-docker-run-v-yi-ji-compose-zhong-de-volumes-du-you-shi-me-qu-bie" class="header-anchor">#</a></h2><p>&#x5148;&#x660E;&#x767D;&#x51E0;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x6302;&#x8F7D;&#x5206;&#x4E3A;<code>&#x6302;&#x8F7D;&#x672C;&#x5730;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;</code>&#xFF0C;&#x6216;&#x8005;<code>&#x6302;&#x8F7D;&#x6570;&#x636E;&#x5377;</code>&#xFF0C;&#x800C;<code>&#x6570;&#x636E;&#x5377;</code>&#x53C8;&#x5206;&#x4E3A;<code>&#x533F;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x548C;<code>&#x547D;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x3002;</p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x5728;<code>Dockerfile</code>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x662F;&#x6302;&#x8F7D;&#x662F;&#x6307;<code>&#x533F;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x8986;&#x76D6;&#x3002;&#x901A;&#x8FC7; <code>docker run</code> &#x7684; <code>-v</code> &#x53C2;&#x6570;&#x6216;&#x8005; <code>docker-compose.yml</code> &#x7684; <code>volumes</code> &#x6307;&#x5B9A;&#x3002;&#x4F7F;&#x7528;<code>&#x547D;&#x540D;&#x5377;</code>&#x7684;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#xFF0C;&#x5176;&#x5B83;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;<code>&#x547D;&#x540D;&#x6570;&#x636E;&#x5377;</code>&#x7684;&#x540D;&#x5B57;&#x6765;&#x6307;&#x5B9A;&#x6302;&#x8F7D;&#xFF0C;&#x5171;&#x4EAB;&#x5176;&#x5185;&#x5BB9;&#xFF08;&#x4E0D;&#x8FC7;&#x8981;&#x6CE8;&#x610F;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x7684;&#x7ADE;&#x4E89;&#x95EE;&#x9898;&#xFF09;&#x3002;</p>
<p>&#x6570;&#x636E;&#x5377;&#x9ED8;&#x8BA4;&#x53EF;&#x80FD;&#x4F1A;&#x4FDD;&#x5B58;&#x4E8E; <code>/var/lib/docker/volumes</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x4E00;&#x822C;&#x4E0D;&#x9700;&#x8981;&#x3001;&#x4E5F;&#x4E0D;&#x5E94;&#x8BE5;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x3002;</p>
<h2 id="duo-ge-docker-rong-qi-zhi-jian-gong-xiang-shu-ju-zen-me-ban-nfs"><a href="#&#x591A;&#x4E2A;-Docker-&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS&#xFF1F;" class="headerlink" title="&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS&#xFF1F;"></a>&#x591A;&#x4E2A; Docker &#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x600E;&#x4E48;&#x529E;&#xFF1F;NFS&#xFF1F; <a href="#duo-ge-docker-rong-qi-zhi-jian-gong-xiang-shu-ju-zen-me-ban-nfs" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BBF;&#x4E3B;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x540C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5377;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x7A0B;&#x5E8F;&#x4E0A;&#x8981;&#x5904;&#x7406;&#x597D;&#x5E76;&#x53D1;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5982;&#x679C;&#x662F;&#x4E0D;&#x540C;&#x5BBF;&#x4E3B;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x5377;&#x9A71;&#x52A8;&#xFF0C;&#x8BA9;&#x5206;&#x5E03;&#x5728;&#x4E0D;&#x540C;&#x5BBF;&#x4E3B;&#x7684;&#x5BB9;&#x5668;&#x90FD;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x5982;S3&#x4E4B;&#x7C7B;&#xFF1A;</p>
<p><a href="https://docs.docker.com/engine/extend/plugins/#volume-plugins" target="_blank" rel="external">https://docs.docker.com/engine/extend/plugins/#volume-plugins</a></p>
<h2 id="ji-ran-yi-ge-rong-qi-yi-ge-ying-yong-na-me-wo-xiang-zai-gai-rong-qi-zhong-yong-ji-hua-ren-wu-cron-zen-me-ban"><a href="#&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1;-cron-&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1; cron &#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x65E2;&#x7136;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x60F3;&#x5728;&#x8BE5;&#x5BB9;&#x5668;&#x4E2D;&#x7528;&#x8BA1;&#x5212;&#x4EFB;&#x52A1; cron &#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#ji-ran-yi-ge-rong-qi-yi-ge-ying-yong-na-me-wo-xiang-zai-gai-rong-qi-zhong-yong-ji-hua-ren-wu-cron-zen-me-ban" class="header-anchor">#</a></h2><p><code>cron</code> &#x5176;&#x5B9E;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x53E6;&#x8D77;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6765;&#x8FDB;&#x884C;&#xFF0C;&#x5982;&#x9700;&#x8BBF;&#x95EE;&#x8BE5;&#x5E94;&#x7528;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x8BE5;&#x5E94;&#x7528;&#x7684;&#x6570;&#x636E;&#x5377;&#x5373;&#x53EF;&#x3002;&#x800C; cron &#x7684;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;cron &#x4EE5;&#x524D;&#x53F0;&#x8FD0;&#x884C;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6709;&#x4E2A; python &#x811A;&#x672C;&#x53EF;&#x4EE5;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x6784;&#x5EFA;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3002;</p>
<p>&#x9996;&#x5148;&#x57FA;&#x4E8E; python &#x7684;&#x955C;&#x50CF;&#x5B9A;&#x5236;&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> python:<span class="number">3.5</span>.<span class="number">2</span></div><div class="line"></div><div class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</div><div class="line"></div><div class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update \</span></div><div class="line">    &amp;&amp; apt-get install -y cron \</div><div class="line">    &amp;&amp; apt-get autoremove -y</div><div class="line"></div><div class="line"><span class="keyword">COPY</span><span class="bash"> ./cronpy /etc/cron.d/cronpy</span></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;cron&quot;</span>, <span class="string">&quot;-f&quot;</span>]</span></div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x6240;&#x63D0;&#x53CA;&#x7684; <code>cronpy</code> &#x5C31;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8BA1;&#x5212;&#x6267;&#x884C;&#x7684;cron&#x811A;&#x672C;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">* * * * * root /app/task.py &gt;&gt; /var/<span class="built_in">log</span>/task.log 2&gt;&amp;1</div></pre></td></tr></table></figure>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x8BA1;&#x5212;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5B9A;&#x65F6;&#x6267;&#x884C; <code>/app/task.py</code> &#x6587;&#x4EF6;&#xFF0C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x5728; <code>/var/log/task.log</code> &#x4E2D;&#x3002;&#x8FD9;&#x4E2A; <code>task.py</code> &#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x53EA;&#x662F;&#x8F93;&#x51FA;&#x4E2A;&#x65F6;&#x95F4;&#x800C;&#x5DF2;&#x3002;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/local/bin/python</span></div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line">print(<span class="string">&quot;Cron job has run at {0} with environment variable &quot;</span>.format(str(datetime.now())))</div></pre></td></tr></table></figure>
<p>&#x8FD9; <code>task.py</code> &#x53EF;&#x4EE5;&#x5728;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x65F6;&#x653E;&#x8FDB;&#x53BB;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x4E3E;&#x4F8B;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x6784;&#x5EFA;&#x955C;&#x50CF;</span></div><div class="line">docker build -t cronjob:latest .</div><div class="line"></div><div class="line"><span class="comment"># &#x8FD0;&#x884C;&#x955C;&#x50CF;</span></div><div class="line">docker run \</div><div class="line">    --name cronjob \</div><div class="line">    <span class="_">-d</span> \</div><div class="line">    -v $(<span class="built_in">pwd</span>)/task.py:/app/task.py \</div><div class="line">    -v $(<span class="built_in">pwd</span>)/<span class="built_in">log</span>/:/var/<span class="built_in">log</span>/ \</div><div class="line">    cronjob:latest</div></pre></td></tr></table></figure>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E94;&#x8BE5;&#x5728;&#x6784;&#x5EFA;&#x4E3B;&#x673A;&#x4E0A;&#x8D4B;&#x4E88; <code>task.py</code> &#x6587;&#x4EF6;&#x53EF;&#x6267;&#x884C;&#x6743;&#x9650;&#x3002;</p>
<h2 id="docker-pull-xia-lai-de-jing-xiang-wen-jian-du-zai-na"><a href="#docker-pull-&#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F;" class="headerlink" title="docker pull &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F;"></a><code>docker pull</code> &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x90FD;&#x5728;&#x54EA;&#xFF1F; <a href="#docker-pull-xia-lai-de-jing-xiang-wen-jian-du-zai-na" class="header-anchor">#</a></h2><p>&#x521D;&#x5B66; Docker &#x8981;&#x53CD;&#x590D;&#x544A;&#x8BEB;&#x81EA;&#x5DF1;&#xFF0C;Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x3002;</p>
<p>Docker&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;Docker &#x955C;&#x50CF;&#x4E5F;&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x7684; ISO &#x6587;&#x4EF6;&#x3002;Docker &#x7684;&#x955C;&#x50CF;&#x662F;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x90FD;&#x662F;&#x7531;&#x5F88;&#x591A;&#x5C42;&#xFF0C;&#x5F88;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x7EC4;&#x6210;&#x3002;&#x800C;&#x4E0D;&#x540C;&#x7684;&#x955C;&#x50CF;&#x662F;&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x7684;&#x5C42;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5177;&#x4F53;&#x54EA;&#x4E2A;&#x6587;&#x4EF6;&#x662F; <code>pull</code> &#x4E0B;&#x6765;&#x7684;&#x955C;&#x50CF;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x955C;&#x50CF;&#x4FDD;&#x5B58;&#x4F4D;&#x7F6E;&#x53D6;&#x51B3;&#x4E8E;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E00;&#x822C;<code>Linux</code>&#x7CFB;&#x7EDF;&#x4E0B;&#xFF0C;&#x5728; <code>/var/lib/docker</code> &#x91CC;&#x3002;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528; <code>Union FS</code> &#x7684;&#x7CFB;&#x7EDF;(<code>Ubuntu</code>)&#xFF0C;&#x5982; <code>aufs</code>, <code>overlay2</code> &#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; <code>/var/lib/docker/{aufs,overlay2}</code> &#x4E0B;&#x770B;&#x5230;&#x627E;&#x5230;&#x5404;&#x4E2A;&#x955C;&#x50CF;&#x7684;&#x5C42;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x5C42;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;<code>CentOS</code>&#x8FD9;&#x7C7B;&#x6CA1;&#x6709;<code>Union FS</code>&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F1A;&#x4F7F;&#x7528;&#x5982;<code>devicemapper</code>&#x8FD9;&#x7C7B;&#x4E1C;&#x897F;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x529F;&#x80FD;(&#x5982;<code>snapshot</code>)&#x6A21;&#x62DF;&#xFF0C;&#x955C;&#x50CF;&#x4F1A;&#x5B58;&#x50A8;&#x4E8E;&#x5757;&#x8BBE;&#x5907;&#x91CC;&#xFF0C;&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x770B;&#x5230;&#x5177;&#x4F53;&#x6BCF;&#x5C42;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x6BCF;&#x5C42;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>CentOS/RHEL</code> &#x4F7F;&#x7528; <code>lvm-loop</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x672C;&#x5730;&#x7A00;&#x758F;&#x6587;&#x4EF6;&#x6A21;&#x62DF;&#x5757;&#x8BBE;&#x5907;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4F1A;&#x4F4D;&#x4E8E; <code>/var/lib/docker/devicemapper/devicemapper/data</code> &#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x63A8;&#x8350;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5F88;&#x5927;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x4F60;&#x5728;&#x7528; <code>devicemapper + loop</code> &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x53BB;&#x53C2;&#x7167;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x6362; <code>direct-lvm</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5206;&#x914D;&#x771F;&#x6B63;&#x7684;&#x5757;&#x8BBE;&#x5907;&#x7ED9; <code>devicemapper</code> &#x53BB;&#x7528;&#x3002;</p>
<h2 id="docker-images-ming-ling-xian-shi-de-jing-xiang-zhan-liao-hao-da-de-kong-jian-zen-me-ban-mei-ci-du-shi-xia-zai-zhe-me-da-de-jing-xiang"><a href="#docker-images-&#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F;" class="headerlink" title="docker images &#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F;"></a><code>docker images</code> &#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x955C;&#x50CF;&#x5360;&#x4E86;&#x597D;&#x5927;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x955C;&#x50CF;&#xFF1F; <a href="#docker-images-ming-ling-xian-shi-de-jing-xiang-zhan-liao-hao-da-de-kong-jian-zen-me-ban-mei-ci-du-shi-xia-zai-zhe-me-da-de-jing-xiang" class="header-anchor">#</a></h2><p>&#x8FD9;&#x4E2A;&#x663E;&#x793A;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x8BA1;&#x7B97;&#x540E;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8981;&#x77E5;&#x9053; docker image &#x662F;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x5728;<code>1.10</code>&#x4E4B;&#x524D;&#xFF0C;&#x4E0D;&#x540C;&#x955C;&#x50CF;&#x65E0;&#x6CD5;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x5C42;&#xFF0C;&#x6240;&#x4EE5;&#x57FA;&#x672C;&#x4E0A;&#x786E;&#x5B9E;&#x662F;&#x4E0B;&#x8F7D;&#x5927;&#x5C0F;&#x3002;&#x4F46;&#x662F;&#x4ECE;<code>1.10</code>&#x4E4B;&#x540E;&#xFF0C;&#x5DF2;&#x6709;&#x7684;&#x5C42;&#xFF08;&#x901A;&#x8FC7;<code>SHA256</code>&#x6765;&#x5224;&#x65AD;&#xFF09;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x4E0B;&#x8F7D;&#x3002;&#x53EA;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x53D8;&#x5316;&#x7684;&#x5C42;&#x3002;&#x6240;&#x4EE5;&#x5B9E;&#x9645;&#x4E0B;&#x8F7D;&#x5927;&#x5C0F;&#x6BD4;&#x8FD9;&#x4E2A;&#x6570;&#x503C;&#x8981;&#x5C0F;&#x3002;&#x800C;&#x4E14;&#x672C;&#x5730;&#x786C;&#x76D8;&#x7A7A;&#x95F4;&#x5360;&#x7528;&#xFF0C;&#x4E5F;&#x6BD4;<code>docker images</code>&#x5217;&#x51FA;&#x6765;&#x7684;&#x4E1C;&#x897F;&#x52A0;&#x8D77;&#x6765;&#x5C0F;&#x5F88;&#x591A;&#xFF0C;&#x5F88;&#x591A;&#x91CD;&#x590D;&#x7684;&#x90E8;&#x5206;&#x5171;&#x4EAB;&#x4E86;&#x3002;</p>
<h2 id="docker-images-a-hou-xian-shi-liao-hao-duo-none-de-jing-xiang-du-shi-shi-me-ya-neng-shan-me"><a href="#docker-images-a-&#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A;-lt-none-gt-&#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F;" class="headerlink" title="docker images -a &#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A; &lt;none&gt; &#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F;"></a><code>docker images -a</code> &#x540E;&#x663E;&#x793A;&#x4E86;&#x597D;&#x591A; <code>&lt;none&gt;</code> &#x7684;&#x955C;&#x50CF;&#xFF1F;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x5440;&#xFF1F;&#x80FD;&#x5220;&#x4E48;&#xFF1F; <a href="#docker-images-a-hou-xian-shi-liao-hao-duo-none-de-jing-xiang-du-shi-shi-me-ya-neng-shan-me" class="header-anchor">#</a></h2><p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;<code>&lt;none&gt;</code> &#x5C31;&#x662F;&#x8BF4;&#x8BE5;&#x955C;&#x50CF;&#x6CA1;&#x6709;&#x6253;&#x6807;&#x7B7E;&#x3002;&#x800C;&#x6CA1;&#x6709;&#x6253;&#x6807;&#x7B7E;&#x955C;&#x50CF;&#x4E00;&#x822C;&#x5206;&#x4E3A;&#x4E24;&#x7C7B;&#xFF0C;&#x4E00;&#x7C7B;&#x662F;<strong>&#x4F9D;&#x8D56;&#x955C;&#x50CF;</strong>&#xFF0C;&#x4E00;&#x7C7B;&#x662F;<strong>&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;</strong>&#x3002;</p>
<h3 id="yi-lai-jing-xiang"><a href="#&#x4F9D;&#x8D56;&#x955C;&#x50CF;" class="headerlink" title="&#x4F9D;&#x8D56;&#x955C;&#x50CF;"></a>&#x4F9D;&#x8D56;&#x955C;&#x50CF; <a href="#yi-lai-jing-xiang" class="header-anchor">#</a></h3><p>Docker&#x7684;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7684;&#x5B58;&#x50A8;&#x5C42;&#x662F;Union FS&#xFF0C;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x3002;&#x6240;&#x4EE5;&#x4EFB;&#x4F55;&#x955C;&#x50CF;&#x9664;&#x4E86;&#x6700;&#x4E0A;&#x9762;&#x4E00;&#x5C42;&#x6253;&#x4E0A;&#x6807;&#x7B7E;(tag)&#x5916;&#xFF0C;&#x5176;&#x5B83;&#x4E0B;&#x9762;&#x4F9D;&#x8D56;&#x7684;&#x4E00;&#x5C42;&#x5C42;&#x5B58;&#x50A8;&#x4E5F;&#x662F;&#x5B58;&#x5728;&#x7684;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x6CA1;&#x6709;&#x6253;&#x4E0A;&#x4EFB;&#x4F55;&#x6807;&#x7B7E;&#xFF0C;&#x6240;&#x4EE5;&#x5728; <code>docker images -a</code> &#x7684;&#x65F6;&#x5019;&#x4F1A;&#x4EE5; <code>&lt;none&gt;</code> &#x7684;&#x5F62;&#x5F0F;&#x663E;&#x793A;&#x3002;&#x6CE8;&#x610F;&#x89C2;&#x5BDF;&#x4E00;&#x4E0B; <code>docker pull</code> &#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x7684;<code>sha256</code>&#x7684;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B; <code>&lt;none&gt;</code> &#x4E2D;&#x7684;&#x76F8;&#x540C;&#x6821;&#x9A8C;&#x503C;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5B83;&#x4EEC;&#x5C31;&#x662F;&#x4F9D;&#x8D56;&#x955C;&#x50CF;&#x3002;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;<strong>&#x4E0D;&#x5E94;&#x5F53;&#x88AB;&#x5220;&#x9664;</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x6807;&#x7B7E;&#x955C;&#x50CF;&#x5728;&#x4F9D;&#x8D56;&#x5B83;&#x4EEC;&#x3002;</p>
<h3 id="diu-liao-biao-qian-de-jing-xiang"><a href="#&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;" class="headerlink" title="&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF;"></a>&#x4E22;&#x4E86;&#x6807;&#x7B7E;&#x7684;&#x955C;&#x50CF; <a href="#diu-liao-biao-qian-de-jing-xiang" class="header-anchor">#</a></h3><p>&#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#x53EF;&#x80FD;&#x672C;&#x6765;&#x6709;&#x6807;&#x7B7E;&#xFF0C;&#x540E;&#x6765;&#x4E22;&#x4E86;&#x3002;&#x539F;&#x56E0;&#x53EF;&#x80FD;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<ul>
<li><code>docker pull</code> &#x4E86;&#x4E00;&#x4E2A;&#x540C;&#x6837;&#x6807;&#x7B7E;&#x4F46;&#x662F;&#x65B0;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x4E8E;&#x662F;&#x8BE5;&#x6807;&#x7B7E;&#x4ECE;&#x65E7;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#x8F6C;&#x79FB;&#x5230;&#x4E86;&#x65B0;&#x7248;&#x672C;&#x955C;&#x50CF;&#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#x65E7;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#x4E0A;&#x7684;&#x6807;&#x7B7E;&#x5C31;&#x4E22;&#x4E86;&#xFF1B;</li>
<li><code>docker build</code> &#x65F6;&#x6307;&#x5B9A;&#x7684;&#x6807;&#x7B7E;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF;&#x62E5;&#x6709;&#x8BE5;&#x6807;&#x7B7E;&#xFF0C;&#x800C;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF;&#x5C31;&#x4E22;&#x5931;&#x4E86;&#x6807;&#x7B7E;&#x3002;</li>
</ul>
<p>&#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#x88AB;&#x79F0;&#x4E3A; <code>dangling</code> &#xFF08;&#x6643;&#x8361;&#x7740;&#x7684;&#xFF09;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x4E9B;&#x955C;&#x50CF;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#xFF0C;&#x4F7F;&#x7528; <code>dangling=true</code> &#x8FC7;&#x6EE4;&#x6761;&#x4EF6;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x624B;&#x52A8;&#x5220;&#x9664; dangling &#x955C;&#x50CF;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker rmi $(docker images -aq <span class="_">-f</span> <span class="string">&quot;dangling=true&quot;</span>)</div></pre></td></tr></table></figure>
<p>&#x5BF9;&#x4E8E;&#x9891;&#x7E41;&#x6784;&#x5EFA;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x6BD4;&#x5982; Jenkins &#x4E4B;&#x7C7B;&#x7684;&#x73AF;&#x5883;&#x3002;&#x624B;&#x52A8;&#x6E05;&#x7406;&#x663E;&#x7136;&#x4E0D;&#x662F;&#x597D;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x5E94;&#x8BE5;&#x5B9A;&#x671F;&#x6267;&#x884C;&#x56FA;&#x5B9A;&#x811A;&#x672C;&#x6765;&#x6E05;&#x7406;&#x8FD9;&#x4E9B;&#x65E0;&#x7528;&#x7684;&#x955C;&#x50CF;&#x3002;&#x5F88;&#x5E78;&#x8FD0;&#xFF0C;Spotify &#x4E5F;&#x9762;&#x4E34;&#x4E86;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4ED6;&#x4EEC;&#x5DF2;&#x7ECF;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x5DE5;&#x5177;&#x6765;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;<a href="https://github.com/spotify/docker-gc" target="_blank" rel="external">https://github.com/spotify/docker-gc</a></p>
<h2 id="wei-shi-me-docker-hub-de-jing-xiang-chi-cun-he-docker-images-bu-yi-zhi"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-Docker-Hub-&#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C;-docker-images-&#x4E0D;&#x4E00;&#x81F4;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; Docker Hub &#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C; docker images &#x4E0D;&#x4E00;&#x81F4;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; Docker Hub &#x7684;&#x955C;&#x50CF;&#x5C3A;&#x5BF8;&#x548C; <code>docker images</code> &#x4E0D;&#x4E00;&#x81F4;&#xFF1F; <a href="#wei-shi-me-docker-hub-de-jing-xiang-chi-cun-he-docker-images-bu-yi-zhi" class="header-anchor">#</a></h2><p>Docker Hub&#x4E0A;&#x663E;&#x793A;&#x7684;&#x662F;&#x7ECF;&#x8FC7; <code>gzip</code> &#x538B;&#x7F29;&#x540E;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5927;&#x5C0F;&#x4E5F;&#x662F;&#x4F60;&#x5C06;&#x4E0B;&#x8F7D;&#x7684;&#x955C;&#x50CF;&#x5927;&#x5C0F;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x4E5F;&#x662F; Docker Hub &#x7528;&#x6237;&#x6700;&#x5173;&#x5FC3;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x800C; <code>docker images</code> &#x663E;&#x793A;&#x7684;&#x662F;<code>pull</code>&#x4E0B;&#x6765;&#x5E76;&#x89E3;&#x538B;&#x7F29;&#x540E;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x56E0;&#x4E3A;&#x4F7F;&#x7528;<code>docker images</code>&#x7684;&#x65F6;&#x5019;&#x66F4;&#x5173;&#x5FC3;&#x7684;&#x662F;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x5360;&#x7528;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x663E;&#x793A;&#x7684;&#x662F;&#x672A;&#x538B;&#x7F29;&#x955C;&#x50CF;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<h2 id="docker-ri-zhi-du-zai-na-li-zen-me-shou-ji"><a href="#Docker-&#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F;" class="headerlink" title="Docker &#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F;"></a>Docker &#x65E5;&#x5FD7;&#x90FD;&#x5728;&#x54EA;&#x91CC;&#xFF1F;&#x600E;&#x4E48;&#x6536;&#x96C6;&#xFF1F; <a href="#docker-ri-zhi-du-zai-na-li-zen-me-shou-ji" class="header-anchor">#</a></h2><p>&#x65E5;&#x5FD7;&#x5206;&#x4E24;&#x7C7B;&#xFF0C;&#x4E00;&#x7C7B;&#x662F; <code>docker daemon &#x65E5;&#x5FD7;</code>&#xFF0C;&#x65E2; Docker &#x5F15;&#x64CE;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#xFF1B;&#x53E6;&#x4E00;&#x7C7B;&#x662F; <code>&#x5BB9;&#x5668;&#x65E5;&#x5FD7;</code>&#x3002;</p>
<p><code>docker daemon &#x65E5;&#x5FD7;</code> &#x4E00;&#x822C;&#x662F;&#x4EA4;&#x7ED9;&#x4E86; <code>Upstart</code>(Ubuntu 14.04) &#x6216;&#x8005; <code>systemd</code> (CentOS 7, Ubuntu 16.04)&#x3002;&#x524D;&#x8005;&#x4E00;&#x822C;&#x4F4D;&#x4E8E; <code>/var/log/upstart/docker.log</code> &#x4E0B;&#xFF0C;&#x540E;&#x8005;&#x4E00;&#x822C;&#x901A;&#x8FC7; <code>jounarlctl -u docker</code> &#x6765;&#x8BFB;&#x53D6;&#x3002;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x7684;&#x4F4D;&#x7F6E;&#x90FD;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;SO&#x4E0A;&#x6709;&#x4EBA;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4EFD;&#x5217;&#x8868;&#xFF0C;&#x6211;&#x7A0D;&#x5FAE;&#x4FEE;&#x6B63;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x7CFB;&#x7EDF;</th>
<th>&#x65E5;&#x5FD7;&#x4F4D;&#x7F6E;</th>
</tr>
</thead>
<tbody>
<tr>
<td> Ubuntu(14.04)</td>
<td>/var/log/upstart/docker.log</td>
</tr>
<tr>
<td> Ubuntu(16.04)</td>
<td>journalctl -u docker.service</td>
</tr>
<tr>
<td> CentOS 7/RHEL 7/Fedora</td>
<td>journalctl -u docker.service</td>
</tr>
<tr>
<td> CoreOS</td>
<td>journalctl -u docker.service</td>
</tr>
<tr>
<td> OpenSuSE</td>
<td>journalctl -u docker.service</td>
</tr>
<tr>
<td> OSX</td>
<td>~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/log/d&#x200C;&#x200B;ocker.log</td>
</tr>
<tr>
<td> Debian GNU/Linux 7</td>
<td>/var/log/daemon.log</td>
</tr>
<tr>
<td> Debian GNU/Linux 8</td>
<td>journalctl -u docker.service</td>
</tr>
<tr>
<td> Boot2Docker</td>
<td>/var/log/docker.log</td>
</tr>
</tbody>
</table>
<p><code>&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;</code>&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker logs</code> &#x547D;&#x4EE4;&#x6765;&#x8BBF;&#x95EE;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x50CF; <code>tail -f</code> &#x4E00;&#x6837;&#xFF0C;&#x4F7F;&#x7528; <code>docker logs -f</code> &#x6765;&#x5B9E;&#x65F6;&#x67E5;&#x770B;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528; Docker Compose&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>docker-compose logs &lt;&#x670D;&#x52A1;&#x540D;&gt;</code> &#x6765;&#x67E5;&#x770B;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6DF1;&#x7A76;&#x5176;&#x65E5;&#x5FD7;&#x4F4D;&#x7F6E;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x9ED8;&#x8BA4;&#x90FD;&#x4F1A;&#x4EE5; <code>json-file</code> &#x7684;&#x683C;&#x5F0F;&#x5B58;&#x50A8;&#x4E8E; <code>/var/lib/docker/containers/&lt;&#x5BB9;&#x5668;id&gt;/&lt;&#x5BB9;&#x5668;id&gt;-json.log</code> &#x4E0B;&#xFF0C;&#x4E0D;&#x8FC7;&#x5E76;&#x4E0D;&#x5EFA;&#x8BAE;&#x53BB;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x8BFB;&#x53D6;&#x5185;&#x5BB9;&#xFF0C;&#x56E0;&#x4E3A;Docker&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5B8C;&#x5584;&#x5730;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x65B9;&#x5F0F; - <code>Docker &#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x9A71;&#x52A8;</code>&#x3002;</p>
<p>&#x5173;&#x4E8E;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#xFF0C;<code>Docker</code> &#x5185;&#x7F6E;&#x4E86;&#x5F88;&#x591A;&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7C7B;&#x4F3C;&#x4E8E; <code>fluentd</code>, <code>syslog</code> &#x8FD9;&#x7C7B;&#x670D;&#x52A1;&#x6536;&#x96C6;&#x65E5;&#x5FD7;&#x3002;&#x65E0;&#x8BBA;&#x662F; <code>docker daemon</code>&#xFF0C;&#x8FD8;&#x662F;&#x5BB9;&#x5668;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6253;&#x7B97;&#x7528; <code>fluentd</code> &#x6536;&#x96C6;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker run <span class="_">-d</span> \</div><div class="line">    --log-driver=fluentd \</div><div class="line">    --log-opt fluentd-address=10.2.3.4:24224 \</div><div class="line">    --log-opt tag=<span class="string">&quot;docker.{{.Name}}&quot;</span> \</div><div class="line">    nginx</div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D; <code>10.2.3.4:24224</code> &#x662F; <code>fluentd</code> &#x670D;&#x52A1;&#x5730;&#x5740;&#xFF0C;&#x5B9E;&#x9645;&#x73AF;&#x5883;&#x4E2D;&#x5E94;&#x8BE5;&#x6362;&#x6210;&#x771F;&#x5B9E;&#x7684;&#x5730;&#x5740;&#x3002;</p>
<h2 id="wo-yong-de-shi-a-li-yun-ubuntu-14-04-zhu-ji-nei-he-huan-shi-3-13-zen-me-ban"><a href="#&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91;-Ubuntu-14-04-&#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;3-13&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91; Ubuntu 14.04 &#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;3.13&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x6211;&#x7528;&#x7684;&#x662F;&#x963F;&#x91CC;&#x4E91; <code>Ubuntu 14.04</code> &#x4E3B;&#x673A;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x662F;<code>3.13</code>&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#wo-yong-de-shi-a-li-yun-ubuntu-14-04-zhu-ji-nei-he-huan-shi-3-13-zen-me-ban" class="header-anchor">#</a></h2><p>&#x5176;&#x5B9E; <code>Ubuntu 14.04</code> &#x5B98;&#x65B9;&#x7EF4;&#x62A4;&#x7684;&#x5185;&#x6838;&#x5DF2;&#x7ECF;&#x5230; <code>4.4</code> &#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x5347;&#x7EA7;&#x5185;&#x6838;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install -y --install-recommends linux-generic-lts-xenial</div></pre></td></tr></table></figure>
<h2 id="ru-he-dong-tai-xiu-gai-nei-cun-xian-zhi"><a href="#&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F;"></a>&#x5982;&#x4F55;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x5185;&#x5B58;&#x9650;&#x5236;&#xFF1F; <a href="#ru-he-dong-tai-xiu-gai-nei-cun-xian-zhi" class="header-anchor">#</a></h2><p><code>Docker 1.10</code> &#x4E4B;&#x540E;&#x652F;&#x6301;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#xFF0C;&#x4F7F;&#x7528; <code>docker update</code> &#x547D;&#x4EE4;&#xFF0C;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker update -m 300m</div></pre></td></tr></table></figure>
<h2 id="jing-chang-zai-ge-chong-docker-ming-ling-li-kan-dao-label-label-shi-shi-me-gan-shi-me-yong-de"><a href="#&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD;-Docker-&#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230;-label&#xFF0C;label-&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F;" class="headerlink" title="&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD; Docker &#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230; --label&#xFF0C;label &#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F;"></a>&#x7ECF;&#x5E38;&#x5728;&#x5404;&#x79CD; <code>Docker</code> &#x547D;&#x4EE4;&#x91CC;&#x770B;&#x5230; <code>--label</code>&#xFF0C;<code>label</code> &#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5E72;&#x4EC0;&#x4E48;&#x7528;&#x7684;&#xFF1F; <a href="#jing-chang-zai-ge-chong-docker-ming-ling-li-kan-dao-label-label-shi-shi-me-gan-shi-me-yong-de" class="header-anchor">#</a></h2><p><code>Label</code> &#x662F;<code>&#x952E;&#x503C;&#x5BF9;</code>&#xFF0C;&#x662F; <code>metadata</code>&#xFF0C;&#x662F;&#x8D2F;&#x7A7F;&#x4E8E; <code>Docker</code> &#x5404;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#xFF0C;&#x5305;&#x62EC;&#x5F15;&#x64CE;&#x3001;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x3001;&#x5377;&#x3001;&#x7F51;&#x7EDC;&#x3001;Swarm &#x8282;&#x70B9;&#x3001;&#x670D;&#x52A1;&#x7B49;&#x3002;</p>
<ul>
<li>&#x952E; <code>key</code>&#xFF1A;&#x683C;&#x5F0F;&#x8981;&#x6C42;&#x53EA;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5B57;&#x6BCD;&#x548C;&#x6570;&#x5B57;&#xFF0C;&#x4EE5;&#x53CA;<code>.</code>&#xFF0C;<code>-</code>&#x3002;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E; <code>Java</code> &#x90A3;&#x79CD;&#x53CD;&#x5411;&#x57DF;&#x540D;&#x683C;&#x5F0F;&#xFF0C;&#x5982; <code>com.example.mytag</code>&#x3002;</li>
<li>&#x503C; <code>value</code>&#xFF1A;&#x683C;&#x5F0F;&#x5FC5;&#x987B;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x9664;&#x4E86;&#x666E;&#x901A;&#x5B57;&#x7B26;&#x4E32;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x662F; <code>JSON</code>, <code>XML</code>, <code>CSV</code> &#x6216;&#x8005; <code>YAML</code>&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x3002;</li>
</ul>
<p>&#x5F53;&#x8D44;&#x6E90;&#x5F88;&#x5C11;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5BF9;&#x4E00;&#x4E2A;&#x4E2A;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5728;&#x7BA1;&#x7406;&#x5F88;&#x591A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E48;&#x505A;&#x5C31;&#x53D8;&#x5F97;&#x4E0D;&#x5927;&#x73B0;&#x5B9E;&#x3002;&#x7ECF;&#x5E38;&#x7684;&#x9700;&#x6C42;&#x662F;&#x9488;&#x5BF9;&#x67D0;&#x4E00;&#x7C7B;&#x7684;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x4F7F;&#x7528; <code>label</code> &#x6765;&#x5E2E;&#x52A9;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x5F53;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x8FD9;&#x4E2A;&#x8D44;&#x6E90;&#x7684; <code>label</code>&#xFF08;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;&#x4E2A; <code>label</code>&#xFF09;&#xFF0C;&#x800C;&#x5F53;&#x521B;&#x5EFA;&#x4E86;&#x5F88;&#x591A;&#x4E2A;&#x8D44;&#x6E90;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FC7;&#x6EE4; <code>label</code> &#x7684;&#x952E;&#x3001;&#x503C;&#x6765;&#x5F97;&#x5230;&#x6240;&#x9700;&#x7684;&#x8D44;&#x6E90;&#x5217;&#x8868;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker run</code> &#x8FD0;&#x884C;&#x4E00;&#x5806;&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x901A;&#x8FC7; <code>label</code> &#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x662F;&#x67B6;&#x6784;&#x4E2D;&#x7684;&#x54EA;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<ul>
<li>&#x524D;&#x7AEF;&#xFF1A;<code>--label type=frontend</code></li>
<li>&#x4E2D;&#x95F4;&#x4EF6;&#xFF1A;<code>--label type=middleware</code></li>
<li>&#x5B58;&#x50A8;&#xFF1A;<code>--label type=storage</code></li>
</ul>
<p>&#x5728;&#x540E;&#x671F;&#x7EF4;&#x62A4;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FC7;&#x6EE4;&#x663E;&#x793A;&#x60F3;&#x8981;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x53EA;&#x60F3;&#x770B;&#x524D;&#x7AEF;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x60C5;&#x51B5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker ps --filter label=<span class="built_in">type</span>=frontend</div></pre></td></tr></table></figure>
<p>&#x800C;&#x4E14;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x548C;&#x5176;&#x5B83;&#x547D;&#x4EE4;&#x914D;&#x5408;&#x64CD;&#x4F5C;&#x8FD9;&#x7EC4;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505C;&#x6B62;&#x6240;&#x6709;&#x524D;&#x7AEF;&#x5BB9;&#x5668;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker stop $(docker ps <span class="_">-f</span> label=<span class="built_in">type</span>=frontend)</div></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528; <code>label</code> &#x5728;&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x4E2D;&#x4E5F;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x540C;&#x7684; Docker &#x4E3B;&#x673A;&#x7684;&#x5F15;&#x64CE; <code>dockerd</code> &#x53C2;&#x6570;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7; <code>label</code> &#x6765;&#x52A0;&#x5165;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#xFF1A;</p>
<ul>
<li>&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4E3A; <code>SSD</code>&#xFF1A;<code>--label storage=ssd</code></li>
<li>&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x4E3A; <code>HDD</code>&#xFF1A;<code>--label storage=hdd</code></li>
</ul>
<p>&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x5E0C;&#x671B;&#x8DD1;&#x5728; <code>SSD</code> &#x4E0A;&#x4EE5;&#x83B7;&#x5F97;&#x66F4;&#x5927;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x800C;&#x65E5;&#x5FD7;&#x3001;&#x5907;&#x4EFD;&#x670D;&#x52A1;&#x5219;&#x5E0C;&#x671B;&#x8DD1;&#x5728; <code>HDD</code> &#x4E0A;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x5BB9;&#x91CF;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x505A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --name mysql \</div><div class="line">    --constraint <span class="string">&apos;engine.labels.storage == ssd&apos;</span> \</div><div class="line">    mysql</div></pre></td></tr></table></figure>
<h3 id="tian-jia-label-yi-ji-guo-lu"><a href="#&#x6DFB;&#x52A0;label&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4;" class="headerlink" title="&#x6DFB;&#x52A0;label&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4;"></a>&#x6DFB;&#x52A0;<code>label</code>&#x4EE5;&#x53CA;&#x8FC7;&#x6EE4; <a href="#tian-jia-label-yi-ji-guo-lu" class="header-anchor">#</a></h3><p>&#x6DFB;&#x52A0; <code>label</code> &#x5927;&#x591A;&#x683C;&#x5F0F;&#x90FD;&#x662F;&#x5728;&#x521B;&#x5EFA;&#x3001;&#x4FEE;&#x6539;&#x8D44;&#x6E90;&#x65F6;&#xFF0C;&#x4F7F;&#x7528; <code>--label &lt;key&gt;=&lt;value&gt;</code> &#x53C2;&#x6570;&#xFF08;&#x90E8;&#x5206;&#x547D;&#x4EE4;&#x63D0;&#x4F9B;&#x4E86; <code>-l</code> &#x7F29;&#x5199;&#x5F62;&#x5F0F;&#xFF09;&#x3002;<code>value</code> &#x53EF;&#x4EE5;&#x7701;&#x7565;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A; <code>--label &lt;key&gt;</code>&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x591A;&#x7EC4; <code>label</code>&#xFF0C;&#x53EA;&#x9700;&#x591A;&#x7EC4; <code>--label</code> &#x5373;&#x53EF;&#x3002;</p>
<p>&#x8FC7;&#x6EE4; <code>label</code> &#x5219;&#x5927;&#x591A;&#x53D1;&#x751F;&#x5728;&#x5217;&#x8868;&#x547D;&#x4EE4;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>--filter label=&lt;key&gt;=&lt;value&gt;</code>&#xFF0C;&#x6216;&#x8005;&#x5BF9;&#x4E8E;&#x4E0D;&#x5173;&#x5FC3; <code>value</code> &#x7684;&#x60C5;&#x51B5;&#xFF0C;<code>--filter label=&lt;key&gt;</code>&#xFF08;&#x90E8;&#x5206;&#x547D;&#x4EE4;&#x63D0;&#x4F9B;&#x4E86; <code>-f</code> &#x7684;&#x7F29;&#x5199;&#x5F62;&#x5F0F;&#xFF09;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x5217;&#x51FA;&#x4E86;&#x652F;&#x6301; <code>label</code> &#x7684;&#x547D;&#x4EE4;&#xFF08;&#x9664;&#x975E;&#x7279;&#x6B8A;&#x58F0;&#x660E;&#xFF0C;&#x201D;&#x6DFB;&#x52A0;&#x201D;&#x547D;&#x4EE4;&#x4F7F;&#x7528; <code>--label</code> &#x9009;&#x9879;&#x6DFB;&#x52A0; <code>label</code>&#xFF1B;&#x201D;&#x8FC7;&#x6EE4;&#x201D;&#x547D;&#x4EE4;&#x4F7F;&#x7528; <code>--filter</code> &#x8FC7;&#x6EE4;<code>label</code>&#xFF09;&#xFF1A;</p>
<ul>
<li>Docker &#x5F15;&#x64CE;<ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>dockerd</code>&#xFF1A; <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/dockerd/</a></li>
</ul>
</li>
<li>&#x955C;&#x50CF;<ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<ul>
<li><code>docker build</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/build/</a></li>
<li><code>Dockerfile</code> &#x4E2D;&#x7684; <code>LABEL</code>&#xFF08;&#x4F1A;&#x7EE7;&#x627F;<code>FROM</code>&#x955C;&#x50CF;&#x7684;<code>LABEL</code>&#xFF09;&#xFF1A;<a href="https://docs.docker.com/engine/reference/builder/#/label" target="_blank" rel="external">https://docs.docker.com/engine/reference/builder/#/label</a></li>
</ul>
</li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker images</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/images/#/filtering" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/images/#/filtering</a></li>
</ul>
</li>
<li>&#x5BB9;&#x5668;<ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/create/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/create/</a><ul>
<li>&#x9664;&#x4E86; <code>--label</code> &#x5916;&#xFF0C;<code>docker create</code> &#x8FD8;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x9009;&#x9879; <code>--label-file</code> &#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D; <code>label</code></li>
</ul>
</li>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker run</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/run/#/set-metadata-on-container--l---label---label-file" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/run/#/set-metadata-on-container--l---label---label-file</a><ul>
<li>&#x9664;&#x4E86; <code>--label</code> &#x5916;&#xFF0C;<code>docker run</code> &#x8FD8;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x9009;&#x9879; <code>--label-file</code> &#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x52A0;&#x8F7D; <code>label</code></li>
</ul>
</li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker ps</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/ps/#/label" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/ps/#/label</a></li>
</ul>
</li>
<li>&#x5377;<ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker volume create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/volume_create/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/volume_create/</a></li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker volume ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/volume_ls/#/filtering" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/volume_ls/#/filtering</a></li>
</ul>
</li>
<li>&#x7F51;&#x7EDC;<ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker network create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/network_create/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/network_create/</a></li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker network ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/network_ls/#/filtering" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/network_ls/#/filtering</a></li>
</ul>
</li>
<li>Swarm &#x8282;&#x70B9;<ul>
<li><code>docker node update</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/node_update/#/add-label-metadata-to-a-node" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/node_update/#/add-label-metadata-to-a-node</a><ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>--label-add</code></li>
<li>&#x5220;&#x9664;&#xFF1A;<code>--label-rm</code></li>
</ul>
</li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker node ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/node_ls/#/filtering" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/node_ls/#/filtering</a></li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker node ps</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/node_ps/#/label" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/node_ps/#/label</a></li>
</ul>
</li>
<li>&#x670D;&#x52A1;<ul>
<li>&#x6DFB;&#x52A0;&#xFF1A;<code>docker service create</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/set-metadata-on-a-service--l---label" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/service_create/#/set-metadata-on-a-service--l---label</a><ul>
<li>&#x9664;&#x4E86; <code>--label</code> &#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--container-label</code> &#x6765;&#x6DFB;&#x52A0;&#x5BB9;&#x5668; <code>label</code></li>
</ul>
</li>
<li><code>docker service update</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_update/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/service_update/</a><ul>
<li>&#x6DFB;&#x52A0;&#x5BB9;&#x5668; <code>label</code>&#xFF1A;<code>--container-label-add</code></li>
<li>&#x5220;&#x9664;&#x5BB9;&#x5668; <code>label</code>&#xFF1A;<code>--container-label-rm</code></li>
<li>&#x6DFB;&#x52A0;&#x670D;&#x52A1; <code>label</code>&#xFF1A;<code>--label-add</code></li>
<li>&#x5220;&#x9664;&#x670D;&#x52A1; <code>label</code>&#xFF1A;<code>--label-rm</code></li>
</ul>
</li>
<li>&#x8FC7;&#x6EE4;&#xFF1A;<code>docker service ls</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_ls/#/label" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/service_ls/#/label</a></li>
</ul>
</li>
</ul>
<p>&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x8D44;&#x6E90;&#x5916;&#xFF0C;<code>docker events</code> &#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>label</code> &#x8FC7;&#x6EE4;&#x7ED3;&#x679C;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/events/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/events/</a></p>
<h3 id="ji-qun-diao-du-yue-shu"><a href="#&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F;" class="headerlink" title="&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F;"></a>&#x96C6;&#x7FA4;&#x8C03;&#x5EA6;&#x7EA6;&#x675F; <a href="#ji-qun-diao-du-yue-shu" class="header-anchor">#</a></h3><ul>
<li>&#x4E00;&#x4EE3; Swarm&#xFF1A;&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6DFB;&#x52A0;&#x7EA6;&#x675F;<ul>
<li><code>docker run</code>&#xFF1A;<code>-e constraint:storage==sdd</code>&#xFF1A;<a href="https://docs.docker.com/swarm/scheduler/filter/#/how-to-write-filter-expressions" target="_blank" rel="external">https://docs.docker.com/swarm/scheduler/filter/#/how-to-write-filter-expressions</a></li>
<li><code>docker-compose.yml</code>&#xFF1A;&#x4F7F;&#x7528; <code>environment</code> &#x6765;&#x8FDB;&#x884C;&#x7EA6;&#x675F;&#xFF1A;<a href="https://docs.docker.com/compose/swarm/#/manual-scheduling" target="_blank" rel="external">https://docs.docker.com/compose/swarm/#/manual-scheduling</a></li>
</ul>
</li>
</ul>
<p>&#x5982;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">    redis:</span></div><div class="line"><span class="attr">        image:</span> redis</div><div class="line"><span class="attr">        environment:</span></div><div class="line"><span class="bullet">            -</span> <span class="string">&quot;constraint:storage==ssd&quot;</span></div></pre></td></tr></table></figure>
<ul>
<li>&#x4E8C;&#x4EE3; Swarm<ul>
<li><code>docker service create</code>&#xFF1A;<code>--constraint value</code>&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/specify-service-constraints---constraint" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/service_create/#/specify-service-constraints---constraint</a></li>
</ul>
</li>
</ul>
<p>&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>Swarm &#x8282;&#x70B9;</code> &#x7684; <code>label</code> &#x8FDB;&#x884C;&#x7EA6;&#x675F;&#xFF08;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x6B21;&#x7528;&#x7684;&#x4E0D;&#x662F;<code>&#x5F15;&#x64CE;</code>&#x7684;<code>label</code>&#xFF09;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --name web \</div><div class="line">    --constraint <span class="string">&apos;node.labels.type == frontend&apos;</span> \</div><div class="line">    nginx</div></pre></td></tr></table></figure>
<h1 id="dockerfile-xiang-guan-wen-ti"><a href="#Dockerfile-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Dockerfile &#x76F8;&#x5173;&#x95EE;&#x9898;"></a><code>Dockerfile</code> &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#dockerfile-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="docker-commit-zen-me-yong-a"><a href="#docker-commit-&#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F;" class="headerlink" title="docker commit &#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F;"></a><code>docker commit</code> &#x600E;&#x4E48;&#x7528;&#x554A;&#xFF1F; <a href="#docker-commit-zen-me-yong-a" class="header-anchor">#</a></h2><p>&#x7B80;&#x5355;&#x7684;&#x56DE;&#x7B54;&#x5C31;&#x662F;&#xFF0C;&#x4E0D;&#x8981;&#x7528; <code>commit</code>&#xFF0C;&#x53BB;&#x5199; <code>Dockerfile</code>&#x3002;</p>
<p>Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x3002;&#x8FD9;&#x53E5;&#x8BDD;&#x8981;&#x5728;&#x5B66;&#x4E60; Docker &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x53CD;&#x590D;&#x63D0;&#x9192;&#x81EA;&#x5DF1;&#x3002;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x628A;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x6982;&#x5FF5;&#x5E26;&#x8FC7;&#x6765;&#x3002;</p>
<p>Docker &#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x597D;&#x7684; <code>Dockerfile</code> &#x7684;&#x673A;&#x5236;&#x6765;&#x5E2E;&#x52A9;&#x5B9A;&#x5236;&#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; Shell &#x547D;&#x4EE4;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x8FD9;&#x6837;&#x5236;&#x4F5C;&#x7684;&#x955C;&#x50CF;&#x66F4;&#x52A0;&#x900F;&#x660E;&#xFF0C;&#x4E5F;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#xFF0C;&#x5728;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x5347;&#x7EA7;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x7684;&#x5B89;&#x5168;&#x7EF4;&#x62A4;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x4F7F;&#x7528; <code>docker commit</code> &#x5236;&#x4F5C;&#x7684;&#x955C;&#x50CF;&#x88AB;&#x79F0;&#x4E3A;<code>&#x9ED1;&#x7BB1;&#x955C;&#x50CF;</code>&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x91CC;&#x9762;&#x8FDB;&#x884C;&#x7684;&#x662F;&#x9ED1;&#x7BB1;&#x64CD;&#x4F5C;&#xFF0C;&#x9664;&#x672C;&#x4EBA;&#x5916;&#x65E0;&#x4EBA;&#x77E5;&#x6653;&#x3002;&#x5373;&#x4F7F;&#x8FD9;&#x4E2A;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x7684;&#x4EBA;&#xFF0C;&#x8FC7;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#x4E5F;&#x4E0D;&#x4F1A;&#x5B8C;&#x6574;&#x7684;&#x8BB0;&#x8D77;&#x91CC;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x90A3;&#x4E48;&#x5F53;&#x6709;&#x4E9B;&#x4E1C;&#x897F;&#x9700;&#x8981;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x6216;&#x8005;&#x56E0;&#x57FA;&#x7840;&#x955C;&#x50CF;&#x66F4;&#x65B0;&#x800C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x4F1A;&#x8BA9;&#x4E00;&#x5207;&#x53D8;&#x5F97;&#x5F02;&#x5E38;&#x56F0;&#x96BE;&#xFF0C;&#x5C31;&#x5982;&#x540C;&#x91CD;&#x65B0;&#x5B89;&#x88C5;&#x8C03;&#x8BD5;&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x5668;&#x4E00;&#x6837;&#xFF0C;&#x5931;&#x53BB;&#x4E86; Docker &#x7684;&#x4F18;&#x52BF;&#x4E86;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;Docker &#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5176;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F; Union FS&#xFF0C;&#x5206;&#x5C42;&#x5F0F;&#x5B58;&#x50A8;&#xFF0C;&#x6BCF;&#x4E00;&#x6B21; <code>commit</code> &#x90FD;&#x4F1A;&#x5EFA;&#x7ACB;&#x4E00;&#x5C42;&#xFF0C;&#x4E0A;&#x4E00;&#x5C42;&#x7684;&#x6587;&#x4EF6;&#x5E76;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A; <code>rm</code> &#x800C;&#x5220;&#x9664;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x5F53;&#x524D;&#x5C42;&#x6807;&#x8BB0;&#x4E3A;&#x5220;&#x9664;&#x800C;&#x770B;&#x4E0D;&#x5230;&#x4E86;&#x800C;&#x5DF2;&#xFF0C;&#x6BCF;&#x6B21; <code>docker pull</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90A3;&#x4E9B;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x4F1A;&#x5982;&#x5F71;&#x968F;&#x5F62;&#xFF0C;&#x6240;&#x5F97;&#x5230;&#x7684;&#x955C;&#x50CF;&#x4E5F;&#x5FC5;&#x7136;&#x81C3;&#x80BF;&#x4E0D;&#x582A;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x968F;&#x7740;&#x6587;&#x4EF6;&#x5C42;&#x6570;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x955C;&#x50CF;&#x66F4;&#x81C3;&#x80BF;&#xFF0C;&#x5176;&#x8FD0;&#x884C;&#x65F6;&#x6027;&#x80FD;&#x4E5F;&#x5FC5;&#x7136;&#x4F1A;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#x3002;&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x8FDD;&#x80CC;&#x4E86; Docker &#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x3002;</p>
<p>&#x4F7F;&#x7528; <code>commit</code> &#x7684;&#x573A;&#x5408;&#x662F;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x73AF;&#x5883;&#xFF0C;&#x6BD4;&#x5982;&#x5165;&#x4FB5;&#x540E;&#x4FDD;&#x5B58;&#x73B0;&#x573A;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x4E0D;&#x5E94;&#x8BE5;&#x6210;&#x4E3A;&#x5B9A;&#x5236;&#x955C;&#x50CF;&#x7684;&#x6807;&#x51C6;&#x505A;&#x6CD5;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8BF7;&#x7528; <code>Dockerfile</code> &#x5B9A;&#x5236;&#x955C;&#x50CF;&#x3002;</p>
<h2 id="dockerfile-zen-me-xie"><a href="#Dockerfile-&#x600E;&#x4E48;&#x5199;&#xFF1F;" class="headerlink" title="Dockerfile &#x600E;&#x4E48;&#x5199;&#xFF1F;"></a><code>Dockerfile</code> &#x600E;&#x4E48;&#x5199;&#xFF1F; <a href="#dockerfile-zen-me-xie" class="header-anchor">#</a></h2><p>&#x6700;&#x76F4;&#x63A5;&#x4E5F;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x770B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x3002;</p>
<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x8BB2;&#x8FF0;&#x5177;&#x4F53;<code>Dockerfile</code>&#x7684;&#x547D;&#x4EE4;&#x8BED;&#x6CD5;&#xFF1A;<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="external">https://docs.docker.com/engine/reference/builder/</a></p>
<p>&#x7136;&#x540E;&#xFF0C;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#x5B98;&#x65B9;&#x7684;<code>Dockerfile</code>&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="external">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></p>
<p>&#x6700;&#x540E;&#xFF0C;&#x53BB; Docker Hub &#x5B66;&#x4E60;&#x90A3;&#x4E9B;Official&#x7684;&#x955C;&#x50CF;<code>Dockerfile</code>&#x548B;&#x5199;&#x7684;&#x3002;</p>
<h2 id="dockerfile-jiu-shi-shell-jiao-ben-ba-na-wo-dong-yi-xing-xing-ba-xu-yao-zhuang-de-dong-xi-du-xie-jin-qu-bu-jiu-xing-liao"><a href="#Dockerfile-&#x5C31;&#x662F;-shell-&#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002;" class="headerlink" title="Dockerfile &#x5C31;&#x662F; shell &#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002;"></a><code>Dockerfile</code> &#x5C31;&#x662F; shell &#x811A;&#x672C;&#x5427;&#xFF1F;&#x90A3;&#x6211;&#x61C2;&#xFF0C;&#x4E00;&#x884C;&#x884C;&#x628A;&#x9700;&#x8981;&#x88C5;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5199;&#x8FDB;&#x53BB;&#x4E0D;&#x5C31;&#x884C;&#x4E86;&#x3002; <a href="#dockerfile-jiu-shi-shell-jiao-ben-ba-na-wo-dong-yi-xing-xing-ba-xu-yao-zhuang-de-dong-xi-du-xie-jin-qu-bu-jiu-xing-liao" class="header-anchor">#</a></h2><p>&#x4E0D;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x3002;<code>Dockerfile</code> &#x4E0D;&#x7B49;&#x4E8E; <code>.sh</code> &#x811A;&#x672C;</p>
<p><code>Dockerfile</code> &#x786E;&#x5B9E;&#x662F;&#x63CF;&#x8FF0;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86; <code>RUN</code> &#x8FD9;&#x6837;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD0;&#x884C; shell &#x547D;&#x4EE4;&#x3002;&#x4F46;&#x662F;&#x548C;&#x666E;&#x901A; shell &#x811A;&#x672C;&#x8FD8;&#x6709;&#x5F88;&#x5927;&#x7684;&#x4E0D;&#x540C;&#x3002;</p>
<p>Dockerfile &#x63CF;&#x8FF0;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x955C;&#x50CF;&#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x8981;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E00;&#x4E2A;<code>RUN</code>&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x4E00;&#x5C42;&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x5B9A;&#x8981;&#x7406;&#x89E3;&#x201C;&#x5206;&#x5C42;&#x5B58;&#x50A8;&#x201D;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x4E0A;&#x4E00;&#x5C42;&#x7684;&#x4E1C;&#x897F;&#x4E0D;&#x4F1A;&#x88AB;&#x7269;&#x7406;&#x5220;&#x9664;&#xFF0C;&#x800C;&#x662F;&#x4F1A;&#x4FDD;&#x7559;&#x7ED9;&#x4E0B;&#x4E00;&#x5C42;&#xFF0C;&#x4E0B;&#x4E00;&#x5C42;&#x4E2D;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5220;&#x9664;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x8FD9;&#x4E00;&#x5C42;&#x505A;&#x7684;&#x67D0;&#x4E2A;&#x6807;&#x8BB0;&#xFF0C;&#x8BF4;&#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x4E1C;&#x897F;&#x5220;&#x4E86;&#x3002;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x4F1A;&#x53BB;&#x4FEE;&#x6539;&#x4E0A;&#x4E00;&#x5C42;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BCF;&#x4E00;&#x5C42;&#x90FD;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x5BB9;&#x5668;&#x672C;&#x8EAB;&#x7684;<code>immutable</code>&#x7279;&#x6027;&#xFF0C;&#x8981;&#x4FDD;&#x6301;&#x81EA;&#x8EAB;&#x7684;&#x9759;&#x6001;&#x7279;&#x6027;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x65B0;&#x624B;&#x4F1A;&#x5E38;&#x72AF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x628A; <code>Dockerfile</code> &#x5F53;&#x505A; shell &#x811A;&#x672C;&#x6765;&#x5199;&#x4E86;&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RUN</span><span class="bash"> yum update</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install gcc</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install python</span></div><div class="line"><span class="keyword">ADD</span><span class="bash"> jdk-xxxx.tar.gz /tmp</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> xxxx &amp;&amp; install</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> xxx &amp;&amp; configure &amp;&amp; make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F;&#x76F8;&#x5F53;&#x9519;&#x8BEF;&#x7684;&#x3002;&#x9664;&#x4E86;&#x65E0;&#x754F;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x5F88;&#x591A;&#x5C42;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x591A;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x90FD;&#x88AB;&#x88C5;&#x8FDB;&#x4E86;&#x955C;&#x50CF;&#x91CC;&#xFF0C;&#x6BD4;&#x5982;&#x7F16;&#x8BD1;&#x73AF;&#x5883;&#x3001;&#x66F4;&#x65B0;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#x7B49;&#x7B49;&#x3002;&#x7ED3;&#x679C;&#x5C31;&#x662F;&#x4EA7;&#x751F;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x3001;&#x975E;&#x5E38;&#x591A;&#x5C42;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x4E0D;&#x4EC5;&#x4EC5;&#x589E;&#x52A0;&#x4E86;&#x6784;&#x5EFA;&#x90E8;&#x7F72;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x5F88;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;</p>
<p>&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#x5E94;&#x8BE5;&#x662F;&#x628A;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x653E;&#x5230;&#x4E00;&#x4E2A; <code>RUN</code> &#x4E0B;&#xFF0C;&#x591A;&#x6761;&#x547D;&#x4EE4;&#x5E94;&#x8BE5;&#x7528; <code>&amp;&amp;</code> &#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x6700;&#x540E;&#x8981;&#x6253;&#x626B;&#x5E72;&#x51C0;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x73AF;&#x5883;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x6458;&#x81EA;&#x5B98;&#x65B9; redis &#x955C;&#x50CF; <code>Dockerfile</code> &#x7684;&#x90E8;&#x5206;&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RUN</span><span class="bash"> buildDeps=<span class="string">&apos;gcc libc6-dev make&apos;</span> \</span></div><div class="line">    &amp;&amp; <span class="built_in">set</span> -x \</div><div class="line">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y <span class="variable">$buildDeps</span> --no-install-recommends \</div><div class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</div><div class="line">    &amp;&amp; wget -O redis.tar.gz <span class="string">&quot;<span class="variable">$REDIS_DOWNLOAD_URL</span>&quot;</span> \</div><div class="line">    &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$REDIS_DOWNLOAD_SHA1</span> *redis.tar.gz&quot;</span> | sha1sum -c - \</div><div class="line">    &amp;&amp; mkdir -p /usr/src/redis \</div><div class="line">    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</div><div class="line">    &amp;&amp; rm redis.tar.gz \</div><div class="line">    &amp;&amp; make -C /usr/src/redis \</div><div class="line">    &amp;&amp; make -C /usr/src/redis install \</div><div class="line">    &amp;&amp; rm -r /usr/src/redis \</div><div class="line">    &amp;&amp; apt-get purge -y --auto-remove <span class="variable">$buildDeps</span></div></pre></td></tr></table></figure>
<h2 id="context-dao-di-shi-yi-ge-shi-me-gai-nian"><a href="#context-&#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F;" class="headerlink" title="context &#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F;"></a><code>context</code> &#x5230;&#x5E95;&#x662F;&#x4E00;&#x4E2A;&#x4EC0;&#x4E48;&#x6982;&#x5FF5;&#xFF1F; <a href="#context-dao-di-shi-yi-ge-shi-me-gai-nian" class="header-anchor">#</a></h2><p><code>context</code>&#xFF0C;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x662F; <code>docker build</code> &#x4E2D;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x3002;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x5FC5;&#x987B;&#x6307;&#x5B9A; <code>context</code>&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t xxx &lt;context&#x8DEF;&#x5F84;&gt;</div></pre></td></tr></table></figure>
<p>&#x6216;&#x8005; <code>docker-compose.yml</code> &#x4E2D;&#x7684;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attr">app:</span></div><div class="line"><span class="attr">    build:</span></div><div class="line"><span class="attr">        context:</span> &lt;context&#x8DEF;&#x5F84;<span class="string">&gt;</span></div><div class="line"><span class="attr">        dockerfile:</span> dockerfile</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x90FD;&#x9700;&#x8981;&#x6307;&#x5B9A; <code>context</code>&#x3002;</p>
<p><code>context</code> &#x662F;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x4E0D;&#x8981;&#x548C;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x7684;<code>Dockerfile</code> &#x4E2D;&#x7684; <code>WORKDIR</code> &#x5F04;&#x6DF7;&#xFF0C;<code>context</code> &#x662F; <code>docker build</code> &#x547D;&#x4EE4;&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x3002;</p>
<p><code>docker build</code> &#x547D;&#x4EE4;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x771F;&#x6B63;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x5E76;&#x975E;&#x7531;&#x8BE5;&#x547D;&#x4EE4;&#x76F4;&#x63A5;&#x5B8C;&#x6210;&#x3002;<code>docker build</code> &#x547D;&#x4EE4;&#x5C06; <code>context</code> &#x7684;&#x76EE;&#x5F55;&#x4E0A;&#x4F20;&#x7ED9; <code>docker daemon</code>&#xFF0C;&#x7531;&#x5B83;&#x8D1F;&#x8D23;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x3002;</p>
<p>&#x5728; Dockerfile &#x4E2D;&#x5982;&#x679C;&#x5199; <code>COPY ./package.json /app/</code> &#x8FD9;&#x79CD;&#x547D;&#x4EE4;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x610F;&#x601D;&#x5E76;&#x4E0D;&#x662F;&#x6307;&#x6267;&#x884C; <code>docker build</code> &#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>package.json</code>&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x6307; <code>Dockerfile</code> &#x6240;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>package.json</code>&#xFF0C;&#x800C;&#x662F;&#x6307; <code>context</code> &#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>package.json</code>&#x3002;</p>
<p>&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x4EBA;&#x53D1;&#x73B0; <code>COPY ../package.json /app</code> &#x6216;&#x8005; <code>COPY /opt/xxxx /app</code> &#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x90FD;&#x5728; <code>context</code> &#x4E4B;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x771F;&#x6B63;&#x9700;&#x8981;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x5B83;&#x4EEC;&#x590D;&#x5236;&#x5230; <code>context</code> &#x76EE;&#x5F55;&#x4E0B;&#x518D;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>docker build -t xxx .</code> &#x4E2D;&#x7684;&#x8FD9;&#x4E2A;<code>.</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5728;&#x6307;&#x5B9A; <code>Context</code> &#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x5E76;&#x975E;&#x662F;&#x6307;&#x5B9A; <code>Dockerfile</code> &#x6240;&#x5728;&#x76EE;&#x5F55;&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x989D;&#x5916;&#x6307;&#x5B9A; <code>Dockerfile</code> &#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x5C06; <code>Context</code> &#x4E0B;&#x7684;&#x540D;&#x4E3A; <code>Dockerfile</code> &#x7684;&#x6587;&#x4EF6;&#x4F5C;&#x4E3A; <code>Dockerfile</code>&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x591A;&#x4EBA;&#x4F1A;&#x6DF7;&#x6DC6;&#xFF0C;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E2A; <code>.</code> &#x662F;&#x5728;&#x8BF4; <code>Dockerfile</code> &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x7136;&#x3002;</p>
<h2 id="entrypoint-he-cmd-dao-di-you-shi-me-bu-tong"><a href="#ENTRYPOINT-&#x548C;-CMD-&#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;" class="headerlink" title="ENTRYPOINT &#x548C; CMD &#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;"></a><code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x5230;&#x5E95;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F; <a href="#entrypoint-he-cmd-dao-di-you-shi-me-bu-tong" class="header-anchor">#</a></h2><p><code>Dockerfile</code> &#x7684;&#x76EE;&#x7684;&#x662F;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x51C6;&#x5907;&#x7684;&#x662F;&#x4E3B;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3002;&#x90A3;&#x4E48;&#x51C6;&#x5907;&#x597D;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x624D;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x4E3B;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x542F;&#x52A8;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x8C03;&#x7528; <code>ENTRYPOINT</code>&#xFF0C;&#x5E76;&#x4E14;&#x628A; <code>CMD</code> &#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x8FDB;&#x53BB;&#x8FD0;&#x884C;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x7684;&#x6982;&#x5FF5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ENTRYPOINT <span class="string">&quot;CMD&quot;</span></div></pre></td></tr></table></figure>
<p>&#x5047;&#x8BBE;&#x6709;&#x4E2A; <code>myubuntu</code> &#x955C;&#x50CF; <code>ENTRYPOINT</code> &#x662F; <code>sh -c</code>&#xFF0C;&#x800C;&#x6211;&#x4EEC; <code>docker run -it myubuntu uname -a</code>&#x3002;&#x90A3;&#x4E48; <code>uname -a</code> &#x5C31;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x6307;&#x5B9A;&#x7684; <code>CMD</code>&#xFF0C;&#x90A3;&#x4E48; Docker &#x5B9E;&#x9645;&#x8FD0;&#x884C;&#x7684;&#x5C31;&#x662F;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sh -c <span class="string">&quot;uname -a&quot;</span></div></pre></td></tr></table></figure>
<ul>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>ENTRYPOINT</code>&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EA;&#x6267;&#x884C; <code>CMD</code>&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86; <code>ENTRYPOINT</code> &#x800C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>CMD</code>&#xFF0C;&#x81EA;&#x7136;&#x6267;&#x884C; <code>ENTRYPOINT</code>;</li>
<li>&#x5982;&#x679C; <code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x90FD;&#x6307;&#x5B9A;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5982;&#x540C;&#x4E0A;&#x9762;&#x6240;&#x8FF0;&#xFF0C;&#x6267;&#x884C; <code>ENTRYPOINT &quot;CMD&quot;</code>&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>ENTRYPOINT</code>&#xFF0C;&#x800C; <code>CMD</code> &#x7528;&#x7684;&#x662F;&#x4E0A;&#x8FF0;&#x90A3;&#x79CD; shell &#x547D;&#x4EE4;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x5219;&#x81EA;&#x52A8;&#x4F7F;&#x7528; <code>sh -c</code> &#x4F5C;&#x4E3A; <code>ENTRYPOINT</code>&#x3002;</li>
</ul>
<p>&#x6CE8;&#x610F;&#x6700;&#x540E;&#x4E00;&#x70B9;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x8FD9;&#x4E2A;&#x533A;&#x522B;&#x5BFC;&#x81F4;&#x4E86;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#x653E;&#x5230; <code>CMD</code> &#x548C; <code>ENTRYPOINT</code> &#x4E0B;&#x6548;&#x679C;&#x4E0D;&#x540C;&#xFF0C;&#x56E0;&#x6B64;&#x6709;&#x53EF;&#x80FD;&#x653E;&#x5728; <code>ENTRYPOINT</code> &#x4E0B;&#x7684;&#x540C;&#x6837;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x7531;&#x4E8E;&#x9700;&#x8981; <code>tty</code> &#x800C;&#x8FD0;&#x884C;&#x65F6;&#x5FD8;&#x8BB0;&#x4E86;&#x7ED9;&#xFF08;&#x6BD4;&#x5982;&#x5FD8;&#x8BB0;&#x4E86;<code>docker-compose.yml</code> &#x7684; <code>tty:true</code>&#xFF09;&#x5BFC;&#x81F4;&#x8FD0;&#x884C;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#x53EF;&#x4EE5;&#x5F88;&#x7075;&#x6D3B;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x505A;&#x4E2A; <code>git</code> &#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x628A; <code>git</code> &#x547D;&#x4EE4;&#x6307;&#x5B9A;&#x4E3A; <code>ENTRYPOINT</code>&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5728; <code>docker run</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76F4;&#x63A5;&#x8DDF;&#x5B50;&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x3002;&#x6BD4;&#x5982; <code>docker run git log</code> &#x5C31;&#x662F;&#x663E;&#x793A;&#x65E5;&#x5FD7;&#x3002;</p>
<h2 id="na-dao-yi-ge-jing-xiang-ru-he-huo-de-jing-xiang-de-dockerfile"><a href="#&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684;-Dockerfile-&#xFF1F;" class="headerlink" title="&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684; Dockerfile &#xFF1F;"></a>&#x62FF;&#x5230;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x4F55;&#x83B7;&#x5F97;&#x955C;&#x50CF;&#x7684; <code>Dockerfile</code> &#xFF1F; <a href="#na-dao-yi-ge-jing-xiang-ru-he-huo-de-jing-xiang-de-dockerfile" class="header-anchor">#</a></h2><ul>
<li>&#x76F4;&#x63A5;&#x53BB; Docker Hub &#x4E0A;&#x770B;&#xFF1A;&#x5927;&#x591A;&#x6570; Docker Hub &#x4E0A;&#x7684;&#x955C;&#x50CF;&#x90FD;&#x4F1A;&#x6709; <code>Dockerfile</code>&#xFF0C;&#x76F4;&#x63A5;&#x5728; Docker Hub &#x7684;&#x955C;&#x50CF;&#x9875;&#x9762;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>Dockerfile</code> &#x7684;&#x94FE;&#x63A5;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x662F;&#x81EA;&#x5DF1;&#x516C;&#x53F8;&#x505A;&#x7684;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x6253;&#x4E2A;&#x7535;&#x8BDD;&#x3001;&#x53D1;&#x4E2A;&#x6D88;&#x606F;&#x95EE;&#x4E00;&#x4E0B;&#x3002;&#x522B;&#x770B;&#x8FD9;&#x4E2A;&#x8BF4;&#x6CD5;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x50BB;&#xFF0C;&#x4E0D;&#x5C11;&#x4EBA;&#x90FD;&#x5B81;&#x53EF;&#x81EA;&#x5DF1;&#x7422;&#x78E8;&#x4E5F;&#x4E0D;&#x53BB;&#x95EE;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709; <code>Dockerfile</code>&#xFF0C;&#x4E00;&#x822C;&#x8FD9;&#x7C7B;&#x955C;&#x50CF;&#x5C31;&#x4E0D;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x8FD9;&#x7C7B;&#x9ED1;&#x7BB1;&#x4F3C;&#x7684;&#x955C;&#x50CF;&#x5F88;&#x5BB9;&#x6709;&#x6709;&#x95EE;&#x9898;&#x3002;&#x5982;&#x679C;&#x662F;&#x4EC0;&#x4E48;&#x7279;&#x6B8A;&#x539F;&#x56E0;&#xFF0C;&#x90A3;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x770B;&#xFF1B;</li>
<li><code>docker history</code> &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x955C;&#x50CF;&#x6BCF;&#x4E00;&#x5C42;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x547D;&#x4EE4;&#xFF0C;&#x5F53;&#x7136;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x7684; <code>commit</code> &#x770B;&#x4E0D;&#x89C1;&#x64CD;&#x4F5C;&#xFF1B;</li>
<li><code>docker inspect</code> &#x53EF;&#x4EE5;&#x5206;&#x6790;&#x955C;&#x50CF;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#x3002;</li>
<li>&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x955C;&#x50CF;&#xFF0C;&#x8FDB;&#x5165;<code>shell</code>&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x53BB;&#x8FDB;&#x4E00;&#x6B65;&#x5206;&#x6790;&#x65E5;&#x5FD7;&#x3001;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x53CA;&#x53D8;&#x5316;&#x3002;</li>
<li>&#x7ECF;&#x8FC7;&#x5206;&#x6790;&#x540E;&#xFF0C;&#x81EA;&#x5DF1;&#x5199; <code>Dockerfile</code> &#x8FD8;&#x539F;&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
<h2 id="zai-ni-de-lnmp-de-li-zi-zhong-php-de-dockerfile-li-mian-de-gou-jian-yi-lai-he-yun-xing-yi-lai-du-shi-shi-me-yi-si"><a href="#&#x5728;&#x4F60;&#x7684;-LNMP-&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP-&#x7684;-Dockerfile-&#x91CC;&#x9762;&#x7684;-&#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D;-&#x548C;-&#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D;-&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;" class="headerlink" title="&#x5728;&#x4F60;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP &#x7684; Dockerfile &#x91CC;&#x9762;&#x7684; &#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D; &#x548C; &#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D; &#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;"></a>&#x5728;&#x4F60;&#x7684; LNMP &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;PHP &#x7684; <code>Dockerfile</code> &#x91CC;&#x9762;&#x7684; &#x201C;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&#x201D; &#x548C; &#x201C;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&#x201D; &#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F; <a href="#zai-ni-de-lnmp-de-li-zi-zhong-php-de-dockerfile-li-mian-de-gou-jian-yi-lai-he-yun-xing-yi-lai-du-shi-shi-me-yi-si" class="header-anchor">#</a></h2><p>&#x8FD9;&#x91CC;&#x6240;&#x63D0;&#x5230;&#x7684;&#x662F;&#x6211;&#x7684;&#x90A3;&#x4E2A; LNMP &#x4F8B;&#x5B50;&#x7684; <code>php</code> &#x670D;&#x52A1;&#x7684; <code>Dockerfile</code>&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/php/Dockerfile" target="_blank" rel="external">https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/php/Dockerfile</a></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> php:<span class="number">7</span>-fpm</div><div class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></div><div class="line"><span class="comment"># &quot;&#x6784;&#x5EFA;&#x4F9D;&#x8D56;&quot;</span></div><div class="line">    &amp;&amp; buildDeps=<span class="string">&quot; \</span></div><div class="line">        build-essential \</div><div class="line">        php5-dev \</div><div class="line">        libfreetype6-dev \</div><div class="line">        libjpeg62-turbo-dev \</div><div class="line">        libmcrypt-dev \</div><div class="line">        libpng12-dev \</div><div class="line">    &quot; \</div><div class="line"><span class="comment"># &quot;&#x8FD0;&#x884C;&#x4F9D;&#x8D56;&quot;</span></div><div class="line">    &amp;&amp; runtimeDeps=<span class="string">&quot; \</span></div><div class="line">        libfreetype6 \</div><div class="line">        libjpeg62-turbo \</div><div class="line">        libmcrypt4 \</div><div class="line">        libpng12-0 \</div><div class="line">    &quot; \</div><div class="line"><span class="comment"># &quot;&#x5B89;&#x88C5; php &#x4EE5;&#x53CA;&#x7F16;&#x8BD1;&#x6784;&#x5EFA;&#x7EC4;&#x4EF6;&#x6240;&#x9700;&#x5305;&quot;</span></div><div class="line">    &amp;&amp; apt-get update \</div><div class="line">    &amp;&amp; apt-get install -y ${runtimeDeps} ${buildDeps} --no-install-recommends \</div><div class="line"><span class="comment"># &quot;&#x7F16;&#x8BD1;&#x5B89;&#x88C5; php &#x7EC4;&#x4EF6;&quot;</span></div><div class="line">    &amp;&amp; docker-php-ext-install iconv mcrypt mysqli pdo pdo_mysql zip \</div><div class="line">    &amp;&amp; docker-php-ext-configure gd \</div><div class="line">        --with-freetype-dir=/usr/include/ \</div><div class="line">        --with-jpeg-dir=/usr/include/ \</div><div class="line">    &amp;&amp; docker-php-ext-install gd \</div><div class="line"><span class="comment"># &quot;&#x6E05;&#x7406;&quot;</span></div><div class="line">    &amp;&amp; apt-get purge -y --auto-remove \</div><div class="line">        -o APT::AutoRemove::RecommendsImportant=false \</div><div class="line">        -o APT::AutoRemove::SuggestsImportant=false \</div><div class="line">        $buildDeps \</div><div class="line">    &amp;&amp; rm -rf /var/cache/apt/* \</div><div class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x662F;&#x9488;&#x5BF9; <code>php</code> &#x955C;&#x50CF;&#x8FDB;&#x884C;&#x5B9A;&#x5236;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B; <code>php:7-fpm</code> &#x4E2D;&#x6CA1;&#x6709;&#x5B89;&#x88C5;&#x6240;&#x9700;&#x7684; <code>mysqli</code>, <code>pdo_mysql</code>, <code>gd</code> &#x7B49;&#x7EC4;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x5B89;&#x88C5;&#xFF0C;&#x800C;&#x4E14;&#xFF0C;&#x90E8;&#x5206;&#x7EC4;&#x4EF6;&#x8FD8;&#x9700;&#x8981;&#x7F16;&#x8BD1;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x6D89;&#x53CA;&#x4E86;&#x4E24;&#x7C7B;&#x4F9D;&#x8D56;&#x5E93;/&#x5DE5;&#x5177;&#xFF0C;&#x4E00;&#x7C7B;&#x662F;&#x5B89;&#x88C5;&#x3001;&#x7F16;&#x8BD1;&#x9636;&#x6BB5;&#x6240;&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#xFF1B;&#x53E6;&#x4E00;&#x7C7B;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x6240;&#x9700;&#x7684;&#x4F9D;&#x8D56;&#x3002;&#x8981;&#x8BB0;&#x4F4F; <code>Dockerfile</code> &#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x4E2D;&#x8981;&#x6C42;&#x6700;&#x7EC8;&#x955C;&#x50CF;&#x53EA;&#x5E94;&#x8BE5;&#x4FDD;&#x7559;&#x6700;&#x5C0F;&#x7684;&#x6240;&#x9700;&#x4F9D;&#x8D56;&#xFF0C;&#x56E0;&#x6B64;&#x5B89;&#x88C5;&#x6784;&#x5EFA;&#x7684;&#x4F9D;&#x8D56;&#x5E94;&#x8BE5;&#x5728;&#x5B89;&#x88C5;&#x7ED3;&#x675F;&#x540E;&#x6E05;&#x9664;&#xFF0C;&#x8FD9;&#x4E00;&#x5C42;&#x53EA;&#x4FDD;&#x7559;&#x771F;&#x6B63;&#x9700;&#x8981;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x4F9D;&#x8D56;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x9075;&#x5FAA;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x8FD9;&#x91CC;&#x533A;&#x5206;&#x4E86; <code>buildDeps</code> &#x548C; <code>runtimeDeps</code> &#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5B89;&#x88C5;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x5378;&#x8F7D;&#x3001;&#x6E05;&#x7406; <code>buildDeps</code> &#x7684;&#x4F9D;&#x8D56;&#x3002;&#x8FD9;&#x6837;&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x65E0;&#x5173;&#x7684;&#x4E1C;&#x897F;&#x8FD8;&#x5728;&#x8BE5;&#x5C42;&#x4E2D;&#x3002;</p>
<h2 id="ying-yong-dai-ma-shi-ying-gai-gua-zai-su-zhu-mu-lu-huan-shi-fang-ru-jing-xiang-nei"><a href="#&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F;" class="headerlink" title="&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F;"></a>&#x5E94;&#x7528;&#x4EE3;&#x7801;&#x662F;&#x5E94;&#x8BE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x8FD8;&#x662F;&#x653E;&#x5165;&#x955C;&#x50CF;&#x5185;&#xFF1F; <a href="#ying-yong-dai-ma-shi-ying-gai-gua-zai-su-zhu-mu-lu-huan-shi-fang-ru-jing-xiang-nei" class="header-anchor">#</a></h2><p>&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4EE3;&#x7801;&#x53D8;&#x52A8;&#x975E;&#x5E38;&#x9891;&#x7E41;&#xFF0C;&#x6BD4;&#x5982;&#x5F00;&#x53D1;&#x9636;&#x6BB5;&#xFF0C;&#x4EE3;&#x7801;&#x51E0;&#x4E4E;&#x6BCF;&#x51E0;&#x5206;&#x949F;&#x5C31;&#x9700;&#x8981;&#x53D8;&#x52A8;&#x8C03;&#x8BD5;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--volume</code> &#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7684;&#x529E;&#x6CD5;&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x6784;&#x5EFA;&#x65B0;&#x955C;&#x50CF;&#xFF0C;&#x76F4;&#x63A5;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x52A0;&#x8F7D;&#x6700;&#x65B0;&#x4EE3;&#x7801;&#xFF0C;&#x751A;&#x81F3;&#x6709;&#x4E9B;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x4ECE;&#x800C;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x9891;&#x7E41;&#x53D8;&#x52A8;&#xFF0C;&#x6BD4;&#x5982;&#x53D1;&#x5E03;&#x9636;&#x6BB5;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x6784;&#x5EFA;&#x597D;&#x7684;&#x5E94;&#x7528;&#x653E;&#x5165;&#x955C;&#x50CF;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x662F;&#x4F7F;&#x7528; CI/CD &#x5DE5;&#x5177;&#xFF0C;&#x5982; <code>Jenkins</code>, <code>Drone.io</code>, <code>Gitlab CI</code> &#x7B49;&#xFF0C;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x3001;&#x5236;&#x4F5C;&#x955C;&#x50CF;&#x3001;&#x53D1;&#x5E03;&#x955C;&#x50CF;&#x3001;&#x4EE5;&#x53CA;&#x5206;&#x6B65;&#x53D1;&#x5E03;&#x4E0A;&#x7EBF;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E5F;&#x662F;&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x9891;&#x7E41;&#x53D8;&#x66F4;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#xFF0C;&#x6216;&#x8005;&#x52A8;&#x6001;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5377;&#x3002;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x5E76;&#x975E;&#x9891;&#x7E41;&#x53D8;&#x66F4;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E94;&#x8BE5;&#x5C06;&#x5176;&#x7EB3;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x4E2D;&#xFF0C;&#x8D70; CI/CD &#x6D41;&#x7A0B;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x867D;&#x7136;&#x65B9;&#x4FBF;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x5229;&#x4E8E;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x56E0;&#x4E3A;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x524D;&#x8FD8;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x96C6;&#x7FA4;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x540C;&#x6B65;&#x5B58;&#x5728;&#x6240;&#x6302;&#x8F7D;&#x7684;&#x76EE;&#x5F55;&#x53CA;&#x5176;&#x5185;&#x5BB9;&#x3002;&#x56E0;&#x6B64;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x66F4;&#x503E;&#x5411;&#x4E8E;&#x5C06;&#x5E94;&#x7528;&#x6253;&#x5165;&#x955C;&#x50CF;&#xFF0C;&#x65B9;&#x4FBF;&#x90E8;&#x7F72;&#x3002;</p>
<h1 id="docker-compose-xiang-guan-wen-ti"><a href="#Docker-Compose-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Docker Compose &#x76F8;&#x5173;&#x95EE;&#x9898;"></a>Docker Compose &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#docker-compose-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="ni-na-ge-lnmp-li-zi-zhong-de-docker-compose-yml-zhong-you-hao-duo-networks-du-shi-shi-me-yi-si-a"><a href="#&#x4F60;&#x90A3;&#x4E2A;LNMP&#x4F8B;&#x5B50;&#x4E2D;&#x7684;-docker-compose-yml-&#x4E2D;&#x6709;&#x597D;&#x591A;-networks&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F;" class="headerlink" title="&#x4F60;&#x90A3;&#x4E2A;LNMP&#x4F8B;&#x5B50;&#x4E2D;&#x7684; docker-compose.yml &#x4E2D;&#x6709;&#x597D;&#x591A; networks&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F;"></a>&#x4F60;&#x90A3;&#x4E2A;<code>LNMP</code>&#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>docker-compose.yml</code> &#x4E2D;&#x6709;&#x597D;&#x591A; <code>networks</code>&#xFF0C;&#x90FD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x554A;&#xFF1F; <a href="#ni-na-ge-lnmp-li-zi-zhong-de-docker-compose-yml-zhong-you-hao-duo-networks-du-shi-shi-me-yi-si-a" class="header-anchor">#</a></h2><p>&#x6211;&#x5199;&#x7684;<code>LNMP</code>&#x591A;&#x5BB9;&#x5668;&#x4E92;&#x901A;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="external">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p>
<p>&#x524D;&#x9762;<code>services</code>&#x4E0B;&#x7684;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x4E0B;&#x9762;&#x7684;<code>networks</code>&#xFF0C;&#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x8981;&#x63A5;&#x5230;&#x54EA;&#x4E2A;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;<br>&#x800C;&#x6700;&#x540E;&#x7684;&#x90A3;&#x4E2A;&#x603B;&#x7684;<code>networks</code>&#x4E0B;&#x9762;&#x7684;&#xFF0C;&#x662F;&#x8FD9;&#x51E0;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#x5B9A;&#x4E49;&#x3002;</p>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;<code>nginx</code> &#x63A5;&#x5230;&#x4E86;&#x540D;&#x4E3A; <code>frontend</code> &#x7684;&#x524D;&#x7AEF;&#x7F51;&#x7EDC;&#xFF1B;<code>mysql</code> &#x63A5;&#x5230;&#x4E86;&#x540D;&#x4E3A; <code>backend</code> &#x7684;&#x540E;&#x7AEF;&#x7F51;&#x7EDC;&#xFF1B;&#x800C;&#x4F5C;&#x4E3A;&#x4E2D;&#x95F4;&#x7684; <code>php</code> &#x65E2;&#x9700;&#x8981;&#x548C; <code>nginx</code> &#x901A;&#x8BAF;&#xFF0C;&#x53C8;&#x9700;&#x8981;&#x548C; <code>mysql</code> &#x901A;&#x8BAF;&#xFF0C;&#x6240;&#x4EE5;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x4E86; <code>frontend</code> &#x548C; <code>backend</code> &#x7F51;&#x7EDC;&#x3002;&#x7531;&#x4E8E; <code>nginx</code> &#x548C; <code>mysql</code> &#x4E0D;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x7F51;&#x7EDC;&#xFF0C;&#x6240;&#x4EE5;&#x4E8C;&#x8005;&#x65E0;&#x6CD5;&#x901A;&#x8BAF;&#xFF0C;&#x8D77;&#x5230;&#x4E86;&#x9694;&#x79BB;&#x7684;&#x4F5C;&#x7528;&#x3002;</p>
<p>&#x5173;&#x4E8E;Docker&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x4ECB;&#x7ECD;&#xFF1A;<br><a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/#/user-defined-networks" target="_blank" rel="external">https://docs.docker.com/engine/userguide/networking/dockernetworks/#/user-defined-networks</a></p>
<p>&#x5173;&#x4E8E;&#x5728;Docker Compose&#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5B98;&#x65B9;&#x8FD9;&#x90E8;&#x5206;&#x6587;&#x6863;&#xFF1A;<br><a href="https://docs.docker.com/compose/networking/" target="_blank" rel="external">https://docs.docker.com/compose/networking/</a></p>
<h2 id="shi-yong-compose-de-shi-hou-peng-dao-an-http-request-took-too-long-to-complete-cuo-wu-zen-me-ban"><a href="#&#x4F7F;&#x7528;-Compose-&#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230;-&#x201C;An-HTTP-request-took-too-long-to-complete&#x2026;-&#x201D;-&#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="&#x4F7F;&#x7528; Compose &#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230; &#x201C;An HTTP request took too long to complete&#x2026;.&#x201D; &#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>&#x4F7F;&#x7528; Compose &#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230; &#x201C;An HTTP request took too long to complete&#x2026;.&#x201D; &#x9519;&#x8BEF;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#shi-yong-compose-de-shi-hou-peng-dao-an-http-request-took-too-long-to-complete-cuo-wu-zen-me-ban" class="header-anchor">#</a></h2><p>Compose &#x7684;&#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x65F6;&#x9650;&#x662F;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x7684;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> COMPOSE_HTTP_TIMEOUT=120</div></pre></td></tr></table></figure>
<p>&#x4E0D;&#x8FC7;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x5E94;&#x8BE5;&#x8D85;&#x65F6;&#xFF0C;&#x8D85;&#x65F6;&#x7684;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;&#x6240;&#x8BBF;&#x95EE;&#x7684; Docker Engine &#x8FC7;&#x4E8E;&#x7E41;&#x5FD9;&#xFF0C;&#x800C;&#x65E0;&#x6CD5;&#x54CD;&#x5E94; Compose &#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5E94;&#x8BE5;&#x68C0;&#x67E5;&#x5177;&#x4F53; Docker Engine &#x51FA;&#x4E86;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x8FD8;&#x5728;&#x7528;&#x7740; <code>CentOS</code> &#x9ED8;&#x8BA4;&#x7684; device mapper &#x7684; loop &#x8BBE;&#x5907;&#xFF0C;&#x7B49;&#x7B49;&#x3002;</p>
<h1 id="docker-swarm-xiang-guan-wen-ti"><a href="#Docker-Swarm-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Docker Swarm &#x76F8;&#x5173;&#x95EE;&#x9898;"></a>Docker Swarm &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#docker-swarm-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="docker-duo-su-zhu-wang-luo-zen-me-pei-zhi"><a href="#Docker-&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F;" class="headerlink" title="Docker &#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F;"></a>Docker &#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#x600E;&#x4E48;&#x914D;&#x7F6E;&#xFF1F; <a href="#docker-duo-su-zhu-wang-luo-zen-me-pei-zhi" class="header-anchor">#</a></h2><p>&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x770B;&#x3002;<br><a href="https://gist.github.com/twang2218/def4097648deac398a949b58e2a31610" target="_blank" rel="external">https://gist.github.com/twang2218/def4097648deac398a949b58e2a31610</a></p>
<p>&#x5176;&#x4E2D;&#x4E24;&#x4E2A;&#x811A;&#x672C;:</p>
<ul>
<li>&#x5E26;swarm&#x4E00;&#x8D77;&#x73A9; overlay&#xFF1A;<code>build-overlay-with-swarm.sh</code></li>
<li>&#x4E0D;&#x5E26;swarm&#x73A9;&#xFF0C;&#x76F4;&#x63A5;&#x6784;&#x5EFA;overlay&#xFF1A;<code>build-overlay-without-swarm.sh</code></li>
</ul>
<h2 id="swarm-huan-jing-zhong-zen-me-zhi-ding-mou-ge-rong-qi-zai-zhi-ding-de-su-zhu-shang-yun-xing-ni"><a href="#Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F;" class="headerlink" title="Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F;"></a>Swarm&#x73AF;&#x5883;&#x4E2D;&#x600E;&#x4E48;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x5462;&#xFF1F; <a href="#swarm-huan-jing-zhong-zen-me-zhi-ding-mou-ge-rong-qi-zai-zhi-ding-de-su-zhu-shang-yun-xing-ni" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A; Docker Host &#x5EFA;&#x7ACB;&#x65F6;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--label</code> &#x6307;&#x5B9A;&#x5176; Docker Daemon &#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker daemon \</div><div class="line">    --label com.example.environment=<span class="string">&quot;production&quot;</span> \</div><div class="line">    --label com.example.storage=<span class="string">&quot;ssd&quot;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x5E94;&#x8BE5;&#x914D;&#x7F6E;&#x5728; <code>docker daemon</code> &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x91CC;&#xFF0C;&#x5982; <code>docker.service</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7B80;&#x5355;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#x2026;&#x2026;</p>
</blockquote>
<p>&#x7136;&#x540E;&#x8FD0;&#x884C;&#x5BB9;&#x5668;&#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7EA6;&#x675F;&#x8C03;&#x5EA6;&#x5373;&#x53EF;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Compose &#x6587;&#x4EF6;&#x7684; <code>environment</code> &#x914D;&#x7F6E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker run</code> &#x7684; <code>-e</code> &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x53C2;&#x6570;&#x3002;&#x4E0B;&#x9762;&#x4EE5; Compose &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E3A;&#x4F8B;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">  mongodb:</span></div><div class="line"><span class="attr">    image:</span> mongo:latest</div><div class="line"><span class="attr">    environment:</span></div><div class="line"><span class="bullet">      -</span> <span class="string">&quot;constraint:com.example.storage==ssd&quot;</span></div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x8FD9;&#x4E2A; <code>mongodb</code> &#x7684;&#x670D;&#x52A1;&#x5C31;&#x4F1A;&#x8FD0;&#x884C;&#x5728;&#x6807;&#x8BB0;&#x4E3A; <code>com.example.storage=&quot;ssd&quot;</code> &#x7684;&#x5BBF;&#x4E3B;&#x4E0A;&#x8FD0;&#x884C;&#x3002;</p>
<h2 id="wei-shi-me-swarm-ji-qun-de-overlay-network-kua-su-zhu-wu-fa-hu-fang"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-Swarm-&#x96C6;&#x7FA4;&#x7684;-overlay-network-&#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; Swarm &#x96C6;&#x7FA4;&#x7684; overlay network &#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; Swarm &#x96C6;&#x7FA4;&#x7684; overlay network &#x8DE8;&#x5BBF;&#x4E3B;&#x65E0;&#x6CD5;&#x4E92;&#x8BBF;&#xFF1F; <a href="#wei-shi-me-swarm-ji-qun-de-overlay-network-kua-su-zhu-wu-fa-hu-fang" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x68C0;&#x67E5;&#x5EFA;&#x7ACB; Swarm &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x5176;&#x5B83;&#x8282;&#x70B9;&#x6240;&#x5BA3;&#x544A;&#x7684;&#x672C;&#x8282;&#x70B9;&#x7684;&#x5730;&#x5740;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x5355;&#x7F51;&#x5361;&#x3001;&#x5355;IP&#x7684;&#x5BBF;&#x4E3B;&#xFF0C;Swarm &#x4F1A;&#x81EA;&#x52A8;&#x9009;&#x62E9;&#x7F51;&#x5361;&#x5730;&#x5740;&#xFF0C;&#x4F46;&#x662F;&#x591A;&#x7F51;&#x5361;&#x3001;&#x591A;IP&#x7684;&#x5BBF;&#x4E3B;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x624B;&#x52A8;&#x5BA3;&#x544A;&#x5730;&#x5740;&#x3002;</p>
<ul>
<li>&#x5BF9;&#x4E8E;&#x4E00;&#x4EE3; Swarm &#x800C;&#x8A00;&#xFF0C;&#x68C0;&#x67E5;&#x4E00;&#x4E0B; <code>docker daemon</code> &#x7684;&#x914D;&#x7F6E;&#x4E2D;&#xFF0C;<code>--cluster-advertise</code> &#x5730;&#x5740;&#x662F;&#x5426;&#x914D;&#x7F6E;&#x6B63;&#x786E;&#x3002;</li>
<li>&#x5BF9;&#x4E8E;&#x4E8C;&#x4EE3; Swarm&#xFF0C;&#x5219;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x521B;&#x5EFA;&#x3001;&#x52A0;&#x5165; Swarm &#x7684;&#x65F6;&#x5019;&#xFF0C;<code>--advertise-addr</code> &#x662F;&#x5426;&#x586B;&#x5199;&#x6B63;&#x786E;&#x3002;</li>
</ul>
<p>&#x5BA3;&#x544A;&#x5730;&#x5740;&#x5FC5;&#x987B;&#x662F;&#x5168;&#x96C6;&#x7FA4;&#x53EF;&#x4EE5;&#x4E92;&#x8BBF;&#x7684;&#xFF0C;&#x7531;&#x4E8E;&#x8BE5;&#x5730;&#x5740;&#x7AEF;&#x53E3;&#x662F; <code>Docker Remote API</code> &#x7AEF;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528; <code>curl</code> &#x6765;&#x8FDE;&#x63A5;&#x5176;&#x5B83;&#x8282;&#x70B9;&#xFF0C;&#x4EE5;&#x5224;&#x65AD;&#x4E92;&#x901A;&#x6027;&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x5BBF;&#x4E3B;&#x95F4;&#x7684;&#x7F51;&#x7EDC;&#x4E92;&#x901A;&#x95EE;&#x9898;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5BBF;&#x4E3B;&#x7684;&#x9632;&#x706B;&#x5899;&#x5F00;&#x542F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x68C0;&#x67E5;&#x4E0B;&#x5217;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x6709;&#x6CA1;&#x6709;&#x653E;&#x5F00;&#xFF1A;</p>
<ul>
<li><code>7946/{udp,tcp}</code></li>
<li><code>4789/{udp,tcp}</code></li>
<li>{<code>2375</code>,<code>2376</code>,<code>2377</code>,<code>3375</code>,<code>3376</code>}/<code>tcp</code> &#xFF08;&#x5177;&#x4F53;&#x7AEF;&#x53E3;&#x53D6;&#x51B3;&#x4E8E;&#x5B9E;&#x9645; <code>Swarm</code> &#x6216; <code>Engine</code> &#x5B88;&#x62A4;&#x7AEF;&#x53E3;)</li>
</ul>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>telnet</code>, <code>curl</code> &#x4E4B;&#x7C7B;&#x7684;&#x5DE5;&#x5177;&#x786E;&#x4FDD;&#x4E0A;&#x8FF0;&#x7AEF;&#x53E3;&#x53EF;&#x4EE5;&#x4E92;&#x8BBF;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8FD8;&#x662F;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x542F;&#x7528;&#x5404;&#x4E2A; <code>docker daemon</code> &#x7684;&#x8C03;&#x8BD5;&#x6A21;&#x5F0F;&#x3002;&#x548C;&#x914D;&#x7F6E; <code>--insecure-registry</code> &#x4E00;&#x6837;&#xFF0C;&#x7F16;&#x8F91; Docker &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5728; <code>dockerd</code> &#x540E;&#x6DFB;&#x52A0; <code>-D</code> &#x53C2;&#x6570;&#x3002;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#xFF0C;&#x5EFA;&#x7ACB;&#x96C6;&#x7FA4;&#x3001;&#x7F51;&#x7EDC;&#x3001;&#x670D;&#x52A1;&#x3002;&#x5982;&#x679C;&#x95EE;&#x9898;&#x91CD;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x6790; <code>Docker Daemon</code> &#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x5177;&#x4F53;&#x67E5;&#x770B;&#x65E5;&#x5FD7;&#x7684;&#x65B9;&#x6CD5;&#x89C1;&#x524D;&#x9762;&#x7684;&#x95EE;&#x7B54;&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x4E8C;&#x4EE3; Swarm &#x521B;&#x5EFA;&#x7684;<code>service</code>&#x9ED8;&#x8BA4;&#x7684; <code>--endpoint-mode</code> &#x662F; <code>vip</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>&#x865A;&#x62DF;IP</code>&#xFF0C;&#x5229;&#x7528;<code>IPVS</code>&#x505A;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x90A3;&#x4E2A;&#x3002;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x540D;&#x89E3;&#x6790;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;<code>vip</code>&#x5730;&#x5740;&#xFF0C;&#x8BE5;&#x5730;&#x5740;&#x662F;&#x65E0;&#x6CD5;&#x8DE8;&#x5BBF;&#x4E3B; <code>ping</code> &#x7684;&#x3002;&#x56E0;&#x6B64;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x8981;&#x9A8C;&#x8BC1;&#x8DE8;&#x5BBF;&#x4E3B;&#x670D;&#x52A1;&#x4E92;&#x901A;&#x6027;&#xFF0C;&#x5E94;&#x8BE5;&#x76F4;&#x63A5;&#x786E;&#x8BA4;<code>TCP</code>&#x6216;<code>UDP</code>&#x670D;&#x52A1;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;&#x5982;&#x679C;&#x5FC5;&#x987B;<code>ping</code>&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x8981;&#x53BB;<code>ping</code>&#x8FD9;&#x4E2A;<code>vip</code>&#xFF0C;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x5BB9;&#x5668;&#x771F;&#x5B9E;&#x5730;&#x5740;<code>tasks.&lt;&#x670D;&#x52A1;&#x540D;&gt;</code>&#xFF0C;&#x6BD4;&#x5982;&#x670D;&#x52A1;&#x540D;&#x4E3A;<code>web</code>&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F7F;&#x7528;&#x547D;&#x4EE4;<code>ping tasks.web</code>&#x3002;</p>
<p>&#x53C2;&#x8003;&#xFF1A;</p>
<p><a href="https://docs.docker.com/swarm/plan-for-production/" target="_blank" rel="external">https://docs.docker.com/swarm/plan-for-production/</a></p>
<p><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/#/open-ports-between-the-hosts" target="_blank" rel="external">https://docs.docker.com/engine/swarm/swarm-tutorial/#/open-ports-between-the-hosts</a></p>
<p><a href="https://docs.docker.com/engine/swarm/networking/" target="_blank" rel="external">https://docs.docker.com/engine/swarm/networking/</a></p>
<h2 id="docker-er-dai-swarm-ji-swarm-mode-docker-service-create-bu-ke-yi-shi-yong-v-na-zen-me-shi-yong-juan-volume"><a href="#Docker-&#x4E8C;&#x4EE3;Swarm-&#x65E2;-Swarm-Mode-&#xFF0C;docker-service-create-&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;-v-&#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;-Volume-&#xFF1F;" class="headerlink" title="Docker &#x4E8C;&#x4EE3;Swarm (&#x65E2; Swarm Mode)&#xFF0C;docker service create &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; -v &#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;(Volume)&#xFF1F;"></a>Docker &#x4E8C;&#x4EE3;Swarm (&#x65E2; Swarm Mode)&#xFF0C;<code>docker service create</code> &#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-v</code> &#x90A3;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x5377;(Volume)&#xFF1F; <a href="#docker-er-dai-swarm-ji-swarm-mode-docker-service-create-bu-ke-yi-shi-yong-v-na-zen-me-shi-yong-juan-volume" class="header-anchor">#</a></h2><p>&#x4ECE;&#x4E8C;&#x4EE3; Swarm &#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x4F7F;&#x7528; <code>--mount</code> &#x53C2;&#x6570;&#x6765;&#x8FDB;&#x884C;&#x5377;&#x6302;&#x8F7D;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x8BED;&#x4E49;&#x8FDB;&#x884C;&#x66F4;&#x660E;&#x786E;&#x7684;&#x5212;&#x5206;&#x3002;</p>
<p>&#x6302;&#x8F7D;&#x5206;&#x4E24;&#x79CD;&#xFF1A;</p>
<ul>
<li>&#x7ED1;&#x5B9A;&#x6302;&#x8F7D; <code>bind-mount</code>&#xFF1A;&#x8FD9;&#x7C7B;&#x6302;&#x8F7D;&#x5C06;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;/&#x6587;&#x4EF6;&#x7ED1;&#x5B9A;&#x5230;&#x5BB9;&#x5668;&#x7684;&#x67D0;&#x4E2A;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x7C7B;&#x6302;&#x8F7D;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x5BBF;&#x4E3B;&#x548C;&#x5BB9;&#x5668;&#x7684;&#x4E0D;&#x540C;uid&#x5BFC;&#x81F4;&#x7684;&#x6743;&#x9650;&#x3001;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5DEE;&#x5F02;&#x95EE;&#x9898;&#x3002;</li>
<li>&#x6570;&#x636E;&#x5377; <code>data volumes</code>&#xFF1A;&#x8FD9;&#x7C7B;&#x6302;&#x8F7D;&#x662F;&#x4E4B;&#x524D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#x5377;&#x3002;&#x5377;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x547D;&#x540D;&#x5377;<code>named volume</code>&#x4EE5;&#x53CA;&#x533F;&#x540D;&#x5377;<code>anonymous volume</code></li>
</ul>
<p>&#x6302;&#x8F7D;&#x53C2;&#x6570;&#x7684;&#x683C;&#x5F0F;&#x57FA;&#x672C;&#x4E0A;&#x4E3A; <code>--mount &lt;key1&gt;=&lt;value1&gt;[,&lt;key2&gt;=&lt;value2&gt;,...]</code>&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x53C2;&#x6570;&#x6709;&#xFF1A;</p>
<ul>
<li><code>type</code>: &#x5982;&#x4E4B;&#x524D;&#x6240;&#x8BF4;&#xFF0C;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A; <code>volume</code> &#x548C; <code>bind</code>&#x3002;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A; <code>type</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; <code>volume</code>&#xFF1B;</li>
<li><code>src</code> &#x6216; <code>source</code>&#xFF1A;&#x6E90;&#xFF1A;<ul>
<li>&#x5982;&#x679C; <code>type=volume</code>&#xFF0C;<code>src</code> &#x5219;&#x662F;&#x5377;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x662F;&#x53EF;&#x9009;&#x9879;&#x3002;&#x5982;&#x679C;&#x5B58;&#x5728;&#x5C31;&#x662F;&#x547D;&#x540D;&#x5377;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6307;&#x5B9A; <code>src</code> &#x5219;&#x662F;&#x533F;&#x540D;&#x5377;&#xFF1B;</li>
<li>&#x5982;&#x679C; <code>type=bind</code>&#xFF0C;<code>src</code> &#x662F;&#x5BBF;&#x4E3B;&#x672C;&#x5730;&#x7684;&#x8DEF;&#x5F84;&#xFF1B;</li>
</ul>
</li>
<li><code>dst</code> &#x6216; <code>destination</code> &#x6216; <code>target</code>&#xFF1A;&#x5C06;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x6302;&#x8F7D;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x4F1A;&#x5728;&#x6302;&#x8F7D;&#x524D;&#x81EA;&#x52A8;&#x5EFA;&#x7ACB;&#x8DEF;&#x5F84;&#x3002;</li>
<li><code>readonly</code> &#x6216; <code>ro</code>&#xFF1A;&#x662F;&#x5426;&#x8BA9;&#x8BE5;&#x6302;&#x8F7D;&#x4E3A;&#x53EA;&#x8BFB;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x8BFB;&#x5199;&#x3002;</li>
</ul>
<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#xFF1A;</p>
<ul>
<li><code>volume-driver</code>&#xFF1A;&#x6307;&#x5B9A;&#x5377;&#x9A71;&#x52A8;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <code>local</code>&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x5176;&#x5B83;&#xFF08;&#x5982; <code>flocker</code>, <code>glusterfs</code>, <code>ceph</code>&#xFF09;&#x4E4B;&#x7C7B;&#x7684;&#x9A71;&#x52A8;&#xFF1B;</li>
<li><code>volume-label</code>&#xFF1A;&#x6307;&#x5B9A;&#x5377;&#x7684;&#x5143;&#x6570;&#x636E;(metadata)&#xFF0C;&#x4ECE;&#x800C;&#x65B9;&#x4FBF;&#x8FC7;&#x6EE4;&#x64CD;&#x4F5C;&#xFF1B;</li>
<li><code>volume-opt</code>&#xFF1A;&#x4E0D;&#x540C;&#x7684;&#x5377;&#x9A71;&#x52A8;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x3002;</li>
</ul>
<p><code>--mount</code> &#x548C; <code>--volume</code> &#x6709;&#x4E00;&#x4E9B;&#x5DEE;&#x5F02;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p>
<ul>
<li><code>--mount</code> &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5377;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x4E8B;&#x5148;&#x4F7F;&#x7528; <code>docker volume create</code> &#x6765;&#x521B;&#x5EFA;&#x5377;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x591A;&#x7EC4;&#x4E0D;&#x540C;&#x9A71;&#x52A8;&#x7684;&#x5377;&#xFF1B;</li>
<li><code>--mount</code> &#x5982;&#x679C; <code>type=bind</code> &#x7684;&#x8BDD;&#xFF0C;&#x5BBF;&#x4E3B;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#xFF0C;&#x5426;&#x5219;&#x62A5;&#x9519;&#x3002;&#x800C; <code>--volume</code> &#x5219;&#x5728;&#x5BBF;&#x4E3B;&#x4E0D;&#x5B58;&#x5728;&#x8BE5;&#x8DEF;&#x5F84;&#x65F6;&#xFF0C;&#x5728;&#x5BBF;&#x4E3B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x76EE;&#x5F55;&#x6765;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x3002;</li>
</ul>
<p>&#x4E3E;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<p>&#x6302;&#x8F7D;&#x547D;&#x540D;&#x5377;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">  --name my-service \</div><div class="line">  --replicas 3 \</div><div class="line">  --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=my-volume,destination=/path/<span class="keyword">in</span>/container,volume-label=<span class="string">&quot;color=red&quot;</span>,volume-label=<span class="string">&quot;shape=round&quot;</span> \</div><div class="line">  nginx:alpine</div></pre></td></tr></table></figure>
<p>&#x6302;&#x8F7D;&#x533F;&#x540D;&#x5377;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">  --name my-service \</div><div class="line">  --replicas 3 \</div><div class="line">  --mount <span class="built_in">type</span>=volume,destination=/path/<span class="keyword">in</span>/container \</div><div class="line">  nginx:alpine</div></pre></td></tr></table></figure>
<p>&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line"> --name my-service \</div><div class="line"> --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/path/on/host,destination=/path/<span class="keyword">in</span>/container \</div><div class="line"> nginx:alpine</div></pre></td></tr></table></figure>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/add-bind-mounts-or-volumes" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/service_create/#/add-bind-mounts-or-volumes</a></p>
<h2 id="dui-yu-liang-jie-dian-ji-qun-lai-shuo-replicas-2-he-mode-global-shi-bu-shi-yi-ge-yi-si"><a href="#&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;-replicas-2-&#x548C;-mode-global-&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F;" class="headerlink" title="&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;--replicas=2 &#x548C; --mode=global &#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F;"></a>&#x5BF9;&#x4E8E;&#x4E24;&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#x6765;&#x8BF4;&#xFF0C;<code>--replicas=2</code> &#x548C; <code>--mode=global</code> &#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x610F;&#x601D;&#xFF1F; <a href="#dui-yu-liang-jie-dian-ji-qun-lai-shuo-replicas-2-he-mode-global-shi-bu-shi-yi-ge-yi-si" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x4E8C;&#x8005;&#x8BED;&#x4E49;&#x5C31;&#x4E0D;&#x540C;&#x3002;</p>
<ul>
<li><code>--replicas=2</code>&#xFF0C;&#x662F;&#x8981;&#x6C42;&#x8BE5;&#x670D;&#x52A1;&#x6709;2&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x65E0;&#x8BBA;&#x96C6;&#x7FA4;&#x591A;&#x5C11;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4E5F;&#x4E0D;&#x5728;&#x4E4E;&#x8FD9;&#x4E24;&#x4E2A;&#x526F;&#x672C;&#x662F;&#x4E0D;&#x662F;&#x90FD;&#x8DD1;&#x5728;&#x4E00;&#x4E2A;&#x5BBF;&#x4E3B;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x786E;&#x4FDD;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF1B;</li>
<li><code>--mode=global</code>&#xFF0C;&#x662F;&#x8981;&#x6C42;&#x670D;&#x52A1;&#x5728;&#x96C6;&#x7FA4;&#x6BCF;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8DD1;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x3002;</li>
</ul>
<p>&#x73B0;&#x8C61;&#x4E0A;&#x4E5F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;<code>--replicas=2</code> &#x662F;&#x8981;&#x786E;&#x4FDD;&#x526F;&#x672C;&#x4E3A;2&#x4E2A;&#x3002;&#x90A3;&#x4E48;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x4F1A;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x5728;&#x8D77;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x526F;&#x672C;&#x6570;&#x4E3A;2&#x3002;&#x800C;&#x5BF9;&#x4E8E; <code>--mode=global</code> &#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x4E0D;&#x4F1A;&#x518D;&#x53E6;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8D77;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x3002;</p>
<h1 id="docker-machine-xiang-guan-wen-ti"><a href="#Docker-Machine-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Docker Machine &#x76F8;&#x5173;&#x95EE;&#x9898;"></a>Docker Machine &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#docker-machine-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="ru-he-zai-docker-toolbox-zhong-chuang-jian-de-default-xu-ni-ji-zhong-tian-jia-docker-opts-zhi-lei-de-pei-zhi"><a href="#&#x5982;&#x4F55;&#x5728;-Docker-Toolbox-&#x4E2D;&#x521B;&#x5EFA;&#x7684;-default-&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;DOCKER-OPTS&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5728; Docker Toolbox &#x4E2D;&#x521B;&#x5EFA;&#x7684; default &#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;DOCKER_OPTS&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F;"></a>&#x5982;&#x4F55;&#x5728; Docker Toolbox &#x4E2D;&#x521B;&#x5EFA;&#x7684; <code>default</code> &#x865A;&#x62DF;&#x673A;&#x4E2D;&#x6DFB;&#x52A0;<code>DOCKER_OPTS</code>&#x4E4B;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#xFF1F; <a href="#ru-he-zai-docker-toolbox-zhong-chuang-jian-de-default-xu-ni-ji-zhong-tian-jia-docker-opts-zhi-lei-de-pei-zhi" class="header-anchor">#</a></h2><p>&#x5176;&#x5B9E;&#x5728;&#x6700;&#x521D;&#x521B;&#x5EFA;&#x8BE5;docker host&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528; <code>docker-machine</code> &#x6307;&#x5B9A;&#x5F15;&#x64CE;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8981;&#x7D27;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;rm&#x6389;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x91CD;&#x65B0;&#x5EFA;&#x7ACB;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E0D;&#x65B9;&#x4FBF; rm &#x6389;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x53EF;&#x4EE5; <code>docker-machine ssh</code> &#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x4FEE;&#x6539; <code>/var/lib/boot2docker/profile</code> &#x6587;&#x4EF6;&#xFF0C;&#x4FEE;&#x6539;&#x91CC;&#x9762;&#x7684; <code>EXTRA_ARGS</code> &#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002;</p>
<h2 id="docker-machine-chuang-jian-de-zhu-ji-zen-me-zhi-jie-ssh-jin-qu-gai-liao-root-mi-ma-hao-xiang-ye-mei-yong"><a href="#docker-machine-&#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5;-ssh-&#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86;-root-&#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F;" class="headerlink" title="docker-machine &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5; ssh &#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86; root &#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F;"></a><code>docker-machine</code> &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#x600E;&#x4E48;&#x76F4;&#x63A5; <code>ssh</code> &#x8FDB;&#x53BB;&#xFF1F;&#x6539;&#x4E86; <code>root</code> &#x5BC6;&#x7801;&#x597D;&#x50CF;&#x4E5F;&#x6CA1;&#x7528;&#xFF1F; <a href="#docker-machine-chuang-jian-de-zhu-ji-zen-me-zhi-jie-ssh-jin-qu-gai-liao-root-mi-ma-hao-xiang-ye-mei-yong" class="header-anchor">#</a></h2><p><code>docker-machine</code> &#x521B;&#x5EFA;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x4F1A;&#x9075;&#x5FAA;&#x5B89;&#x5168;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x56E0;&#x6B64;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x5141;&#x8BB8; <code>root</code> &#x767B;&#x5F55;&#xFF0C;&#x800C;&#x4E14;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x5141;&#x8BB8;&#x5BC6;&#x7801;&#x767B;&#x5F55;&#xFF0C;&#x53EA;&#x5141;&#x8BB8;<code>&#x5BC6;&#x94A5;</code>&#x767B;&#x5F55;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x5F88;&#x591A;&#x56FD;&#x5185;&#x6587;&#x7AE0;&#x79F0;&#x4E3A;&#x7684;&#x514D;&#x5BC6;&#x767B;&#x5F55;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x975E;&#x514D;&#x5BC6;&#xFF09;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x4F7F;&#x7528;&#x5BC6;&#x94A5; <code>~/.docker/machine/machines/&lt;&#x673A;&#x5668;&#x540D;&gt;/id_rsa</code> &#x767B;&#x5F55;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh -i ~/.docker/machine/machines/default/id_rsa \</div><div class="line">    -o UserKnownHostsFile=/dev/null \</div><div class="line">    -o StrictHostKeyChecking=no \</div><div class="line">    docker@$(docker-machine ip default)</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x8FDE;&#x63A5;&#x7684;&#x662F; <code>default</code> &#x8FD9;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x5176;&#x5B83;&#x7684;&#x673A;&#x5668;&#x6362;&#x6210;&#x522B;&#x7684;&#x5373;&#x53EF;&#x3002;&#x53E6;&#x5916;&#x7684;&#x4E24;&#x4E2A; <code>-o</code> &#x7684;&#x53C2;&#x6570;&#x662F;&#x8BA9;&#x5176;&#x4E0D;&#x8981;&#x6821;&#x9A8C;&#x670D;&#x52A1;&#x5668;&#x5BC6;&#x94A5;&#xFF0C;&#x8FD9;&#x5F53;&#x7136;&#x662F;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x8BD5;&#x9A8C;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x5173;&#x7CFB;&#x3002;</p>
<h2 id="docker-machine-shi-yong-d-generic-shi-zhi-ding-yong-hu-generic-ssh-user-hou-fa-xian-yao-sudo-mi-ma-jie-guo-bao-cuo-tui-chu-zhe-shi-zen-me-hui-shi"><a href="#docker-machine-&#x4F7F;&#x7528;-d-generic-&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237;-generic-ssh-user-&#x540E;&#x53D1;&#x73B0;&#x8981;-sudo-&#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;" class="headerlink" title="docker-machine &#x4F7F;&#x7528; -d generic &#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237; --generic-ssh-user &#x540E;&#x53D1;&#x73B0;&#x8981; sudo &#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F;"></a><code>docker-machine</code> &#x4F7F;&#x7528; <code>-d generic</code> &#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x7528;&#x6237; <code>--generic-ssh-user</code> &#x540E;&#x53D1;&#x73B0;&#x8981; <code>sudo</code> &#x5BC6;&#x7801;&#xFF0C;&#x7ED3;&#x679C;&#x62A5;&#x9519;&#x9000;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF1F; <a href="#docker-machine-shi-yong-d-generic-shi-zhi-ding-yong-hu-generic-ssh-user-hou-fa-xian-yao-sudo-mi-ma-jie-guo-bao-cuo-tui-chu-zhe-shi-zen-me-hui-shi" class="header-anchor">#</a></h2><p>&#x4F60;&#x5E94;&#x8BE5;&#x518D;&#x4ED4;&#x7EC6;&#x770B;&#x770B; <code>generic</code> &#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/machine/drivers/generic/#/sudo-privileges" target="_blank" rel="external">https://docs.docker.com/machine/drivers/generic/#/sudo-privileges</a></p>
<p>&#x91CC;&#x9762;&#x8BF4;&#x7684;&#x5F88;&#x6E05;&#x695A;&#xFF0C;&#x9ED8;&#x8BA4;&#x7528;&#x6237;&#x662F; <code>root</code>&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x901A;&#x8FC7; <code>--generic-ssh-user</code> &#x6307;&#x5B9A;&#x5176;&#x5B83;&#x7528;&#x6237;&#x7684;&#x8BDD;&#xFF0C;&#x8BE5;&#x7528;&#x6237;&#x5FC5;&#x987B;&#x62E5;&#x6709;&#x65E0;&#x5BC6;&#x7801;<code>sudo</code>&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x5C31;&#x662F;&#x5728; <code>sudoers</code> &#x6587;&#x4EF6;&#x4E2D;&#x5BF9;&#x8BE5;&#x7528;&#x6237;&#x914D;&#x7F6E; <code>NOPASSWD</code>&#x3002;</p>
<h1 id="docker-registry-xiang-guan-wen-ti"><a href="#Docker-Registry-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Docker Registry &#x76F8;&#x5173;&#x95EE;&#x9898;"></a>Docker Registry &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#docker-registry-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="wo-docker-push-de-shi-hou-zen-me-bao-authentication-required-cuo-wu"><a href="#&#x6211;-docker-push-&#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5;-authentication-required-&#x9519;&#x8BEF;&#xFF1F;" class="headerlink" title="&#x6211; docker push &#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5; authentication required &#x9519;&#x8BEF;&#xFF1F;"></a>&#x6211; <code>docker push</code> &#x7684;&#x65F6;&#x5019;&#x600E;&#x4E48;&#x62A5; <code>authentication required</code> &#x9519;&#x8BEF;&#xFF1F; <a href="#wo-docker-push-de-shi-hou-zen-me-bao-authentication-required-cuo-wu" class="header-anchor">#</a></h2><p>&#x56E0;&#x4E3A;&#x4F60;&#x6CA1;&#x6709;&#x767B;&#x5F55;&#x3002;&#x5982;&#x679C;&#x662F;&#x5411; Docker Hub &#x63A8;&#x9001;&#x955C;&#x50CF;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFF1A; <a href="https://hub.docker.com/" target="_blank" rel="external">https://hub.docker.com/</a></p>
<h2 id="wo-zhu-ce-yong-hu-aaa-liao-zen-me-huan-shi-wu-fa-docker-push-bbb-xxx-a"><a href="#&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237;-aaa-&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;-docker-push-bbb-xxx-&#x554A;&#xFF1F;" class="headerlink" title="&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237; aaa &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5; docker push bbb/xxx &#x554A;&#xFF1F;"></a>&#x6211;&#x6CE8;&#x518C;&#x7528;&#x6237; <code>aaa</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x8FD8;&#x662F;&#x65E0;&#x6CD5; <code>docker push bbb/xxx</code> &#x554A;&#xFF1F; <a href="#wo-zhu-ce-yong-hu-aaa-liao-zen-me-huan-shi-wu-fa-docker-push-bbb-xxx-a" class="header-anchor">#</a></h2><p>&#x1F612;&#x2026;&#x2026;&#x56E0;&#x4E3A;&#x4F60; <code>push</code> &#x5230;&#x522B;&#x4EBA;&#x7684; <code>repo</code> &#x4E86;&#xFF0C;&#x4F60;&#x53EA;&#x80FD; <code>push</code> &#x5230; <code>aaa/xxx</code> &#x4E0B;&#x3002;</p>
<h2 id="bu-guan-yong-a-wo-zhe-hui-docker-push-aaa-xxx-liao-zen-me-gao-su-wo-bu-cun-zai-a"><a href="#&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE;-docker-push-aaa-xxx-&#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE; docker push aaa/xxx &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F;"></a>&#x4E0D;&#x7BA1;&#x7528;&#x554A;&#xFF0C;&#x6211;&#x8FD9;&#x56DE; <code>docker push aaa/xxx</code> &#x4E86;&#xFF0C;&#x600E;&#x4E48;&#x544A;&#x8BC9;&#x6211;&#x4E0D;&#x5B58;&#x5728;&#x554A;&#xFF1F; <a href="#bu-guan-yong-a-wo-zhe-hui-docker-push-aaa-xxx-liao-zen-me-gao-su-wo-bu-cun-zai-a" class="header-anchor">#</a></h2><p>&#x1F613;&#x2026;&#x2026;&#x56E0;&#x4E3A;&#x4F60;&#x6CA1;&#x6709; <code>tag</code> &#x5BF9;&#x5E94;&#x7684;&#x955C;&#x50CF;&#x4E3A; <code>aaa/xxx</code>&#x3002;</p>
<p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x90FD;&#x662F;&#x7531;&#x4E8E;&#x4F60;&#x6CA1;&#x6709;&#x53BB;&#x770B;&#x6587;&#x6863;&#xFF0C;&#x5EFA;&#x8BAE;&#x4E0D;&#x8981;&#x8FD9;&#x4E48;&#x4E00;&#x6B21;&#x6B21;&#x7684;&#x778E;&#x649E;&#xFF0C;&#x53BB;&#x770B;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;</p>
<p><a href="https://docs.docker.com/engine/getstarted/step_six/" target="_blank" rel="external">https://docs.docker.com/engine/getstarted/step_six/</a><br><a href="https://docs.docker.com/engine/tutorials/dockerrepos/" target="_blank" rel="external">https://docs.docker.com/engine/tutorials/dockerrepos/</a></p>
<h2 id="docker-push-dao-si-you-registry-zong-shi-bu-cheng-gong-zen-me-ban"><a href="#docker-push-&#x5230;&#x79C1;&#x6709;-registry-&#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="docker push &#x5230;&#x79C1;&#x6709; registry &#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a><code>docker push</code> &#x5230;&#x79C1;&#x6709; registry &#x603B;&#x662F;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#docker-push-dao-si-you-registry-zong-shi-bu-cheng-gong-zen-me-ban" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x5728;&#x62A5;&#x9519;&#x4E2D;&#x770B;&#x5230;&#x4E86; <code>https</code>&#xFF0C;&#x90A3;&#x5F88;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A; <code>registry</code> &#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x8BC1;&#x4E66;&#x3002;</p>
<p>&#x5F88;&#x591A;&#x4EBA;&#x6700;&#x5F00;&#x59CB;&#x914D;&#x7F6E; <code>registry</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x800C;&#x6CA1;&#x6709;&#x914D;&#x7F6E; <code>TLS</code> &#x8BC1;&#x4E66;&#x3002;</p>
<p>&#x8FD9;&#x662F;<strong>&#x4E0D;&#x5B89;&#x5168;</strong>&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5728; Docker &#x4E2D;<strong>&#x4E0D;&#x63A8;&#x8350;</strong>&#x4F7F;&#x7528;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x523B;&#x610F;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x4E0D;&#x5B89;&#x5168; <code>registry</code> &#x7684;&#x590D;&#x6742;&#x5EA6;&#x3002;&#x4F7F;&#x7528;&#x8005;&#x5FC5;&#x987B;&#x5728; <code>docker daemon</code> &#x914D;&#x7F6E;&#x4E2D;&#xFF0C;&#x660E;&#x786E;&#x58F0;&#x660E;&#x8981;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x4E0D;&#x5B89;&#x5168;&#x7684; <code>registry</code>&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x5728; <a href="http://www.ubuntu.com/download/server" target="_blank" rel="external">Ubuntu 16.04</a> &#x4E2D;&#xFF0C;&#x7F16;&#x8F91; <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> &#x4E2D;&#x7684; <code>ExecStart=</code> &#x7684;&#x7ED3;&#x5C3E;&#xFF0C;&#x52A0;&#x5165; <code>--insecure-registry=192.168.99.100:5000</code>&#xFF0C;&#x5C06; <code>192.168.99.100:5000</code> &#x66FF;&#x6362;&#x6210;&#x4F60;&#x7684; <code>registry</code> &#x5730;&#x5740;&#x3002;&#x5982;&#x679C;&#x6709;&#x5F88;&#x591A; <code>registry</code>&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x591A;&#x7EC4;&#x3002;&#x6216;&#x8005;&#x5982;&#x679C;&#x865A;&#x62DF;&#x673A;&#x7684; <code>IP</code> &#x603B;&#x662F;&#x53D8;&#x5316;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>CIDR</code> &#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982; <code>--insecure-registry=192.168.99.0/24</code>&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x6D4B;&#x8BD5;&#x8FC7;&#x540E;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;<a href="https://docs.docker.com/registry/deploying/#/get-a-certificate" target="_blank" rel="external">&#x914D;&#x4E0A; TLS &#x8BC1;&#x4E66;</a>&#x3002;&#x73B0;&#x5728; <a href="https://letsencrypt.org/getting-started/" target="_blank" rel="external">Let&#x2019;s Encrpyt</a> &#x5DF2;&#x7ECF;&#x652F;&#x6301; <code>DNS</code> &#x8BA4;&#x8BC1;&#x4E86;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x66B4;&#x9732;&#x5185;&#x90E8;&#x7684;&#x673A;&#x5668;&#x4E8E;&#x516C;&#x7F51;&#xFF0C;&#x7528;&#x5176;<a href="https://certbot.eff.org/" target="_blank" rel="external">&#x811A;&#x672C;</a>&#x81EA;&#x52A8;&#x53D6;&#x5F97;&#x514D;&#x8D39;&#x8BC1;&#x4E66;&#x662F;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x3002;</p>
<h2 id="wo-docker-push-liao-hen-duo-jing-xiang-dao-si-you-de-registry-shang-zen-me-cai-neng-cha-kan-shang-mian-du-you-sha-huo-zhe-sou-suo"><a href="#&#x6211;-docker-push-&#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684;-registry-&#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F;" class="headerlink" title="&#x6211; docker push &#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684; registry &#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F;"></a>&#x6211; <code>docker push</code> &#x4E86;&#x5F88;&#x591A;&#x955C;&#x50CF;&#x5230;&#x79C1;&#x6709;&#x7684; registry &#x4E0A;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x4E0A;&#x9762;&#x90FD;&#x6709;&#x5565;&#xFF1F;&#x6216;&#x8005;&#x641C;&#x7D22;&#xFF1F; <a href="#wo-docker-push-liao-hen-duo-jing-xiang-dao-si-you-de-registry-shang-zen-me-cai-neng-cha-kan-shang-mian-du-you-sha-huo-zhe-sou-suo" class="header-anchor">#</a></h2><p>&#x4E24;&#x79CD;&#x529E;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528; Registry V2 API&#x3002;&#x53EF;&#x4EE5;&#x5217;&#x51FA;&#x6240;&#x6709;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://&lt;&#x79C1;&#x6709;registry&#x5730;&#x5740;&gt;/v2/_catalog</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x79C1;&#x6709; Registry &#x5C1A;&#x652F;&#x6301; V1 API&#xFF08;&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker search</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker search &lt;&#x79C1;&#x6709;registry&#x5730;&#x5740;&gt;/&lt;&#x5173;&#x952E;&#x5B57;&gt;</div></pre></td></tr></table></figure>
<h2 id="ru-he-shan-chu-si-you-registry-zhong-de-jing-xiang"><a href="#&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709;-registry-&#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709; registry &#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F;"></a>&#x5982;&#x4F55;&#x5220;&#x9664;&#x79C1;&#x6709; registry &#x4E2D;&#x7684;&#x955C;&#x50CF;&#xFF1F; <a href="#ru-he-shan-chu-si-you-registry-zhong-de-jing-xiang" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;docker registry &#x662F;&#x4E0D;&#x5141;&#x8BB8;&#x5220;&#x9664;&#x955C;&#x50CF;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x914D;&#x7F6E;<code>config.yml</code>&#x4E2D;&#x542F;&#x7528;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">delete:</span></div><div class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#xFF0C;&#x4F7F;&#x7528; API <code>GET /v2/&lt;&#x955C;&#x50CF;&#x540D;&gt;/manifests/&lt;tag&gt;</code> &#x6765;&#x53D6;&#x5F97;&#x8981;&#x5220;&#x9664;&#x7684;<code>&#x955C;&#x50CF;:Tag</code>&#x6240;&#x5BF9;&#x5E94;&#x7684; <code>digest</code>&#x3002;</p>
<p>Registry <code>2.3</code> &#x4EE5;&#x540E;&#xFF0C;&#x5FC5;&#x987B;&#x52A0;&#x5165;&#x5934; <code>Accept: application/vnd.docker.distribution.manifest.v2+json</code>&#xFF0C;&#x5426;&#x5219;&#x53D6;&#x5230;&#x7684; <code>digest</code> &#x662F;&#x9519;&#x8BEF;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x8BEF;&#x5220;&#x9664;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x8981;&#x5220;&#x9664; <code>myimage:latest</code> &#x955C;&#x50CF;&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x5F97; <code>digest</code> &#x7684;&#x547D;&#x4EE4;&#x662F;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ curl --header <span class="string">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span> \</div><div class="line">  -I -X HEAD http://192.168.99.100:5000/v2/myimage/manifests/latest \</div><div class="line">  | grep Digest</div><div class="line">Docker-Content-Digest: sha256:3a07b4e06c73b2e3924008270c7f3c3c6e3f70d4dbb814ad8bff2697123ca33c</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x8C03;&#x7528; API <code>DELETE /v2/&lt;&#x955C;&#x50CF;&#x540D;&gt;/manifests/&lt;digest&gt;</code> &#x6765;&#x5220;&#x9664;&#x955C;&#x50CF;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl  -X DELETE http://192.168.99.100:5000/v2/myimage/manifests/sha256:3a07b4e06c73b2e3924008270c7f3c3c6e3f70d4dbb814ad8bff2697123ca33c</div></pre></td></tr></table></figure>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x955C;&#x50CF;&#x5DF2;&#x4ECE; <code>registry</code> &#x4E2D;&#x6807;&#x8BB0;&#x5220;&#x9664;&#xFF0C;&#x5916;&#x754C;&#x8BBF;&#x95EE; <code>pull</code> &#x4E0D;&#x5230;&#x4E86;&#x3002;&#x4F46;&#x662F; <code>registry</code> &#x7684;&#x672C;&#x5730;&#x7A7A;&#x95F4;&#x5E76;&#x672A;&#x91CA;&#x653E;&#xFF0C;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x5783;&#x573E;&#x6536;&#x96C6;&#x624D;&#x4F1A;&#x91CA;&#x653E;&#x3002;&#x800C;&#x5783;&#x573E;&#x6536;&#x96C6;&#x4E0D;&#x53EF;&#x4EE5;&#x5728;&#x7EBF;&#x8FDB;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x505C;&#x6B62; <code>registry</code>&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5047;&#x8BBE; <code>registry</code> &#x662F;&#x7528; Compose &#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x7528;&#x6765;&#x5783;&#x573E;&#x6536;&#x96C6;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker-compose stop</div><div class="line">docker run -it --name gc --rm --volumes-from registry_registry_1 registry:2 garbage-collect /etc/registry/config.yml</div><div class="line">docker-compose start</div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D; <code>registry_registry_1</code> &#x53EF;&#x4EE5;&#x66FF;&#x6362;&#x4E3A;&#x5B9E;&#x9645;&#x7684; <code>registry</code> &#x7684;&#x5BB9;&#x5668;&#x540D;&#xFF0C;&#x800C; <code>/etc/registry/config.yml</code> &#x5219;&#x66FF;&#x6362;&#x4E3A;&#x5B9E;&#x9645;&#x7684; <code>registry</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;</p>
<p><a href="https://docs.docker.com/registry/configuration/#/delete" target="_blank" rel="external">https://docs.docker.com/registry/configuration/#/delete</a></p>
<p><a href="https://docs.docker.com/registry/spec/api/#/deleting-an-image" target="_blank" rel="external">https://docs.docker.com/registry/spec/api/#/deleting-an-image</a></p>
<h2 id="shi-yong-guo-nei-jing-xiang-huan-shi-man-gong-si-nei-hao-duo-docker-zhu-ji-du-xu-yao-qu-chong-fu-xia-zai-jing-xiang-zha-ban"><a href="#&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A;-docker-&#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F;" class="headerlink" title="&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A; docker &#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F;"></a>&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x955C;&#x50CF;&#x8FD8;&#x662F;&#x6162;&#xFF0C;&#x516C;&#x53F8;&#x5185;&#x597D;&#x591A; docker &#x4E3B;&#x673A;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x548B;&#x529E;&#xFF1F; <a href="#shi-yong-guo-nei-jing-xiang-huan-shi-man-gong-si-nei-hao-duo-docker-zhu-ji-du-xu-yao-qu-chong-fu-xia-zai-jing-xiang-zha-ban" class="header-anchor">#</a></h2><p>&#x5728;&#x5C40;&#x57DF;&#x7F51;&#x5185;&#xFF0C;&#x672C;&#x5730;&#x67B6;&#x8BBE;&#x4E2A; Docker Registry mirror&#xFF0C;&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7A7A;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0; Registry &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>config.yml</code>&#xFF0C;&#x5176;&#x5185;&#x5BB9;&#x4E3A;&#xFF1A;</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="number">0.1</span></div><div class="line"><span class="attr">log:</span></div><div class="line"><span class="attr">    fields:</span></div><div class="line"><span class="attr">        service:</span> registry</div><div class="line"><span class="attr">storage:</span></div><div class="line"><span class="attr">    cache:</span></div><div class="line"><span class="attr">        blobdescriptor:</span> inmemory</div><div class="line"><span class="attr">    filesystem:</span></div><div class="line"><span class="attr">        rootdirectory:</span> /var/lib/registry</div><div class="line"><span class="attr">http:</span></div><div class="line"><span class="attr">    addr:</span> :<span class="number">5000</span></div><div class="line"><span class="attr">    headers:</span></div><div class="line"><span class="attr">        X-Content-Type-Options:</span> [nosniff]</div><div class="line"><span class="attr">health:</span></div><div class="line"><span class="attr">    storagedriver:</span></div><div class="line"><span class="attr">        enabled:</span> <span class="literal">true</span></div><div class="line"><span class="attr">        interval:</span> <span class="number">10</span>s</div><div class="line"><span class="attr">        threshold:</span> <span class="number">3</span></div><div class="line"><span class="attr">proxy:</span></div><div class="line"><span class="attr">    remoteurl:</span> https://registry<span class="bullet">-1.</span>docker.io</div></pre></td></tr></table></figure>
<p>&#x5E76;&#x4E14;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E2A; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x65B9;&#x4FBF;&#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#xFF1A;</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">&apos;2&apos;</span></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">    mirror:</span></div><div class="line"><span class="attr">        image:</span> registry:<span class="number">2</span></div><div class="line"><span class="attr">        ports:</span></div><div class="line"><span class="bullet">            -</span> <span class="string">&quot;5000:5000&quot;</span></div><div class="line"><span class="attr">        volumes:</span></div><div class="line"><span class="bullet">            -</span> ./config.yml:/etc/docker/registry/</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x7528; Docker Compose &#x542F;&#x52A8;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x670D;&#x52A1;&#xFF1A;<code>docker-compose up -d</code></p>
<p>&#x7136;&#x540E;&#x5728;&#x5C40;&#x57DF;&#x7F51;&#x4E2D;&#x7684;&#x6240;&#x6709; Docker &#x4E3B;&#x673A;&#x4E2D;&#x7684; Docker Daemon &#x914D;&#x7F6E;&#x4E2D;&#xFF0C;&#x90FD;&#x6DFB;&#x52A0;&#x4E00;&#x6761; <code>--registry-mirror=&lt;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740;&gt;</code></p>
<p>&#x9996;&#x5148;&#x7528;docker pull&#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x770B;&#x4E00;&#x4E0B;&#x65F6;&#x95F4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ time docker pull php:7-fpm-alpine</div><div class="line">7-fpm-alpine: Pulling from library/php</div><div class="line">e110a4a17941: Pull complete</div><div class="line">d9f63633faf6: Pull complete</div><div class="line">ac309a5bc5d5: Pull complete</div><div class="line">4523ec888a62: Pull complete</div><div class="line">6a77f79ab9b5: Pull complete</div><div class="line">27243562b67c: Pull complete</div><div class="line">33e1803456c2: Pull complete</div><div class="line">a1219b0a1418: Pull complete</div><div class="line">Digest: sha256:f7d6f6844df64f8f615fa50ca28b3f1ad82be0a2dcde0b55205d31c1bb9f4820</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> php:7-fpm-alpine</div><div class="line">docker pull php:7-fpm-alpine  0.07s user 0.07s system 0% cpu 2:30.43 total</div></pre></td></tr></table></figure>
<p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x4E0B;&#x8F7D;&#x4E86; php:7-fpm-alpine&#xFF0C;&#x7528;&#x65F6; 2 &#x5206; 30&#x79D2;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5220;&#x6389;&#x955C;&#x50CF;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker rmi php:7-fpm-alpine</div><div class="line">Untagged: php:7-fpm-alpine</div><div class="line">Deleted: sha256:b80ca1f4f99d13e00ac6ef13aca7c1ef6e2fb83ec2fe6a035e8beeeb05afb4b6</div><div class="line">Deleted: sha256:69ee0f31988504dc3e3b068476f11d06b43<span class="built_in">fc</span>34465a1c58d351406b9d2368e7a</div><div class="line">...</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x91CD;&#x65B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#xFF0C;&#x6D4B;&#x8BD5;&#x65F6;&#x95F4;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ time docker pull php:7-fpm-alpine</div><div class="line">7-fpm-alpine: Pulling from library/php</div><div class="line">e110a4a17941: Pull complete</div><div class="line">d9f63633faf6: Pull complete</div><div class="line">ac309a5bc5d5: Pull complete</div><div class="line">4523ec888a62: Pull complete</div><div class="line">6a77f79ab9b5: Pull complete</div><div class="line">27243562b67c: Pull complete</div><div class="line">33e1803456c2: Pull complete</div><div class="line">a1219b0a1418: Pull complete</div><div class="line">Digest: sha256:f7d6f6844df64f8f615fa50ca28b3f1ad82be0a2dcde0b55205d31c1bb9f4820</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> php:7-fpm-alpine</div><div class="line">docker pull php:7-fpm-alpine  0.05s user 0.04s system 0% cpu 13.778 total</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6B21;&#x7531;&#x4E8E;&#x8BE5; docker image &#x672C;&#x5730; mirror &#x7F13;&#x5B58;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x7528;&#x65F6;&#x7EA6;14&#x79D2;&#xFF0C;&#x901F;&#x5EA6;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;</p>
<p>&#x670D;&#x52A1;&#x7AEF;&#xFF1A;<a href="https://docs.docker.com/registry/configuration/#/proxy" target="_blank" rel="external">https://docs.docker.com/registry/configuration/#/proxy</a></p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;<a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/dockerd/</a></p>
<h2 id="zi-ji-jia-de-registry-zen-me-ren-he-yong-hu-du-ke-yi-qu-dao-jing-xiang-zhe-bu-an-quan-a"><a href="#&#x81EA;&#x5DF1;&#x67B6;&#x7684;-registry-&#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F;" class="headerlink" title="&#x81EA;&#x5DF1;&#x67B6;&#x7684; registry &#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F;"></a>&#x81EA;&#x5DF1;&#x67B6;&#x7684; <code>registry</code> &#x600E;&#x4E48;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x53D6;&#x5230;&#x955C;&#x50CF;&#xFF1F;&#x8FD9;&#x4E0D;&#x5B89;&#x5168;&#x554A;&#xFF1F; <a href="#zi-ji-jia-de-registry-zen-me-ren-he-yong-hu-du-ke-yi-qu-dao-jing-xiang-zhe-bu-an-quan-a" class="header-anchor">#</a></h2><p>&#x90A3;&#x662F;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x52A0;&#x8BA4;&#x8BC1;&#xFF0C;&#x4E0D;&#x52A0;&#x8BA4;&#x8BC1;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5141;&#x8BB8;&#x4EFB;&#x4F55;&#x4EBA;&#x8BBF;&#x95EE;&#x7684;&#x3002;</p>
<p>&#x6DFB;&#x52A0;&#x8BA4;&#x8BC1;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li>Registry &#x914D;&#x7F6E;&#x4E2D;&#x52A0;&#x5165;&#x8BA4;&#x8BC1;&#xFF1A; <a href="https://docs.docker.com/registry/configuration/#/auth" target="_blank" rel="external">https://docs.docker.com/registry/configuration/#/auth</a></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attr">auth:</span></div><div class="line"><span class="attr">  token:</span></div><div class="line"><span class="attr">    realm:</span> token-realm</div><div class="line"><span class="attr">    service:</span> token-service</div><div class="line"><span class="attr">    issuer:</span> registry-token-issuer</div><div class="line"><span class="attr">    rootcertbundle:</span> /root/certs/bundle</div><div class="line"><span class="attr">  htpasswd:</span></div><div class="line"><span class="attr">    realm:</span> basic-realm</div><div class="line"><span class="attr">    path:</span> /path/to/htpasswd</div></pre></td></tr></table></figure>
<ul>
<li>&#x524D;&#x7AEF;&#x67B6;&#x8BBE; nginx &#x8FDB;&#x884C;&#x8BA4;&#x8BC1;&#xFF1A;<a href="https://docs.docker.com/registry/recipes/nginx/" target="_blank" rel="external">https://docs.docker.com/registry/recipes/nginx/</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">location /v2/ {</div><div class="line">    ...</div><div class="line">    auth_basic <span class="string">&quot;Registry realm&quot;</span>;</div><div class="line">    auth_basic_user_file /etc/nginx/conf.d/nginx.htpasswd;</div><div class="line">    ...</div><div class="line">}</div></pre></td></tr></table></figure>
<h1 id="centos-rhel-hong-mao-xi-tong-te-you-wen-ti"><a href="#CentOS-RHEL-&#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898;" class="headerlink" title="CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898;"></a>CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x7279;&#x6709;&#x95EE;&#x9898; <a href="#centos-rhel-hong-mao-xi-tong-te-you-wen-ti" class="header-anchor">#</a></h1><h2 id="zai-centos-6-shang-an-zhuang-hou-zen-me-zui-gao-zhi-you-docker-1-7-zhe-ge-ban-ben"><a href="#&#x5728;-CentOS-6-&#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709;-Docker-1-7-&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F;" class="headerlink" title="&#x5728; CentOS 6 &#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709; Docker 1.7 &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F;"></a>&#x5728; CentOS 6 &#x4E0A;&#x5B89;&#x88C5;&#x540E;&#x600E;&#x4E48;&#x6700;&#x9AD8;&#x53EA;&#x6709; Docker 1.7 &#x8FD9;&#x4E2A;&#x7248;&#x672C;&#xFF1F; <a href="#zai-centos-6-shang-an-zhuang-hou-zen-me-zui-gao-zhi-you-docker-1-7-zhe-ge-ban-ben" class="header-anchor">#</a></h2><p>Docker &#x5DF2;&#x7ECF;&#x4E0D;&#x518D;&#x652F;&#x6301; CentOS 6 &#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x5230;&#x7684;&#x662F;&#x5F88;&#x4E45;&#x4EE5;&#x524D;&#x7684;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x4E4B;&#x540E;&#x518D;&#x4E5F;&#x6CA1;&#x6709;&#x53D1;&#x5E03;&#x8FC7; CentOS 6 &#x7684;&#x7248;&#x672C;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x518D;&#x5728; CentOS 6&#x4E0A;&#x7528; Docker &#x4E86;&#x3002;&#x6362; CentOS 7 &#x6216;&#x8005; Ubuntu &#x5427;&#x3002;</p>
<h2 id="gua-zai-su-zhu-mu-lu-jie-guo-permission-denied-mei-quan-xian"><a href="#&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C;-Permission-denied&#xFF0C;&#x6CA1;&#x6743;&#x9650;" class="headerlink" title="&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C; Permission denied&#xFF0C;&#x6CA1;&#x6743;&#x9650;"></a>&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x7ED3;&#x679C; Permission denied&#xFF0C;&#x6CA1;&#x6743;&#x9650; <a href="#gua-zai-su-zhu-mu-lu-jie-guo-permission-denied-mei-quan-xian" class="header-anchor">#</a></h2><p>&#x539F;&#x56E0;&#x662F; CentOS/RHEL&#x4E2D;&#x7684; SELinux &#x9650;&#x5236;&#x4E86;&#x76EE;&#x5F55;&#x6743;&#x9650;&#x3002;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x89C4;&#x5219;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F; <code>man docker-run</code> &#x7684;&#x89E3;&#x91CA;&#xFF1A;</p>
<blockquote>
<p>When  using  SELinux,  be  aware that the host has no knowledge of container<br>SELinux policy. Therefore, in the above example, if SELinux policy  is enforced,<br>the /var/db directory is not  writable to the container. A &#x201C;Permission Denied&#x201D;<br>message will occur and an avc: message in the host&#x2019;s syslog.</p>
<p>To  work  around  this, at time of writing this man page, the following command<br>needs to be run in order for the  proper  SELinux  policy  type label to be<br>attached to the host directory:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chcon -Rt svirt_sandbox_file_t /var/db</div></pre></td></tr></table></figure>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/" target="_blank" rel="external">http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/</a></p>
<h2 id="docker-de-var-lib-docker-devicemapper-zhan-yong-kong-jian-bu-duan-zeng-chang-zen-me-po"><a href="#Docker&#x7684;-var-lib-docker-devicemapper-&#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;-&#x600E;&#x4E48;&#x7834;&#xFF1F;" class="headerlink" title="Docker&#x7684; /var/lib/docker/devicemapper &#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;, &#x600E;&#x4E48;&#x7834;&#xFF1F;"></a>Docker&#x7684; <code>/var/lib/docker/devicemapper</code> &#x5360;&#x7528;&#x7A7A;&#x95F4;&#x4E0D;&#x65AD;&#x589E;&#x957F;, &#x600E;&#x4E48;&#x7834;&#xFF1F; <a href="#docker-de-var-lib-docker-devicemapper-zhan-yong-kong-jian-bu-duan-zeng-chang-zen-me-po" class="header-anchor">#</a></h2><p>&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x4E00;&#x822C;&#x662F; CentOS/RHEL &#x7EA2;&#x5E3D;&#x7CFB;&#x7684;&#x95EE;&#x9898;&#xFF0C;CentOS &#x8FD9;&#x7C7B;&#x7EA2;&#x5E3D;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x50CF; Ubuntu &#x90A3;&#x6837;&#x6709;&#x6210;&#x719F;&#x7684; Union FS&#x5B9E;&#x73B0;(&#x5982;<code>aufs</code>)&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x4F7F;&#x7528; <code>devicemapper</code>&#xFF0C;&#x800C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>lvm-loop</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#x7A00;&#x758F;&#x6587;&#x4EF6;&#x6765;&#x5F53;&#x6210;&#x4E00;&#x4E2A;&#x5757;&#x8BBE;&#x5907;&#xFF0C;&#x7ED9;<code>devicemapper</code>&#x7528;&#xFF0C;&#x4F5C;&#x4E3A;Docker&#x955C;&#x50CF;&#x5BB9;&#x5668;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x6027;&#x80FD;&#x5F88;&#x5DEE;&#x4E0D;&#x8BF4;&#xFF0C;&#x4E0D;&#x7A33;&#x5B9A;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;bug&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x529E;&#x6CD5;&#x6362;Ubuntu/Debian&#x7CFB;&#x7EDF;&#xFF0C;&#x90A3;&#x4E48;&#x6700;&#x8D77;&#x7801;&#x5E94;&#x8BE5;&#x5EFA;&#x7ACB;&#x5757;&#x8BBE;&#x5907;&#xFF08;&#x5206;&#x533A;&#x3001;&#x5377;&#xFF09;&#x7ED9; <code>devicemapper</code>&#x7528;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-direct-lvm-mode-for-production" target="_blank" rel="external">https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-direct-lvm-mode-for-production</a></p>
<p>&#x4E25;&#x683C;&#x6765;&#x8BF4; CentOS/RHEL 7 &#x4E2D;&#x5B9E;&#x9645;&#x4E0A;&#x6709;&#x4E00;&#x4E2A; Union FS &#x5B9E;&#x73B0;&#xFF0C;&#x867D;&#x7136; CentOS/RHEL 7 &#x7684;&#x5185;&#x6838;&#x662F;3.10&#xFF0C;&#x4E0D;&#x8FC7;&#x7EA2;&#x5E3D;&#x4ECE; Linux 3.18 backport &#x56DE;&#x6765;&#x4E86; <code>overlay</code> fs &#x7684;&#x9A71;&#x52A8;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x7EA2;&#x5E3D;&#x81EA;&#x5DF1;&#x90FD;&#x5728;&#x5B98;&#x65B9;&#x7684;&#x53D1;&#x5E03;&#x58F0;&#x660E;&#x4E2D;&#x8BF4;&#x80FD;&#x4E0D;&#x8981;&#x7528;&#x5C31;&#x4E0D;&#x7528;&#x3002;</p>
<p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.2_Release_Notes/technology-preview-file_systems.html" target="_blank" rel="external">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.2_Release_Notes/technology-preview-file_systems.html</a></p>
<h2 id="centos-7-de-nei-he-tai-lao-liao-3-10-shi-bu-shi-hen-duo-docker-gong-neng-bu-zhi-chi"><a href="#CentOS-7-&#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86;-3-10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A;Docker&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;" class="headerlink" title="CentOS 7 &#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86; 3.10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A;Docker&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F;"></a>CentOS 7 &#x7684;&#x5185;&#x6838;&#x592A;&#x8001;&#x4E86; 3.10&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x5F88;&#x591A;Docker&#x529F;&#x80FD;&#x4E0D;&#x652F;&#x6301;&#xFF1F; <a href="#centos-7-de-nei-he-tai-lao-liao-3-10-shi-bu-shi-hen-duo-docker-gong-neng-bu-zhi-chi" class="header-anchor">#</a></h2><p>&#x4E4B;&#x524D;&#x6211;&#x4E5F;&#x662F;&#x8FD9;&#x6837;&#x4EE5;&#x4E3A;&#x7684;&#xFF0C;&#x6BD5;&#x7ADF;&#x5F88;&#x591A;&#x5185;&#x6838;&#x529F;&#x80FD;&#x9700;&#x8981;&#x66F4;&#x9AD8;&#x7684;&#x7248;&#x672C;&#x3002;&#x6BD4;&#x5982; Overlay FS &#x9700;&#x8981;Linux 3.18&#xFF0C;&#x800C;Overlay network&#x9700;&#x8981;Linux 3.16&#x3002;&#x800C;CentOS 7&#x5185;&#x6838;&#x4E3A;3.10&#xFF0C;&#x6309;&#x7406;&#x8BF4;&#x4E0D;&#x4F1A;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x9AD8;&#x7EA7;&#x7279;&#x6027;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x4E8B;&#x5B9E;&#x5E76;&#x975E;&#x5982;&#x6B64;&#xFF0C;&#x7EA2;&#x5E3D;&#x56E2;&#x961F;&#x4F1A;&#x628A;&#x4E00;&#x4E9B;&#x65B0;&#x5185;&#x6838;&#x7684;&#x529F;&#x80FD;backport&#x56DE;&#x8001;&#x7684;&#x5185;&#x6838;&#x3002;&#x6BD4;&#x5982; <code>overlay fs</code>&#x7B49;&#x3002;&#x6240;&#x4EE5;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x4F9D;&#x65E7;&#x4F1A;&#x652F;&#x6301;&#x3002;&#x56E0;&#x6B64; CentOS 7&#x7684;Docker Engine&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x652F;&#x6301; <code>overlay network</code>&#xFF0C;&#x4EE5;&#x53CA; <code>overlay fs</code>&#x3002;&#x56E0;&#x6B64;&#x5728;&#x65B0;&#x7684; Docker 1.12 &#x4E2D;&#xFF0C;CentOS/RHEL 7 &#x624D;&#x6709;&#x53EF;&#x80FD;&#x652F;&#x6301; Swarm Mode&#x3002;</p>
<p>&#x5373;&#x4F7F;&#x7EA2;&#x5E3D;&#x4F1A;&#x628A;&#x4E00;&#x4E9B;&#x9AD8;&#x7248;&#x672C;&#x5185;&#x6838;&#x7684;&#x529F;&#x80FD;backport&#x56DE; 3.10 &#x5185;&#x6838;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x4FEE;&#x4FEE;&#x8865;&#x8865;&#x51FA;&#x6765;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x5F88;&#x7A33;&#x5B9A;&#xFF0C;&#x6240;&#x4EE5;&#x4F9D;&#x65E7;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x7EF4;&#x62A4;&#x5185;&#x6838;&#x7248;&#x672C;&#x5347;&#x7EA7;&#x7684;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x5982; Ubuntu&#x3002;</p>
<h2 id="centos-7-rhel-7-sheng-ji-1-12-hou-wu-fa-qi-dong-bao-cuo-unit-docker-socket-failed-to-load-no-such-file-or-directory"><a href="#CentOS-7-RHEL-7-&#x5347;&#x7EA7;-1-12-&#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x62A5;&#x9519;-Unit-docker-socket-failed-to-load-No-such-file-or-directory" class="headerlink" title="CentOS 7/RHEL 7 &#x5347;&#x7EA7; 1.12 &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x62A5;&#x9519; Unit docker.socket failed to load: No such file or directory."></a>CentOS 7/RHEL 7 &#x5347;&#x7EA7; 1.12 &#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x62A5;&#x9519; <code>Unit docker.socket failed to load: No such file or directory.</code> <a href="#centos-7-rhel-7-sheng-ji-1-12-hou-wu-fa-qi-dong-bao-cuo-unit-docker-socket-failed-to-load-no-such-file-or-directory" class="header-anchor">#</a></h2><p>&#x5176;&#x539F;&#x56E0;&#x662F;&#x7531;&#x4E8E;&#x4ECE; <code>1.12</code> &#x5F00;&#x59CB;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5728; <code>systemd</code> &#x4E2D;&#x5199;&#x4E2A; <code>docker.socket</code> &#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5C31;&#x968F;&#x5347;&#x7EA7;&#x800C;&#x5220;&#x9664;&#x4E86;&#x3002;&#x800C; <code>docker.service</code> &#x7531;&#x4E8E;&#x88AB;&#x4FEE;&#x6539;&#x8FC7;&#xFF08;&#x6216;&#x522B;&#x7684;&#x4EC0;&#x4E48;&#x539F;&#x56E0;&#xFF09;&#xFF0C;&#x5BFC;&#x81F4; <code>yum</code> &#x5347;&#x7EA7;&#x7684;&#x65F6;&#x5019;&#x6CA1;&#x6709;&#x66FF;&#x6362;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;&#x4E8E;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x65E7;&#x7684; <code>docker.service</code> &#x4E2D;&#x914D;&#x7F6E;&#x8981;&#x6C42;&#x6709; <code>docker.socket</code> &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5DF2;&#x7ECF;&#x5728;&#x65B0;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5BFC;&#x81F4;&#x542F;&#x52A8;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x6253;&#x5F00; <code>docker.service</code>&#xFF0C;&#x5C06;&#x5176;&#x53C2;&#x7167; <code>1.12</code> &#x7684;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#x5373;&#x53EF;&#x3002;&#x5BFB;&#x627E;&#x5230; <code>Required=docker.socket</code> &#x90A3;&#x884C;&#xFF0C;&#x5220;&#x6389;&#x3002;&#x7136;&#x540E;&#x5BFB;&#x627E;&#x5230; <code>docker daemon</code> &#x90A3;&#x884C;&#xFF0C;&#x5C06;&#x5176;&#x540E;&#x7684; <code>-H fd://</code> &#x5220;&#x6389;&#x3002;&#x5982;&#x679C;&#x613F;&#x610F;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x5C06; <code>docker daemon</code> &#x6539;&#x4E3A; <code>dockerd</code>&#xFF0C;&#x56E0;&#x4E3A;&#x4ECE; <code>1.12</code> &#x5F00;&#x59CB;&#x6539;&#x540D;&#x53EB;&#x8FD9;&#x4E2A;&#x4E86;&#x3002;&#x4FDD;&#x5B58;&#x9000;&#x51FA;&#x91CD;&#x542F;&#x670D;&#x52A1;&#x5373;&#x53EF;&#x3002;</p>
<h1 id="mac-windows-xiang-guan-wen-ti"><a href="#Mac-Windows-&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="Mac / Windows &#x76F8;&#x5173;&#x95EE;&#x9898;"></a>Mac / Windows &#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#mac-windows-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="wei-shi-me-zai-mac-xia-gua-zai-su-zhu-mu-lu-usr-local-nginx-bu-cheng-gong"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x5728;Mac&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;-usr-local-nginx&#x4E0D;&#x6210;&#x529F;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x5728;Mac&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;/usr/local/nginx&#x4E0D;&#x6210;&#x529F;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x5728;<code>Mac</code>&#x4E0B;&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;<code>/usr/local/nginx</code>&#x4E0D;&#x6210;&#x529F;&#xFF1F; <a href="#wei-shi-me-zai-mac-xia-gua-zai-su-zhu-mu-lu-usr-local-nginx-bu-cheng-gong" class="header-anchor">#</a></h2><p>&#x867D;&#x7136; Docker &#x56E2;&#x961F;&#x5C3D;&#x91CF;&#x8BA9;&#x4F7F;&#x7528; <a href="https://www.docker.com/products/docker-toolbox" target="_blank" rel="external">Docker Toolbox</a>, <a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="external">Docker for Mac</a> and <a href="https://docs.docker.com/docker-for-windows" target="_blank" rel="external">Docker fo Windows</a> &#x7684;&#x7528;&#x6237;&#x611F;&#x89C9;&#x64CD;&#x4F5C; Docker &#x5C31;&#x50CF;&#x5728; Linux &#x4E0B;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x5728; Mac/Windows &#x4E0A;&#x5E76;&#x975E;&#x662F;&#x76F4;&#x63A5;&#x8FD0;&#x884C; Docker &#x7684;&#x3002;&#x4E2D;&#x95F4;&#x7ECF;&#x8FC7;&#x4E86;&#x4E00;&#x4E2A; Linux &#x865A;&#x62DF;&#x673A;&#xFF0C;&#x800C; Docker &#x8FD0;&#x884C;&#x5728;&#x90A3;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x91CC;&#x3002;</p>
<p>&#x56E0;&#x6B64; Mac &#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x76EE;&#x5F55;&#x5B9E;&#x9645;&#x4E0A;&#x5E76;&#x4E0D;&#x662F; Docker &#x773C;&#x4E2D;&#x7684;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x7528;&#x6237;&#x5C3D;&#x91CF;&#x611F;&#x89C9;&#x4E0D;&#x5230;&#x8FD9;&#x4E2A;&#x5DEE;&#x5F02;&#xFF0C;<code>Boot2Docker</code> &#x6216;&#x8005; <code>Docker for Mac / Windows</code> &#x4E2D;&#xFF0C;&#x5C06;&#x4E00;&#x90E8;&#x5206;&#x7269;&#x7406;&#x4E3B;&#x673A;&#x7684;&#x76EE;&#x5F55;&#x6620;&#x5C04;&#x5230;&#x4E86; Linux &#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x5176;&#x4E0A; Docker &#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x8FD9;&#x4E9B;&#x7269;&#x7406;&#x673A;&#x7684;&#x76EE;&#x5F55;&#x4E86;&#x3002;</p>
<p>&#x51FA;&#x4E8E;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x628A;&#x7269;&#x7406;&#x673A;&#x7684;&#x6240;&#x6709;&#x76EE;&#x5F55;&#x90FD;&#x6620;&#x5C04;&#x5230; Linux &#x865A;&#x62DF;&#x673A;&#x5185;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x53EA;&#x6709;&#x5F53;&#x524D;&#x7528;&#x6237;&#x76EE;&#x5F55;&#x5728;&#x5185;&#x7684;&#x4E00;&#x4E9B;&#x76EE;&#x5F55;&#x4F1A;&#x88AB;&#x6620;&#x5C04;&#x5230; Linux &#x865A;&#x62DF;&#x673A;&#x5185;&#xFF0C;&#x6BD4;&#x5982; <code>/Users</code>, <code>/Volumes</code> &#x7B49;&#x3002;</p>
<p>&#x5BF9;&#x4E8E; <code>Docker for Mac</code> &#x7684;&#x7528;&#x6237;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x914D;&#x7F6E;&#x754C;&#x9762; <code>File Sharing</code> &#x4E2D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x7684;&#x6620;&#x5C04;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x51FA;&#x4E8E;&#x5B89;&#x5168;&#x8003;&#x8651;&#xFF0C;&#x4E0D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x6620;&#x5C04;&#xFF0C;&#x800C;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x7528;&#x6237;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x662F;&#x66F4;&#x597D;&#x5730;&#x505A;&#x6CD5;&#x3002;</p>
<h1 id="wei-da-de-qiang-xiang-guan-wen-ti"><a href="#&#x4F1F;&#x5927;&#x7684;&#x5899;&#x76F8;&#x5173;&#x95EE;&#x9898;" class="headerlink" title="&#x4F1F;&#x5927;&#x7684;&#x5899;&#x76F8;&#x5173;&#x95EE;&#x9898;"></a>&#x4F1F;&#x5927;&#x7684;&#x5899;&#x76F8;&#x5173;&#x95EE;&#x9898; <a href="#wei-da-de-qiang-xiang-guan-wen-ti" class="header-anchor">#</a></h1><h2 id="docker-toolbox-compose-machine-zong-shi-xia-zai-bu-lai-zen-me-ban"><a href="#Docker-Toolbox-Compose-Machine-&#x603B;&#x662F;&#x4E0B;&#x8F7D;&#x4E0D;&#x6765;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="Docker Toolbox/Compose/Machine &#x603B;&#x662F;&#x4E0B;&#x8F7D;&#x4E0D;&#x6765;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>Docker Toolbox/Compose/Machine &#x603B;&#x662F;&#x4E0B;&#x8F7D;&#x4E0D;&#x6765;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#docker-toolbox-compose-machine-zong-shi-xia-zai-bu-lai-zen-me-ban" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#x611F;&#x8C22;&#x4F1F;&#x5927;&#x7684;&#x5899;&#xFF0C;&#x7136;&#x540E;&#x7FFB;&#x5899;&#x4E0B;&#x8F7D;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x90E8;&#x5206;&#x5E38;&#x7528;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x6211;&#x4E0A;&#x4F20;&#x4E86;&#x4E00;&#x4EFD;&#x5230;&#x767E;&#x5EA6;&#x4E91;&#x4E0A;&#xFF0C;&#x9274;&#x4E8E;&#x767E;&#x5EA6;&#x4E91;&#x8FD9;&#x5C71;&#x5BE8;&#x8D27;&#x6587;&#x4EF6;&#x5B8C;&#x6574;&#x6027;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#xFF0C;&#x6211;zip&#x538B;&#x7F29;&#x4E86;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x6240;&#x4EE5;&#x8F83;&#x5927;&#xFF0C;&#x6162;&#x6162;&#x4E0B;&#x8F7D;&#x3002;</p>
<p>&#x94FE;&#x63A5;:<a href="https://pan.baidu.com/s/1o7V5scM" target="_blank" rel="external">https://pan.baidu.com/s/1o7V5scM</a> &#x5BC6;&#x7801;:tzxc</p>
<ul>
<li>Linux: <code>linux-1.12.0.zip</code></li>
<li>Mac: <code>mac-1.12.0.zip</code></li>
<li>Windows: <code>windows-1.12.0.zip</code></li>
</ul>
<p>ZIP &#x6587;&#x4EF6;&#x5185;&#x5305;&#x542B;&#x4E86; <code>md5sum.txt</code> &#x4EE5;&#x53CA; <code>sha256sum.txt</code>&#xFF0C;&#x4E0B;&#x8F7D;&#x540E;&#x53EF;&#x4EE5;&#x7528;&#x5176;&#x786E;&#x8BA4;&#x6587;&#x4EF6;&#x5B8C;&#x6574;&#x6027;&#x3002;</p>
<h2 id="shi-zhi-jie-yong-yum-apt-get-an-zhuang-docker-ma"><a href="#&#x662F;&#x76F4;&#x63A5;&#x7528;-yum-apt-get-&#x5B89;&#x88C5;-Docker-&#x5417;&#xFF1F;" class="headerlink" title="&#x662F;&#x76F4;&#x63A5;&#x7528; yum / apt-get &#x5B89;&#x88C5; Docker &#x5417;&#xFF1F;"></a>&#x662F;&#x76F4;&#x63A5;&#x7528; yum / apt-get &#x5B89;&#x88C5; Docker &#x5417;&#xFF1F; <a href="#shi-zhi-jie-yong-yum-apt-get-an-zhuang-docker-ma" class="header-anchor">#</a></h2><p>&#x65E0;&#x8BBA;&#x662F;CentOS&#x8FD8;&#x662F;Ubuntu&#xFF0C;&#x90FD;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x6E90;&#x91CC;&#x9762;&#x7684;Docker&#xFF0C;&#x7248;&#x672C;&#x592A;&#x53E4;&#x8001;&#xFF0C;&#x6CA1;&#x6CD5;&#x7528;&#x3002;</p>
<p>&#x5B98;&#x65B9;&#x6B63;&#x5F0F;&#x7684;&#x5B89;&#x88C5;Docker&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -fsSL https://get.docker.com/ | sh</div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x8BBF;&#x95EE;&#x5B98;&#x65B9;&#x6E90;&#x592A;&#x6162;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x7684;&#x6E90;&#x5B89;&#x88C5;&#xFF1A;</p>
<p>&#x4F7F;&#x7528;<code>&#x963F;&#x91CC;&#x4E91;</code>&#x7684;&#x5B89;&#x88C5;&#x811A;&#x672C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</div></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528;<code>DaoCloud</code>&#x7684;Docker&#x5B89;&#x88C5;&#x811A;&#x672C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL https://get.daocloud.io/docker | sh</div></pre></td></tr></table></figure>
<h2 id="docker-pull-hao-man-a-zen-me-ban"><a href="#docker-pull-&#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F;" class="headerlink" title="docker pull &#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F;"></a>docker pull &#x597D;&#x6162;&#x554A;&#x600E;&#x4E48;&#x529E;&#xFF1F; <a href="#docker-pull-hao-man-a-zen-me-ban" class="header-anchor">#</a></h2><p>&#x8981;&#x611F;&#x6069;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x3002;&#x4F7F;&#x7528;<code>&#x963F;&#x91CC;&#x4E91;&#x52A0;&#x901F;&#x5668;</code>&#x6216;&#x8005;<code>DaoCloud&#x7684;&#x52A0;&#x901F;&#x5668;</code>&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x4EE3;&#x7406;&#x3001;&#x955C;&#x50CF;&#xFF09;&#x5427;&#xFF1A;</p>
<p>&#x8981;&#x7533;&#x8BF7;&#x963F;&#x91CC;&#x4E91;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#xFF0C;&#x6CE8;&#x518C;&#x963F;&#x91CC;&#x4E91;&#x5F00;&#x53D1;&#x8D26;&#x6237;(<em>&#x514D;&#x8D39;&#x7684;</em>)&#x540E;&#xFF0C;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x94FE;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#xFF1A; <a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="external">https://cr.console.aliyun.com/#/accelerator</a></p>
<p>&#x8981;&#x7533;&#x8BF7; DaoCloud&#x52A0;&#x901F;&#x5668;&#x5730;&#x5740;&#xFF0C;&#x6CE8;&#x518C; DaoCloud &#x8D26;&#x6237;(<em>&#x652F;&#x6301;&#x5FAE;&#x4FE1;&#x767B;&#x5F55;</em>)&#xFF0C;&#x7136;&#x540E;&#x8BBF;&#x95EE;&#xFF1A; <a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="external">https://www.daocloud.io/mirror#accelerator-doc</a><br>DaoCloud &#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x811A;&#x672C;&#x5B89;&#x88C5;&#x52A0;&#x901F;&#x5668;&#xFF1A;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL https://get.daocloud.io/daotools/set_mirror.sh | sh <span class="_">-s</span> http://ef2bef07.m.daocloud.io</div></pre></td></tr></table></figure>
<p>&#x53C2;&#x8003;&#x535A;&#x6587;&#xFF1A;</p>
<p><a href="http://www.imike.me/2016/04/20/Docker%E4%B8%8B%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F/" target="_blank" rel="external">http://www.imike.me/2016/04/20/Docker%E4%B8%8B%E4%BD%BF%E7%94%A8%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F/</a></p>
<h3 id="ubuntu-14-04-pei-zhi"><a href="#Ubuntu-14-04-&#x914D;&#x7F6E;" class="headerlink" title="Ubuntu 14.04 &#x914D;&#x7F6E;"></a>Ubuntu 14.04 &#x914D;&#x7F6E; <a href="#ubuntu-14-04-pei-zhi" class="header-anchor">#</a></h3><p>&#x5BF9;&#x4E8E;&#x4F7F;&#x7528; <code>Upstart</code> &#x7684;&#x7CFB;&#x7EDF;(&#x5982; Ubuntu 14.04)&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x7C7B;&#x65B9;&#x6CD5;&#x914D;&#x7F6E;&#x52A0;&#x901F;&#x5668;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">&quot;DOCKER_OPTS=\&quot;\$DOCKER_OPTS &#x2013;registry-mirror=http://your-id.m.daocloud.io -d\&quot;&quot;</span> &gt;&gt; /etc/default/docker</div></pre></td></tr></table></figure>
<h3 id="ubuntu-16-04-pei-zhi"><a href="#Ubuntu-16-04-&#x914D;&#x7F6E;" class="headerlink" title="Ubuntu 16.04 &#x914D;&#x7F6E;"></a>Ubuntu 16.04 &#x914D;&#x7F6E; <a href="#ubuntu-16-04-pei-zhi" class="header-anchor">#</a></h3><p>&#x7F16;&#x8F91; <code>systemd</code> &#x7684;&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>docker.service</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /etc/systemd/system/multi-user.target.wants/docker.service</div></pre></td></tr></table></figure>
<p>&#x5728; <code>ExecStart</code> &#x4E2D;&#x7684;&#x884C;&#x5C3E;&#x6DFB;&#x52A0;&#x4E0A;&#x6240;&#x9700;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#xFF1A;</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">ExecStart</span>=/usr/bin/docker daemon -H fd:// --registry-mirror=https://jxus37ac.mirror.aliyuncs.com</div></pre></td></tr></table></figure>
<blockquote>
<p>&#x6CE8;: Docker 1.12 &#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;<code>docker daemon</code> &#x6539;&#x4E3A; <code>dockerd</code>&#x3002;</p>
</blockquote>
<p>&#x4FDD;&#x5B58;&#x9000;&#x51FA;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;&#x670D;&#x52A1;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo systemctl daemon-reload</div><div class="line">sudo systemctl restart docker</div></pre></td></tr></table></figure>
<p>&#x786E;&#x8BA4;&#x4E00;&#x4E0B;&#x914D;&#x7F6E;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x751F;&#x6548;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ps -ef | grep docker</div></pre></td></tr></table></figure>
<p>&#x751F;&#x6548;&#x540E;&#x8FD9;&#x91CC;&#x4F1A;&#x770B;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>
<h2 id="zhuang-wan-docker-toolbox-hou-fa-xian-xia-zai-jing-xiang-su-du-tai-man-shi-bu-shi-xu-yao-xiu-gai-shi-me-pei-zhi-wen-jian"><a href="#&#x88C5;&#x5B8C;-Docker-Toolbox-&#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F;" class="headerlink" title="&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F;"></a>&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#x53D1;&#x73B0;&#x4E0B;&#x8F7D;&#x955C;&#x50CF;&#x901F;&#x5EA6;&#x592A;&#x6162;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x4EC0;&#x4E48;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1F; <a href="#zhuang-wan-docker-toolbox-hou-fa-xian-xia-zai-jing-xiang-su-du-tai-man-shi-bu-shi-xu-yao-xiu-gai-shi-me-pei-zhi-wen-jian" class="header-anchor">#</a></h2><p>&#x5B89;&#x88C5; Docker Toolbox &#x65F6;&#xFF0C;&#x5B89;&#x88C5;&#x7A0B;&#x5E8F;&#x4F1A;&#x4F7F;&#x7528; <code>docker-machine</code> &#x4E3A;&#x4F60;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> virtualbox default</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x6CA1;&#x6709;&#x52A0;&#x4EFB;&#x4F55;&#x53C2;&#x6570;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x62E5;&#x6709;&#x4F1F;&#x5927;&#x7684;&#x5899;&#x7684;&#x56FD;&#x5185;&#x7F51;&#x7EDC;&#x6765;&#x8BF4;&#xFF0C;&#x6709;&#x4E9B;&#x4E0D;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x7B80;&#x5355;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5728;&#x5B89;&#x88C5;&#x5B8C; Docker Toolbox &#x540E;&#xFF0C;&#x5220;&#x6389;&#x9ED8;&#x8BA4;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x8BE5;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x521B;&#x5EFA;&#x65F6;&#x52A0;&#x5165;&#x6709;&#x4E2D;&#x56FD;&#x7279;&#x8272;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker-machine rm default</div><div class="line"></div><div class="line">docker-machine create <span class="_">-d</span> virtualbox \</div><div class="line">     --engine-registry-mirror https://jxus37ac.mirror.aliyuncs.com \</div><div class="line">     --engine-insecure-registry 192.168.99.0/24 \</div><div class="line">     --engine-storage-driver overlay2 \</div><div class="line">     default</div></pre></td></tr></table></figure>
<blockquote>
<p>&#x5220;&#x9664; <code>default</code> &#x865A;&#x62DF;&#x673A;&#x7684;&#x65F6;&#x5019;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x5176;&#x4E2D;&#x955C;&#x50CF;&#x3001;&#x5BB9;&#x5668;&#x7B49;&#x5185;&#x5BB9;&#x90FD;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</p>
</blockquote>
<h1 id="qi-ta-wen-ti"><a href="#&#x5176;&#x5B83;&#x95EE;&#x9898;" class="headerlink" title="&#x5176;&#x5B83;&#x95EE;&#x9898;"></a>&#x5176;&#x5B83;&#x95EE;&#x9898; <a href="#qi-ta-wen-ti" class="header-anchor">#</a></h1><h2 id="docker-zi-liao-hao-shao-a-wang-shang-de-ming-ling-zen-me-bu-neng-yong"><a href="#Docker-&#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F;" class="headerlink" title="Docker &#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F;"></a>Docker &#x8D44;&#x6599;&#x597D;&#x5C11;&#x554A;&#xFF1F;&#x7F51;&#x4E0A;&#x7684;&#x547D;&#x4EE4;&#x600E;&#x4E48;&#x4E0D;&#x80FD;&#x7528;&#xFF1F; <a href="#docker-zi-liao-hao-shao-a-wang-shang-de-ming-ling-zen-me-bu-neng-yong" class="header-anchor">#</a></h2><p>&#x9996;&#x5148;&#xFF0C;&#x505A;&#x6280;&#x672F;&#x5DE5;&#x4F5C;&#xFF0C;&#x8BF7;&#x73CD;&#x60DC;&#x751F;&#x547D;&#xFF0C;&#x8FDC;&#x79BB;&#x767E;&#x5EA6;&#xFF1B;<br>&#x5176;&#x6B21;&#xFF0C;&#x4E0D;&#x7FFB;&#x5899;&#x3001;&#x4E0D;&#x7528;Google&#x3001;&#x4E0D;&#x770B;&#x82F1;&#x6587;&#x8D44;&#x6599;&#xFF0C;&#x90A3;&#x8BF7;&#x8F6C;&#x884C;&#xFF0C;&#x6CA1;&#x6CD5;&#x6DF7;&#x3002;</p>
<p>&#x7136;&#x540E;&#x662F;&#x56DE;&#x7B54;&#x95EE;&#x9898;&#xFF0C;Docker&#x7684;&#x8D44;&#x6599;&#x5176;&#x5B9E;&#x5F88;&#x4E30;&#x5BCC;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8BB2;&#x89E3;&#x975E;&#x5E38;&#x8BE6;&#x7EC6;&#x3002;</p>
<p><a href="https://docs.docker.com/" target="_blank" rel="external">https://docs.docker.com/</a></p>
<p>&#x53E6;&#x5916;&#xFF0C;Docker&#x6709;&#x4E30;&#x5BCC;&#x7684;&#x955C;&#x50CF;&#x5E93;&#xFF0C;Docker Hub&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5B98;&#x65B9;(Official)&#x7684;&#x955C;&#x50CF;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x5236;&#x4F5C;&#x6BD4;&#x8F83;&#x7CBE;&#x826F;&#x3002;</p>
<p><a href="https://hub.docker.com/explore/" target="_blank" rel="external">https://hub.docker.com/explore/</a></p>
<p>&#x6240;&#x6709;&#x7684;&#x5B98;&#x65B9;&#x955C;&#x50CF;&#x90FD;&#x6709; <code>Dockerfile</code>&#xFF0C;&#x4EE5;&#x53CA;&#x5728;github&#x4E0A;&#x6709;&#x5168;&#x90E8;&#x751F;&#x6210;&#x955C;&#x50CF;&#x7684;&#x914D;&#x5957;&#x6587;&#x4EF6;&#xFF0C;&#x9075;&#x5FAA;&#x4E86;<code>Dockerfile</code>&#x7684;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E5F;&#x662F;&#x5F88;&#x597D;&#x5730;&#x5B66;&#x4E60;&#x8D44;&#x6599;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x5728; YouTube &#x7684; Docker &#x5B98;&#x65B9;&#x9891;&#x9053;&#x4E0B;&#x6709;&#x51E0;&#x767E;&#x4E2A;&#x89C6;&#x9891;&#x8BB2;&#x5EA7;&#xFF0C;&#x4ECE;&#x521D;&#x7EA7;&#x5230;&#x9AD8;&#x7EA7;&#x7528;&#x6237;&#x90FD;&#x80FD;&#x4ECE;&#x91CC;&#x9762;&#x5B66;&#x5230;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x3002;</p>
<p><a href="https://www.youtube.com/user/dockerrun" target="_blank" rel="external">https://www.youtube.com/user/dockerrun</a></p>
<h2 id="docker-1-8-yi-hou-ban-ben-du-you-shi-me-gai-jin-me"><a href="#Docker-1-8&#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F;" class="headerlink" title="Docker 1.8&#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F;"></a>Docker 1.8&#x4EE5;&#x540E;&#x7248;&#x672C;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x6539;&#x8FDB;&#x4E48;&#xFF1F; <a href="#docker-1-8-yi-hou-ban-ben-du-you-shi-me-gai-jin-me" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A;&#x7248;&#x672C;&#x53D1;&#x5E03;&#x65F6;&#xFF0C;&#x5B98;&#x65B9;&#x535A;&#x5BA2; <a href="https://blog.docker.com" target="_blank" rel="external">https://blog.docker.com</a> &#x90FD;&#x4F1A;&#x6709;&#x4E13;&#x95E8;&#x6587;&#x7AE0;&#x63CF;&#x8FF0;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x6539;&#x8FDB;&#x3002;</p>
<ul>
<li><a href="https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/" target="_blank" rel="external">https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/</a></li>
<li><a href="https://blog.docker.com/2016/02/docker-1-10/" target="_blank" rel="external">https://blog.docker.com/2016/02/docker-1-10/</a></li>
<li><a href="https://blog.docker.com/2016/04/docker-engine-1-11-runc/" target="_blank" rel="external">https://blog.docker.com/2016/04/docker-engine-1-11-runc/</a></li>
<li><a href="https://blog.docker.com/2016/06/docker-1-12-built-in-orchestration/" target="_blank" rel="external">https://blog.docker.com/2016/06/docker-1-12-built-in-orchestration/</a></li>
</ul>
<h2 id="kubernetes-zhe-ci-zha-nian-a"><a href="#Kubernetes-&#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;" class="headerlink" title="Kubernetes &#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F;"></a>Kubernetes &#x8FD9;&#x8BCD;&#x548B;&#x5FF5;&#x554A;&#xFF1F; <a href="#kubernetes-zhe-ci-zha-nian-a" class="header-anchor">#</a></h2><p>Kubernetes &#x7684;&#x53D1;&#x97F3;&#xFF1A;<code>koo-ber-nay&apos;-tace</code> &#xFF0C;&#x8FD9;&#x8BCD;&#x6765;&#x81EA;&#x5E0C;&#x814A;<code>&#x8235;&#x624B;</code>&#x8FD9;&#x4E2A;&#x8BCD;&#x3002;<br>&#x4F46;&#x662F;&#x7ECF;&#x5E38;&#x6709;&#x4EBA;&#x5FF5;&#x6210;&#xFF1A;<code>koo-ber-net-ees</code>&#xFF0C;&#x6216;&#x8005;<code>k8s</code>&#xFF0C;<code>k-eights</code>&#x3002;</p>
<p><a href="http://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html" target="_blank" rel="external">http://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html</a></p>
<h2 id="wen-yi-ju-kubernetes-wei-sha-jiao-k8s"><a href="#&#x95EE;&#x4E00;&#x53E5;-Kubernetes-&#x4E3A;&#x5565;&#x53EB;-&#x201C;k8s&#x201D;&#xFF1F;" class="headerlink" title="&#x95EE;&#x4E00;&#x53E5; Kubernetes &#x4E3A;&#x5565;&#x53EB; &#x201C;k8s&#x201D;&#xFF1F;"></a>&#x95EE;&#x4E00;&#x53E5; Kubernetes &#x4E3A;&#x5565;&#x53EB; &#x201C;k8s&#x201D;&#xFF1F; <a href="#wen-yi-ju-kubernetes-wei-sha-jiao-k8s" class="header-anchor">#</a></h2><p>&#x662F;&#x56E0;&#x4E3A;&#x53D1;&#x97F3;&#x63A5;&#x8FD1;&#x4E48;&#x2026;&#x2026;&#x597D;&#x5427;&#xFF0C;&#x5B9E;&#x8BDD;&#x8BF4;&#x4E86;&#x5427;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x72AF;&#x61D2;&#xFF0C;&#x6570;&#x6570; k &#x548C; s &#x4E2D;&#x95F4;&#x591A;&#x5C11;&#x4E2A;&#x5B57;&#x6BCD;&#xFF1F;8&#x4E2A;&#x5427;&#xFF0C;&#x8FD9;&#x4E2A;8 &#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x7701;&#x7565;8&#x4E2A;&#x5B57;&#x6BCD;&#xFF0C;&#x61D2;&#x5F97;&#x6572;&#x4E86;&#x2026;&#x2026; &#x5176;&#x5B9E;&#x8FD9;&#x7C7B;&#x7528;&#x6CD5;&#x5F88;&#x591A;&#xFF0C;&#x6BD4;&#x5982; i18n (internationalization), l11n (localization) &#x7B49;&#x7B49;&#xFF0C;&#x8001;&#x5916;&#x4E5F;&#x61D2;&#x5F97;&#x6253;&#x5B57;&#x554A;&#x3002;</p>
<h2 id="wo-de-pei-zhi-wen-jian-chuan-qun-wen-jian-liao-bang-mang-kan-kan-zhe-shi-wo-de-pei-zhi-sheng-lue-ji-qian-zi"><a href="#&#x6211;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F20;&#x7FA4;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x5E2E;&#x5FD9;&#x770B;&#x770B;&#xFF1F;&#x8FD9;&#x662F;&#x6211;&#x7684;&#x914D;&#x7F6E;&#x2026;-&#x7701;&#x7565;&#x51E0;&#x5343;&#x5B57;" class="headerlink" title="&#x6211;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F20;&#x7FA4;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x5E2E;&#x5FD9;&#x770B;&#x770B;&#xFF1F;&#x8FD9;&#x662F;&#x6211;&#x7684;&#x914D;&#x7F6E;&#x2026;(&#x7701;&#x7565;&#x51E0;&#x5343;&#x5B57;)"></a>&#x6211;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4F20;&#x7FA4;&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x5E2E;&#x5FD9;&#x770B;&#x770B;&#xFF1F;&#x8FD9;&#x662F;&#x6211;&#x7684;&#x914D;&#x7F6E;&#x2026;(&#x7701;&#x7565;&#x51E0;&#x5343;&#x5B57;) <a href="#wo-de-pei-zhi-wen-jian-chuan-qun-wen-jian-liao-bang-mang-kan-kan-zhe-shi-wo-de-pei-zhi-sheng-lue-ji-qian-zi" class="header-anchor">#</a></h2><p>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8FD9;&#x7C7B;&#x6587;&#x672C;&#x4E1C;&#x897F;&#xFF0C;&#x5E94;&#x8BE5;&#x7528;&#x8FD9;&#x7C7B;&#x526A;&#x8D34;&#x677F;&#x7F51;&#x7AD9;&#xFF0C;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7FA4;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x5927;&#x6BB5;&#x5237;&#x5C4F;&#xFF0C;&#x683C;&#x5F0F;&#x6DF7;&#x4E71;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x8BED;&#x6CD5;&#x9AD8;&#x4EAE;&#xFF1A;</p>
<ul>
<li><a href="http://pastebin.com/" target="_blank" rel="external">http://pastebin.com/</a></li>
<li><a href="http://paste.ubuntu.com/" target="_blank" rel="external">http://paste.ubuntu.com/</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;h1 id=&quot;qian-yan&quot;&gt;&lt;a href=&quot;#&amp;#x524D;&amp;#x8A00;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x524D;&amp;#x8A00;&quot;&gt;&lt;/a&gt;&amp;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="faq" scheme="http://blog.lab99.org/tags/faq/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Moby 的 Cool Hack session</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-12-video-moby-cool-hack-session-dockercon.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-12-video-moby-cool-hack-session-dockercon.html</id>
    <published>2016-07-11T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#nei-rong">&#x5185;&#x5BB9;</a></li>
<li><a href="#entropy-failure-injection-management-api-for-docker-platforms-by-jeff-nickoloff">Entropy: failure injection management API for Docker platforms by Jeff Nickoloff</a><ul>
<li><a href="#project-entropy">Project Entropy</a></li>
</ul>
</li>
<li><a href="#serverless-docker-by-ben-firshman">Serverless Docker by Ben Firshman</a><ul>
<li><a href="#serviceless-docker">Serviceless == Docker</a></li>
<li><a href="#wo-men-jin-tian-swarm-ji-qun-huan-jing-qi-shi-shi-mian-lin-he-90-nian-dai-cgi-yi-yang-de-wen-ti">&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C; 90&#x5E74;&#x4EE3;<code>CGI</code>&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;</a></li>
</ul>
</li>
<li><a href="#in-the-air-update-of-a-drone-with-docker-and-resin-io">In-the-air update of a drone with Docker and Resin.io</a><ul>
<li><a href="#drone-shi-yun-xing-yu-resin-io-jia-gou-de">Drone &#x662F;&#x8FD0;&#x884C;&#x4E8E; <code>Resin.io</code> &#x67B6;&#x6784;&#x7684;&#x3002;</a></li>
<li><a href="#sheng-ji-handover-strategy">&#x5347;&#x7EA7; Handover Strategy</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Moby&#x2019;s Cool Hack Session DockerCon<br>by Mano Marks and Kristie Howard</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/75vm6rRb6K0" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=75vm6rRb6K0" target="_blank" rel="external">https://www.youtube.com/watch?v=75vm6rRb6K0</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=k03143nuw7k&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/k03143nuw7k.html" target="_blank" rel="external">http://v.qq.com/x/page/k03143nuw7k.html</a></p>
<h1 id="nei-rong"><a href="#&#x5185;&#x5BB9;" class="headerlink" title="&#x5185;&#x5BB9;"></a>&#x5185;&#x5BB9; <a href="#nei-rong" class="header-anchor">#</a></h1><p>&#x6BCF;&#x5E74;DockerCon&#x7ED3;&#x5C3E;&#x90FD;&#x4F1A;&#x9009;&#x51FA;&#x6700;&#x6709;&#x521B;&#x610F;&#x7684;&#x9879;&#x76EE;&#x3002;</p>
<h1 id="entropy-failure-injection-management-api-for-docker-platforms-by-jeff-nickoloff"><a href="#Entropy-failure-injection-management-API-for-Docker-platforms-by-Jeff-Nickoloff" class="headerlink" title="Entropy: failure injection management API for Docker platforms by Jeff Nickoloff"></a>Entropy: failure injection management API for Docker platforms by Jeff Nickoloff <a href="#entropy-failure-injection-management-api-for-docker-platforms-by-jeff-nickoloff" class="header-anchor">#</a></h1><p>&#x4EE5;&#x524D;&#x5728;AWS&#x5DE5;&#x4F5C;&#xFF0C;&#x540E;&#x6765;&#x7ED9;&#x5F88;&#x591A;&#x516C;&#x53F8;&#x505A;&#x8FC7;&#x54A8;&#x8BE2;&#x3002;&#x5728;AWS&#x7684;&#x65F6;&#x5019;8&#x4E2A;&#x4EBA;&#x7684;&#x56E2;&#x961F;&#x7BA1;&#x7406;300&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>
<blockquote>
<p><strong>If something can fail, it will fail.</strong></p>
</blockquote>
<p>&#x5BF9;&#x4E8E;&#x8FD0;&#x7EF4;&#x6765;&#x8BF4;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x7ECF;&#x5E38; <code>fail</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5750;&#x5728;&#x5B9A;&#x65F6;&#x70B8;&#x5F39;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x67D0;&#x5929;<code>3am</code>&#x88AB;&#x53EB;&#x9192;&#x540E;&#x67E5;&#x4E86;&#x5F88;&#x4E45;&#xFF0C;&#x6700;&#x540E;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x770B;&#x5230;&#x4E00;&#x884C;&#x6CE8;&#x91CA;&#xFF0C;&#x201C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4F30;&#x8BA1;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x2026;&#x2026;&#x201D;</p>
<p>&#x4ECE;&#x5DE5;&#x7A0B;&#x89D2;&#x5EA6;&#x770B;&#x95EE;&#x9898;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x4ECE;&#x5982;&#x4F55;&#x8BA9;&#x6865;&#x62C6;&#x6389;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x5982;&#x4F55;&#x7EC4;&#x88C5;&#x8FD9;&#x4E2A;&#x6865;&#x7684;&#x89D2;&#x5EA6;&#x3002;</p>
<h2 id="project-entropy"><a href="#Project-Entropy" class="headerlink" title="Project Entropy"></a>Project Entropy <a href="#project-entropy" class="header-anchor">#</a></h2><p><a href="https://github.com/buildertools/entropy" target="_blank" rel="external">https://github.com/buildertools/entropy</a></p>
<p>Demo&#x4E2D;&#xFF0C;&#x7528;&#x4E00;&#x4E2A;<code>compose</code>&#x6587;&#x4EF6;&#xFF0C;&#x542F;&#x52A8;&#x4E00;&#x4E2A;3&#x8282;&#x70B9;<code>swarm cluster</code>&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;Docker In Docker &#xFF08;image: <code>docker:1.10-dind</code>)&#xFF0C;&#x8FD0;&#x884C;&#x5728; <code>Docker for Mac</code>, <code>1.12-rc2</code>&#x4E0A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">demo entropy-client create --frequency 10 --probability .50 --failure latency --image allingeek/gremlins --criteria service=PingGoogle</div></pre></td></tr></table></figure>
<p>&#x5229;&#x7528;Docker in Docker&#xFF0C;&#x6765;&#x5F15;&#x5165;&#x5EF6;&#x65F6;&#xFF0C;&#x751A;&#x81F3;&#x5931;&#x8D25;&#x3002;</p>
<h1 id="serverless-docker-by-ben-firshman"><a href="#Serverless-Docker-by-Ben-Firshman" class="headerlink" title="Serverless Docker by Ben Firshman"></a>Serverless Docker by Ben Firshman <a href="#serverless-docker-by-ben-firshman" class="header-anchor">#</a></h1><h2 id="serviceless-docker"><a href="#Serviceless-Docker" class="headerlink" title="Serviceless == Docker"></a>Serviceless == Docker <a href="#serviceless-docker" class="header-anchor">#</a></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># &#x5F15;&#x5165;Docker Library</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> dockerrun</div><div class="line"></div><div class="line"><span class="comment"># &#x8FDE;&#x63A5; Swarm API</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>client = dockerrun.from_env()</div><div class="line"></div><div class="line"><span class="comment"># &#x7136;&#x540E;&#x8FD0;&#x884C;&#x6307;&#x5B9A;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x7ED9;&#x5B9A;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>client.run(<span class="string">&quot;bfirsh/leftpad&quot;</span>, [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;5&quot;</span>])</div><div class="line"><span class="string">&apos;  foo\n&apos;</span></div></pre></td></tr></table></figure>
<p><code>dockerrun</code> package &#x662F; Ben &#x5199;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x5229;&#x7528; <code>docker-py</code> API&#x7684;&#x5305;&#x3002;&#x53EF;&#x4EE5;&#x7528;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x5F62;&#x5F0F;&#x6267;&#x884C; Docker &#x955C;&#x50CF;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x3002;</p>
<p>&#x5728; DockerCon &#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x662F; <code>&#x1F431;</code> vs <code>&#x1F436;</code> &#x7684;&#x6295;&#x7968; app&#x3002;&#x8FD9;&#x4E2A; app &#x6709;5&#x4E2A;&#x4E00;&#x76F4;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x800C;&#x6784;&#x6210;&#x3002;</p>
<blockquote>
<p><code>Voting App</code> &#x2192; <code>Message Queue</code> &#x2192; <code>Worker</code> &#x2192; <code>database</code> &#x2192; <code>Result App</code></p>
</blockquote>
<p>&#x5728; Ben &#x7684;&#x6F14;&#x793A;&#x4E2D;&#xFF0C;&#x4ED6;&#x6CA1;&#x6709;&#x6301;&#x7EED;&#x8FD0;&#x884C; <code>Message Queue</code> &#x548C; <code>Worker</code> &#x8FD9;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x7528;<code>dockerrun</code> &#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53BB;&#x8BB0;&#x5F55;&#x8BE5;&#x6295;&#x7968;&#x7ED3;&#x679C;&#xFF0C;&#x76F4;&#x63A5;&#x9001;&#x5230;&#x6570;&#x636E;&#x5E93;&#x3002;&#x8FD9;&#x6837;&#x53EA;&#x6709;&#x5728;&#x6709;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x8FD0;&#x884C;&#x8BB0;&#x5F55;&#x6295;&#x7968;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6CA1;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4E0D;&#x53BB;&#x8FD0;&#x884C;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x3002;</p>
<p>&#x7ED3;&#x6784;&#x5C31;&#x6539;&#x53D8;&#x4E3A;&#xFF1A;</p>
<blockquote>
<p><code>Voting App</code> &#x2192; <code>Record Vote Task</code> &#x2192; <code>Database</code> &#x2192; <code>Result App</code></p>
</blockquote>
<p>&#x7136;&#x540E;&#x518D;&#x89C2;&#x5BDF;&#x8FD9;&#x4E2A;&#x6784;&#x67B6;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0; <code>Voting App</code> &#x548C; <code>Result App</code> &#x8FD9;&#x662F;&#x4E24;&#x4E2A; <code>HTTP</code> &#x670D;&#x52A1;&#xFF0C;&#x800C;&#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x5C31;&#x662F;&#x5728;&#x90A3;&#x91CC;&#x7B49;&#x7740;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x3002;&#x4F3C;&#x4E4E;&#x8FD9;&#x4E2A;&#x4E5F;&#x53EF;&#x4EE5;&#x6539;&#x53D8; s<code>erviceless</code>&#xFF0C;<code>functional</code> &#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x9700;&#x6C42;&#x7684;&#x65F6;&#x5019;&#x624D;&#x8FD0;&#x884C;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5DF2;&#x7ECF;&#x51E0;&#x5341;&#x5E74;&#x524D;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x53EB;&#x505A; <code>CGI</code>(<em>&#x2026;&#x2026;&#x1F613;</em>)&#x3002;</p>
<p>&#x5BF9;&#x4E8E; <code>Voting App</code> &#x6765;&#x8BF4;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x56E0;&#x4E3A; <code>Python</code> &#x4E2D;&#x5185;&#x7F6E;&#x4E86; <code>CGIHandler()</code> &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x5E94;&#x7528;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x529F;&#x80FD;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x51E0;&#x5341;&#x5E74;&#x4E86;&#x3002;</p>
<p>&#x800C;&#x5BF9;&#x4E8E; <code>Result App</code> &#x6709;&#x4E9B;&#x9EBB;&#x70E6;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F; <code>Node.js App</code>&#xFF0C;&#x975E;&#x5E38;&#x73B0;&#x4EE3;&#xFF0C;&#x6CA1;&#x6709;&#x8FD9;&#x4E48;&#x53E4;&#x8001;&#x7684;&#x673A;&#x5236;&#x3002;&#x5F88;&#x9057;&#x61BE;&#x554A;&#xFF0C;&#x4E8E;&#x662F; Ben &#x51B3;&#x5B9A;&#x7528;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x652F;&#x6301;&#x4E0B;&#x4E00;&#x4EE3; <code>Serviceless</code> &#x7684;&#x8BED;&#x8A00;&#x91CD;&#x5199;&#x4E86; <code>Result App</code> - <code>Perl</code> (<em>&#x2026;&#x2026;&#x1F613;&#x8FD8;&#x80FD;&#x518D;&#x53E4;&#x8001;&#x4E9B;&#x4E48;&#xFF1F;&#xFF1F;</em>)</p>
<p>&#x7136;&#x540E;&#x73B0;&#x5728;&#x7ED3;&#x6784;&#x5C31;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x53D8;&#x5316;&#x4E86;&#xFF1A;</p>
<blockquote>
<p><code>Entrypoint</code> &#x2192; { <code>handle_vote</code> &#x2192; <code>process vote</code>, <code>handle_result</code> } &#x2192; <code>database</code></p>
</blockquote>
<p>&#x8BBF;&#x95EE;&#x670D;&#x52A1; <a href="http://localhost/vote/" target="_blank" rel="external">http://localhost/vote/</a> &#x540E;&#x4F1A;&#x770B;&#x5230;&#x5DF2;&#x7ECF;&#x89C1;&#x8FC7;&#x5F88;&#x591A;&#x6B21;&#x7684; <code>vote app</code>&#x3002;&#x800C;&#x4E0B;&#x65B9;&#x7684; <code>Container ID</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x6BCF;&#x6B21;&#x8BF7;&#x6C42;&#xFF0C;&#x90FD;&#x662F;&#x8FD0;&#x884C;&#x7684;&#x4E00;&#x4E2A;&#x65B0;&#x7684; Container &#x7684; ID&#xFF0C;&#x662F;&#x5728;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x4E00;&#x6B21;&#x76F8;&#x540C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<p>&#x57FA;&#x672C;&#x4E0A;&#xFF0C;&#x9664;&#x4E86;&#x5165;&#x53E3;&#x70B9;&#x548C;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x957F;&#x671F;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;/&#x670D;&#x52A1;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x662F; <code>Serviceless</code>&#x3002;</p>
<p>&#x8FD9;&#x4E2A;demo&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x8981;&#x63A8;&#x8350;&#x5927;&#x5BB6;&#x90FD;&#x653E;&#x5F03;&#x73B0;&#x4EE3;Web&#x6280;&#x672F;&#xFF0C;&#x800C;&#x56DE;&#x53BB;&#x7528;CGI&#xFF0C;&#x800C;&#x662F;&#x5C55;&#x793A;&#x4E86;&#x51E0;&#x4E2A;&#x6709;&#x610F;&#x601D;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ul>
<li>&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x7CFB;&#x5217;function&#x5C01;&#x88C5;&#x4E3A;&#x5BB9;&#x5668;&#xFF08;&#x66F4;&#x7EC6;&#x7C92;&#x5316;&#x7684;&#x5FAE;&#x670D;&#x52A1;&#xFF1F;&#xFF09;</li>
<li>&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x662F;&#x8FD0;&#x884C;&#x4E8E;swarm&#x4E0A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x6269;&#x5C55;</li>
<li>&#x4ECE;&#x5BB9;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x522B;&#x7684;&#x5BB9;&#x5668;</li>
</ul>
<h2 id="wo-men-jin-tian-swarm-ji-qun-huan-jing-qi-shi-shi-mian-lin-he-90-nian-dai-cgi-yi-yang-de-wen-ti"><a href="#&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C;-90&#x5E74;&#x4EE3;CGI&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C; 90&#x5E74;&#x4EE3;CGI&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;"></a>&#x6211;&#x4EEC;&#x4ECA;&#x5929;Swarm&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x5176;&#x5B9E;&#x662F;&#x9762;&#x4E34;&#x548C; 90&#x5E74;&#x4EE3;<code>CGI</code>&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898; <a href="#wo-men-jin-tian-swarm-ji-qun-huan-jing-qi-shi-shi-mian-lin-he-90-nian-dai-cgi-yi-yang-de-wen-ti" class="header-anchor">#</a></h2><p>Ben &#x5F15;&#x7533;&#x4E86;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x8DA3;&#x7684;&#x76F8;&#x4F3C;&#x6027;&#x3002;</p>
<p>&#x5728;90&#x5E74;&#x4EE3;&#xFF0C;CGI&#x662F;&#x975E;&#x5E38;&#x5438;&#x5F15;&#x4EBA;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6B64;&#x4E4B;&#x524D;&#x53EA;&#x80FD;&#x591F;&#x63D0;&#x4F9B;&#x9759;&#x6001;&#x9875;&#x9762;&#xFF0C;&#x800C;CGI&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x52A8;&#x6001;&#x7684;&#x5185;&#x5BB9;&#xFF1B;&#x800C;&#x4ECA;&#x5929;&#x5728;Swarm&#x8FD9;&#x79CD;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5176;&#x5B9E;&#x9762;&#x4E34;&#x7684;&#x662F;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x6B21;&#x9759;&#x6001;&#x7684;&#x4E0D;&#x662F;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x662F;&#x670D;&#x52A1;/&#x5BB9;&#x5668;/&#x670D;&#x52A1;&#x5668;&#xFF0C;Docker&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;&#x4E9B;&#x9759;&#x6001;&#x7684;&#x4E1C;&#x897F;&#x52A8;&#x6001;&#x5316;&#xFF0C;&#x4E0D;&#x540C;&#x5C42;&#x6B21;&#x7684;&#x5BB9;&#x5668;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x6709;&#x67D0;&#x4E9B;&#x5BB9;&#x5668;&#x6839;&#x636E;&#x9700;&#x6C42;&#x800C;&#x52A8;&#x6001;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#xFF0C;&#x4ECE;&#x524D;&#x7AEF;&#x5230;&#x4E2D;&#x95F4;&#x4EF6;&#x5230;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x5BB9;&#x5668;&#x6280;&#x672F;&#x4E0B;&#x5B9E;&#x73B0;&#x5168;&#x52A8;&#x6001;&#x73AF;&#x5883;&#x3002;</p>
<p><a href="https://github.com/bfirsh/serverless-docker#serverlessdocker" target="_blank" rel="external">https://github.com/bfirsh/serverless-docker#serverlessdocker</a></p>
<h1 id="in-the-air-update-of-a-drone-with-docker-and-resin-io"><a href="#In-the-air-update-of-a-drone-with-Docker-and-Resin-io" class="headerlink" title="In-the-air update of a drone with Docker and Resin.io"></a>In-the-air update of a drone with Docker and Resin.io <a href="#in-the-air-update-of-a-drone-with-docker-and-resin-io" class="header-anchor">#</a></h1><ul>
<li>&#x8DE8;&#x5E73;&#x53F0;&#x6784;&#x5EFA;</li>
<li>&#x5D4C;&#x5165;&#x5F0F;&#x8BBE;&#x5907;&#x6700;&#x5C0F;&#x7CFB;&#x7EDF;</li>
<li>&#x5BB9;&#x5668; Deltas</li>
<li>&#x5D4C;&#x5165;&#x5F0F;&#x5347;&#x7EA7; Strategies</li>
</ul>
<h2 id="drone-shi-yun-xing-yu-resin-io-jia-gou-de"><a href="#Drone-&#x662F;&#x8FD0;&#x884C;&#x4E8E;-Resin-io-&#x67B6;&#x6784;&#x7684;&#x3002;" class="headerlink" title="Drone &#x662F;&#x8FD0;&#x884C;&#x4E8E; Resin.io &#x67B6;&#x6784;&#x7684;&#x3002;"></a>Drone &#x662F;&#x8FD0;&#x884C;&#x4E8E; <code>Resin.io</code> &#x67B6;&#x6784;&#x7684;&#x3002; <a href="#drone-shi-yun-xing-yu-resin-io-jia-gou-de" class="header-anchor">#</a></h2><p><code>Resin.io</code> &#x2192; <code>Linux Kernel</code> + <code>yocto</code> + <code>Docker</code> + <code>Resin.io</code> Container + <code>App</code> Container + <code>Extensions</code> Container</p>
<h2 id="sheng-ji-handover-strategy"><a href="#&#x5347;&#x7EA7;-Handover-Strategy" class="headerlink" title="&#x5347;&#x7EA7; Handover Strategy"></a>&#x5347;&#x7EA7; Handover Strategy <a href="#sheng-ji-handover-strategy" class="header-anchor">#</a></h2><p>&#x73B0;&#x5728; <code>Drone</code> &#x4E0A;&#x8DD1;&#x7684;&#x662F; <code>Version 1</code>&#xFF0C;&#x5C06;&#x8981;&#x5347;&#x7EA7;&#x5230; <code>Version 2</code>&#x3002;&#x7B56;&#x7565;&#x5E76;&#x975E;&#x662F;&#x6740;&#x6389; <code>V1</code> &#x7136;&#x540E;&#x8FD0;&#x884C; <code>V2</code>&#xFF0C;&#x800C;&#x662F; <code>V2</code> &#x5BB9;&#x5668;&#x51C6;&#x5907;&#x597D;&#x540E;&#xFF0C;&#x5148;&#x8FD0;&#x884C;&#xFF0C;&#x8FD0;&#x884C;&#x540E; <code>V1</code> &#x5BB9;&#x5668;&#x5F00;&#x59CB;&#x5411; <code>V2</code> &#x5BB9;&#x5668;&#x4EA4;&#x63A5;&#x8D44;&#x6E90;(<code>rotors</code>, <code>camera</code>, <code>websocket</code>)&#x7B49;&#x3002;&#x4EA4;&#x63A5;&#x7ED3;&#x675F;&#x540E;&#xFF0C;<code>V2</code> &#x5B9E;&#x9645;&#x4E0A;&#x5DF2;&#x7ECF;&#x5728;&#x627F;&#x8F7D;&#x670D;&#x52A1;&#x4E86;&#xFF0C;<code>V1</code>&#x6CA1;&#x7528;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;<code>V1</code>&#x4F1A;&#x5411;&#x4E0A;&#x7EA7;&#x7533;&#x8BF7;&#x8BF4;<code>kill me</code>&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x5E73;&#x6ED1;&#xFF0C;&#x53EA;&#x6709;&#x975E;&#x5E38;&#x5C0F;&#x7684;gap&#x3002;</p>
<p>&#x73B0;&#x5728;&#x770B;&#x5230;&#x7684;Web&#x754C;&#x9762;&#x662F;Drone&#x8EAB;&#x4E0A;&#x8DD1;&#x7684;&#x4E00;&#x4E2A;Web&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD4;&#x56DE;&#x5B9E;&#x65F6;&#x7684;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6709;&#x65B0;&#x7684;&#x529F;&#x80FD;&#x63D0;&#x4EA4;&#x4E86;&#xFF0C;<code>git push resin master</code> &#x540E;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x5E76;&#x4E14;<code>push</code>&#x5230;<code>docker registry</code>&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x89E6;&#x53D1;&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#xFF0C;Drone&#x4F1A;&#x5F00;&#x59CB;&#x4E0B;&#x8F7D;&#x65B0;&#x7248;&#x672C;&#x7684;&#x955C;&#x50CF;&#x51C6;&#x5907;&#x8FD0;&#x884C;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x4F1A;&#x5728;Drone control panel&#x4E0A;&#x770B;&#x5230;&#x9640;&#x87BA;&#x4EEA;&#x4F1A;&#x6709;&#x4E9B;&#x6296;&#x52A8;&#xFF0C;&#x8FD9;&#x4E9B;&#x6296;&#x52A8;&#x662F;<code>V1</code>&#x548C;<code>V2</code>&#x5728;&#x4EA4;&#x63A5;sensor&#x63A7;&#x5236;&#x6743;&#x65F6;&#x4EA7;&#x751F;&#x7684;gap&#xFF0C;&#x975E;&#x5E38;&#x5C0F;&#x3002;&#x800C;&#x4E14;&#x5347;&#x7EA7;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x4F1A;&#x770B;&#x5230;&#x65B0;&#x7684;&#x70ED;&#x6210;&#x50CF;camera&#x5F00;&#x59CB;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：runC - 一个可以运行 Docker 容器的小引擎 - Phil Estes</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-11-video-runc-the-little-engine-that-could-run-docker-containers.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-11-video-runc-the-little-engine-that-could-run-docker-containers.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#shi-me-shi-oci">&#x4EC0;&#x4E48;&#x662F; OCI&#xFF1F;</a></li>
<li><a href="#shi-me-shi-runc">&#x4EC0;&#x4E48;&#x662F; <code>runC</code>&#xFF1F;</a><ul>
<li><a href="#introduction-to-runc">Introduction to <code>runc</code></a></li>
<li><a href="#runc-an-open-innovation-platform">runC: An open innovation platform</a></li>
</ul>
</li>
<li><a href="#demo">Demo</a><ul>
<li><a href="#some-tools">Some tools</a></li>
<li><a href="#ocitools">ocitools</a></li>
<li><a href="#chuang-jian-ji-ben-de-alpine-rong-qi">&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;<code>alpine</code>&#x5BB9;&#x5668;</a></li>
<li><a href="#geng-jia-fu-za-de-rong-qi-nginx">&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668; <code>nginx</code></a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - runC - The little engine that could (run Docker containers)<br>by Phil Estes from IBM Cloud (@estesp)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/ZAhzoz2zJj8" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=ZAhzoz2zJj8" target="_blank" rel="external">https://www.youtube.com/watch?v=ZAhzoz2zJj8</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=d0314aalgwo&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/d0314aalgwo.html" target="_blank" rel="external">http://v.qq.com/x/page/d0314aalgwo.html</a></p>
<h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><ul>
<li>&#x5DF2;&#x7ECF;&#x53C2;&#x4E0E;&#x5F00;&#x53D1;Docker&#x9879;&#x76EE;2&#x5E74;&#x4E86;&#xFF0C;&#x662F;Docker engine maintainer</li>
<li>&#x662F; Docker Captains &#x6210;&#x5458;</li>
<li>&#x5DF2;&#x7ECF;&#x53C2;&#x4E0E; Linux/OSS 10+ &#x5E74;&#x7684;&#x7ECF;&#x9A8C;</li>
<li>&#x5B9E;&#x73B0; Docker engine &#x7684;User namespace</li>
<li>&#x5E2E;&#x52A9;&#x8BBE;&#x8BA1; <code>v2.2</code> image spec &#x591A;&#x5E73;&#x53F0;&#x652F;&#x6301;</li>
<li>&#x5B9E;&#x73B0;&#x7B2C;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x591A;&#x5E73;&#x53F0;image &#xFF08;v2.3 registry &amp; Docker Hub)</li>
</ul>
<h1 id="shi-me-shi-oci"><a href="#&#x4EC0;&#x4E48;&#x662F;-OCI&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; OCI&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; OCI&#xFF1F; <a href="#shi-me-shi-oci" class="header-anchor">#</a></h1><p><code>OCI</code> &#x2192; <code>Open Container Initiative</code></p>
<ul>
<li><p>OCI &#x662F;&#x4E00;&#x4E2A; Linux foundation &#x534F;&#x4F5C;&#x9879;&#x76EE;</p>
</li>
<li><p>&#x4E0D;&#x53D7;&#x4EFB;&#x4F55;&#x5382;&#x5546;&#x6240;&#x63A7;&#x5236;</p>
</li>
<li><p>&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x6807;&#x51C6;</p>
<ul>
<li>&#x5305;&#x62EC;&#x5BB9;&#x5668; <code>runtime specification</code></li>
<li>&#x53C2;&#x8003;&#x8FD0;&#x884C;&#x65F6;</li>
<li><code>image format specificaiton</code></li>
</ul>
</li>
<li><p>&#x5BA3;&#x5E03;&#x4E8E; 2015/06/20</p>
</li>
<li><p>&#x7B7E;&#x7F72;&#x4E8E; 2015/12/08</p>
</li>
<li><p>&#x5F53;&#x524D;&#x5927;&#x7EA6;&#x6709;46&#x4E2A;&#x516C;&#x53F8;</p>
</li>
<li><p>&#x4ECA;&#x5E74;6&#x6708; <code>runtime specification</code> &#x5C06;&#x4F1A;&#x5230; <code>1.0.0-rc1</code>, <code>image format specification</code> &#x5C06;&#x4F1A;&#x5230; 0.3.0</p>
</li>
</ul>
<p><a href="https://github.com/opencontainers/" target="_blank" rel="external">https://github.com/opencontainers/</a></p>
<h1 id="shi-me-shi-runc"><a href="#&#x4EC0;&#x4E48;&#x662F;-runC&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; runC&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; <code>runC</code>&#xFF1F; <a href="#shi-me-shi-runc" class="header-anchor">#</a></h1><h2 id="introduction-to-runc"><a href="#Introduction-to-runc" class="headerlink" title="Introduction to runc"></a>Introduction to <code>runc</code> <a href="#introduction-to-runc" class="header-anchor">#</a></h2><p>runc &#x662F;&#x4E00;&#x4E2A; libcontainer &#x7684;wrapper<br>Libcontainer &#x5219;&#x662F;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x63A5;&#x53E3;</p>
<p>runc &#x9700;&#x8981;&#x4E24;&#x90E8;&#x5206;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x4E2A; OCI &#x914D;&#x7F6E;(JSON)</li>
<li>&#x4E00;&#x4E2A; root &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li>
</ul>
<p>&#x6240;&#x4EE5;&#xFF0C;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it &#x2014;<span class="built_in">read</span>-only -v /host:/hostpath alpine sh</div></pre></td></tr></table></figure>
<p>&#x547D;&#x4EE4;&#x5C06;&#x4F1A;&#x88AB;&#x7FFB;&#x8BD1;&#x4E3A; <code>config.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">    <span class="attr">&quot;ociVersion&quot;</span>: <span class="string">&quot;0.6.0-dev&quot;</span>,</div><div class="line">    <span class="attr">&quot;platform&quot;</span>: {</div><div class="line">        <span class="attr">&quot;os&quot;</span>: <span class="string">&quot;linux&quot;</span>,</div><div class="line">        <span class="attr">&quot;arch&quot;</span>: <span class="string">&quot;amd64&quot;</span></div><div class="line">    },</div><div class="line">    <span class="attr">&quot;process&quot;</span>: {</div><div class="line">        <span class="attr">&quot;terminal&quot;</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">&quot;args&quot;</span>: [</div><div class="line">            <span class="string">&quot;sh&quot;</span></div><div class="line">        ],</div><div class="line">        <span class="attr">&quot;env&quot;</span>: [</div><div class="line">            <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/bin&quot;</span>,</div><div class="line"></div><div class="line">        ]</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="runc-an-open-innovation-platform"><a href="#runC-An-open-innovation-platform" class="headerlink" title="runC: An open innovation platform"></a>runC: An open innovation platform <a href="#runc-an-open-innovation-platform" class="header-anchor">#</a></h2><ul>
<li><p>&#x5B9E;&#x73B0;&#x5E95;&#x5C42;&#x5BB9;&#x5668;&#x7279;&#x6027;</p>
<ul>
<li>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x7684;&#x7279;&#x6027;&#x5E94;&#x8BE5;&#x5B9A;&#x4E49;&#x4E8E; <code>OCI runtime specification</code></li>
<li>&#x65B0;&#x7684;&#x529F;&#x80FD; (<code>PID cgroup controls</code>, <code>checkpoint</code>/<code>restore</code>, <code>seccomp</code>) &#x5E94;&#x8BE5;&#x5728;<code>runC</code>&#x4E2D;&#x5B9E;&#x73B0;</li>
</ul>
</li>
<li><p>OCI &#x517C;&#x5BB9;/&#x53EF;&#x63D2;&#x63A5;&#x7684;&#x6267;&#x884C;&#x5F15;&#x64CE;</p>
<ul>
<li>&#x901A;&#x8FC7; OCI spec &#x517C;&#x5BB9;&#x7684;&#x4EE3;&#x7801;&#x4E3A;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;OS&#x73AF;&#x5883;</li>
<li>&#x6BD4;&#x5982;&#xFF1A;<code>runz</code> (Solaris zones), <code>runv</code>(hypervisor-based), <code>Intel Clear Containers</code></li>
</ul>
</li>
<li><p>&#x8FED;&#x4EE3;&#x5F0F;&#x7684;&#x5BB9;&#x5668;&#x914D;&#x7F6E;&#x6D4B;&#x8BD5;/&#x8C03;&#x8BD5;</p>
<ul>
<li>&#x7B80;&#x5355;&#x7684; &#x201C;Docker-like&#x201D; &#x53D8;&#x79CD;&#xFF0C;&#x66F4;&#x5C11;&#x7684; friction &#x548C;&#x5FEB;&#x901F;&#x53D8;&#x5316;</li>
<li>&#x964D;&#x4F4E;&#x4F9D;&#x8D56;&#x95E8;&#x69DB;&#xFF1A;&#x5355;&#x4E00;&#x7684;binary + &#x7269;&#x7406; r<code>ootfs bundle</code> + <code>JSON config</code></li>
</ul>
</li>
</ul>
<p>&#x524D;&#x5341;&#x8D21;&#x732E; <code>opencontainers/runc</code> &#x7684;&#x516C;&#x53F8;&#xFF1A;</p>
<p>Docker, OpenVZ, Huawei, Redhat, Google, IBM, SuSE, Pivotal, Fujitsu, Microsoft</p>
<h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><h2 id="some-tools"><a href="#Some-tools" class="headerlink" title="Some tools"></a>Some tools <a href="#some-tools" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/usr/bin/runc           https://github.com/opencontainers/runc</div><div class="line">/usr/bin/ocitools       https://github.com/opencontainers/ocitools</div><div class="line">/usr/<span class="built_in">local</span>/bin/riddlers https://github.com/jfrazelle/riddler</div><div class="line">/usr/<span class="built_in">local</span>/bin/netns    https://github.com/jfrazelle/netns</div><div class="line">/usr/<span class="built_in">local</span>/bin/uidmapshift  http://bazzar.launchpad.net/~serge-hallyn/+junk/nsexec/view/head:/uidmapshift.c</div></pre></td></tr></table></figure>
<blockquote>
<p><code>jfrazelle</code> - Jessica Frazelle - Queen of Container</p>
</blockquote>
<h2 id="ocitools"><a href="#ocitools" class="headerlink" title="ocitools"></a>ocitools <a href="#ocitools" class="header-anchor">#</a></h2><p><code>ocitools generate</code> &#x4F1A;&#x7ACB;&#x523B;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; JSON &#x6587;&#x4EF6;&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x57FA;&#x672C;&#x80FD;&#x529B;&#x7684; JSON &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<p><code>ocitools generate --help</code> &#x4F1A;&#x663E;&#x793A;&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x6709;&#x4E9B;&#x50CF; <code>docker run</code> &#x7684;&#x547D;&#x4EE4;&#x3002;</p>
<h2 id="chuang-jian-ji-ben-de-alpine-rong-qi"><a href="#&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;alpine&#x5BB9;&#x5668;" class="headerlink" title="&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;alpine&#x5BB9;&#x5668;"></a>&#x521B;&#x5EFA;&#x57FA;&#x672C;&#x7684;<code>alpine</code>&#x5BB9;&#x5668; <a href="#chuang-jian-ji-ben-de-alpine-rong-qi" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; docker container</span></div><div class="line">$ docker run --name alpine alpine date</div><div class="line"></div><div class="line"><span class="comment"># &#x8FD0;&#x884C; riddler&#xFF0C;&#x4F1A;&#x5C06;&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x4FDD;&#x5B58;&#x4E3A; config.json</span></div><div class="line">$ mkdir alpine</div><div class="line">$ riddler -idlen 65535 -idroot 100000</div><div class="line"></div><div class="line"><span class="comment"># &#x8FD0;&#x884C; runc</span></div><div class="line">$ runc start alpine</div></pre></td></tr></table></figure>
<p>&#x4EC0;&#x4E48;&#x7ED3;&#x679C;&#x90FD;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#xFF0C;&#x547D;&#x4EE4;&#x4E0D;&#x5DE5;&#x4F5C;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E24;&#x90E8;&#x5206;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x63D0;&#x4F9B;&#x4E86; <code>config.json</code>&#xFF0C;&#x8FD8;&#x7F3A; <code>rootfs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x63D0;&#x53D6; alpine &#x5BB9;&#x5668;&#x7684;rootfs&#x5230;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x4EE5;&#x53CA;&#x66F4;&#x6362;uid</span></div><div class="line">$ exportrootfs -u 10000 -r 65536 alpine</div><div class="line"></div><div class="line"><span class="comment"># &#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x91CC;&#x9762;&#x662F;&#x6807;&#x51C6;alpine&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;</span></div><div class="line">$ ls <span class="_">-l</span> rootfs</div><div class="line"></div><div class="line"><span class="comment"># &#x7136;&#x540E;&#x518D;&#x6B21;&#x5C1D;&#x8BD5;&#x8FD0;&#x884C; runc</span></div><div class="line">$ runc start alpine</div><div class="line">could not synchronise with container process: device or resource busy</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F;&#x7531;&#x4E8E; Ubuntu 14.04 &#x5185;&#x6838;&#x5347;&#x7EA7;&#x540E;&#x548C; Docker <code>user namespace</code> &#x51B2;&#x7A81;&#x7684;&#x4E00;&#x4E2A;<code>bug</code>&#xFF0C;&#x5DF2;&#x7ECF;&#x4FEE;&#x590D;&#x4E86;&#xFF0C;&#x5C06;&#x5728;&#x5728; <code>4.4.0-25</code> &#x53D1;&#x5E03;&#x540E;&#x89E3;&#x51B3;(&#x73B0;&#x5728;&#x662F;<code>4.4.0-28</code>)&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>runc</code> &#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x5C31;&#x6CA1;&#x6551;&#x4E86;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x662F; <code>mqueue</code> &#x5BFC;&#x81F4;&#x7684;&#xFF0C;&#x800C;&#x5728; <code>config.json</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x4F7F;&#x7528; <code>mqueue</code> &#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A; <code>/dev/mqueue</code> &#x90E8;&#x5206;&#x5220;&#x9664;&#x3002;&#x7136;&#x540E;&#x518D;&#x6B21;&#x5C1D;&#x8BD5;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ runc start alpine</div><div class="line">Tue Jun 21 20:51:54 UTC 2016</div></pre></td></tr></table></figure>
<p>&#x800C;&#x4E14;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4FEE;&#x6539; <code>config.json</code> &#x6765;&#x8FDB;&#x884C;&#x522B;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6BD4;&#x5982;&#x628A;&#x5176;&#x4E2D;&#x7684; <code>Terminal</code> &#x6539;&#x4E3A; <code>true</code>&#xFF0C;&#x628A;<code>args</code>&#x4E2D;&#x7684;<code>/bin/date</code>&#x6539;&#x4E3A;<code>sh</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ runc start alpine</div><div class="line">/ <span class="comment"># ls -l</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x91CC;&#x663E;&#x793A;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x6709;&#x4FE1;&#x606F;&#x662F; <code>root</code>&#xFF0C;&#x800C;&#x5728;&#x5916;&#x754C; <code>uid</code> &#x5219;&#x662F; <code>100000</code>&#x3002;</p>
<p>&#x6B64;&#x65F6;&#x7684;&#x7F51;&#x7EDC;&#x90E8;&#x5206;&#x8FD8;&#x662F;&#x4E0D;&#x5DE5;&#x4F5C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; <code>runc</code> &#x4E0D;&#x8D1F;&#x8D23;&#x7F51;&#x7EDC;&#x90E8;&#x5206;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ifconfig</div><div class="line">lo  ...</div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; <code>riddler</code> &#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;<br>&#x4F7F;&#x7528; <code>hook</code>&#xFF0C;&#x5728; <code>prestart</code> &#x7684;&#x65F6;&#x5019;&#x6267;&#x884C; <code>netns</code><br>&#x5F53;&#x7136;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x53BB;&#x6389; <code>mqueue</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">riddler -idlen 65535 -idroot 100000 -hook prestart:netns alpine</div></pre></td></tr></table></figure>
<p>&#x6B64;&#x65F6;&#x518D;&#x8FD0;&#x884C; runc&#xFF0C;&#x5C31;&#x6709;&#x4E86;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5916;&#x90E8;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ runc start alpine</div><div class="line">/ <span class="comment"># ifconfig</span></div><div class="line">eth0 ...</div><div class="line">lo ...</div></pre></td></tr></table></figure>
<p><code>runc</code>, <code>docker</code> &#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x9650;&#x5236;&#x4E86;&#x5F88;&#x591A; <code>syscall</code>&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x5728;&#x4E8E;&#x90A3;&#x4E9B;&#x7BA1;&#x7406;&#x6027;&#x8D28;&#x7684;<br>&#x6BD4;&#x5982; <code>get_hostname</code> &#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x662F; <code>set_hostname</code> &#x5C31;&#x4E0D;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x5982;&#x679C;&#x67E5;&#x770B; <code>config.json</code> &#x4F1A;&#x770B;&#x5230;&#xFF0C;&#x914D;&#x7F6E; <code>Hostname</code> &#x6240;&#x9700;&#x7684; <code>SYS_ADMIN</code> &#x6743;&#x9650;&#x5E76;&#x4E0D;&#x5728;&#x5217;&#x8868;&#x4E2D;&#x3002;<br>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86; <code>CAP_SYS_ADMIN</code> &#x5230; <code>capabilities</code> &#x4E2D;&#xFF0C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x4FEE;&#x6539; <code>hostname</code> &#x4E86;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/ <span class="comment"># hostname</span></div><div class="line">alpine</div><div class="line">/ <span class="comment"># hostname foo</span></div><div class="line">/ <span class="comment"># hostname</span></div><div class="line">foo</div><div class="line">/ <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x5229;&#x7528; <code>seccomp</code> &#x7CBE;&#x8C03;&#x8FD9;&#x90E8;&#x5206;&#x6743;&#x9650;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06; <code>config.json</code> &#x4E2D;&#x7684; <code>sethostname</code> &#x7684;&#x6743;&#x9650;&#x4ECE; <code>SCMP_ACT_ALLOW</code> &#x6539;&#x4E3A; <code>SCMP_ACT_KILL</code>&#xFF0C;&#x7136;&#x5F53;&#x6211;&#x4EEC;&#x518D;&#x6B21;&#x6267;&#x884C; <code>hostname</code> &#x8BBE;&#x7F6E;&#x4E3B;&#x673A;&#x65F6;&#x5C31;&#x4F1A;&#x62A5;&#x9519;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/ <span class="comment"># hostname</span></div><div class="line">alpine</div><div class="line">/ <span class="comment"># hostname foo</span></div><div class="line">Bad system call</div></pre></td></tr></table></figure>
<h2 id="geng-jia-fu-za-de-rong-qi-nginx"><a href="#&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668;-nginx" class="headerlink" title="&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668; nginx"></a>&#x66F4;&#x52A0;&#x590D;&#x6742;&#x7684;&#x5BB9;&#x5668; <code>nginx</code> <a href="#geng-jia-fu-za-de-rong-qi-nginx" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528; <code>runc</code> &#x5728;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x8FD0;&#x884C;&#x4E86; <code>nginx</code>&#xFF0C;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x8FD0;&#x884C;&#x4E86;<code>lynx</code>&#x6765;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x3002;</p>
<p>&#x8FD0;&#x884C; <code>ps aux | grep nginx</code> &#x4F1A;&#x53D1;&#x73B0; <code>nginx</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4EE5;<code>root</code>&#x8EAB;&#x4EFD;&#x8FD0;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6700;&#x521D;&#x5BFC;&#x51FA;&#x7684;&#x65F6;&#x5019;&#x5FD8;&#x8BB0;&#x4E86;&#x8BBE;&#x7F6E; <code>uid</code>&#x3002;&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x505A;&#x4E00;&#x4E2A;<code>nginx</code>&#x5BB9;&#x5668;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker run --name nginx nginx</div><div class="line">riddler -idlen 65536 -idroot 200000 -hook prestart:netns nginx</div><div class="line">exportrootfs -u 200000 -r 65536 nginx</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6B21;&#x518D; <code>ps aux | grep nginx</code> &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x4EE5; <code>200000</code> id &#x8FD0;&#x884C;&#x7684; nginx &#x5BB9;&#x5668;&#x4E86;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x77E5;&#x9053;&#x4E86; <code>rootfs</code> &#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x5230;&#x8FD9;&#x4E2A;&#x4F4D;&#x7F6E;&#x66FF;&#x6362;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x8FD0;&#x884C;&#x5728;&#x7528;&#x6237; <code>namespace</code> &#x7684; <code>nginx pid</code> &#x662F; <code>24252</code>&#xFF0C;&#x53EF;&#x4EE5; <code>ls -l /proc/24252/ns</code> &#x770B;&#x5230; <code>namespace</code> &#x7684;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x5982;&#x679C;&#x60F3;&#x521B;&#x9020;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x5171;&#x4EAB;&#x7684; <code>alpine</code>&#xFF0C;&#x90A3;&#x4E48;&#x5FC5;&#x987B;<code>user namespace</code>&#x4E00;&#x81F4;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir alpine2</div><div class="line"><span class="built_in">cd</span> alpine2</div><div class="line">riddler -idlen 65536 -idroot 200000 alpine</div><div class="line">exportrootfs -u 200000 -r 65536 alpine</div></pre></td></tr></table></figure>
<p>&#x5728; <code>config.json</code> &#x4E2D;&#x627E;&#x5230; <code>&quot;type&quot;: &quot;network&quot;</code>&#xFF0C;&#x6DFB;&#x52A0;&#x4E00;&#x884C;<code>path</code>&#xFF0C;&#x65E2;&#xFF1A;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;network&quot;</span>,</div><div class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/proc/24252/ns/net&quot;</span></div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x540C;&#x6837;&#x4FEE;&#x6539; <code>user namespace</code>&#xFF1A;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;user&quot;</span>,</div><div class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/proc/24252/ns/user&quot;</span></div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A; <code>alpine2</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ runc start alpine2</div><div class="line">/ <span class="comment"># ifconfig</span></div><div class="line">eth0    ...</div><div class="line">        inet addr: 172.19.0.11 ...</div><div class="line">...</div></pre></td></tr></table></figure>
<p><code>alpine2</code> &#x8FD0;&#x884C;&#x5728;&#x4E86;&#x521A;&#x624D; <code>nginx</code> &#x7684;&#x7F51;&#x7EDC;&#x91CC;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 开发环境 - 第二讲 - Borja Burgos</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-2.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-2.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#docker-cloud-gou-jian-bu-shu-yun-xing">Docker Cloud: &#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C;</a></li>
<li><a href="#automation">Automation</a></li>
<li><a href="#collaboration">Collaboration</a></li>
<li><a href="#demo">Demo</a><ul>
<li><a href="#staging">Staging</a></li>
<li><a href="#production">Production</a></li>
</ul>
</li>
<li><a href="#kai-shi-yan-shi">&#x5F00;&#x59CB;&#x6F14;&#x793A;</a><ul>
<li><a href="#shou-xian-fu-yu-xin-yuan-gong-docker-cloud-quan-xian">&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5; docker cloud &#x6743;&#x9650;</a></li>
<li><a href="#fernando-jie-shou-xiu-gai-gong-zuo">Fernando &#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C;</a></li>
<li><a href="#boss-borja-guo-lai-cha-kan-gong-zuo-fa-xian-ce-shi-shi-bai">Boss (Borja) &#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;</a></li>
<li><a href="#fernando-xiu-gai-dai-ma-yi-man-zu-ce-shi-xu-qiu">Fernando &#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;</a></li>
<li><a href="#docker-cloud-jin-xing-jing-xiang-gou-jian-bing-zi-dong-bu-shu">Docker Cloud &#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72;</a></li>
<li><a href="#zai-bu-shu-dao-sheng-chan-huan-jing-qian-jin-xing-an-quan-jian-cha">&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;</a></li>
</ul>
</li>
<li><a href="#wen-da">&#x95EE;&#x7B54;</a><ul>
<li><a href="#q-wo-xiang-zhi-dao-ni-men-shi-zen-me-jie-jue-mi-yao-mi-ma-lei-de-wen-ti-bi-ru-zai-gang-cai-de-li-zi-zhong-staging-de-fu-wu-bu-shu-xiang-guan-de-mi-ma-bi-ran-he-sheng-chan-huan-jing-bu-tong-er-zhe-xie-ken-ding-bu-hui-fang-dao-dai-ma-zhong-na-me-ni-men-zen-me-jie-jue-zhe-ge-wen-ti-de">Q: &#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging &#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F;</a></li>
<li><a href="#q-li-zi-zhong-yan-shi-de-ke-yi-tian-jia-zu-zhi-ji-cheng-yuan-zhe-xie-gong-neng-shi-me-shi-hou-ke-yi-ga-gei-da-jia-yong">Q: &#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F;</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker for Developers - Part 2<br>by Borja Burgos, Fernando Mayo</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/ZsIb5tkyncA" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=ZsIb5tkyncA" target="_blank" rel="external">https://www.youtube.com/watch?v=ZsIb5tkyncA</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=j0314zhu619&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/j0314zhu619.html" target="_blank" rel="external">http://v.qq.com/x/page/j0314zhu619.html</a></p>
<h1 id="docker-cloud-gou-jian-bu-shu-yun-xing"><a href="#Docker-Cloud-&#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C;" class="headerlink" title="Docker Cloud: &#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C;"></a>Docker Cloud: &#x6784;&#x5EFA;&#x3001;&#x90E8;&#x7F72;&#x3001;&#x8FD0;&#x884C; <a href="#docker-cloud-gou-jian-bu-shu-yun-xing" class="header-anchor">#</a></h1><ul>
<li><p>&#x6784;&#x5EFA;</p>
<ul>
<li>Docker Builds</li>
<li>Integration Tests</li>
<li>Privacy controls</li>
<li>Parallelism</li>
<li>Official Images</li>
</ul>
</li>
<li><p>&#x90E8;&#x7F72;</p>
<ul>
<li>&#x516C;&#x5171; registry</li>
<li>&#x79C1;&#x6709; repositories</li>
<li>&#x5B89;&#x5168;&#x626B;&#x63CF;</li>
<li>&#x591A;&#x6784;&#x67B6;</li>
</ul>
</li>
<li><p>&#x8FD0;&#x884C;</p>
<ul>
<li>&#x6784;&#x67B6; agnostic</li>
<li>overlay network</li>
<li>&#x670D;&#x52A1;&#x53D1;&#x73B0;</li>
<li>&#x4E00;&#x952E;&#x5347;&#x7EA7;</li>
<li>&#x5BB9;&#x6613;&#x6269;&#x5C55;</li>
</ul>
</li>
</ul>
<h1 id="automation"><a href="#Automation" class="headerlink" title="Automation"></a>Automation <a href="#automation" class="header-anchor">#</a></h1><p>&#x4F7F;&#x7528; <code>Docker Cloud</code> &#xFF0C;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x4ECE; <code>CI</code> &#x5230; <code>CD</code> &#x7684;&#x5168;&#x7A0B;&#x81EA;&#x52A8;&#x5316;&#x8FC7;&#x7A0B;&#x3002;</p>
<h1 id="collaboration"><a href="#Collaboration" class="headerlink" title="Collaboration"></a>Collaboration <a href="#collaboration" class="header-anchor">#</a></h1><p>&#x4F7F;&#x7528; <code>Docker Cloud</code> &#x53EF;&#x4EE5;&#x8BA9;&#x56E2;&#x961F;&#x5728;&#x4E91;&#x73AF;&#x5883;&#x534F;&#x4F5C; <code>CI</code>/<code>CD</code></p>
<h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF0C;&#x4E00;&#x4E2A;&#x516C;&#x53F8;&#x53EB;&#x505A; <code>Cloudvote</code>&#x3002;&#x9700;&#x8981;&#x5BF9;&#x5206;&#x6B65;<code>CI</code>/<code>CD</code>&#x3002;</p>
<h2 id="staging"><a href="#Staging" class="headerlink" title="Staging"></a>Staging <a href="#staging" class="header-anchor">#</a></h2><blockquote>
<p><code>&#x81EA;&#x52A8;&#x6784;&#x5EFA;</code> &#x2192; <code>&#x6D4B;&#x8BD5;</code> &#x2192; <code>&#x5B89;&#x5168;&#x626B;&#x63CF;</code> &#x2192; <code>&#x91CD;&#x65B0;&#x90E8;&#x7F72;</code></p>
</blockquote>
<p>&#x4EE3;&#x7801;&#x5B58;&#x50A8;&#x4E8E; <code>GitHub</code> &#x7684; <code>staging</code> &#x5206;&#x652F;&#x4E2D;&#xFF0C;{<code>/worker</code>, <code>/result-app</code>, <code>/voting-app</code>}&#xFF0C;&#x4ECE; <code>git push</code> &#x5F00;&#x59CB;&#xFF0C;&#x81EA;&#x52A8;&#x6784;&#x5EFA;&#xFF0C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x4E14;<code>push</code>&#x4E3A; <code>cloudvote</code>/{<code>worker</code>,<code>result-app</code>,<code>voting-app</code>}:<code>staging</code>&#xFF0C;&#x7136;&#x540E;&#x90E8;&#x7F72;&#x5230; D<code>igital Ocean</code> 2&#x8282;&#x70B9;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x4E2D;&#x53BB;&#x8FD0;&#x884C;&#x3002;&#x5168;&#x90E8;&#x81EA;&#x52A8;&#x5316;&#x8FD0;&#x884C;&#x3002;</p>
<h2 id="production"><a href="#Production" class="headerlink" title="Production"></a>Production <a href="#production" class="header-anchor">#</a></h2><blockquote>
<p><code>&#x81EA;&#x52A8;&#x6784;&#x5EFA;</code> &#x2192; <code>&#x6D4B;&#x8BD5;</code> &#x2192; <code>&#x5B89;&#x5168;&#x626B;&#x63CF;</code></p>
</blockquote>
<p>&#x4EE3;&#x7801;&#x5B58;&#x50A8;&#x4E8E; <code>GitHub</code> &#x7684; <code>master</code> &#x5206;&#x652F;&#xFF0C;&#x6784;&#x5EFA;&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#x540E;&#xFF0C;&#x6807;&#x8BB0;&#x4E3A; <code>:latest</code>&#xFF0C;&#x7136;&#x540E;&#x90E8;&#x7F72;&#x5230; <code>AWS</code> &#x7684;5&#x8282;&#x70B9;&#x53BB;&#x8FD0;&#x884C;&#x3002;</p>
<h1 id="kai-shi-yan-shi"><a href="#&#x5F00;&#x59CB;&#x6F14;&#x793A;" class="headerlink" title="&#x5F00;&#x59CB;&#x6F14;&#x793A;"></a>&#x5F00;&#x59CB;&#x6F14;&#x793A; <a href="#kai-shi-yan-shi" class="header-anchor">#</a></h1><h2 id="shou-xian-fu-yu-xin-yuan-gong-docker-cloud-quan-xian"><a href="#&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5;-docker-cloud-&#x6743;&#x9650;" class="headerlink" title="&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5; docker cloud &#x6743;&#x9650;"></a>&#x9996;&#x5148;&#x8D4B;&#x4E88;&#x65B0;&#x5458;&#x5DE5; docker cloud &#x6743;&#x9650; <a href="#shou-xian-fu-yu-xin-yuan-gong-docker-cloud-quan-xian" class="header-anchor">#</a></h2><p>&#x8BBF;&#x95EE; <a href="https://cloud.docker.com" target="_blank" rel="external">https://cloud.docker.com</a> &#xFF0C;&#x767B;&#x5F55;&#x540E;&#x9009;&#x62E9; <code>cloudvote app</code> &#x2192; <code>Teams</code> &#x2192; <code>&#x6DFB;&#x52A0;&#x7528;&#x6237;</code> &#x3002;&#x8FD9;&#x6837;&#x8BE5;&#x7528;&#x6237;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE; <a href="https://cloud.docker.com" target="_blank" rel="external">https://cloud.docker.com</a> &#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x9879;&#x76EE;&#x4E86;&#x3002;</p>
<h2 id="fernando-jie-shou-xiu-gai-gong-zuo"><a href="#Fernando-&#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C;" class="headerlink" title="Fernando &#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C;"></a>Fernando &#x63A5;&#x624B;&#x4FEE;&#x6539;&#x5DE5;&#x4F5C; <a href="#fernando-jie-shou-xiu-gai-gong-zuo" class="header-anchor">#</a></h2><p>Fernando &#x5F00;&#x59CB;&#x65B0;&#x7684;&#x5DE5;&#x4F5C;&#x540E;&#xFF0C;&#x5148;&#x53BB; <code>Github</code> &#x770B;&#x4E00;&#x4E0B; <code>issue</code>&#x3002; &#x53D1;&#x73B0;&#x4E86;&#x65B0;&#x7684; <code>issue #2</code>&#xFF0C;&#x8981;&#x6C42;&#x628A; <code>Dog</code> &#x548C; <code>Cats</code> &#x6362;&#x4E3A;<code>&#x1F431;</code>&#x548C;<code>&#x1F436;</code>&#x4E24;&#x4E2A;emoji&#x3002;&#x597D;&#x5427;&#xFF0C;&#x5148; <code>fork</code> &#x8FD9;&#x4E2A; <code>repository</code>&#xFF0C;&#x7136;&#x540E; <code>clone</code> &#x5230;&#x672C;&#x5730;&#x3002;</p>
<p>&#x5148;&#x68C0;&#x67E5;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;&#x662F;&#x5426;&#x5982;&#x671F;&#x671B;&#x4E00;&#x822C;&#x5DE5;&#x4F5C;&#xFF0C;&#x7531;&#x4E8E;&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;&#x4E86; <code>Docker for Mac</code>&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x8FD0;&#x884C; <code>docker-compose up</code> &#xFF0C;&#x7136;&#x540E;&#x8BBF;&#x95EE; <code>localhost:5000</code> &#x548C; <code>localhost:5001</code> &#x770B;&#x7ED3;&#x679C;&#xFF0C;&#x55EF;&#xFF0C;&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x3002;</p>
<p>&#x7136;&#x540E;&#x5F00;&#x59CB;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF0C;&#x5148;&#x53BB; <a href="http://apps.timwhitlock.info/emoji/tables/unicode" target="_blank" rel="external">http://apps.timwhitlock.info/emoji/tables/unicode</a> &#x4E2D;&#x641C;&#x7D22;&#x5230; <code>dog face</code> &#x7684;emoji unicode&#x3002;&#x7136;&#x540E;&#x6253;&#x5F00; <code>instavote-app/result-app/views/index.html</code> &#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684; <code>Dogs</code>  &#x548C; <code>Cats</code> &#xFF0C;&#x6539;&#x53D8;&#x4E3A; Unicode &#x4E2D;&#x7684;&#x5BF9;&#x5E94;&#x503C;&#x3002;</p>
<p>&#x4F5C;&#x4E3A;&#x989D;&#x5916;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;Fernando &#x628A; Dog vote &#x63D0;&#x9AD8;&#x4E86;&#x4E00;&#x500D;&#xFF0C;&#x7136;&#x540E;&#x589E;&#x52A0;&#x4E86; <code>libxml2</code> &#x4F5C;&#x4E3A;&#x66F4;&#x597D;&#x7684;xml&#x652F;&#x6301;&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;<code>git diff</code> &#x68C0;&#x67E5;&#x53D8;&#x66F4;&#xFF0C;<code>git add .</code> &#x6DFB;&#x52A0;&#x4FEE;&#x6539;&#xFF0C;<code>git checkout -b myfeat</code> <code>&#x5C06;&#x5F53;&#x524D;staging</code> &#x4FEE;&#x6539;&#x7F6E;&#x4E8E; <code>myfeat</code> &#x5206;&#x652F;&#xFF0C;&#x7136;&#x540E; <code>git commit -m &#x201C;Awesome feature&#x201D;</code> &#x6765;&#x63D0;&#x4EA4;&#x4FEE;&#x6539;&#xFF0C;&#x7136;&#x540E; <code>git push origin my feat</code> &#x63D0;&#x4EA4;&#x53D8;&#x66F4;&#x3002;</p>
<p>&#x56DE;&#x5230; <code>github</code>&#xFF0C;&#x7136;&#x540E;&#x770B;&#x5230;&#x65B0;&#x7684;&#x5206;&#x652F;&#x5DF2;&#x7ECF;&#x4E0A;&#x6765;&#x4E86;&#xFF0C;&#x70B9;&#x51FB; <code>Compare &amp; Pull Request</code>&#xFF0C;&#x6765;&#x63D0;&#x4EA4;<code>PR</code>&#x3002; &#x9009;&#x62E9; <code>target</code> &#x4E3A; <code>staging</code> &#x5206;&#x652F;&#xFF0C;&#x70B9;&#x51FB;&#x63D0;&#x4EA4;&#xFF0C;&#x597D;&#x4E86;&#xFF0C;&#x5B8C;&#x4E8B;&#x513F;&#x4E86;&#x3002;&#x597D;&#x50CF;&#x6709;&#x4E9B;&#x4EC0;&#x4E48;<code>test</code>&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x65E0;&#x6240;&#x8C13;&#x4E86;&#xFF0C;&#x4E0D;&#x7BA1;&#x4E86;&#xFF0C;&#x7136;&#x540E; Fernando &#x901A;&#x77E5;&#x4E86;boss&#xFF0C;&#x5DE5;&#x4F5C;&#x505A;&#x5B8C;&#x4E86;&#x3002;</p>
<h2 id="boss-borja-guo-lai-cha-kan-gong-zuo-fa-xian-ce-shi-shi-bai"><a href="#Boss-Borja-&#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;" class="headerlink" title="Boss (Borja) &#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;"></a>Boss (Borja) &#x8FC7;&#x6765;&#x67E5;&#x770B;&#x5DE5;&#x4F5C;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25; <a href="#boss-borja-guo-lai-cha-kan-gong-zuo-fa-xian-ce-shi-shi-bai" class="header-anchor">#</a></h2><p>Borja &#x56DE;&#x6765;&#x8FDB;&#x4E00;&#x6B65;&#x89E3;&#x91CA; <code>test</code> &#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x3002;&#x6253;&#x5F00; <code>docker-compose.test.yml</code>&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x53EB;&#x505A; <code>sut</code> - system under test&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#x3001;&#x6D4B;&#x8BD5;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x3002;</p>
<p>&#x6253;&#x5F00;&#x6D4B;&#x8BD5;&#x9879;&#x76EE;&#xFF0C;<code>test.sh</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x8BD5;&#x56FE;&#x5224;&#x65AD;vote&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;</p>
<p>&#x89E3;&#x91CA;&#x540E;&#x56DE;&#x5230; <code>github</code> &#x9875;&#x9762;&#xFF0C;&#x53D1;&#x73B0;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#x4E86;&#xFF0C;Borja &#x8D28;&#x95EE;&#x4E3A;&#x5565;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x5931;&#x8D25;&#x4E86;&#x5462;&#xFF1F;Fernando&#x8BF4;&#xFF0C;&#x6211;&#x8FD8;&#x52A0;&#x4E86;&#x589E;&#x5F3A;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;&#x7ED9; dog x2 &#x7684;vote&#x3002;boss &#x663E;&#x7136;&#x4E0D;&#x540C;&#x610F;&#x8FD9;&#x79CD;&#x4E0D;&#x516C;&#x5E73;&#x7684;&#x5BF9;&#x5F85;&#xFF0C;&#x8981;&#x6C42;&#x5220;&#x9664;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x3002;</p>
<h2 id="fernando-xiu-gai-dai-ma-yi-man-zu-ce-shi-xu-qiu"><a href="#Fernando-&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;" class="headerlink" title="Fernando &#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42;"></a>Fernando &#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x4EE5;&#x6EE1;&#x8DB3;&#x6D4B;&#x8BD5;&#x9700;&#x6C42; <a href="#fernando-xiu-gai-dai-ma-yi-man-zu-ce-shi-xu-qiu" class="header-anchor">#</a></h2><p>&#x4E8E;&#x662F; Fernando &#x56DE;&#x5230;&#x4EE3;&#x7801;&#x7F16;&#x8F91;&#x5668;&#x4E2D;&#xFF0C;&#x5220;&#x6389;&#x8FD9;&#x90E8;&#x5206; code&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0; <code>git diff</code>, <code>git add .</code>, <code>git commit &#x2014;amend</code>, <code>git push &#x2014;force origin my feat</code>&#x3002;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>docker cloud</code> &#x5DF2;&#x7ECF;&#x88AB;&#x901A;&#x77E5;&#x6709;&#x65B0;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x4E8E;&#x662F;&#x5F00;&#x59CB;&#x8FD0;&#x884C;&#x65B0;&#x7684;&#x6D4B;&#x8BD5;&#x4E86;&#x3002;</p>
<h2 id="docker-cloud-jin-xing-jing-xiang-gou-jian-bing-zi-dong-bu-shu"><a href="#Docker-Cloud-&#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72;" class="headerlink" title="Docker Cloud &#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72;"></a>Docker Cloud &#x8FDB;&#x884C;&#x955C;&#x50CF;&#x6784;&#x5EFA;&#x5E76;&#x81EA;&#x52A8;&#x90E8;&#x7F72; <a href="#docker-cloud-jin-xing-jing-xiang-gou-jian-bing-zi-dong-bu-shu" class="header-anchor">#</a></h2><p><code>Docker cloud</code> &#x53EF;&#x4EE5;&#x5728;&#x516C;&#x6709;&#x4E91;&#x6216;&#x8005;&#x79C1;&#x6709;&#x4E91;&#x4E2D;&#x8FD0;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x76EE;&#x524D;&#x652F;&#x6301; <code>github</code> &#x548C; <code>bitbucket</code>&#x3002;</p>
<p>&#x6D4B;&#x8BD5;&#x901A;&#x8FC7;&#x540E;&#xFF0C;&#x70B9;&#x51FB; <code>merge</code> &#x5408;&#x5E76;&#x5230; <code>staging</code> &#x5206;&#x652F;&#x4E2D;&#x3002;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x81EA;&#x52A8;&#x5316;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x89E6;&#x53D1; Docker Cloud &#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;Docker &#x4F1A;&#x81EA;&#x52A8;&#x6784;&#x5EFA;&#x5BF9;&#x5E94;&#x955C;&#x50CF;&#x3002;</p>
<p>&#x5728; <code>Staging</code> &#x7684; <code>Service Stack</code> &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>Result-app</code> &#x7684; <code>AutoDeploy</code> &#x7684;&#x72B6;&#x6001;&#x662F; <code>ON</code>&#xFF0C;&#x8BF4;&#x660E;&#x6784;&#x5EFA;&#x6210;&#x529F;&#x4F1A;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;</p>
<p>Docker Cloud &#x8FD8;&#x96C6;&#x6210;&#x5230;&#x4E86; <code>Slack</code> &#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x6784;&#x5EFA;&#x4FE1;&#x606F;&#x7B49;&#x90FD;&#x4F1A;&#x5728; <code>slack</code> &#x91CC;&#x770B;&#x5230;&#x3002;&#x53EF;&#x4EE5;&#x5728; <code>#dockercloud</code> channel &#x4E2D;&#x770B;&#x5230;&#x6D4B;&#x8BD5;&#x5931;&#x8D25;&#x3001;&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#x3001;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x90E8;&#x7F72;&#x7B49;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x81EA;&#x52A8;&#x90E8;&#x7F72;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; Docker Cloud &#x4E2D;&#x63D0;&#x4F9B;&#x7684; url &#x8BBF;&#x95EE;&#x5BF9;&#x5E94;&#x5E94;&#x7528;&#x8FDE;&#x63A5;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x7ED3;&#x679C;&#x3002;</p>
<h2 id="zai-bu-shu-dao-sheng-chan-huan-jing-qian-jin-xing-an-quan-jian-cha"><a href="#&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;" class="headerlink" title="&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;"></a>&#x5728;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x524D;&#xFF0C;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5; <a href="#zai-bu-shu-dao-sheng-chan-huan-jing-qian-jin-xing-an-quan-jian-cha" class="header-anchor">#</a></h2><p>&#x5728; Docker Cloud &#x4E2D;&#x70B9;&#x51FB; <code>repository</code> &#x2192; <code>Result-app</code> &#x2192; <code>Tags</code> &#xFF08;&#x5237;&#x65B0;&#x4E00;&#x4E0B;&#x754C;&#x9762;&#xFF09;</p>
<p>&#x770B;&#x5230;&#x65B0;&#x7684; Image &#x88AB;&#x626B;&#x63CF;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x4E86; <code>libxml2</code> &#x5B58;&#x5728;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x8FD9;&#x662F; Fernando &#x6DFB;&#x52A0;&#x7684;&#x65B0;&#x7684;&#x4F9D;&#x8D56;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x90E8;&#x7F72;&#x5230;&#x751F;&#x4EA7;&#x670D;&#x52A1;&#x53BB;&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x89E3;&#x51B3;&#x5B89;&#x5168;&#x9690;&#x60A3;&#x95EE;&#x9898;&#x3002;</p>
<h1 id="wen-da"><a href="#&#x95EE;&#x7B54;" class="headerlink" title="&#x95EE;&#x7B54;"></a>&#x95EE;&#x7B54; <a href="#wen-da" class="header-anchor">#</a></h1><h2 id="q-wo-xiang-zhi-dao-ni-men-shi-zen-me-jie-jue-mi-yao-mi-ma-lei-de-wen-ti-bi-ru-zai-gang-cai-de-li-zi-zhong-staging-de-fu-wu-bu-shu-xiang-guan-de-mi-ma-bi-ran-he-sheng-chan-huan-jing-bu-tong-er-zhe-xie-ken-ding-bu-hui-fang-dao-dai-ma-zhong-na-me-ni-men-zen-me-jie-jue-zhe-ge-wen-ti-de"><a href="#Q-&#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging-&#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F;" class="headerlink" title="Q: &#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging &#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F;"></a>Q: &#x6211;&#x60F3;&#x77E5;&#x9053;&#x4F60;&#x4EEC;&#x662F;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x5BC6;&#x94A5;&#x3001;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;Staging &#x7684;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x76F8;&#x5173;&#x7684;&#x5BC6;&#x7801;&#x5FC5;&#x7136;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x653E;&#x5230;&#x4EE3;&#x7801;&#x4E2D;&#x3002;&#x90A3;&#x4E48;&#x4F60;&#x4EEC;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#xFF1F; <a href="#q-wo-xiang-zhi-dao-ni-men-shi-zen-me-jie-jue-mi-yao-mi-ma-lei-de-wen-ti-bi-ru-zai-gang-cai-de-li-zi-zhong-staging-de-fu-wu-bu-shu-xiang-guan-de-mi-ma-bi-ran-he-sheng-chan-huan-jing-bu-tong-er-zhe-xie-ken-ding-bu-hui-fang-dao-dai-ma-zhong-na-me-ni-men-zen-me-jie-jue-zhe-ge-wen-ti-de" class="header-anchor">#</a></h2><p>A: &#x6240;&#x6709;&#x7684; secret &#x90FD;&#x5B58;&#x50A8;&#x4E8E; docker cloud&#xFF0C;&#x955C;&#x50CF;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x91CC;&#x9762;&#x4E0D;&#x5305;&#x542B;&#x5BC6;&#x7801;&#x7C7B;&#x4FE1;&#x606F;&#xFF0C;&#x4ED6;&#x4EEC;&#x5E94;&#x8BE5;&#x662F;&#x72EC;&#x7ACB;&#x4E8E;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x7684;&#xFF0C;&#x5728;&#x4EFB;&#x4F55;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x90FD;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x3002;</p>
<h2 id="q-li-zi-zhong-yan-shi-de-ke-yi-tian-jia-zu-zhi-ji-cheng-yuan-zhe-xie-gong-neng-shi-me-shi-hou-ke-yi-ga-gei-da-jia-yong"><a href="#Q-&#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F;" class="headerlink" title="Q: &#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F;"></a>Q: &#x4F8B;&#x5B50;&#x4E2D;&#x6F14;&#x793A;&#x7684;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x7EC4;&#x7EC7;&#x53CA;&#x6210;&#x5458;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;GA&#x7ED9;&#x5927;&#x5BB6;&#x7528;&#xFF1F; <a href="#q-li-zi-zhong-yan-shi-de-ke-yi-tian-jia-zu-zhi-ji-cheng-yuan-zhe-xie-gong-neng-shi-me-shi-hou-ke-yi-ga-gei-da-jia-yong" class="header-anchor">#</a></h2><p>A: &#x73B0;&#x5728;&#x662F;&#x5185;&#x90E8; beta &#x6D4B;&#x8BD5;&#xFF0C;&#x5F88;&#x5FEB;&#x4F1A;&#x5F00;&#x653E;&#x51FA;&#x6765;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 开发环境 - 第一讲 - David Gageot</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-1.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-11-video-docker-for-developer-part-1.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#yan-shi">&#x6F14;&#x793A;</a></li>
<li><a href="#application-bundle">Application Bundle</a></li>
<li><a href="#wen-da">&#x95EE;&#x7B54;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker for Developer - Part 1<br>by David Gageot</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/SK0sqfVn7ls" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=SK0sqfVn7ls" target="_blank" rel="external">https://www.youtube.com/watch?v=SK0sqfVn7ls</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=l03143jinsh&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/l03143jinsh.html" target="_blank" rel="external">http://v.qq.com/x/page/l03143jinsh.html</a></p>
<h1 id="yan-shi"><a href="#&#x6F14;&#x793A;" class="headerlink" title="&#x6F14;&#x793A;"></a>&#x6F14;&#x793A; <a href="#yan-shi" class="header-anchor">#</a></h1><p><code>docker-compose up -d</code> &#x540E;&#xFF0C;&#x6240;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x4F1A;&#x51FA;&#x73B0;&#x5728; <code>localhost</code> &#x4E0A;&#xFF0C;&#x8FD9;&#x662F;&#x5728; Linux &#x4E16;&#x754C;&#x5F88;&#x6B63;&#x5E38;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x56E0;&#x4E3A;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x673A;&#x4E0A;&#x3002;&#x800C;&#x5728;&#x8FC7;&#x53BB;&#x7684; Docker Toolbox &#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x4F7F;&#x7528; boot2docker &#x8FD9;&#x4E2A;virtualbox &#x865A;&#x62DF;&#x673A;&#x7684;IP - <code>192.168.99.100</code> &#x6765;&#x8BBF;&#x95EE;&#xFF0C;&#x73B0;&#x5728;&#x7ECF;&#x8FC7;&#x5F88;&#x590D;&#x6742;&#x7684;&#x5E95;&#x5C42;&#x5904;&#x7406; (VPNkit)&#xFF0C;&#x4E00;&#x5207;&#x90FD;&#x53D8;&#x5F97;&#x50CF; Linux &#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x672C;&#x673A;&#x5730;&#x5740;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p>
<p>&#x6302;&#x8F7D;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x4EE5;&#x524D;&#x867D;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x6302;&#x8F7D;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4E2D;&#x95F4;&#x9694;&#x4E86;&#x4E00;&#x5C42; Virtualbox &#xFF0C;&#x5F88;&#x591A;&#x529F;&#x80FD;&#xFF0C;&#x5982; fs notification &#x65E0;&#x6CD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982; Live Reload&#x3002;&#x73B0;&#x5728;&#x901A;&#x8FC7; <code>OSXfs</code>&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x73B0;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x5F00;&#x542F; Live Relaod &#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x82F9;&#x679C;&#x4E0A;&#xFF0C;&#x7528;&#x4E60;&#x60EF;&#x7684;&#x7F16;&#x8F91;&#x5668;&#x7F16;&#x8F91;&#x4EE3;&#x7801;&#xFF0C;&#x6BD4;&#x5982;CSS&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x5B58;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x53D8;&#x5316;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x505A;&#x7684;&#x662F;&#x52A8;&#x6001;&#x8C03;&#x8BD5;&#x3002;&#x4E4B;&#x524D;<code>Keynote</code>&#x4E2D;&#x6F14;&#x793A;&#x4E86;&#x7528; <code>Visual Studio Code</code> &#x8C03;&#x8BD5; <code>Docker</code> &#x5185;&#x8FD0;&#x884C;&#x7684; <code>Node.js</code> &#x5E94;&#x7528;&#x3002;&#x8FD9;&#x6B21; David &#x6F14;&#x793A;&#x4E86;&#x8C03;&#x8BD5; Java &#x7A0B;&#x5E8F;&#xFF0C;&#x5E76;&#x4E14;&#x6F14;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x5177;&#x4F53;&#x8BBE;&#x7F6E;&#x3002;</p>
<p>Java &#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x8C03;&#x8BD5;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x5141;&#x8BB8;IDE&#x6765;&#x8FDE;&#x63A5;&#x8FD0;&#x884C;&#x7684;&#x5E94;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528; 5005 &#x7AEF;&#x53E3;&#x3002;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x662F;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#x7684;&#xFF1F;&#x6253;&#x5F00; IDE (<code>IntelliJ</code>) <code>Run/Debug Configuration</code>&#xFF0C;&#x70B9;&#x5DE6;&#x4E0A;&#x89D2;&#x2795;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x8C03;&#x8BD5;&#x914D;&#x7F6E; - <code>Remote</code>&#xFF0C;&#x7136;&#x540E;&#x81EA;&#x52A8;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x4F1A;&#x663E;&#x793A;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x91CC;&#x9ED8;&#x8BA4;&#x7684;&#x662F; <code>localhost</code> <code>5005</code>&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x9996;&#x5148;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5728; <code>words-java</code> &#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x5F00;&#x542F;&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x3002;&#x7136;&#x540E;<code>stop</code>, <code>rm -f</code>, <code>up -d</code> &#x91CD;&#x542F;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;&#x5728; <code>IntelliJ</code> &#x4E2D;&#x70B9;&#x51FB; <code>Debug</code> &#x6309;&#x94AE;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x8FDE;&#x63A5;&#x4E0A;&#x4E86;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;Java&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x5237;&#x65B0;&#x9875;&#x9762;&#xFF0C;&#x89E6;&#x53D1;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x53D1;&#x73B0;IDE&#x6210;&#x529F;&#x7684;&#x505C;&#x6B62;&#x5728;&#x4E86;&#x65AD;&#x70B9;&#x5904;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-compose scale words-java=20</div></pre></td></tr></table></figure>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;David &#x4F7F;&#x7528;&#x4E86; Go &#x8BF7;&#x6C42;Docker &#x5185;&#x7F6E;DNS&#x89E3;&#x6790; <code>words-java</code>&#xFF0C;&#x7136;&#x540E;&#x5185;&#x7F6E;DNS&#x8FD4;&#x56DE;&#x4E86;<code>50</code>&#x4E2A;&#x5BF9;&#x5E94;&#x7684;IP&#x5730;&#x5740;&#x3002;<code>Go</code> &#x5185;&#x90E8;&#x8FDB;&#x884C;&#x968F;&#x673A;&#x9009;&#x62E9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#xFF0C;&#x4EE5;&#x6B64;&#x8FBE;&#x5230;&#x4E86;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<h1 id="application-bundle"><a href="#Application-Bundle" class="headerlink" title="Application Bundle"></a>Application Bundle <a href="#application-bundle" class="header-anchor">#</a></h1><p><code>Docker Compose</code> with <code>Docker 1.12</code> &#x652F;&#x6301; <code>Docker Application Bundle</code> &#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;<code>docker-compose</code>&#x6240;&#x63CF;&#x8FF0;&#x7684;app&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;<code>.dab</code>&#x6587;&#x4EF6;&#xFF0C;&#x65B9;&#x4FBF;&#x5206;&#x53D1;&#x90E8;&#x7F72;&#x3002;</p>
<p>&#x6253;&#x5305; <code>DAB</code> &#x6587;&#x4EF6;&#x6709;&#x4E00;&#x4E9B;&#x9700;&#x6C42;&#xFF0C;&#x8FD9;&#x4E9B;&#x9700;&#x6C42;&#x548C; <code>Docker Compose</code> + <code>Swarm</code> &#x57FA;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x4E0D;&#x7136;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x7B49;&#x3002;</p>
<p>&#x6267;&#x884C; <code>docker-compose bundle</code> &#x540E;&#xFF0C;Docker Compose &#x4F1A;&#x6267;&#x884C; <code>build</code> &#x6307;&#x4EE4;&#xFF0C;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x6587;&#x4EF6;&#x7684; <code>image</code> &#x90E8;&#x5206;&#xFF0C;&#x5C06;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF; <code>push</code> &#x5230; Docker Hub &#x4E0A;&#x3002;&#x7136;&#x540E;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x540D;(&#x9ED8;&#x8BA4;&#x4E3A;&#x76EE;&#x5F55;&#x540D;) &#x7684; <code>xxxx.dab</code> &#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6240;&#x751F;&#x6210;&#x7684; .dab &#x6587;&#x4EF6;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x4E00;&#x4E2A; JSON &#x6587;&#x4EF6;&#xFF0C;&#x91CC;&#x9762;&#x50CF; <code>docker-compose.yml</code> &#x4E00;&#x6837;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#x7684;<code>Image</code>&#xFF0C;&#x53CA;&#x5176; <code>SHA256</code> &#x7684;&#x6821;&#x9A8C;&#x7801;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x90E8;&#x7F72;&#x8FD9;&#x4E2A;<code>.dab</code>&#x6587;&#x4EF6;&#x3002;&#x548C; <code>docker-compose.yml</code> &#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;<code>DAB</code> &#x8981;&#x6C42;&#x8FD0;&#x884C;&#x5728; <code>Docker Swarm Mode</code> &#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x6F14;&#x793A;&#x7684;&#x65F6;&#x5019;&#xFF0C;David &#x4F7F;&#x7528; <code>docker swarm init</code> &#x5F00;&#x542F;&#x4E86;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x7684;&#x5355;&#x8282;&#x70B9; Swarm&#x3002;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x90E8;&#x7F72;&#x4E4B;&#x524D;&#x6253;&#x5305; <code>xxxx.dab</code> &#x6587;&#x4EF6;&#xFF0C;<code>docker deploy xxxx</code>&#xFF0C;&#x7136;&#x540E;docker &#x4F1A;&#x5728; <code>swarm</code> &#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x7F51;&#x7EDC;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x5404;&#x79CD;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x542F;&#x52A8;&#x3002;</p>
<p>&#x7136;&#x540E; David &#x505A;&#x4E86;&#x4E2A;&#x5F88;&#x5927;&#x80C6;&#x7684;&#x4E3E;&#x52A8;&#xFF0C;&#x91CD;&#x542F;&#x4E86;&#x81EA;&#x5DF1;&#x7684; Mac &#x7B14;&#x8BB0;&#x672C;&#x3002;&#x6765;&#x7ED9;&#x5927;&#x5BB6;&#x73B0;&#x573A;&#x6F14;&#x793A;&#x91CD;&#x542F;&#x540E;&#xFF0C;&#x6240;&#x6709;&#x90E8;&#x7F72;&#x7684; Docker service &#x4F1A;&#x5904;&#x4E8E;&#x81EA;&#x52A8;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>
<h1 id="wen-da"><a href="#&#x95EE;&#x7B54;" class="headerlink" title="&#x95EE;&#x7B54;"></a>&#x95EE;&#x7B54; <a href="#wen-da" class="header-anchor">#</a></h1><p><strong>Q: &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49; Bundle &#x6587;&#x4EF6;&#x4E48;&#xFF1F;&#x8FD8;&#x662F;&#x5FC5;&#x987B;&#x7ECF;&#x8FC7; Compose &#x4E00;&#x6B21;&#x8F6C;&#x624B;&#xFF1F;</strong></p>
<p>A: &#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5199; .dab &#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x53EA;&#x662F;&#x4E2A; JSON &#x6587;&#x4EF6;&#x3002;&#x4F46;&#x662F;&#x663E;&#x7136;&#x4F7F;&#x7528; docker-compose.yml &#x4F1A;&#x66F4;&#x7B80;&#x5355;&#x3002;</p>
<p><strong>Q: &#x6F14;&#x793A;&#x4EE3;&#x7801;&#x4F1A;&#x653E;&#x5728; github &#x4E0A;&#x4E48;&#xFF1F;</strong></p>
<p>A: &#x662F;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x90FD;&#x5DF2;&#x7ECF;&#x5728; github &#x4E0A;&#x4E86;&#x3002;</p>
<p><a href="https://github.com/dgageot/dockercon16" target="_blank" rel="external">https://github.com/dgageot/dockercon16</a></p>
<p><strong>Q: Docker for Mac &#x662F;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;Linux VM &#x4E0A;&#xFF1F;&#x8FD8;&#x662F;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x5728; Mac &#x4E0A;&#xFF1F;</strong></p>
<p>A: &#x662F;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7CBE;&#x7B80;&#x7684; Linux VM &#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;VM&#x662F;&#x8FD0;&#x884C;&#x5728; OSX &#x5185;&#x7F6E;&#x7684; <code>Hypervisor</code> &#x6846;&#x67B6;&#x4E0A;&#x7684;(<code>Hyperkit</code>)&#x3002;</p>
<p><strong>Q: &#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5982;&#x679C;Java&#x4EE3;&#x7801;&#x4FEE;&#x6539;&#x4E86;&#xFF0C;&#x4F60;&#x600E;&#x4E48;&#x786E;&#x4FDD;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4EE3;&#x7801;&#x8DDF;&#x7740;&#x6539;&#x53D8;&#xFF1F;&#x518D;&#x6B21;&#x6784;&#x5EFA;&#xFF1F;</strong></p>
<p>A: <code>Java</code> &#x8981;&#x6BD4; <code>Node.js</code> &#x590D;&#x6742;&#x4E00;&#x4E9B;&#xFF0C;&#x5728;<code>Node.js</code>&#x4E2D;&#xFF0C;&#x53EA;&#x8981;&#x4FEE;&#x6539;&#x4E86;<code>JS</code>&#x4EE3;&#x7801;&#xFF0C;&#x4FDD;&#x5B58;&#x5373;&#x53EF;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x5C31;&#x53EF;&#x4EE5;&#x611F;&#x77E5;&#x53D8;&#x5316;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;&#x800C;Java&#x8981;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x4EE5;&#x53CA;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>stop</code>, <code>rm -f</code>, <code>up -d</code> &#x7684;&#x65B9;&#x5F0F;&#x786E;&#x4FDD;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4EE3;&#x7801;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x5E76;&#x8FD0;&#x884C;&#x3002;</p>
<p><strong>Q: &#x5728;&#x521A;&#x624D;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A; microservice &#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;3&#x4E2A;&#xFF0C;&#x800C;&#x662F;20&#x591A;&#x4E2A;&#xFF0C;&#x6BCF;&#x4E2A;&#x90FD;&#x6765;&#x81EA;&#x4E8E;&#x4E0D;&#x540C;&#x7684; repository&#xFF0C;&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x7EC4;&#x7EC7;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#xFF1F;&#x662F;&#x628A; docker-compose.yml &#x653E;&#x5230;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; repository &#x4E48;&#xFF1F;</strong></p>
<p>A: &#x5BF9;&#x4E8E;&#x5C0F;&#x7684;&#x9879;&#x76EE;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x9876;&#x5C42;&#x76EE;&#x5F55;&#x653E;&#x7F6E; docker-compose.yml &#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x6BCF;&#x4E2A; micro service &#x653E;&#x7F6E;&#x4E8E;&#x5404;&#x81EA;&#x7684;&#x5B50;&#x76EE;&#x5F55;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x5F88;&#x590D;&#x6742;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; git sub-module &#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E4B;&#x524D;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x591F;&#x4E86;&#x3002;</p>
<p><strong>Q: &#x4E4B;&#x524D;&#x7684; DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x662F;&#x8C01;&#x8D1F;&#x8D23;&#x89E3;&#x6790;&#x7684;&#x8FD9;&#x4E2A;DNS&#x5730;&#x5740;&#xFF1F;&#x56E0;&#x4E3A;&#x5728;&#x542F;&#x7528; Swarm &#x4E4B;&#x524D;&#xFF0C;&#x4F3C;&#x4E4E;&#x5C31;&#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4E86;&#x3002;</strong></p>
<p>A: DNS &#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x662F;&#x5185;&#x7F6E;&#x7684;&#x7F51;&#x7EDC;&#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x9700;&#x8981; Swarm &#x7684;&#x4ECB;&#x5165;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5BF9;&#x65B9;&#x7684;&#x670D;&#x52A1;&#x540D;&#x5373;&#x53EF;&#x3002;</p>
<p><strong>Q: &#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#xFF0C;&#x6211;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x4F7F;&#x7528; Docker Compose&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x5FC5;&#x8981;&#x4F7F;&#x7528; Application Bundle&#xFF1F;&#x5B83;&#x4EEC;&#x4E8C;&#x8005;&#x7684;&#x533A;&#x522B;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</strong></p>
<p>A: &#x5982;&#x679C;&#x6211;&#x4EEC;&#x89C2;&#x5BDF; <code>docker-compose.yml</code> &#x6587;&#x4EF6;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5728;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x5B9A;&#x4E49;&#x4E2D;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x6307;&#x5B9A;&#x90A3;&#x4E2A;&#x955C;&#x50CF;&#x7248;&#x672C;&#xFF0C;&#x6240;&#x4EE5;compose&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#xFF0C;&#x5B9A;&#x4E49;&#x4E86;&#x6784;&#x6210;&#x5E94;&#x7528;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;&#x9650;&#x5B9A;&#x670D;&#x52A1;&#x7684;&#x955C;&#x50CF;&#x7248;&#x672C;&#x3002;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x505A;&#x6CD5;&#x662F; <code>tag</code> &#x6BCF;&#x4E00;&#x4E2A; <code>image</code>&#xFF0C;&#x7136;&#x540E;&#x6539;&#x53D8; <code>docker-compose</code> &#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;&#x800C;&#x73B0;&#x5728;&#x5219;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x884C;<code>bundle</code>&#xFF0C;&#x5C31;&#x4F1A;&#x628A;&#x5F53;&#x524D;&#x7279;&#x5B9A;&#x7684;&#x7248;&#x672C;&#x4FE1;&#x606F;&#x6253;&#x5305;&#x3002;</p>
<p><strong>Q: &#x4F1A;&#x628A;&#x955C;&#x50CF;&#x4E00;&#x540C;&#x6253;&#x5305;&#x4E48;&#xFF1F;&#x8FD8;&#x662F;&#x8BF4;&#x5FC5;&#x987B; <code>push</code> &#x5230; docker hub&#xFF1F;</strong></p>
<p>&#x76EE;&#x524D;&#x53EA;&#x6253;&#x5305;&#x7684;&#x662F;&#x955C;&#x50CF;&#x4FE1;&#x606F;&#xFF0C;&#x662F;&#x4E2A;JSON&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x5305;&#x542B;&#x955C;&#x50CF;tarball&#xFF0C;&#x5C06;&#x6765;&#x6709;&#x53EF;&#x80FD;&#x8FD9;&#x4E48;&#x505A;&#x3002;</p>
<p><strong>Q: &#x5F53; deploy &#x4E00;&#x4E2A; bundle &#x540E;&#xFF0C;&#x8FD9;&#x4E1C;&#x897F;&#x662F;&#x5B58;&#x54EA;&#x4E86;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48; docker engine&#x4F1A;&#x91CD;&#x542F;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#xFF1F;</strong></p>
<p>A: &#x8FD9;&#x5C5E;&#x4E8E; <code>Swarm Mode</code> &#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5F53; <code>docker deploy</code> &#x4E00;&#x4E2A; <code>bundle</code> &#x540E;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x544A;&#x8BC9; <code>docker engine</code> &#x5EFA;&#x7ACB;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5F53;&#x7CFB;&#x7EDF;&#x91CD;&#x542F;&#x540E;&#xFF0C;<code>docker engine</code> &#x4F1A;&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x7684;&#x670D;&#x52A1;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x671F;&#x671B;&#x7684;&#x670D;&#x52A1;&#x72B6;&#x6001;&#x3002;&#x53D1;&#x73B0;&#x786E;&#x5B9E;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x5EFA;&#x7ACB;&#x670D;&#x52A1;&#x6216;&#x8005;&#x542F;&#x52A8;&#x3002;</p>
<p><strong>Q: <code>docker bundle</code> &#x53EF;&#x4E0D;&#x53EF;&#x4EE5; <code>push</code> &#x5230; private registry&#xFF1F;</strong></p>
<p>A: &#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x867D;&#x7136;&#x89C9;&#x5F97;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x6E05;&#x695A;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5E94;&#x8BE5;&#x95EE;&#x4E00;&#x4E0B; Docker Engine &#x7684;team&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Containerd - 构建容器 Supervisor - Michael Crosby</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-11-video-containerd-building-a-container-supervisor.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-11-video-containerd-building-a-container-supervisor.html</id>
    <published>2016-07-10T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#whoami">&gt; whoami</a></li>
<li><a href="#man-containerd">&gt; man containerd</a></li>
<li><a href="#why">&gt; why</a></li>
<li><a href="#benchmarks">Benchmarks</a></li>
<li><a href="#events">events</a></li>
<li><a href="#daemonless">&gt; daemonless</a><ul>
<li><a href="#container-state">&gt; container state</a></li>
<li><a href="#daemonless-problems">&gt; daemonless problems</a><ul>
<li><a href="#containerd-shim">&gt; containerd-shim</a></li>
<li><a href="#exit-status">&gt; exit status</a></li>
<li><a href="#stdio">&gt; stdio</a></li>
<li><a href="#re-parenting">&gt; re-parenting</a></li>
</ul>
</li>
<li><a href="#the-oom-problem">&gt; The OOM problem</a><ul>
<li><a href="#runtime-workflow">&gt; runtime workflow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#yan-shi-dai-ma">&#x6F14;&#x793A;&#x4EE3;&#x7801;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Containerd - Building a Container Supervisor<br>by Michael Crosby</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/VWuHWfEB6ro" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=VWuHWfEB6ro" target="_blank" rel="external">https://www.youtube.com/watch?v=VWuHWfEB6ro</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=q0314svqva0&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/q0314svqva0.html" target="_blank" rel="external">http://v.qq.com/x/page/q0314svqva0.html</a></p>
<h1 id="whoami"><a href="#gt-whoami" class="headerlink" title="&gt; whoami"></a>&gt; whoami <a href="#whoami" class="header-anchor">#</a></h1><ul>
<li>&#x81EA; Docker 0.3 &#x5F00;&#x59CB;&#x5C31;&#x662F;&#x4ECB;&#x5165;&#x5F00;&#x53D1;&#xFF0C;0.5&#x5F00;&#x59CB;&#x5C31;&#x662F; maintainer &#xFF08;&#x5C31;&#x662F;&#x4ECE;&#x7ED1;&#x5B9A; localhost &#x53D8;&#x6210;&#x7ED1;&#x5B9A; socket&#xFF0C;&#x55EF;&#xFF0C;&#x7ED3;&#x679C;&#x6240;&#x6709;&#x4EBA;&#x7684;&#x73AF;&#x5883;&#x90FD;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#xFF09;</li>
<li>dockerui &#x7684;&#x4F5C;&#x8005;</li>
<li>libcontainer &#x7684;&#x4F5C;&#x8005;</li>
<li>nsinit &#x7684;&#x4F5C;&#x8005;</li>
<li>runc &#x7684;&#x4F5C;&#x8005;</li>
<li>containerd &#x7684;&#x4F5C;&#x8005;</li>
<li>OCI &#x7684;maintainer</li>
</ul>
<h1 id="man-containerd"><a href="#gt-man-containerd" class="headerlink" title="&gt; man containerd"></a>&gt; man containerd <a href="#man-containerd" class="header-anchor">#</a></h1><ul>
<li><p>&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x5BB9;&#x5668; supervisor</p>
<ul>
<li>&#x5F88;&#x591A;&#x4EBA;&#x8BF4;&#x8FD9;&#x662F;&#x5728;&#x53D6;&#x4EE3; systemd&#xFF0C;&#x4E0D;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E13;&#x6CE8;&#x4E8E;&#x5BB9;&#x5668;</li>
</ul>
</li>
<li><p>runC (OCI) multiplexer</p>
<ul>
<li>&#x867D;&#x7136;&#x53EB;containerd&#xFF0C;&#x4F46;&#x662F;&#x771F;&#x6B63;&#x521B;&#x5EFA;&#x5BB9;&#x5668;&#x7684;&#x662F;runC(OCI)&#x5C42;</li>
</ul>
</li>
<li><p>&#x5BB9;&#x5668;&#x751F;&#x5B58;&#x5468;&#x671F;&#x64CD;&#x4F5C;</p>
</li>
</ul>
<h1 id="why"><a href="#gt-why" class="headerlink" title="&gt; why"></a>&gt; why <a href="#why" class="header-anchor">#</a></h1><ul>
<li>&#x96C6;&#x6210; runc</li>
<li>&#x652F;&#x6301;&#x591A;&#x4E2A; runtime</li>
<li>Execution v2</li>
<li>&#x5206;&#x79BB;&#x6267;&#x884C;&#x673A;&#x6784;&#x548C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li>
<li>daemonless &#x5BB9;&#x5668;</li>
<li>&#x66F4;&#x5E72;&#x51C0;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;</li>
</ul>
<h1 id="benchmarks"><a href="#Benchmarks" class="headerlink" title="Benchmarks"></a>Benchmarks <a href="#benchmarks" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ./benchmark -count 100</div><div class="line">INFO[0001] 1.149902846 seconds</div></pre></td></tr></table></figure>
<p>&#x6D4B;&#x8BD5;containerd:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo containerd &#x2014;debug` &#x7136;&#x540E;&#x53E6;&#x4E00;&#x8FB9;&#x8FD0;&#x884C; `sudo ./benchmark -count 100</div></pre></td></tr></table></figure>
<h1 id="events"><a href="#events" class="headerlink" title="events"></a>events <a href="#events" class="header-anchor">#</a></h1><ul>
<li><p>&#x65E0;&#x9501; event loop</p>
</li>
<li><p>&#x5E76;&#x53D1;&#x63A7;&#x5236;</p>
<ul>
<li>&#x4E00;&#x6B21;&#x5E76;&#x53D1;10&#x4E2A;&#x53EF;&#x80FD;&#x4F1A;&#x6BD4;&#x5E76;&#x53D1;100&#x4E2A;&#x66F4;&#x5FEB;&#x3002;</li>
</ul>
</li>
</ul>
<h1 id="daemonless"><a href="#gt-daemonless" class="headerlink" title="&gt; daemonless"></a>&gt; daemonless <a href="#daemonless" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#x9700;&#x6C42;&#xFF0C;Docker&#x5347;&#x7EA7;&#x975E;&#x5E38;&#x5FEB;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x6B21;&#x5347;&#x7EA7;&#x6240;&#x6709;&#x7684;&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x88AB;kill&#x6389;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x66F4;&#x5E73;&#x6ED1;&#x7684;&#x5347;&#x7EA7;&#x65B9;&#x5F0F;&#xFF0C;&#x5347;&#x7EA7;Docker&#x4E0D;&#x4F1A;&#x8BA9;&#x5BB9;&#x5668;&#x6B7B;&#x6389;&#x3002;</p>
<h2 id="container-state"><a href="#gt-container-state" class="headerlink" title="&gt; container state"></a>&gt; container state <a href="#container-state" class="header-anchor">#</a></h2><ul>
<li>&#x6700;&#x7B80;&#x5355;&#x7684;&#x7BA1;&#x7406;&#x72B6;&#x6001;&#x7684;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x8BA9;&#x5BB9;&#x5668;&#x6CA1;&#x6709;&#x72B6;&#x6001;</li>
<li>&#x5185;&#x5B58;&#x91CC;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x4FDD;&#x5B58;</li>
<li>/run &#x662F;&#x4F60;&#x7684;&#x597D;&#x670B;&#x53CB;</li>
</ul>
<p>&#x5BB9;&#x5668;&#x53EA;&#x662F;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x9700;&#x8981; pid &#x548C; path &#x6307;&#x5411;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x5373;&#x53EF;&#x6062;&#x590D;&#x6240;&#x6709;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x7ED3;&#x6784;&#x53BB;&#x4FDD;&#x5B58;&#x8FD9;&#x4E9B;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x3002;</p>
<h2 id="daemonless-problems"><a href="#gt-daemonless-problems" class="headerlink" title="&gt; daemonless problems"></a>&gt; daemonless problems <a href="#daemonless-problems" class="header-anchor">#</a></h2><ul>
<li>&#x9000;&#x51FA;&#x4EE3;&#x7801;&#x548C;wait4()</li>
<li>tty / stdio</li>
<li>reparenting</li>
<li>facilitated by a shim</li>
</ul>
<h3 id="containerd-shim"><a href="#gt-containerd-shim" class="headerlink" title="&gt; containerd-shim"></a>&gt; containerd-shim <a href="#containerd-shim" class="header-anchor">#</a></h3><blockquote>
<p><code>containerd</code> &#x2192; <code>&#x591A;&#x4E2A; shim</code> &#x2192; <code>&#x6BCF;&#x4E2A; shim</code> &#x5BF9;&#x5E94; <code>&#x4E00;&#x4E2A; runc</code></p>
</blockquote>
<p><code>shim</code> &#x89E3;&#x51B3;&#x4E86; <code>tty</code> / <code>stdio</code> &#x548C; <code>reparenting</code> &#x95EE;&#x9898;</p>
<h3 id="exit-status"><a href="#gt-exit-status" class="headerlink" title="&gt; exit status"></a>&gt; exit status <a href="#exit-status" class="header-anchor">#</a></h3><ul>
<li><p>FIFO for blocking + file</p>
<ul>
<li>fifo (Pipe with inode) for exit event</li>
<li>file for exit status</li>
</ul>
</li>
<li><p>O_CLOEXEC</p>
</li>
<li><p>RDONLY/WRONLY</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (mkfifo(&#x201C;<span class="built_in">exit</span>-fifo&#x201D;, <span class="number">0666</span>) != <span class="number">0</span>) {</div><div class="line">    <span class="built_in">printf</span>(&#x201C;%s\n&#x201D;, strerror(errno));</div><div class="line">    <span class="built_in">exit</span>(EXIT_FAILURE);</div><div class="line">}</div><div class="line"><span class="keyword">int</span> fd = open(&#x201C;<span class="built_in">exit</span>-fifo&#x201D;, O_WRONLY | O_CLOEXEC, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h3 id="stdio"><a href="#gt-stdio" class="headerlink" title="&gt; stdio"></a>&gt; stdio <a href="#stdio" class="header-anchor">#</a></h3><ul>
<li><p>FIFOs for data</p>
</li>
<li><p>fifos have a buffer (default 64k)</p>
<ul>
<li>/proc/sys/fs/pipe-max-size</li>
</ul>
</li>
</ul>
<h3 id="re-parenting"><a href="#gt-re-parenting" class="headerlink" title="&gt; re-parenting"></a>&gt; re-parenting <a href="#re-parenting" class="header-anchor">#</a></h3><blockquote>
<p><code>shim</code> &#x2192; <code>runc</code> &#x2192; <code>container</code></p>
</blockquote>
<p>&#x5F53; <code>runc</code> &#x9000;&#x51FA;&#x540E;&#xFF0C;<code>container</code> &#x53EF;&#x4EE5; <code>reparent</code> &#x5230; <code>shim</code>&#x3002;</p>
<h4 id="re-parenting-rules"><a href="#gt-re-parenting-rules" class="headerlink" title="&gt; re-parenting rules"></a>&gt; re-parenting rules <a href="#re-parenting-rules" class="header-anchor">#</a></h4><ul>
<li>&#x4F60;&#x7684; <code>parent</code> &#x662F; <code>fork</code> &#x4F60;&#x7684;&#x8FDB;&#x7A0B;</li>
<li>&#x5982;&#x679C;&#x4F60;&#x7684; <code>parent</code> die&#xFF0C;&#x4F60;&#x65B0;&#x7684;<code>parent</code>&#x662F; <code>PID 1</code></li>
</ul>
<p>&#x5728; 3.4 &#x4E4B;&#x524D;&#xFF0C;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x662F; 3.4 &#x4E4B;&#x540E;&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x4E2A; <code>subreaper</code></p>
<ul>
<li><code>prctl</code> - <code>PR_SET_CHILD_SUBREAPER</code></li>
<li>&#x201C;In effect, a subreaper fulfills the role of init(1) for its descendant processes.&#x201D;</li>
</ul>
<p>&#x6240;&#x4EE5;&#x50CF;&#x521A;&#x624D;&#x8BF4;&#x7684;&#x60C5;&#x51B5;&#xFF0C;<code>shim</code> &#x2192; <code>runc</code> &#x2192; <code>container</code>&#xFF0C;&#x5982;&#x679C;<code>runc</code>&#x9000;&#x51FA;&#xFF0C;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#xFF0C;<code>container</code> &#x5C06;&#x4F1A;&#x6210;&#x4E3A; <code>init</code> (<code>pid:1</code>) &#x7684;<code>child</code>&#xFF0C;&#x800C;<code>shim</code>&#x4F7F;&#x7528;&#x4E86;<code>subreaper</code> &#x540E;&#xFF0C;&#x5C06;&#x4F1A;&#x622A;&#x65AD;&#x8FD9;&#x4E2A;&#x6536;&#x517B;&#x8FDB;&#x7A0B;&#x7684;&#x4E0A;&#x6EAF;&#x8FC7;&#x7A0B;&#xFF0C;<code>shim</code> &#x5C06;&#x6210;&#x4E3A; <code>container</code> &#x7684;&#x65B0; <code>parent</code>&#x3002;</p>
<h2 id="the-oom-problem"><a href="#gt-The-OOM-problem" class="headerlink" title="&gt; The OOM problem"></a>&gt; The OOM problem <a href="#the-oom-problem" class="header-anchor">#</a></h2><p>&#x5982;&#x4F55;&#x5728;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x524D;&#x8FDE;&#x63A5;&#x5230; OOM (<code>Out of Memory</code>) &#x901A;&#x77E5;</p>
<h3 id="runtime-workflow"><a href="#gt-runtime-workflow" class="headerlink" title="&gt; runtime workflow"></a>&gt; runtime workflow <a href="#runtime-workflow" class="header-anchor">#</a></h3><ul>
<li><p><code>create</code></p>
<ul>
<li>&#x521D;&#x59CB;&#x5316;<code>namespace</code>&#x548C;&#x914D;&#x7F6E;</li>
</ul>
</li>
<li><p><code>start</code></p>
<ul>
<li>&#x6267;&#x884C;&#x7528;&#x6237;&#x8FDB;&#x7A0B;</li>
</ul>
</li>
<li><p><code>delete</code></p>
<ul>
<li>&#x5220;&#x9664;&#x5BB9;&#x5668;</li>
</ul>
</li>
</ul>
<p>&#x8FD9;&#x6837;&#x5728; <code>create</code> &#x548C; <code>start</code> &#x4E2D;&#x95F4;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x5F88;&#x591A;&#x5904;&#x7406;&#x4E8B;&#x52A1;&#x7684;&#x673A;&#x4F1A;&#xFF0C;&#x5305;&#x62EC;&#x5904;&#x7406; <code>OOM</code> &#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">runc create <span class="built_in">test</span></div><div class="line">runc list</div><div class="line">runc start <span class="built_in">test</span></div></pre></td></tr></table></figure>
<h1 id="yan-shi-dai-ma"><a href="#&#x6F14;&#x793A;&#x4EE3;&#x7801;" class="headerlink" title="&#x6F14;&#x793A;&#x4EE3;&#x7801;"></a>&#x6F14;&#x793A;&#x4EE3;&#x7801; <a href="#yan-shi-dai-ma" class="header-anchor">#</a></h1><p><a href="https://github.com/crosbymichael/dockercon-2016" target="_blank" rel="external">https://github.com/crosbymichael/dockercon-2016</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：用 Fluentd 和 Datadog 监视 Docker 的最佳实践 - John Hammink</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-08-video-best-practices-for-docker-monitoring-with-fluentd-and-datadog.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-08-video-best-practices-for-docker-monitoring-with-fluentd-and-datadog.html</id>
    <published>2016-07-07T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#fluentd-unified-logging-layer">Fluentd: Unified Logging Layer</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#shi-me-shi-fluentd">&#x4EC0;&#x4E48;&#x662F; Fluentd&#xFF1F;</a></li>
<li><a href="#extensible">Extensible</a><ul>
<li><a href="#core">Core</a></li>
<li><a href="#plugins">Plugins</a></li>
</ul>
</li>
<li><a href="#nei-bu-jia-gou">&#x5185;&#x90E8;&#x67B6;&#x6784;</a></li>
<li><a href="#use-cases">Use Cases</a><ul>
<li><a href="#jian-dan-de-zhuan-fa">&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1;</a></li>
<li><a href="#lue-fu-za-yi-xie-de-li-zi">&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50;</a></li>
<li><a href="#lambda-jia-gou">Lambda &#x67B6;&#x6784;</a></li>
<li><a href="#fluentd-docker-de-li-zi">Fluentd + Docker &#x7684;&#x4F8B;&#x5B50;</a></li>
</ul>
</li>
<li><a href="#docker-toolbox">Docker Toolbox</a><ul>
<li><a href="#docker-toolbox-nei-rong">Docker Toolbox &#x5185;&#x5BB9;</a></li>
</ul>
</li>
<li><a href="#future-of-boot2docker">Future of Boot2Docker</a></li>
<li><a href="#monitoring-docker-at-scale-datadog">Monitoring Docker at Scale (Datadog)</a><ul>
<li><a href="#steps-to-working-with-docker">Steps to working with Docker</a></li>
<li><a href="#docker-machine">docker-machine</a></li>
</ul>
</li>
<li><a href="#monitoring-at-scale">Monitoring at Scale</a><ul>
<li><a href="#operational-complexity">Operational Complexity</a></li>
<li><a href="#xu-yao-qu-ce-liang-de-dong-xi">&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F;</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Best Practices for Docker monitoring with Fluentd and Datadog<br>by John Hammink<br>(2015/08/11)</p>
<div class="owl-media owl-video owl-vimeo"><iframe src="//player.vimeo.com/video/137998663" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://vimeo.com/137998663" target="_blank" rel="external">https://vimeo.com/137998663</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=d0314vikb0b&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/d0314vikb0b.html" target="_blank" rel="external">http://v.qq.com/x/page/d0314vikb0b.html</a></p>
<h1 id="fluentd-unified-logging-layer"><a href="#Fluentd-Unified-Logging-Layer" class="headerlink" title="Fluentd: Unified Logging Layer"></a>Fluentd: Unified Logging Layer <a href="#fluentd-unified-logging-layer" class="header-anchor">#</a></h1><h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x6062;&#x590D;&#x8F6F;&#x4EF6;&#x548C;QA&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x540E;&#x6765;&#x7531;&#x4E8E;&#x5BF9;&#x5206;&#x5F62;&#x7684;&#x75F4;&#x8FF7;&#x6210;&#x4E86;Digital Artist&#x3002;&#x800C;&#x73B0;&#x5728;&#x5219;&#x662F;&#x559C;&#x6B22;&#x4F7F;&#x7528;GPU&#x5BF9;&#x5927;&#x89C4;&#x6A21;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x89C6;&#x89C9;&#x5316;&#x6E32;&#x67D3;&#x3002;</p>
<p>github: <code>jammink2</code></p>
<h1 id="shi-me-shi-fluentd"><a href="#&#x4EC0;&#x4E48;&#x662F;-Fluentd&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Fluentd&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; Fluentd&#xFF1F; <a href="#shi-me-shi-fluentd" class="header-anchor">#</a></h1><p>&#x4E00;&#x4E2A; <strong>&#x53EF;&#x6269;&#x5C55;&#x7684;</strong> &#xFF0C; <strong>&#x53EF;&#x9760;&#x7684;</strong> &#xFF0C; <strong>&#x6570;&#x636E;&#x6536;&#x96C6;</strong> &#x5DE5;&#x5177;</p>
<ul>
<li>&#x53EF;&#x6269;&#x5C55;&#xFF1A;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x6838;&#x5FC3; + &#x5F88;&#x5F3A;&#x5927;&#x7684;&#x63D2;&#x4EF6;</li>
<li>&#x53EF;&#x9760;&#x7684;&#xFF1A;Buffering, HA (failover), load balancing</li>
<li>&#x6570;&#x636E;&#x6536;&#x96C6;&#x5DE5;&#x5177;&#xFF1A;&#x50CF; <code>syslogd</code></li>
</ul>
<p>&#x7EDF;&#x4E00;&#x7684;&#x65E5;&#x5FD7;&#x6570;&#x636E;&#x6536;&#x96C6;&#x5DE5;&#x5177;&#xFF0C;&#x57FA;&#x4E8E; <code>Ruby</code> &#x5199;&#x7684;&#xFF0C;&#x6709;&#x4E00;&#x90E8;&#x5206;<code>C</code>&#x7684;&#x4EE3;&#x7801;&#x3002;&#x6570;&#x636E;&#x6D41;&#x4F7F;&#x7528;&#x7EDF;&#x4E00;&#x7684;<code>JSON</code>&#x683C;&#x5F0F;&#x3002;</p>
<h1 id="extensible"><a href="#Extensible" class="headerlink" title="Extensible"></a>Extensible <a href="#extensible" class="header-anchor">#</a></h1><h2 id="core"><a href="#Core" class="headerlink" title="Core"></a>Core <a href="#core" class="header-anchor">#</a></h2><ul>
<li>Divide and Conqure</li>
<li>&#x7F13;&#x5B58;&#x3001;&#x91CD;&#x8BD5;</li>
<li>&#x9519;&#x8BEF;&#x5904;&#x7406;</li>
<li>&#x6D88;&#x606F;&#x8DEF;&#x7531;</li>
<li>&#x5E76;&#x884C;</li>
</ul>
<h2 id="plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins <a href="#plugins" class="header-anchor">#</a></h2><ul>
<li>&#x8BFB;</li>
<li>&#x89E3;&#x6790;</li>
<li>Buffer</li>
<li>&#x5199;&#x6570;&#x636E;</li>
<li>&#x683C;&#x5F0F;&#x5316;&#x6570;&#x636E;</li>
</ul>
<h1 id="nei-bu-jia-gou"><a href="#&#x5185;&#x90E8;&#x67B6;&#x6784;" class="headerlink" title="&#x5185;&#x90E8;&#x67B6;&#x6784;"></a>&#x5185;&#x90E8;&#x67B6;&#x6784; <a href="#nei-bu-jia-gou" class="header-anchor">#</a></h1><ol>
<li>Input</li>
<li>Parser</li>
<li>Filter</li>
<li>Buffer</li>
<li>Format</li>
<li>Output</li>
</ol>
<p>&#x7B80;&#x5316;&#x7ED3;&#x6784;&#xFF1A; &#x8F93;&#x5165; &#x2192; Buffer &#x2192; &#x8F93;&#x51FA;</p>
<p>Fluentd &#x5C06; M x N &#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x964D;&#x4E3A; M + N&#x3002;</p>
<h1 id="use-cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases <a href="#use-cases" class="header-anchor">#</a></h1><h2 id="jian-dan-de-zhuan-fa"><a href="#&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1;" class="headerlink" title="&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1;"></a>&#x7B80;&#x5355;&#x7684;&#x8F6C;&#x53D1; <a href="#jian-dan-de-zhuan-fa" class="header-anchor">#</a></h2><p>{<code>Web</code>, <code>Mobile</code>} &#x2192; <code>Fluentd</code> &#x2192; <code>MongoDB</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># log from a file</div><div class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">    @type tail</div><div class="line">    path /var/log/httpd.log</div><div class="line">    format apache2</div><div class="line">    tag backend.apache</div><div class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line"></div><div class="line"># log from client libraries</div><div class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">    @type forward</div><div class="line">    port 24224</div><div class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line"></div><div class="line"># store logs to ES and HDFS</div><div class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">backend.</span>*&gt;</span></div><div class="line">    @type mongo</div><div class="line">    database fluent</div><div class="line">    collection test</div><div class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="lue-fu-za-yi-xie-de-li-zi"><a href="#&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50;"></a>&#x7565;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#x7684;&#x4F8B;&#x5B50; <a href="#lue-fu-za-yi-xie-de-li-zi" class="header-anchor">#</a></h2><p>{<code>mobile</code>, <code>web</code>} &#x2192; <code>&#x7B2C;&#x4E00;&#x7EA7; fluentd</code> &#x2192; <code>&#x7B2C;&#x4E8C;&#x7EA7; fluentd</code> &#x2192; <code>ElasicSearch</code></p>
<h2 id="lambda-jia-gou"><a href="#Lambda-&#x67B6;&#x6784;" class="headerlink" title="Lambda &#x67B6;&#x6784;"></a>Lambda &#x67B6;&#x6784; <a href="#lambda-jia-gou" class="header-anchor">#</a></h2><p>{<code>mobile</code>, <code>web</code>} &#x2192; <code>Fluentd</code> &#x2192; {<code>ElasticSearch</code>, <code>Hadoop</code>}</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"># logs from a file</div><div class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">    @type tail</div><div class="line">    path /var/log/httpd.log</div><div class="line">    format apache2</div><div class="line">    tag web.access</div><div class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line"></div><div class="line"># logs from client library</div><div class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">    @type forward</div><div class="line">    port 24224</div><div class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line"></div><div class="line"># store logs to ES and HDFS</div><div class="line"><span class="tag">&lt;<span class="name">match</span> *<span class="attr">.</span>*&gt;</span></div><div class="line">    @type copy</div><div class="line">    <span class="tag">&lt;<span class="name">store</span>&gt;</span></div><div class="line">        @type elasticsearch</div><div class="line">        logstash_format true</div><div class="line">    <span class="tag">&lt;/<span class="name">store</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">store</span>&gt;</span></div><div class="line">        @type webhdfs</div><div class="line">        host namenode</div><div class="line">        port 50070</div><div class="line">        path /path/on/hdfs</div><div class="line">    <span class="tag">&lt;/<span class="name">store</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="fluentd-docker-de-li-zi"><a href="#Fluentd-Docker-&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="Fluentd + Docker &#x7684;&#x4F8B;&#x5B50;"></a>Fluentd + Docker &#x7684;&#x4F8B;&#x5B50; <a href="#fluentd-docker-de-li-zi" class="header-anchor">#</a></h2><p>&#x73AF;&#x5883;&#x662F;<code>3</code>&#x4E2A;Docker&#x5BB9;&#x5668;{<code>Rails</code>, <code>PostgreSQL</code>, <code>RabbitMQ</code>}&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x65E5;&#x5FD7;&#x901A;&#x8FC7;<code>Fluentd</code>&#x65E5;&#x5FD7;&#x9A71;&#x52A8;&#x8F93;&#x51FA;&#x7ED9; <code>Fluentd</code> &#xFF0C;<code>Fluentd</code> &#x8FDB;&#x800C;&#x53D1;&#x9001;&#x7ED9; <code>S3</code>, <code>MongoDB</code>, <code>ElasticSearch</code>, <code>Treasure Data</code>&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x63A5;&#x6536;&#x65E5;&#x5FD7;&#x7684; <code>fluentd</code> &#x7684;&#x914D;&#x7F6E;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">    @forward</div><div class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">td.</span>*<span class="attr">.</span>*&gt;</span></div><div class="line">    @type tdlog</div><div class="line">    apikey xxxxx</div><div class="line">    auto_create_table</div><div class="line">    buffer_type file</div><div class="line">    buffer_path /var/log/td-agent/buffer/td</div><div class="line">    flush_interval 5s</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">secondary</span>&gt;</span></div><div class="line">        @type file</div><div class="line">        path /var/log/td-agent/failed_records</div><div class="line">    <span class="tag">&lt;/<span class="name">secondary</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">td.</span>*<span class="attr">.</span>*&gt;</span></div><div class="line">    @type stdout</div><div class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker run -it \</div><div class="line">    --name <span class="built_in">test</span> \</div><div class="line">    --log-driver=fluentd \</div><div class="line">    --log-opt fluentd-tag=td.docker.{{.Name}} \</div><div class="line">    ubuntu /bin/bash</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x53BB;<code>Treasure Data</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6570;&#x636E;</p>
<h1 id="docker-toolbox"><a href="#Docker-Toolbox" class="headerlink" title="Docker Toolbox"></a>Docker Toolbox <a href="#docker-toolbox" class="header-anchor">#</a></h1><p>by Michael Chiang</p>
<h2 id="docker-toolbox-nei-rong"><a href="#Docker-Toolbox-&#x5185;&#x5BB9;" class="headerlink" title="Docker Toolbox &#x5185;&#x5BB9;"></a>Docker Toolbox &#x5185;&#x5BB9; <a href="#docker-toolbox-nei-rong" class="header-anchor">#</a></h2><ul>
<li>Docker client</li>
<li>Machine</li>
<li>Compose</li>
<li>Kitematic</li>
<li>Virtualbox</li>
</ul>
<h1 id="future-of-boot2docker"><a href="#Future-of-Boot2Docker" class="headerlink" title="Future of Boot2Docker"></a>Future of Boot2Docker <a href="#future-of-boot2docker" class="header-anchor">#</a></h1><p><code>Boot2Docker CLI</code> &#x5E9F;&#x5F03;&#x4E86;&#xFF0C;&#x88AB; <code>Docker Machine</code> &#x66FF;&#x4EE3;&#x4E86;<br>&#x4E0B;&#x4E00;&#x4EE3;&#x7684;&#x7248;&#x672C;&#x5C06;&#x4F1A;&#x4EE3;&#x66FF;&#x5F53;&#x524D;&#x7684; <code>TinyCore Linux</code> &#x7248;&#x672C;</p>
<h1 id="monitoring-docker-at-scale-datadog"><a href="#Monitoring-Docker-at-Scale-Datadog" class="headerlink" title="Monitoring Docker at Scale (Datadog)"></a>Monitoring Docker at Scale (Datadog) <a href="#monitoring-docker-at-scale-datadog" class="header-anchor">#</a></h1><p>by Matt Williams</p>
<h2 id="steps-to-working-with-docker"><a href="#Steps-to-working-with-Docker" class="headerlink" title="Steps to working with Docker"></a>Steps to working with Docker <a href="#steps-to-working-with-docker" class="header-anchor">#</a></h2><ul>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Docker Host (<code>docker-machine</code>)</li>
<li>&#x4ECE;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x521B;&#x5EFA; Docker &#x5BB9;&#x5668;</li>
<li>&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#x534F;&#x4F5C; <code>Docker Compose</code></li>
</ul>
<h2 id="docker-machine"><a href="#docker-machine" class="headerlink" title="docker-machine"></a>docker-machine <a href="#docker-machine" class="header-anchor">#</a></h2><p>&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x521B;&#x5EFA; <code>Docker Host</code>&#xFF0C;{<code>Mac</code>, <code>Windows</code>}:(boot2docker), <code>Google</code>, <code>AWS</code>, <code>Digital Ocean</code> &#x2026;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> vmwarefusion fusiondkr</div><div class="line"></div><div class="line"><span class="built_in">eval</span> $(docker-machine env fusiondkr)</div></pre></td></tr></table></figure>
<p>&#x7528;<code>vmware</code>, <code>virtualbox</code>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#xFF0C;&#x7528;&#x5176;&#x4ED6;&#x7684;&#x4E91;&#x670D;&#x52A1;&#x5219;&#x9700;&#x8981;&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x6BD4;&#x5982;Openstack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> openstack \</div><div class="line">    --openstack-flavor-name standard.large \</div><div class="line">    --openstack-image-id &#x201C;xxxxxxx&#x201D; \</div><div class="line">    --openstack-floatingip-pool &#x201C;Ext-Net&#x201D; \</div><div class="line">    --openstack-ssh-user ubuntu \</div><div class="line">    hpdocker</div><div class="line"></div><div class="line"><span class="built_in">eval</span> $(docker-machine env hpdocker)</div></pre></td></tr></table></figure>
<p>&#x518D;&#x6BD4;&#x5982; AWS&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> amazonec2 \</div><div class="line">    --amazonec2-access-key <span class="variable">$AWS_ACCESS_KEY_ID</span> \</div><div class="line">    --amazonec2-secret-key <span class="variable">$AWS_SECRET_ACCESS_KEY</span> \</div><div class="line">    --amazonec2-ami <span class="variable">$ami</span> \</div><div class="line">    --amazonec2-instance-type <span class="variable">$instance_size</span> \</div><div class="line">    --amazonec2-vpc-id <span class="variable">$vpc_id</span> \</div><div class="line">    --amazonec2-security-group <span class="variable">$security_group</span> \</div><div class="line">    --amazonec2-region <span class="variable">$aws_region</span> \</div><div class="line">    &lt;machine name&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p><code>docker build</code> &#x2192; <code>docker run</code></p>
</blockquote>
<p>&#x524D;&#x7AEF;&#x4E00;&#x4E2A; load balancer&#xFF0C;&#x7528;&#x7684;&#x662F;<code>nginx</code> + <code>consul-template</code><br>&#x540E;&#x7AEF;&#x662F;&#x5404;&#x79CD;&#x5E94;&#x7528;&#x3002;<code>Dockerfile</code>&#x592A;&#x591A;&#x65E0;&#x754F;&#x7684;&#x5C42;&#xFF0C;&#x800C;&#x4E14;&#x4F7F;&#x7528;&#x4E86; <code>Supervisord</code>&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x628A;&#x5BB9;&#x5668;&#x5F53;&#x505A;&#x865A;&#x62DF;&#x673A;&#x4E86;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-compose scale web=20</div></pre></td></tr></table></figure>
<p>download demo:  <a href="http://dtdg.co/dkron" target="_blank" rel="external">http://dtdg.co/dkron</a></p>
<p>&#x76D1;&#x6D4B; docker &#x72B6;&#x6001;</p>
<p>&#x4E24;&#x79CD;&#x547D;&#x4EE4;&#x5F62;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x662F;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker stats</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x4F1A;&#x53EA;&#x663E;&#x793A;&#x5BB9;&#x5668;ID&#xFF0C;&#x4E00;&#x4E32;&#x6570;&#xFF0C;&#x4F30;&#x8BA1;&#x4E00;&#x822C;&#x90FD;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x5565;</p>
<p>&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x5C3E;&#x5760;&#x5BB9;&#x5668;&#x540D;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">docker stats \</div><div class="line">    nginxredisdocker_datadog_1 \</div><div class="line">    nginxredisdocker_loadbalancer_1 \</div><div class="line">    nginxredisdocker_registrator_1 \</div><div class="line">    nginxredisdocker_consol_1 \</div><div class="line">    nginxredisdocker_web_1</div></pre></td></tr></table></figure>
<p>&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x67E5;&#x770B;&#x72B6;&#x6001;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7; <code>REST API</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">http --stream <span class="_">-f</span> --verify=no \</div><div class="line">    --cert=<span class="variable">$DOCKER_CERT_PATH</span>/cert.pem \</div><div class="line">    --cert-key=<span class="variable">$DOCKER_CERT_PATH</span>/key.pem \</div><div class="line">    https://172.16.88.129:2376/containers/xxxxxxx/stats</div><div class="line"></div><div class="line">docker-machine ls</div><div class="line">docker-machine ip</div><div class="line"></div><div class="line">docker ps</div></pre></td></tr></table></figure>
<h1 id="monitoring-at-scale"><a href="#Monitoring-at-Scale" class="headerlink" title="Monitoring at Scale"></a>Monitoring at Scale <a href="#monitoring-at-scale" class="header-anchor">#</a></h1><h2 id="operational-complexity"><a href="#Operational-Complexity" class="headerlink" title="Operational Complexity"></a>Operational Complexity <a href="#operational-complexity" class="header-anchor">#</a></h2><ul>
<li>&#x5E73;&#x5747;&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x7684;&#x5BB9;&#x5668;&#x6570;&#x91CF;&#xFF1A;N ( <code>2014&#x5E74;10&#x6708;</code>&#x65F6;&#xFF0C;N&#x662F;<code>5</code>&#xFF0C;&#x4ECA;&#x5E74;<code>2016</code>&#xFF0C;&#x7EDF;&#x8BA1;&#x540C;&#x6837;&#x662F;<code>5</code>&#xFF09;</li>
<li>N * &#x4E3B;&#x673A;&#x6570;&#x91CF; = &#x591A;&#x5C11;&#x4E2A;&#x201C;&#x4E3B;&#x673A;&#x201D;&#x6765;&#x7BA1;&#x7406;</li>
<li>provision, configuration, orchestration, monitoring.</li>
</ul>
<h2 id="xu-yao-qu-ce-liang-de-dong-xi"><a href="#&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F;" class="headerlink" title="&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F;"></a>&#x9700;&#x8981;&#x53BB;&#x6D4B;&#x91CF;&#x7684;&#x4E1C;&#x897F; <a href="#xu-yao-qu-ce-liang-de-dong-xi" class="header-anchor">#</a></h2><ul>
<li><p>&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x4E3B;&#x673A;</p>
<ul>
<li><code>10</code>&#x4E2A;&#x5DE6;&#x53F3;&#x7684;&#x4E1C;&#x897F;</li>
</ul>
</li>
<li><p>&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</p>
<ul>
<li>&#x5927;&#x7EA6;<code>100</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;</li>
</ul>
</li>
<li><p><code>N</code>&#x4E2A;&#x5BB9;&#x5668;</p>
<ul>
<li><code>100</code> * <code>N</code> &#x4E2A;&#x6D4B;&#x91CF;&#x70B9;</li>
</ul>
</li>
<li><p><code>110</code> + <code>100</code> * <code>N</code> &#x4E2A;&#x6D4B;&#x91CF;&#x70B9;/&#x865A;&#x62DF;&#x673A;</p>
</li>
</ul>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4EE5;&#x524D;&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x9700;&#x8981;<code>160</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x5F97;&#x9700;&#x8981;<code>610</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;<code>100</code>&#x4E2A;&#x4E3B;&#x673A;&#xFF0C;&#x5C31;&#x5F97;&#x9700;&#x8981;<code>61K</code>&#x4E2A;&#x6D4B;&#x91CF;&#x70B9;&#x3002;</p>
<p>&#x548C;&#x865A;&#x62DF;&#x673A;&#x4E0D;&#x540C;&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x66F4;&#x77ED;</p>
<p>&#x865A;&#x62DF;&#x673A;&#x7684;&#x751F;&#x5B58;&#x5468;&#x671F;&#x53EF;&#x80FD;&#x662F;&#x5C0F;&#x65F6;&#x3001;&#x5929;&#x3001;&#x6708;&#x4E3A;&#x5355;&#x4F4D;&#xFF0C;&#x800C;&#x5BB9;&#x5668;&#x5219;&#x662F;&#x5206;&#x949F;&#x3001;&#x5C0F;&#x65F6;&#xFF0C;&#x5929;&#x4E3A;&#x5355;&#x4F4D;&#x3002;</p>
<p>&#x7528; <code>Tag</code> &#x53BB;&#x76D1;&#x6D4B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7528;&#x4E3B;&#x673A;IP&#x4E4B;&#x7C7B;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x4E0D;&#x540C;&#x5BB9;&#x5668;&#x7684;&#x751F;&#x6B7B;&#x53D8;&#x5316;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="fluentd" scheme="http://blog.lab99.org/tags/fluentd/"/>
    
      <category term="vimeo" scheme="http://blog.lab99.org/tags/vimeo/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：在容器内思考 - 一个持续部署的故事 - Maxfield Stewart</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-07-video-thinking-inside-the-container.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-07-video-thinking-inside-the-container.html</id>
    <published>2016-07-06T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#league-legends">League Legends</a></li>
<li><a href="#a-containerized-build-farm">A Containerized Build Farm</a></li>
<li><a href="#story-time">Story Time</a><ul>
<li><a href="#wo-men-dao-di-xiang-yao-shi-me">&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F;</a></li>
</ul>
</li>
<li><a href="#jenkins-primer">Jenkins Primer</a></li>
<li><a href="#docker-container-as-jenkins-slave">Docker Container as Jenkins Slave</a></li>
<li><a href="#rong-qi-fei-chang-yong-zhong">&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;</a></li>
<li><a href="#provisioning-and-plugins">Provisioning and Plugins</a></li>
<li><a href="#we-created-a-monster">We Created a Monster</a></li>
<li><a href="#we-need-to-ispect-our-containers">We Need to Ispect Our Containers</a></li>
<li><a href="#but-it-needs-to-scale">But it needs to Scale</a></li>
<li><a href="#putting-it-all-together">Putting It All Together</a><ul>
<li><a href="#grovvy-xie-de-jenkins-gou-jian-job">Grovvy &#x5199;&#x7684; Jenkins &#x6784;&#x5EFA; Job</a></li>
</ul>
</li>
<li><a href="#dockerception">Dockerception</a></li>
<li><a href="#how-do-you-actually-build-it">How do you actually build it</a></li>
<li><a href="#ting-qi-lai-hen-jian-dan">&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;</a></li>
<li><a href="#lesson-1-docker-isn-t-simple">Lesson 1 - Docker Isn&#x2019;t &#x201C;Simple&#x201D;</a></li>
<li><a href="#lesson-2-rong-qi-xu-ni-ji">Lesson 2 - &#x5BB9;&#x5668; != &#x865A;&#x62DF;&#x673A;</a></li>
<li><a href="#lesson-3-garbage-collection">Lesson 3 - Garbage Collection</a></li>
<li><a href="#lesson-4-maintenance-failure">Lesson 4 - Maintenance/Failure</a></li>
<li><a href="#lesson-5-dao-di-zen-me-sheng-ji">Lesson 5 - &#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F;</a></li>
<li><a href="#lesson-7-credentials-security">Lesson 7 - Credentials &amp; Security</a></li>
<li><a href="#wo-men-cheng-gong-liao-ma">&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Thinking Inside the Container - A Continuous Delivery Story<br>by Maxfield Stewart, Riot Games</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/YViFZBoKqjg" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=YViFZBoKqjg" target="_blank" rel="external">https://www.youtube.com/watch?v=YViFZBoKqjg</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=h03148603la&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/h03148603la.html" target="_blank" rel="external">http://v.qq.com/x/page/h03148603la.html</a></p>
<h1 id="league-legends"><a href="#League-Legends" class="headerlink" title="League Legends"></a>League Legends <a href="#league-legends" class="header-anchor">#</a></h1><ul>
<li>67 millions player/ month, 27 m/daily, 7.5 m at peak.</li>
<li>1.25 Milions Build / Year</li>
<li>10 - 14 k containers / week</li>
<li>120 build jobs / hour</li>
</ul>
<h1 id="a-containerized-build-farm"><a href="#A-Containerized-Build-Farm" class="headerlink" title="A Containerized Build Farm"></a>A Containerized Build Farm <a href="#a-containerized-build-farm" class="header-anchor">#</a></h1><p><code>Jenkins</code> &#x2192; (<code>Docker API</code>) &#x2192; <code>Swarm</code> &#x2192; (<code>Docker API</code>) &#x2192; <code>Build Hosts</code> &#x2192; (<code>Docker API</code>) &#x2192; <code>DryDock</code></p>
<p><code>Jenkins</code> &#x8FD8;&#x4F1A;&#x76F4;&#x63A5;&#x901A;&#x8FC7;SSH&#x8FDE;&#x63A5;<code>Build Host</code></p>
<p>&#x6BCF;&#x4E00;&#x4E2A;Build Host&#x90FD;&#x662F; <code>CentOS 7.2</code>/<code>Docker 1.10.3</code> + <code>cAdvisor</code> + <code>Docker-GC</code> + <code>Container Metrics</code>, 4 core/32GB RAM/120GB LVS</p>
<h1 id="story-time"><a href="#Story-Time" class="headerlink" title="Story Time"></a>Story Time <a href="#story-time" class="header-anchor">#</a></h1><p>&#x4E24;&#x5E74;&#x524D;&#xFF0C;2013&#xFF0C;&#x5728;&#x4E00;&#x4E2A; Jenkins &#x670D;&#x52A1;&#x5668;&#x4E0A;&#xFF0C;&#x8FD0;&#x884C;3500+ unique build jobs &#xFF0C;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#x5C31;&#x662F;&#x6BCF;&#x5C0F;&#x65F6; 650+ &#x4E2A;build&#x3002;90+ Build slave</p>
<p><code>Engineers</code> &#x2192; <code>Ticket(s)</code> &#x2192; <code>Build Team</code></p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x57FA;&#x672C;&#x90FD;&#x88AB;<code>Ticket</code>&#x57CB;&#x4E86;&#x2026;&#x2026;</p>
<h2 id="wo-men-dao-di-xiang-yao-shi-me"><a href="#&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F;"></a>&#x6211;&#x4EEC;&#x5230;&#x5E95;&#x60F3;&#x8981;&#x4EC0;&#x4E48;&#xFF1F; <a href="#wo-men-dao-di-xiang-yao-shi-me" class="header-anchor">#</a></h2><ul>
<li>&#x56E2;&#x961F;&#x5FC5;&#x987B;&#x6709;&#x5FEB;&#x901F;&#x884C;&#x52A8;&#x7684;&#x80FD;&#x529B;</li>
<li>&#x4EA7;&#x54C1;&#x5FC5;&#x987B;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6280;&#x672F;&#x6808;</li>
<li>&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x50CF;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#xFF0C;&#x5E0C;&#x671B;&#x9700;&#x6C42;&#x65B9;&#x53EF;&#x4EE5;&#x7528;code&#x5B9A;&#x4E49;&#x73AF;&#x5883;</li>
</ul>
<p>&#x66FE;&#x7ECF;&#x8003;&#x8651;&#x8FC7;&#x5F88;&#x591A;&#x79CD;&#x65B9;&#x6848;&#xFF1A; <code>Packer</code>, <code>Vagrant</code>, <code>Openstack</code>, <code>AWS EC2</code>, <code>Azure</code>, <code>vmware</code></p>
<p>2014&#x5E74;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7A81;&#x7136;<code>docker</code>&#x51FA;&#x73B0;&#x4E86;&#xFF0C;&#x7531;&#x4E8E;&#x56E2;&#x961F;&#x592A;&#x8FC7;&#x7E41;&#x5FD9;&#xFF0C;&#x6CA1;&#x6709;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;&#x76F4;&#x5230;&#x6709;&#x4E00;&#x5929;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;<code>ticket</code>&#x51FA;&#x73B0;&#x8BF4;&#xFF0C;&#x4F60;&#x4EEC;&#x80FD;&#x591F;&#x5728;build&#x73AF;&#x5883;&#x4E2D;&#x90E8;&#x7F72;<code>Docker</code>&#x4E48;&#xFF1F;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x5C31;&#x592A;&#x8D5E;&#x4E86;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x53CD;&#x5E94;&#xFF0C;&#x4F1A;&#x89C9;&#x5F97;WTF&#xFF0C;&#x53C8;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E1C;&#x897F;&#x60F3;&#x90E8;&#x7F72;&#x4E86;&#xFF1F;&#x4F46;&#x662F;turns out, it&#x2019;s great&#x3002;</p>
<h1 id="jenkins-primer"><a href="#Jenkins-Primer" class="headerlink" title="Jenkins Primer"></a>Jenkins Primer <a href="#jenkins-primer" class="header-anchor">#</a></h1><p><code>Jenkins</code> &#x662F;&#x4E3B;&#x4ECE;&#x7ED3;&#x6784;&#xFF0C;&#x5728; Jenkins &#x773C;&#x4E2D;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x4ECE;&#x6784;&#x5EFA;&#x4E3B;&#x673A;&#x662F;&#x5404;&#x79CD;<code>label</code>&#x800C;&#x5DF2;&#xFF0C;&#x6BD4;&#x5982; <code>Win32</code> + <code>Java</code> + <code>TeamA</code>,&#x6216;&#x8005; <code>CentOS7</code> + <code>Java</code> + <code>TeamB</code> &#x2026;</p>
<p>&#x800C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;&#x5199;&#x6784;&#x5EFA;&#x9700;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x9700;&#x8981;<code>label</code>&#x4E0A;&#x81EA;&#x5DF1;&#x6240;&#x9700;&#x7684;&#x73AF;&#x5883;&#xFF1A;<code>Win32</code> + <code>Java</code> + <code>TeamA</code>&#x4E4B;&#x7C7B;&#x7684;&#x5373;&#x53EF;&#xFF0C;<code>Jenkins</code>&#x4F1A;&#x6839;&#x636E;&#x8FD9;&#x4E9B;<code>Label</code>&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x8C03;&#x5EA6;&#x6784;&#x5EFA;&#x4EFB;&#x52A1;</p>
<h1 id="docker-container-as-jenkins-slave"><a href="#Docker-Container-as-Jenkins-Slave" class="headerlink" title="Docker Container as Jenkins Slave"></a>Docker Container as Jenkins Slave <a href="#docker-container-as-jenkins-slave" class="header-anchor">#</a></h1><p>&#x73B0;&#x5728; <code>Jenkins</code> &#x4E0A;&#x4F30;&#x8BA1;&#x6709;&#x5F88;&#x591A; <code>Docker</code> &#x7684;&#x63D2;&#x4EF6;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5728;1-2&#x5E74;&#x524D;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x9700;&#x8981;&#x627E;&#x51FA;&#x4E00;&#x79CD;&#x529E;&#x6CD5;&#x8BA9; <code>Jenkins</code> &#x4EE5;&#x4E3A;&#x5BB9;&#x5668;&#x5C31;&#x662F; <code>Build Slave</code>&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x53EF;&#x4EE5;&#x8BA9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B; Dockerfile &#x7684;&#x9014;&#x5F84;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#x3002;</p>
<p>&#x540E;&#x6765;&#x901A;&#x8FC7;google&#x5728;Docker Hub&#x4E0A;&#x627E;&#x5230;&#x4E86;&#x4E00;&#x4E2A;Dockerfile&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#x6A21;&#x62DF; Jenkins Build Slave&#x3002;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5305;&#x62EC;&#x4E86; <code>ssh</code>, <code>jdk</code>, <code>git</code>, <code>jenkins</code>&#x7684;&#x5BB9;&#x5668;</p>
<h1 id="rong-qi-fei-chang-yong-zhong"><a href="#&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;" class="headerlink" title="&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF;"></a>&#x5BB9;&#x5668;&#x975E;&#x5E38;&#x81C3;&#x80BF; <a href="#rong-qi-fei-chang-yong-zhong" class="header-anchor">#</a></h1><p>&#x7531;&#x4E8E;&#x4ED6;&#x4EEC;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x80A5;&#x955C;&#x50CF;&#xFF0C;&#x524D;&#x9762;&#x51E0;&#x5C42;&#x8FD8;&#x597D;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x6784;&#x5EFA;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6240;&#x9700;&#x7684;&#x955C;&#x50CF;&#x65F6;&#xFF0C;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#x3002;</p>
<h1 id="provisioning-and-plugins"><a href="#Provisioning-and-Plugins" class="headerlink" title="Provisioning and Plugins"></a>Provisioning and Plugins <a href="#provisioning-and-plugins" class="header-anchor">#</a></h1><ul>
<li>Docker Plugin: &lt;&#x4E2D;&#x9009;&gt;</li>
<li>Mesos Plugin:</li>
<li>Kubernetes Plugin:</li>
</ul>
<p>Jenkins Docker Plugin UI&#x975E;&#x5E38;&#x57FA;&#x672C;&#xFF0C;URL, Docker Image, &#x5BB9;&#x5668;&#x9009;&#x9879;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x7136;&#x540E;&#x8BBE;&#x6CD5;&#x7528;<code>Groovy</code>&#x505A;&#x4E86;&#x4E2A;&#x7ED3;&#x5408;&#x4E8C;&#x8005;API&#x7684;&#x811A;&#x672C;&#x3002;&#x73B0;&#x5728;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;<code>Dockerfile</code>&#xFF0C;&#x7136;&#x540E;Jenkins&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#x6784;&#x5EFA;&#x3002;</p>
<h1 id="we-created-a-monster"><a href="#We-Created-a-Monster" class="headerlink" title="We Created a Monster"></a>We Created a Monster <a href="#we-created-a-monster" class="header-anchor">#</a></h1><p><code>Garbage In-Gabage out</code> Paradigm</p>
<p>&#x4E0D;&#x662F;&#x6240;&#x6709;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x90FD;&#x7406;&#x89E3;&#x8FD9;&#x79CD;&#x6784;&#x67B6;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x7684;&#x65F6;&#x5019;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B;&#x7684;<code>Dockerfile</code>&#xFF0C;&#x6216;&#x8BB8;&#x672C;&#x5730;&#x6784;&#x5EFA;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x5728; <code>Jenkins</code> &#x6784;&#x5EFA; <code>Slave</code> &#x4E0A;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x7136;&#x540E; <code>Jenkins</code> &#x4F1A;&#x975E;&#x5E38;&#x5C3D;&#x804C;&#x7684;&#x53BB;&#x52AA;&#x529B;&#x5DE5;&#x4F5C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x5F88;&#x591A;&#x7684;&#x5BB9;&#x5668;&#x53BB;&#x6EE1;&#x8DB3;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#xFF0C;&#x6700;&#x540E;&#x9762;&#x5BF9;&#x7684;&#x662F;&#x5DE8;&#x5927;&#x7684;<code>docker rmi</code>&#x7684;job&#x3002;</p>
<h1 id="we-need-to-ispect-our-containers"><a href="#We-Need-to-Ispect-Our-Containers" class="headerlink" title="We Need to Ispect Our Containers"></a>We Need to Ispect Our Containers <a href="#we-need-to-ispect-our-containers" class="header-anchor">#</a></h1><p>&#x201C;Infrastructure as Code&#x201D; Managing Servers in the Cloud</p>
<p>&#x6700;&#x5F00;&#x59CB;&#x662F;&#x624B;&#x52A8;&#x68C0;&#x67E5;<code>Docker Image</code>&#xFF0C;&#x5F88;&#x5FEB;&#x5C31;&#x610F;&#x8BC6;&#x5230;&#x8FD9;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x4E8E;&#x662F;&#x521B;&#x5EFA;&#x4E86;&#x4E2A;&#x811A;&#x672C; <code>./harbormaster</code> &#xFF0C;&#x4F7F;&#x7528;<code>Go</code>&#x5199;&#x7684;&#xFF0C;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;<code>Image</code>&#x662F;&#x4E0D;&#x662F;&#x6EE1;&#x8DB3;&#x5404;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x6BD4;&#x5982;<code>ssh</code>&#x554A;&#x4E4B;&#x7C7B;&#x7684;&#x3002;</p>
<h1 id="but-it-needs-to-scale"><a href="#But-it-needs-to-Scale" class="headerlink" title="But it needs to Scale"></a>But it needs to Scale <a href="#but-it-needs-to-scale" class="header-anchor">#</a></h1><p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x6700;&#x5F00;&#x59CB;&#x4F1A;&#x53EA;&#x5728;&#x4E00;&#x4E2A;<code>Docker Host</code>&#x4E0A;&#x8DD1;&#xFF0C;&#x56E0;&#x4E3A;<code>Docker Plugins</code>&#x53EA;&#x652F;&#x6301;&#x4E00;&#x4E2A;<code>Docker API</code>&#x3002;&#x5F53;&#x65F6;&#x5C31;&#x5728;&#x60F3;&#xFF0C;&#x8981;&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;<code>Docker API</code> &#x7136;&#x540E;&#x5B83;&#x7406;&#x89E3;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x7136;&#x540E;&#x5B83;&#x53BB;&#x63A7;&#x5236;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x5668;&#x591A;&#x597D;&#x3002;&#x6070;&#x597D;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;<code>Docker Swarm 0.1</code>&#x53D1;&#x5E03;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x7ACB;&#x5373;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x5C1D;&#x8BD5;&#xFF0C;&#x4ED6;&#x4EEC;&#x7B2C;&#x4E00;&#x6B21;&#x8BD5;&#x7528;&#x7684;&#x65F6;&#x95F4;&#x4F30;&#x8BA1;&#x662F;<code>Swarm 0.2</code>&#x3002;</p>
<h1 id="putting-it-all-together"><a href="#Putting-It-All-Together" class="headerlink" title="Putting It All Together"></a>Putting It All Together <a href="#putting-it-all-together" class="header-anchor">#</a></h1><p>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7528; <code>Dockerfile</code> &#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x6254;&#x7ED9; <code>Registry</code>&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x77E5; <code>Harbor Master</code> &#xFF0C;&#x7136;&#x540E; <code>Harbor Master</code> &#x5F00;&#x59CB;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;&#xFF0C;&#x4F1A;&#x901A;&#x77E5; <code>Swarm Master</code> &#x4E0B;&#x8FBE;&#x4EFB;&#x52A1;&#xFF0C;<code>Swarm Master</code> &#x4F1A;&#x8C03;&#x5EA6;&#x4EFB;&#x52A1;&#x5230;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#x4ECE; <code>Registry</code> &#x4E0B;&#x8F7D;&#x4EFB;&#x52A1;&#x3002;</p>
<p>&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7F8E;&#x597D;&#xFF0C;&#x4ED6;&#x4EEC;&#x8BA9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C1D;&#x8BD5;&#xFF0C;&#x53EF;&#x662F;&#x73B0;&#x5B9E;&#x5F88;&#x6B8B;&#x9177;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6784;&#x5EFA;&#x7684;&#x955C;&#x50CF;&#x5927;&#x7EA6;<code>3GB</code>&#x5DE6;&#x53F3;&#xFF0C;&#x7528;&#x4E86;&#x5F88;&#x4E45;<code>push</code>&#x5230;&#x4E86;<code>registry</code>&#x540E;&#xFF0C;&#x6D4B;&#x8BD5;&#x5E76;&#x6CA1;&#x6709;&#x5F00;&#x59CB;&#x3002;&#x539F;&#x56E0;&#x662F;&#xFF0C;<code>Swarm</code> &#x4E2D;&#x7684; <code>Docker Host</code> &#x540C;&#x6837;&#x9700;&#x8981;&#x5F88;&#x4E45;&#x53BB;&#x4E0B;&#x8F7D;&#x8FD9;&#x4E2A;<code>3GB</code>&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x4E0B;&#x8F7D;&#x540E;&#x624D;&#x53EF;&#x80FD;&#x6D4B;&#x8BD5;&#x3002;&#x6240;&#x4EE5;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x62B1;&#x6028;&#x8BF4;&#x4F60;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x4E0D;&#x597D;&#x7528;&#xFF0C;&#x63D0;&#x4EA4;&#x4E86;&#x4EFB;&#x52A1;&#x8BB8;&#x4E45;&#x90FD;&#x6CA1;&#x6709;&#x5F00;&#x59CB;&#x6D4B;&#x8BD5;&#x3002;</p>
<h2 id="grovvy-xie-de-jenkins-gou-jian-job"><a href="#Grovvy-&#x5199;&#x7684;-Jenkins-&#x6784;&#x5EFA;-Job" class="headerlink" title="Grovvy &#x5199;&#x7684; Jenkins &#x6784;&#x5EFA; Job"></a>Grovvy &#x5199;&#x7684; Jenkins &#x6784;&#x5EFA; Job <a href="#grovvy-xie-de-jenkins-gou-jian-job" class="header-anchor">#</a></h2><p>&#x5185;&#x5BB9;&#x5F88;&#x7B80;&#x5355;</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">node (<span class="string">&apos;Awesome-Build-Label&apos;</span>) {</div><div class="line">    git <span class="string">branch:</span> <span class="string">&quot;master&quot;</span>, <span class="string">url:</span> <span class="string">&quot;git@github.com:maxfields2000/awesome.git&quot;</span></div><div class="line">    sh <span class="string">&quot;./buildme.sh&quot;</span></div><div class="line">}</div></pre></td></tr></table></figure>
<h1 id="dockerception"><a href="#Dockerception" class="headerlink" title="Dockerception"></a>Dockerception <a href="#dockerception" class="header-anchor">#</a></h1><p>&#x5F88;&#x5FEB;&#x5C31;&#x51FA;&#x65B0;&#x7684;&#x9EBB;&#x70E6;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;Docker&#x5F88;&#x597D;&#x7528;&#xFF0C;&#x4E8E;&#x662F;&#x5927;&#x5BB6;&#x5F00;&#x59CB;&#x90FD;&#x7528;Docker&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x5FEB;&#x6709;&#x4EBA;&#x9700;&#x8981;Docker in Docker&#x3002;&#x56E0;&#x4E3A;&#x5F88;&#x591A;&#x4EBA;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x7528;Jenkins&#x6D4B;&#x8BD5;&#x6784;&#x5EFA;Docker &#x955C;&#x50CF;&#x662F;&#x5426;&#x6210;&#x529F;&#x3002;</p>
<p>&#x6700;&#x7EC8;&#xFF0C;&#x4ED6;&#x4EEC;&#x72EC;&#x7ACB;&#x51FA;&#x6765;&#x4E86;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x79F0;&#x4E3A;<code>DRYDOCK</code>&#xFF0C;&#x7136;&#x540E;&#x6240;&#x6709;&#x90A3;&#x4E9B;&#x9700;&#x8981;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x90FD;&#x6307;&#x5411;&#x8FD9;&#x4E2A;&#x673A;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;DIND&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x4F1A;&#x628A;Build Slave&#x96C6;&#x7FA4;&#x641E;&#x5D29;&#x4E86;&#x3002;&#x771F;&#x51FA;&#x4E86;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x76F4;&#x63A5;&#x628A;&#x8FD9;&#x4E2A;&#x673A;&#x5668;&#x7684;&#x6E05;&#x7A7A;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x5373;&#x53EF;&#x3002;</p>
<h1 id="how-do-you-actually-build-it"><a href="#How-do-you-actually-build-it" class="headerlink" title="How do you actually build it"></a>How do you actually build it <a href="#how-do-you-actually-build-it" class="header-anchor">#</a></h1><p><a href="http://engineering.riotgames.com" target="_blank" rel="external">http://engineering.riotgames.com</a><br><a href="https://github.com/maxfields2000/dockerjenkins_tutorial" target="_blank" rel="external">https://github.com/maxfields2000/dockerjenkins_tutorial</a></p>
<h1 id="ting-qi-lai-hen-jian-dan"><a href="#&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;" class="headerlink" title="&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355;"></a>&#x542C;&#x8D77;&#x6765;&#x5F88;&#x7B80;&#x5355; <a href="#ting-qi-lai-hen-jian-dan" class="header-anchor">#</a></h1><p>&#x4E3E;&#x4E86;&#x4E24;&#x6B65;&#x753B;&#x732B;&#x5934;&#x9E70;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;&#x7B2C;&#x4E00;&#x6B65;&#x82B1;&#x4E24;&#x4E2A;&#x5706;&#xFF1B;&#x7B2C;&#x4E8C;&#x6B65;&#x753B;&#x5269;&#x4E0B;&#x7684;&#x90E8;&#x5206;&#x2026;&#x2026;</p>
<p>&#x4E24;&#x5E74;&#x524D;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x4F7F;&#x7528;<code>Docker</code>&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x624D;&#x6765;&#x8FD9;&#x91CC;&#x7ED9;&#x5927;&#x5BB6;&#x6F14;&#x8BB2;&#xFF0C;&#x663E;&#x7136;&#x4E2D;&#x95F4;&#x53D1;&#x751F;&#x4E86;&#x5199;&#x4EC0;&#x4E48;&#x4E8B;&#x60C5;&#xFF0C;&#x4E0D;&#x7136;&#x6211;&#x4EEC;&#x53BB;&#x5E74;&#x5C31;&#x6765;&#x4E86;&#x3002;</p>
<h1 id="lesson-1-docker-isn-t-simple"><a href="#Lesson-1-Docker-Isn&#x2019;t-&#x201C;Simple&#x201D;" class="headerlink" title="Lesson 1 - Docker Isn&#x2019;t &#x201C;Simple&#x201D;"></a>Lesson 1 - Docker Isn&#x2019;t &#x201C;Simple&#x201D; <a href="#lesson-1-docker-isn-t-simple" class="header-anchor">#</a></h1><ul>
<li>Dockerfile &#x7684;&#x64B0;&#x5199;&#x9700;&#x8981;&#x6709;&#x826F;&#x597D;&#x7684;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x77E5;&#x8BC6;&#x80CC;&#x666F;</li>
</ul>
<p>&#x597D;&#x591A;&#x4EBA;&#x7684;&#x95EE;&#x9898;&#x5B9E;&#x9645;&#x4E0A;&#x662F; <code>Dockerfile</code> &#x7684;&#x4E66;&#x5199;&#x95EE;&#x9898;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x8F6C;&#x5316;&#x4E3A;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E1C;&#x897F;&#x4E0D;&#x53EF;&#x80FD;&#x5728; Docker &#x91CC;&#x6784;&#x5EFA;&#x3002;&#x5176;&#x5B9E; Docker &#x7528;&#x6237;&#x90FD;&#x77E5;&#x9053;&#x4E8B;&#x5B9E;&#x5E76;&#x975E;&#x5982;&#x6B64;&#x3002;&#x4ED6;&#x4EEC;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5C31;&#x662F;Teaching&#x3002;</p>
<ul>
<li>&#x7528;&#x6765;&#x6784;&#x5EFA; Docker Images &#x7684; Docker Images &#x662F; Dockerception</li>
<li>Docker &#x201C;Voodoo and Black Magic&#x201D; &#x95EE;&#x9898;</li>
</ul>
<h1 id="lesson-2-rong-qi-xu-ni-ji"><a href="#Lesson-2-&#x5BB9;&#x5668;-&#x865A;&#x62DF;&#x673A;" class="headerlink" title="Lesson 2 - &#x5BB9;&#x5668; != &#x865A;&#x62DF;&#x673A;"></a>Lesson 2 - &#x5BB9;&#x5668; != &#x865A;&#x62DF;&#x673A; <a href="#lesson-2-rong-qi-xu-ni-ji" class="header-anchor">#</a></h1><p>&#x867D;&#x7136;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x50CF;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6BD4;&#x5982;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x91CC;&#x9762; <code>apt-get install</code>&#xFF0C;&#x4F46;&#x662F;Docker&#x4E0D;&#x662F;&#x865A;&#x62DF;&#x673A;&#x3002;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#x5728;&#x91CC;&#x9762;&#x505A;&#x7684;&#x3002;</p>
<ul>
<li>&#x65E0;&#x6CD5;&#x6302;&#x8F7D;&#x8FDC;&#x7A0B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</li>
<li>&#x5BB9;&#x5668;&#x4E0D;&#x4FDD;&#x5B58;&#x72B6;&#x6001;</li>
<li>&#x5BF9;&#x4E8E;&#x6784;&#x5EFA;&#x65F6;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x89C4;&#x77E9;</li>
</ul>
<h1 id="lesson-3-garbage-collection"><a href="#Lesson-3-Garbage-Collection" class="headerlink" title="Lesson 3 - Garbage Collection"></a>Lesson 3 - Garbage Collection <a href="#lesson-3-garbage-collection" class="header-anchor">#</a></h1><p>docker build &#x2192; docker run &#x2192; docker pull &#x2192; volume</p>
<p>github: <code>spotify/docker-gc</code></p>
<h1 id="lesson-4-maintenance-failure"><a href="#Lesson-4-Maintenance-Failure" class="headerlink" title="Lesson 4 - Maintenance/Failure"></a>Lesson 4 - Maintenance/Failure <a href="#lesson-4-maintenance-failure" class="header-anchor">#</a></h1><ul>
<li>Pull hosts on/offline</li>
</ul>
<p>Docker &#x7ECF;&#x5E38;&#x5347;&#x7EA7;&#xFF0C;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x90FD;&#x60F3;&#x4F7F;&#x7528;&#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x5C31;&#x5FC5;&#x987B;&#x6D89;&#x53CA;&#x4E00;&#x4E2A;&#x5982;&#x4F55;&#x5347;&#x7EA7;&#x7EF4;&#x62A4;&#x3001;&#x4E0A;&#x7EBF;&#x4E0B;&#x7EBF;&#x670D;&#x52A1;&#x7684;&#x6D41;&#x7A0B;&#x3002;</p>
<ul>
<li>Update All Images</li>
<li>Rolling Restarts</li>
</ul>
<p>Docker &#x548C;&#x5176;&#x5B83;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#xFF0C;&#x4F1A; Crash&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#x53BB;&#x53D1;&#x73B0;&#x7EF4;&#x62A4;&#x8FD9;&#x4E9B;&#x6545;&#x969C;&#x3002;</p>
<h1 id="lesson-5-dao-di-zen-me-sheng-ji"><a href="#Lesson-5-&#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F;" class="headerlink" title="Lesson 5 - &#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F;"></a>Lesson 5 - &#x5230;&#x5E95;&#x600E;&#x4E48;&#x5347;&#x7EA7;&#xFF1F; <a href="#lesson-5-dao-di-zen-me-sheng-ji" class="header-anchor">#</a></h1><p>&#x5347;&#x7EA7;&#x4E00;&#x5B9A;&#x8981;&#x6709;&#x8BA1;&#x5212;&#xFF0C;&#x5347;&#x7EA7;&#x9700;&#x8981;&#x8003;&#x8651;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#xFF0C;&#x6BD4;&#x5982;&#x5982;&#x679C;Swarm&#x5347;&#x7EA7;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x6709;&#x7684;&#x4F7F;&#x7528;Docker API&#x7684;&#x63D2;&#x4EF6;&#x662F;&#x5426;&#x8FD8;&#x4F1A;&#x7EE7;&#x7EED;&#x652F;&#x6301;&#xFF1F;&#x4E00;&#x822C;&#x60AC;&#x3002;</p>
<h1 id="lesson-7-credentials-security"><a href="#Lesson-7-Credentials-amp-Security" class="headerlink" title="Lesson 7 - Credentials &amp; Security"></a>Lesson 7 - Credentials &amp; Security <a href="#lesson-7-credentials-security" class="header-anchor">#</a></h1><ul>
<li>&#x4EC0;&#x4E48;&#x5E94;&#x8BE5;&#x653E;&#x5230; <code>Base Image</code> &#x91CC;&#xFF1F;</li>
<li>&#x628A;<code>SSH key</code>&#x6254;&#x5230;registry&#x91CC;&#xFF1F;</li>
<li>&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x7684;password&#xFF1F;</li>
<li>&#x6240;&#x6709;&#x5BC6;&#x7801;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x7528;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF1F;</li>
</ul>
<p>&#x73B0;&#x6709;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5728; Jenkins Master &#x4E0A;&#x5B58;&#x50A8;&#x6240;&#x6709; Credentials&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5B83;&#x4EE5;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x5F62;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;&#x6D4B;&#x8BD5;&#x90E8;&#x7F72;&#x73AF;&#x8282;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x786E;&#x4FDD; Jenkins Master &#x5B89;&#x5168;&#x5373;&#x53EF;&#x3002;&#x76EE;&#x524D;&#x8FD8;&#x6709;&#x522B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4ED6;&#x4EEC;&#x6682;&#x65F6;&#x91C7;&#x7528;&#x7684;&#x662F;&#x8FD9;&#x79CD;&#x529E;&#x6CD5;&#x3002;</p>
<h1 id="wo-men-cheng-gong-liao-ma"><a href="#&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F;"></a>&#x6211;&#x4EEC;&#x6210;&#x529F;&#x4E86;&#x5417;&#xFF1F; <a href="#wo-men-cheng-gong-liao-ma" class="header-anchor">#</a></h1><ul>
<li>Over 1200 New Build Jobs Created</li>
<li>30% &#x7684;&#x73AF;&#x5883;&#x662F;&#x5BB9;&#x5668;</li>
<li>&#x6784;&#x5EFA;&#x73AF;&#x5883;&#x53D8;&#x5316;&#x3001;&#x521B;&#x5EFA;&#x3001;&#x4FEE;&#x590D;&#x7684;Ticket&#x6D88;&#x5931;&#x4E86;</li>
<li>&#x6211;&#x4EEC;&#x4E0D;&#x53EA;&#x518D;&#x662F; Build Team &#x4E86;</li>
</ul>
<p>&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x6240;&#x6709;&#x7684;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x90FD;&#x81EA;&#x52A8;&#x5316;&#x4E86;&#xFF0C;&#x800C;&#x6784;&#x5EFA;&#x73AF;&#x5883;&#x90FD; Docker &#x5316;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x4ED6;&#x4EEC;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x4ED6;&#x4EEC;&#x90FD;&#x88AB;&#x5F00;&#x4E86;&#xFF0C;&#x800C;&#x662F;&#x90FD;&#x6210;&#x4E3A;&#x4E86;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x90FD;&#x6210;&#x4E86; Docker &#x4E13;&#x5BB6;&#xFF0C;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6784;&#x5EFA;Docker&#x955C;&#x50CF;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker for Mac and Windows - 深入指南 - Justin Cormack</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-06-video-docker-for-mac-and-windows-the-insider-guide.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-06-video-docker-for-mac-and-windows-the-insider-guide.html</id>
    <published>2016-07-05T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#zi-wo-jie-shao">&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#make-it-native">Make it native</a></li>
<li><a href="#let-s-go-inside">Let&#x2019;s Go Inside</a></li>
<li><a href="#hyperkit">Hyperkit</a></li>
<li><a href="#datakit">DataKit</a></li>
<li><a href="#plumbing">Plumbing</a></li>
<li><a href="#moby">Moby</a><ul>
<li><a href="#wu-zhuang-tai">&#x65E0;&#x72B6;&#x6001;</a></li>
<li><a href="#mei-you-yong-hu-ke-yi-xiu-gai-de-bu-fen">&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;</a></li>
<li><a href="#nei-he">&#x5185;&#x6838;</a></li>
<li><a href="#userspace">Userspace</a></li>
</ul>
</li>
<li><a href="#vpnkit">VPNKit</a></li>
<li><a href="#osxfs">OSXfs</a></li>
<li><a href="#windows-file-sharing">Windows file sharing</a></li>
<li><a href="#yong-hu-jie-mian">&#x7528;&#x6237;&#x754C;&#x9762;</a></li>
<li><a href="#design">Design</a></li>
<li><a href="#wei-shi-me-xxx-bu-neng-yong-a">&#x4E3A;&#x4EC0;&#x4E48; XXX &#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F;</a><ul>
<li><a href="#net-host-de-wang-luo-bu-neng-yong"><code>--net=host</code>&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528;</a></li>
<li><a href="#wo-wu-fa-lian-jie-dao-rong-qi-duan-kou">&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;</a></li>
<li><a href="#zhu-ji-he-rong-qi-jian-de-unix-socket-bu-neng-yong">&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684; Unix socket &#x4E0D;&#x80FD;&#x7528;</a></li>
<li><a href="#sheng-yin-he-shi-pin">&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891;</a></li>
</ul>
</li>
<li><a href="#roadmap">Roadmap</a><ul>
<li><a href="#stability-first-features-second">Stability first, features second</a></li>
</ul>
</li>
<li><a href="#team">Team</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker for Mac and Windows - The Insider&#x2019;s Guide<br>by Justin Cormack, Docker (Cambridge)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/7da-B3rY9V4" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=7da-B3rY9V4" target="_blank" rel="external">https://www.youtube.com/watch?v=7da-B3rY9V4</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=d0314fbp2mx&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/d0314fbp2mx.html" target="_blank" rel="external">http://v.qq.com/x/page/d0314fbp2mx.html</a></p>
<h1 id="zi-wo-jie-shao"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD; <a href="#zi-wo-jie-shao" class="header-anchor">#</a></h1><p>&#x4ED6;&#x5199;&#x7684;&#x4E66;&#xFF1A;<code>Docker in Production - Lessons from the Trenches</code>&#xFF0C;&#x5DF2;&#x7ECF;&#x6709;&#x4E2D;&#x6587;&#x7248;&#x4E86;&#xFF1A;<code>Docker &#x751F;&#x4EA7;&#x73AF;&#x5883; - &#x5B9E;&#x8DF5;&#x6307;&#x5357;</code></p>
<h1 id="make-it-native"><a href="#Make-it-native" class="headerlink" title="Make it native"></a>Make it native <a href="#make-it-native" class="header-anchor">#</a></h1><p>&#x5C31;&#x50CF; <code>Linux</code> &#x73AF;&#x5883;&#x4E00;&#x6837;&#xFF0C;&#x88C5;&#x4E0A;&#x4E86;&#x5C31;&#x5728;&#x90A3;&#xFF0C;&#x60F3;&#x7528;&#x968F;&#x65F6;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x4E0D;&#x9700;&#x8981; <code>Virtualbox</code>&#xFF08;&#x6CA1;&#x4EBA;&#x559C;&#x6B22;vbox&#xFF09;&#xFF0C;&#x4E0D;&#x50CF; <code>Toolbox</code> &#x90A3;&#x6837; intrusive&#x3002;&#x6700;&#x5173;&#x952E;&#x7684;&#xFF0C;&#x8BA9;&#x6587;&#x4EF6; <code>notification</code> &#x53EF;&#x4EE5;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#xFF08;vbox&#x5171;&#x4EAB;&#x5BBF;&#x4E3B;&#x76EE;&#x5F55;&#x4E0D;&#x884C;&#xFF09;</p>
<p>&#x5927;&#x7EA6;&#x82B1;&#x4E86;6&#x4E2A;&#x6708;&#x53BB;&#x5F00;&#x53D1;&#x3002;&#x6709;3&#x4E07;&#x4EBA;&#x5728;&#x7B2C;&#x4E00;&#x5929;&#x5C31;&#x6CE8;&#x518C;&#x8981;&#x6D4B;&#x8BD5;&#xFF0C;&#x800C;&#x5230;<code>DockerCon</code>&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x6709;7&#x4E07;&#x4EBA;&#x4E86;&#x3002;</p>
<h1 id="let-s-go-inside"><a href="#Let&#x2019;s-Go-Inside" class="headerlink" title="Let&#x2019;s Go Inside"></a>Let&#x2019;s Go Inside <a href="#let-s-go-inside" class="header-anchor">#</a></h1><p>Justin &#x663E;&#x793A;&#x4E86;&#x4E00;&#x4E2A; <code>ps</code> &#x5217;&#x8868;&#xFF0C;&#x8FD9;&#x662F;&#x6240;&#x6709; <code>Docker for Mac</code> &#x7684;&#x76F8;&#x5173;&#x8FDB;&#x7A0B;&#x5217;&#x8868;&#xFF0C;&#x57FA;&#x672C;&#x53CD;&#x6620;&#x4E86;&#x5176;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;</p>
<h1 id="hyperkit"><a href="#Hyperkit" class="headerlink" title="Hyperkit"></a>Hyperkit <a href="#hyperkit" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5D4C;&#x5165;&#x5F0F; hypervisor toolkit&#x3002;</p>
<ul>
<li>&#x53EA;&#x5728; Mac &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;Windows &#x5219;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>Hyper-V</code>&#x3002;</li>
<li>&#x57FA;&#x4E8E; <code>xhyve</code>&#xFF0C;&#x8FD9;&#x662F;&#x4ECE; <code>FreeBSD</code> &#x7684; <code>bhyve</code> &#x79FB;&#x690D;&#x8FC7;&#x6765;&#x7684;&#x3002;</li>
<li>&#x4E00;&#x4E2A; <code>hypervisor</code> &#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x6838;&#x7684;&#x5355;&#x8FDB;&#x7A0B;&#x3002;</li>
</ul>
<p>&#x51E0;&#x5E74;&#x524D; <code>OSX</code> &#x5F15;&#x5165;&#x4E86;&#x865A;&#x62DF;&#x5316;&#x6846;&#x67B6;&#xFF0C;&#x5355;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x53EF;&#x4EE5;&#x865A;&#x62DF;&#x673A;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x4F46;&#x662F;&#x6587;&#x6863;&#x8D85;&#x70C2;&#x3002;&#x6CA1;&#x4EBA;&#x7528;&#x5B83;&#xFF0C;&#x76F4;&#x5230; <code>xhyve</code> &#x9879;&#x76EE;&#x542F;&#x52A8;&#xFF0C;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x5927;&#x7EA6;&#x91CD;&#x5199;&#x4E86; <code>bhyve</code> &#x4E00;&#x534A;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x6700;&#x521D;&#x7684; <code>Docker for Mac</code> &#x7684;&#x65E5;&#x5B50;&#x5C31;&#x662F;&#x4F7F;&#x7528; <code>xhype</code> + <code>Linux</code>&#xFF0C;&#x7136;&#x540E;&#x4E0D;&#x65AD;&#x6253;&#x8865;&#x4E01;&#x5F00;&#x59CB;&#x7684;&#x3002;</p>
<p>&#x7531;&#x4E8E; OS X &#x4E0D;&#x652F;&#x6301; Sparse &#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728; <code>Hyperkit</code> &#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>qcow2</code> &#x6587;&#x4EF6;&#x4F5C;&#x4E3A; <code>sparse block device</code>&#x3002;&#x4ECA;&#x5E74;&#x7684;<code>WWDC</code>&#x4E0A;&#xFF0C;&#x82F9;&#x679C;&#x8BF4;&#x5C06;&#x652F;&#x6301; <code>Sparse</code> &#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;&#x3002;</p>
<p>virtio device: <code>network</code>, <code>block</code>, <code>9p</code>, <code>socket</code>, <code>rng</code></p>
<p>&#x5185;&#x5B58;&#x3001;CPU&#x6838;&#x5FC3;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x3002;</p>
<h1 id="datakit"><a href="#DataKit" class="headerlink" title="DataKit"></a>DataKit <a href="#datakit" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x662F; <code>git for data structures</code>&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; <code>Git database</code>&#x3002;</p>
<p>&#x5728; <code>Docker for Mac/Windows</code> &#x4E2D;&#x7684;&#x5E94;&#x7528;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x4F5C;&#x4E3A;&#x914D;&#x7F6E;&#x7684;&#x5B58;&#x50A8;&#x800C;&#x5DF2;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x672C;&#x8EAB;&#x7684;&#x529F;&#x80FD;&#x5F88;&#x5F3A;&#x5927;&#xFF0C;&#x53EF;&#x4EE5;&#x50CF; <code>git</code> &#x90A3;&#x6837;&#x7684;&#x6811;&#x578B;&#x7ED3;&#x6784;&#xFF0C;&#x4EE5;&#x53CA;&#x5206;&#x652F;<code>fork</code>, <code>merge</code>&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x5BF9;&#x4E8E;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x800C;&#x8A00;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x3002;<code>9p</code></p>
<p>Docker&#x7684;&#x914D;&#x7F6E;&#x5C31;&#x5B58;&#x50A8;&#x4E8E;&#x4E0B;&#x9762;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x4E2A; git repository&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">~/Library/Containers/com.docker.docker/Data/database</div></pre></td></tr></table></figure>
<p>&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x8FD9;&#x91CC;&#x4FEE;&#x6539;&#xFF0C;&#x6BD4;&#x5982;CPU&#x6838;&#xFF0C;Docker <code>storage driver</code>&#x7B49;&#x7B49;&#x3002;<code>commit</code> &#x540E;&#xFF0C;<code>Docker for Mac</code>&#x5C06;&#x4F1A;&#x91CD;&#x542F;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x5C06;&#x6765;&#x4F1A;&#x5728; GUI &#x4E2D;&#x7684; Advanced &#x91CC;&#x9762;&#x6DFB;&#x52A0;&#x8FDB;&#x53BB;&#x3002;</p>
<p>&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x5728;VM&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;<code>/Database/branch/master/ro/com.docker.driver.amd64-linux/</code></p>
<p>Justin &#x5728;&#x6267;&#x884C;&#x8FD9;&#x4E2A;VM&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x610F;&#x601D;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4ED6;&#x6267;&#x884C;&#x4E86;&#x4E00;&#x4E2A; Docker &#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh</div></pre></td></tr></table></figure>
<h1 id="plumbing"><a href="#Plumbing" class="headerlink" title="Plumbing"></a>Plumbing <a href="#plumbing" class="header-anchor">#</a></h1><p>&#x6700;&#x540E;&#x5728;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x4E2D;&#x95F4;&#x9009;&#x62E9;&#x4E86; <code>VSock</code> &#x548C; <code>HVSock</code>&#x3002;&#x7528;&#x4ED6;&#x4EEC;&#x6765;&#x8FDB;&#x884C; <code>VM</code> &#x95F4;&#x7684;&#x901A;&#x8BAF;&#xFF0C;&#x5C31;&#x50CF; <code>Unix sockets</code> &#x4E00;&#x6837;&#x3002;</p>
<p><code>VSock</code> &#x6700;&#x521D;&#x662F;&#x7531; <code>VMWare</code> &#x5F00;&#x53D1;&#xFF0C;&#x800C; <code>HVSock</code> &#x662F;&#x5FAE;&#x8F6F;&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x8BBE;&#x8BA1;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E0D;&#x540C;&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x65B0;&#x7684; socket &#x6CA1;&#x6709;&#x5F88;&#x597D;&#x5730;&#x652F;&#x6301;&#xFF0C;&#x6CA1;&#x6709; <code>Go</code> &#x7684;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x591F;&#x901A;&#x8FC7; <code>C</code> &#x7ED1;&#x5B9A;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x901A;&#x8BAF;&#x7531;&#x4E8E;&#x4E0D;&#x662F;&#x8D70;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#x7F51;&#x7EDC;&#x6709;&#x6545;&#x969C;&#xFF0C;&#x901A;&#x8BAF;&#x4E5F;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;&#x9664;&#x4E86;VM&#x95F4;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x5BBF;&#x4E3B;&#x548C;VM&#x7684;&#x901A;&#x8BAF;&#x3002;&#xFF08;&#x63D0;&#x5230;&#x4E86;VM&#x95F4;&#xFF0C;&#x662F;&#x5426;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x50CF; Toolbox &#x90A3;&#x6837;&#x6709;&#x591A;&#x5BBF;&#x4E3B;&#xFF1F;&#xFF09;</p>
<h1 id="moby"><a href="#Moby" class="headerlink" title="Moby"></a>Moby <a href="#moby" class="header-anchor">#</a></h1><p><code>Moby Dock</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;Docker&#x90A3;&#x53EA;&#x9CB8;&#x9C7C;&#x5409;&#x7965;&#x7269;&#x7684;&#x540D;&#x5B57;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x627F;&#x8F7D; Docker &#x4E3B;&#x673A;&#x7684; Linux &#x9879;&#x76EE;&#x7684;code name&#x3002;</p>
<p><a href="https://youtu.be/9xciauwbsuo" target="_blank" rel="external">https://youtu.be/9xciauwbsuo</a></p>
<h2 id="wu-zhuang-tai"><a href="#&#x65E0;&#x72B6;&#x6001;" class="headerlink" title="&#x65E0;&#x72B6;&#x6001;"></a>&#x65E0;&#x72B6;&#x6001; <a href="#wu-zhuang-tai" class="header-anchor">#</a></h2><p><code>Moby</code> &#x662F;&#x57FA;&#x4E8E; <code>Alpine Linux</code>&#xFF0C;<code>Alpine Linux</code> &#x5DF2;&#x7ECF;&#x6709;8&#x5E74;&#x5386;&#x53F2;&#x4E86;&#x3002;&#x662F;&#x5B89;&#x5168;&#x7684;&#x8F7B;&#x91CF;&#x7EA7;Linux&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x57FA;&#x4E8E; <code>musl libc</code>  &#x4EE5;&#x53CA; <code>busybox</code>&#x3002;</p>
<p>Alpine &#x7684;&#x8BBE;&#x8BA1;&#x610F;&#x56FE;&#x662F;<strong>&#x65E0;&#x72B6;&#x6001;</strong> &#x7684;&#xFF0C;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x5728; <code>ramdisk</code> &#x4E4B;&#x7C7B;&#x7684;&#x5730;&#x65B9;&#x8FD0;&#x884C;&#xFF0C;&#x6839;&#x672C;&#x4E0D;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#xFF0C;&#x91CD;&#x542F;&#x4E4B;&#x540E;&#x4E00;&#x5207;&#x6062;&#x590D;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x6070;&#x597D;&#x662F;&#x548C;Docker&#x5BB9;&#x5668;&#x7684;&#x77ED;&#x751F;&#x5B58;&#x5468;&#x671F;&#x7684;&#x7406;&#x5FF5;&#x4E00;&#x81F4;&#x3002;</p>
<p><code>/var</code> &#x76EE;&#x5F55;&#x662F;&#x53EF;&#x4EE5;&#x4FDD;&#x7559;&#x7684;&#xFF0C;Docker &#x8D1F;&#x8D23;&#x8FD9;&#x4E2A;&#x4E86;&#x3002;</p>
<p><code>/Database</code> &#x73B0;&#x5728;&#x6302;&#x8F7D;&#x4E0A;&#x4E86; <code>Datakit</code> &#x7684;&#x6570;&#x636E;&#x5E93;&#x3002;</p>
<p>&#x50CF; <code>Phoenix</code> &#x4E00;&#x6837;&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x65B0;&#x7684; <code>image</code>&#xFF0C;&#x6CA1;&#x6709;&#x5347;&#x7EA7;&#x66F4;&#x65B0;&#x3002;</p>
<p>&#x975E;&#x5E38;&#x7CBE;&#x7B80;&#xFF0C;&#x53EA;&#x8FD0;&#x884C; Docker &#x548C;&#x6240;&#x9700;&#x7684;&#x4E1C;&#x897F;&#x3002;</p>
<h2 id="mei-you-yong-hu-ke-yi-xiu-gai-de-bu-fen"><a href="#&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;" class="headerlink" title="&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206;"></a>&#x6CA1;&#x6709;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x7684;&#x90E8;&#x5206; <a href="#mei-you-yong-hu-ke-yi-xiu-gai-de-bu-fen" class="header-anchor">#</a></h2><ul>
<li>Just works&#xFF0C;&#x786E;&#x4FDD; Docker &#x8FD0;&#x884C;&#x3002;</li>
<li>&#x6240;&#x6709;&#x914D;&#x7F6E;&#x90FD;&#x5728; <code>Datakit</code> &#x7684;<code>database</code>&#x91CC;&#x3002;</li>
<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x5BBF;&#x4E3B;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7; <code>--privileged</code> &#x7684;&#x5BB9;&#x5668;&#x6765;&#x8FDB;&#x884C;&#xFF0C;&#x800C;&#x4E14;&#x901A;&#x8FC7; <code>--restart=always</code> &#x6765;&#x4FDD;&#x6301;&#x6301;&#x4E45;&#x5316;&#x3002;</li>
<li>&#x6BD4;&#x5982;&#x5B89;&#x88C5; <code>sysdig</code> &#x5185;&#x6838;&#x6A21;&#x5757;</li>
<li>root shell: <code>docker run -it &#x2014;privileged &#x2014;pid=host debian nsenter -t 1 -m -u -n -i sh</code></li>
<li>&#x53EF;&#x4EE5; <code>apk update</code> &#x6216;&#x8005; <code>apk install gdb</code>&#x4E4B;&#x7C7B;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x4F46;&#x662F;&#x91CD;&#x542F;&#x5C31;&#x90FD;&#x6CA1;&#x4E86;&#x3002;</li>
</ul>
<h2 id="nei-he"><a href="#&#x5185;&#x6838;" class="headerlink" title="&#x5185;&#x6838;"></a>&#x5185;&#x6838; <a href="#nei-he" class="header-anchor">#</a></h2><ul>
<li>&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>stable 4.4.x</code> &#x7CFB;&#x5217;&#x7684;&#x5185;&#x6838;&#xFF0C;&#x5916;&#x52A0; <code>aufs</code>, <code>vsock</code>, <code>hvsock</code> &#x8865;&#x4E01;&#x3002;</li>
<li>&#x6CA1;&#x6709;&#x6A21;&#x5757;&#xFF0C;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x5185;&#x7F6E;&#x4E86;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x5FEB;&#x901F;&#x542F;&#x52A8;&#xFF0C;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x6A21;&#x5757;</li>
<li>&#x73B0;&#x5728;&#x652F;&#x6301; <code>aufs</code> &#x548C; <code>overlay</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <code>aufs</code> &#x65B0;&#x7684; <code>1.12</code> &#x53D1;&#x5E03;&#x5E26;&#x6765;&#x4E86;&#x65B0;&#x7684; <code>overlay2</code> &#x7684;&#x652F;&#x6301;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x4E4B;&#x524D; <code>overlay</code> &#x7684;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x80FD;&#x4E0D;&#x5C31;&#x8FD9;&#x91CC;&#x5207;&#x6362;&#x5230;&#x9ED8;&#x8BA4; <code>overlay2</code>&#x3002;</li>
<li>&#x652F;&#x6301; <code>NFS</code>, <code>SMB</code>, <code>CRIU</code> &#x4E4B;&#x7C7B;&#x7684;</li>
<li>&#x652F;&#x6301; <code>binfmt_misc</code> &#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>QEMU</code> &#x8FD0;&#x884C; <code>ARM</code>&#x3001;<code>PowerPC</code>, <code>MIPS</code> &#x6216;&#x8005;&#x5176;&#x4ED6;&#x6784;&#x67B6;&#x7684;&#x53EF;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#xFF08;&#x8D85;&#x8D5E;&#xFF09;&#x3002;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker run -it justincormack/armdemo uname <span class="_">-a</span></div><div class="line">Linux a764b3418f3d 4.4.14-moby <span class="comment">#1 SMP Tue Jul 5 02:07:16 UTC 2016 armv7l Linux</span></div><div class="line">$ docker run -it justincormack/armdemo file /bin/busybox</div><div class="line">/bin/busybox: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-armhf.so.1, stripped</div></pre></td></tr></table></figure>
<ul>
<li>&#x914D;&#x7F6E;&#x5728; <code>/proc/config.gz</code> &#x91CC;&#xFF0C;&#x8865;&#x4E01;&#x5728; <code>/etc/kernel-patches</code> &#x91CC;&#x3002;</li>
</ul>
<h2 id="userspace"><a href="#Userspace" class="headerlink" title="Userspace"></a>Userspace <a href="#userspace" class="header-anchor">#</a></h2><ul>
<li><code>Alpine 3.4</code></li>
<li><code>&#x9759;&#x6001;&#x7F16;&#x8BD1;</code>&#x7684; Docker &#x5E76;&#x4E14;&#x5E26; <code>seccomp</code> &#x652F;&#x6301;&#xFF08;&#x6682;&#x4E0D;&#x652F;&#x6301; <code>AppArmor</code>&#xFF0C;&#x53EF;&#x80FD;&#x5C06;&#x665A;&#x4E9B;&#x65F6;&#x5019;&#x4F1A;&#x652F;&#x6301;&#xFF09;&#x3002;</li>
<li>&#x8FD8;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E9B;&#x5982;&#x65F6;&#x95F4;&#x540C;&#x6B65;&#x4E4B;&#x7C7B;&#x7684;&#x529F;&#x80FD;&#xFF0C;<code>Kubernetes</code> &#x9700;&#x8981;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x7684;&#x652F;&#x6301;</li>
</ul>
<h1 id="vpnkit"><a href="#VPNKit" class="headerlink" title="VPNKit"></a>VPNKit <a href="#vpnkit" class="header-anchor">#</a></h1><p>&#x73B0;&#x5728;&#x662F;&#x5728; Mac &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x76EE;&#x524D;&#x6B63;&#x5728; Windows &#x4E0A;&#x6D4B;&#x8BD5;&#xFF08;&#x53EF;&#x4EE5;&#x7528;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x7684;&#xFF09;&#x3002;</p>
<p>&#x5C06;&#x6240;&#x6709; Linux VM &#x4E2D;&#x7684;&#x4EE5;&#x592A;&#x7F51; traffic &#x90FD;&#x5728; OS X &#x4E0A;&#x91CD;&#x6784;&#x6210;<strong>&#x5E94;&#x7528;</strong>&#x7EA7;&#x7684;traffic&#xFF0C;&#x6240;&#x4EE5;&#x5728; OS X &#x4E0A;&#x770B;&#x5230;&#x7684;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7A0B;&#x5E8F;&#x5728;&#x6253;&#x5F00;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5EFA;&#x7ACB;&#x4E00;&#x4E9B;&#x5947;&#x602A;&#x7684;network interface&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x66F4;&#x597D;&#x7684;&#x5904;&#x7406; VPN, &#x9632;&#x706B;&#x5899;&#x7B49;&#x8FD9;&#x4E9B;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x73AF;&#x5883;&#xFF0C;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x73AF;&#x5883;&#x4E2D;&#x5BB9;&#x5668;&#x65E0;&#x6CD5;&#x4E0A;&#x7F51;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>VPNKit &#x4F7F;&#x7528;&#x4E86; <code>Mirage Unikernel</code> &#x4E2D;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x3002;<br><code>Mirage</code> &#x662F;&#x5E95;&#x5C42;&#x7684;&#x7CFB;&#x7EDF;&#x5E93;&#xFF0C;&#x4F7F;&#x7528; <code>OCaml</code> &#x5199;&#x7684; (<code>functional programming language</code>)<br>&#x5F88;&#x5BB9;&#x6613;&#x79FB;&#x690D;&#x5230;&#x522B;&#x7684;&#x5730;&#x65B9;&#x4F7F;&#x7528;&#x3002;</p>
<h1 id="osxfs"><a href="#OSXfs" class="headerlink" title="OSXfs"></a>OSXfs <a href="#osxfs" class="header-anchor">#</a></h1><ul>
<li>&#x73B0;&#x5728;&#x662F;&#x5728; Mac &#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x76EE;&#x524D;&#x5728; Windows&#x4E0A;&#x8FD8;&#x662F;&#x901A;&#x8FC7;SMB&#x7ED1;&#x5B9A;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF08;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x5728;Windows&#x4E0A;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x540D;&#x5B57;&#x6050;&#x6015;&#x5F97;&#x6362;&#xFF09;&#x3002;</li>
<li>&#x5728; Linux &#x90E8;&#x5206;&#x7528;&#x7684;&#x662F; <code>FUSE</code> &#x6765;&#x627F;&#x63A5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x548C;&#x5904;&#x7406;</li>
<li>&#x5C06;&#x6240;&#x6709;&#x901A;&#x8BAF;&#x8F6C;&#x79FB;&#x5230; <code>VSock</code> &#xFF0C;&#x5E76;&#x4E14;&#x8F6C;&#x6362;&#x6210; OSX &#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</li>
<li>&#x76D1;&#x542C; OSX &#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x901A;&#x77E5;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B83;&#x53D8;&#x6210; Linux &#x7684;&#x4E8B;&#x4EF6;&#x8F6C;&#x53D1;&#x8FC7;&#x53BB;&#x3002;</li>
</ul>
<p>&#x56E0;&#x6B64; <code>inotify</code> &#x7EC8;&#x4E8E;&#x53EF;&#x4EE5;&#x7528;&#x4E86;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;OSX&#x6CA1;&#x6709;&#x8BFB;&#x6587;&#x4EF6;&#x4E8B;&#x4EF6;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4ECE;&#x6784;&#x67B6;&#x4E0A;&#xFF0C;<code>OSXfs</code> &#x548C; <code>VPNKit</code> &#x975E;&#x5E38;&#x63A5;&#x8FD1;&#xFF0C;&#x4E8C;&#x8005;&#x90FD;&#x662F;&#x628A;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x4E4B;&#x95F4;&#x7684;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#x3002;</p>
<p>&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x4EE5;&#x5F53;&#x524D;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x7ED1;&#x5B9A;&#x5377;&#x4E4B;&#x7C7B;&#x7684;&#x4E8B;&#x60C5;&#x76F4;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x5DE5;&#x4F5C;&#x3002;&#x800C;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x5B89;&#x5168;&#x9690;&#x60A3;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x4E0D;&#x5E0C;&#x671B;&#x5B83;&#x4EE5;root&#x6267;&#x884C;&#x3002;&#x800C;&#x5728; Linux &#x548C;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x80AF;&#x5B9A;&#x4E0D;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x67D0;&#x4E2A;&#x5EFA;&#x7ACB;&#x7684;&#x6587;&#x4EF6;&#x4F7F;&#x7528;&#x7684;&#x662F; Mac &#x4E0A;&#x7684; UID&#x3002;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x6709;&#x8F6C;&#x6362;&#xFF0C;&#x4F1A;&#x663E;&#x793A;&#x8BE5;&#x5BB9;&#x5668;&#x6267;&#x884C;&#x7528;&#x6237;&#x7684;ID&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x5047;&#x7684;&#x3002;</p>
<h1 id="windows-file-sharing"><a href="#Windows-file-sharing" class="headerlink" title="Windows file sharing"></a>Windows file sharing <a href="#windows-file-sharing" class="header-anchor">#</a></h1><p>&#x5F53;&#x524D; Linux &#x5230; Windows &#x4E4B;&#x95F4;&#x7684;&#x6587;&#x4EF6;&#x5171;&#x4EAB;&#x4F7F;&#x7528;&#x7684;&#x662F; SMB<br>&#x867D;&#x7136;&#x534F;&#x8BAE;&#x4E0A;&#x8BB2; SMB &#x652F;&#x6301; <code>FS Notifications</code>&#xFF0C;&#x4F46;&#x662F; Linux &#x5B9E;&#x73B0;&#x4E0A;&#x6CA1;&#x4EBA;&#x613F;&#x610F;&#x53BB;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x652F;&#x6301;&#x3002;<br>&#x6211;&#x4EEC;&#x5C06;&#x6765;&#x4F1A;&#x8BBE;&#x6CD5;&#x79FB;&#x690D; <code>OSXfs</code> &#x5230; Windows &#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x50CF; Mac &#x4E00;&#x6837;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x9700;&#x8981;&#x65F6;&#x95F4;&#xFF0C;Windows &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x548C; Linux &#x7684;&#x5DEE;&#x5F02;&#x5C31;&#x66F4;&#x5927;&#x4E86;&#x3002;</p>
<h1 id="yong-hu-jie-mian"><a href="#&#x7528;&#x6237;&#x754C;&#x9762;" class="headerlink" title="&#x7528;&#x6237;&#x754C;&#x9762;"></a>&#x7528;&#x6237;&#x754C;&#x9762; <a href="#yong-hu-jie-mian" class="header-anchor">#</a></h1><ul>
<li>&#x73B0;&#x5728;&#x5F88;&#x7CBE;&#x7B80;&#xFF0C;&#x5C06;&#x6765;&#x4F1A;&#x6709;&#x66F4;&#x591A;&#x7684;&#x529F;&#x80FD;&#x52A0;&#x8FDB;&#x6765;&#x3002;</li>
<li>&#x662F;<code>Native</code>&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;OSX&#x4E0A;&#x7528;&#x7684;&#x662F;<code>Swift</code>&#xFF1B;&#x5728;Windows&#x4E0A;&#x7528;&#x7684;&#x662F;<code>C#</code>&#x3002;</li>
<li>&#x901A;&#x8FC7; <code>Datakit</code> &#x7684;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</li>
<li>&#x8BA1;&#x5212;&#x4F1A;&#x628A; <code>Kinematic</code> &#x6216;&#x8005;&#x5176;&#x5B83;&#x7684;&#x754C;&#x9762;&#x96C6;&#x6210;&#x8FDB;&#x6765;&#x3002;</li>
</ul>
<h1 id="design"><a href="#Design" class="headerlink" title="Design"></a>Design <a href="#design" class="header-anchor">#</a></h1><p>&#x4E00;&#x7FA4;&#x53E4;&#x602A;&#x7684;&#x9CB8;&#x9C7C;&#xFF0C;&#x6709; Lauro? &#x8BBE;&#x8BA1;</p>
<h1 id="wei-shi-me-xxx-bu-neng-yong-a"><a href="#&#x4E3A;&#x4EC0;&#x4E48;-XXX-&#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48; XXX &#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48; XXX &#x4E0D;&#x80FD;&#x7528;&#x554A;&#xFF1F; <a href="#wei-shi-me-xxx-bu-neng-yong-a" class="header-anchor">#</a></h1><h2 id="net-host-de-wang-luo-bu-neng-yong"><a href="#net-host&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528;" class="headerlink" title="--net=host&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528;"></a><code>--net=host</code>&#x7684;&#x7F51;&#x7EDC;&#x4E0D;&#x80FD;&#x7528; <a href="#net-host-de-wang-luo-bu-neng-yong" class="header-anchor">#</a></h2><p>&#x539F;&#x56E0;&#x662F;&#x76EE;&#x524D;&#x4F7F;&#x7528;&#x4E86; <code>VPNKit</code> &#x540E;&#xFF0C;&#x5F53;&#x5BB9;&#x5668;&#x901A;&#x8FC7; <code>--publish</code> &#x516C;&#x5F00;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x901A;&#x8BAF;&#x662F;&#x901A;&#x8FC7; <code>/port</code> <code>9p</code> &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4F20;&#x9012;&#x7ED9; Mac &#x7684;&#xFF0C;&#x7136;&#x540E; Mac &#x90E8;&#x5206;&#x4F1A;&#x5F00;&#x59CB;&#x5728;&#x4E3B;&#x673A;&#x4E0A;&#x76D1;&#x542C;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x5728; Mac &#x4E0A;&#x5F53;&#x4F60;&#x8FDE;&#x63A5; <code>localhost:nnn</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5C06;&#x8FD9;&#x4E2A;&#x7F51;&#x7EDC;&#x901A;&#x8BAF;&#x8F6C;&#x53D1;&#x7ED9; Linux&#xFF0C;&#x5E76;&#x8FDB;&#x800C;&#x8F6C;&#x53D1;&#x7ED9;&#x5BB9;&#x5668;&#x3002;&#x540C;&#x6837;&#xFF0C;&#x5728;Docker Swarm&#x4E0B;&#x4E5F;&#x662F;&#x8FD9;&#x4E48;&#x7528;&#x7684;&#x3002;&#xFF08;<em>&#x5C06;&#x6765;&#x5FC5;&#x7136;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x5BBF;&#x4E3B;</em>&#xFF09;</p>
<p>&#x4F46;&#x662F;&#x5F53;&#x4F7F;&#x7528; <code>--net=host</code> &#x540E;&#xFF0C;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x5C06;&#x4E0D;&#x4F1A;&#x901A;&#x77E5; Docker&#xFF0C;&#x6240;&#x4EE5; Docker &#x6CA1;&#x6709;&#x8F7B;&#x6613;&#x7684;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5C06;&#x6765;&#x4F1A;&#x60F3;&#x529E;&#x6CD5;&#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<h2 id="wo-wu-fa-lian-jie-dao-rong-qi-duan-kou"><a href="#&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;" class="headerlink" title="&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3;"></a>&#x6211;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x7AEF;&#x53E3; <a href="#wo-wu-fa-lian-jie-dao-rong-qi-duan-kou" class="header-anchor">#</a></h2><p>&#x4E0D;&#x50CF;&#x4EE5;&#x524D; <code>Docker Toolbox</code> &#x6216;&#x8005; Linux &#x4E0A;&#x90A3;&#x6837;&#xFF0C;Mac &#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x8DEF;&#x7531;&#x901A;&#x8DEF;&#xFF08;<code>bridge</code>)&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;IP&#x8FDE;&#x63A5;&#x5230;&#x5BB9;&#x5668;&#x3002;</p>
<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x8C03;&#x8BD5;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53E6;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982; <code>docker run --net=container:name</code></p>
<p>&#x5176;&#x5B9E;&#x5E94;&#x8BE5;&#x4E60;&#x60EF;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x6BD5;&#x7ADF;&#x5728;&#x591A;&#x5BBF;&#x4E3B;&#x7F51;&#x7EDC;&#xFF08;<code>overlay network</code>&#xFF09;&#x8C03;&#x8BD5;&#x4E2D;&#xFF0C;&#x53EA;&#x80FD;&#x8FD9;&#x6837;&#x8C03;&#x8BD5;&#xFF0C;&#x5BBF;&#x4E3B;&#x662F;&#x65E0;&#x6CD5;&#x548C;&#x53E6;&#x4E00;&#x53F0;&#x5BBF;&#x4E3B;&#x7684;&#x5BB9;&#x5668;&#x76F4;&#x63A5;&#x901A;&#x8BAF;&#x7684;&#x3002;</p>
<p>&#x66FE;&#x7ECF;&#x6709;&#x4E00;&#x5EA6;&#x80FD;&#x7528;&#x6765;&#x7740;&#xFF0C;&#x540E;&#x6765;&#x4E0D;&#x80FD;&#x4E86;&#xFF0C;&#x6BD5;&#x7ADF;&#x5BBF;&#x4E3B;&#x4E0D;&#x518D;&#x6709;<code>bridge</code>&#x63A5;&#x53E3;&#x4E86;&#x3002;&#x5C06;&#x6765;&#x662F;&#x4E0D;&#x662F;&#x8FD8;&#x4F1A;&#x652F;&#x6301;&#x2026;&#x2026;&#x5F88;&#x96BE;&#x8BF4;&#x3002;</p>
<h2 id="zhu-ji-he-rong-qi-jian-de-unix-socket-bu-neng-yong"><a href="#&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684;-Unix-socket-&#x4E0D;&#x80FD;&#x7528;" class="headerlink" title="&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684; Unix socket &#x4E0D;&#x80FD;&#x7528;"></a>&#x4E3B;&#x673A;&#x548C;&#x5BB9;&#x5668;&#x95F4;&#x7684; Unix socket &#x4E0D;&#x80FD;&#x7528; <a href="#zhu-ji-he-rong-qi-jian-de-unix-socket-bu-neng-yong" class="header-anchor">#</a></h2><p>&#x5176;&#x5B9E;&#x8FD9;&#x4E0D;&#x602A;&#x6211;&#x4EEC;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x5C3D;&#x91CF;&#x8BA9;&#x5927;&#x5BB6;&#x611F;&#x89C9;&#x5BB9;&#x5668;&#x662F;&#x76F4;&#x63A5;&#x5728; Mac &#x4E0A;&#x8FD0;&#x884C;&#xFF0C;&#x4F46;&#x662F; Mac &#x548C; &#x5BB9;&#x5668;&#x4E0D;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#xFF0C;&#x4E2D;&#x95F4;&#x8FD8;&#x6709;&#x4E2A; Linux &#x5462;&#x2026;&#x2026;</p>
<p>&#x4E0D;&#x8FC7;&#x5C06;&#x6765;&#x786E;&#x5B9E;&#x6253;&#x7B97;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x901A;&#x8FC7; <code>OSXfs</code> &#x548C; <code>VSock</code> &#x900F;&#x660E;&#x4EE3;&#x7406;&#x3002;&#x5F53;&#x524D;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x90E8;&#x5206;&#x5728;&#x8FD9;&#x4E48;&#x7528;&#x4E86;&#xFF0C;&#x5728; Docker socket &#x4E0A;&#x3002;</p>
<p>&#x76EE;&#x524D;&#xFF0C;&#x7528; TCP &#x5C31;&#x597D;&#x4E86;&#x3002;</p>
<h2 id="sheng-yin-he-shi-pin"><a href="#&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891;" class="headerlink" title="&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891;"></a>&#x58F0;&#x97F3;&#x548C;&#x89C6;&#x9891; <a href="#sheng-yin-he-shi-pin" class="header-anchor">#</a></h2><p><code>X Win</code>, <code>RDP</code>, <code>VNC</code>, <code>HTTP GUI</code> &#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x8BBE;&#x6CD5;&#x8BA9;&#x5B83;&#x4EEC;&#x80FD;&#x5DE5;&#x4F5C;&#xFF0C;<code>Audio</code> &#x4F30;&#x8BA1;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x3002;<br>&#x76EE;&#x524D;&#x4E0D;&#x662F;&#x5F88;&#x591A;&#x4EBA;&#x9700;&#x8981;&#x8FD9;&#x4E9B;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x613F;&#x610F;&#x53EF;&#x4EE5;&#x5E2E;&#x5FD9;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;</p>
<h1 id="roadmap"><a href="#Roadmap" class="headerlink" title="Roadmap"></a>Roadmap <a href="#roadmap" class="header-anchor">#</a></h1><h2 id="stability-first-features-second"><a href="#Stability-first-features-second" class="headerlink" title="Stability first, features second"></a>Stability first, features second <a href="#stability-first-features-second" class="header-anchor">#</a></h2><p>&#x76EE;&#x524D;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x800C;&#x4E0D;&#x662F;<code>feature</code>&#xFF0C;&#x4F46;&#x662F;&#x662F;&#x7528;&#x6237;&#x9A71;&#x52A8; feature &#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5C3D;&#x60C5;&#x6765;&#x66FF;&#x81EA;&#x5DF1;&#x7684;&#x60F3;&#x6CD5;&#x3002;</p>
<h1 id="team"><a href="#Team" class="headerlink" title="Team"></a>Team <a href="#team" class="header-anchor">#</a></h1><p>&#x56E2;&#x961F;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x5728; DockerCon &#x73B0;&#x573A;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x6709;&#x5F88;&#x591A; Docker &#x7684;&#x5458;&#x5DE5;&#x8D21;&#x732E;&#x4E86;&#x4EE3;&#x7801;&#x3002;&#x5E76;&#x4E14;&#x5305;&#x542B;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF08;&#x7279;&#x522B;&#x662F; <code>bhyve</code>, <code>xhyve</code>, <code>Mirage</code>, <code>Alpine Linux</code>&#xFF09;</p>
<p>&#x5E7B;&#x706F;&#x7247;&#x5728;&#xFF1A;<code>docker run -d -P justincormack/dockercon2016</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 1.12 新功能 - Mike Goelzer</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-05-video-what-is-new-in-docker-1-12.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-05-video-what-is-new-in-docker-1-12.html</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#swarm-mode">Swarm Mode</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#node-failure">Node Failure</a></li>
<li><a href="#scaling">Scaling</a></li>
<li><a href="#global-services">Global Services</a></li>
<li><a href="#constraints">Constraints</a></li>
<li><a href="#services-tasks-containers"><code>Services</code> &#x2192; <code>Tasks</code> &#x2192; <code>Containers</code></a></li>
<li><a href="#stack-shi-service-de-ji-he"><code>Stack</code> &#x662F; <code>Service</code> &#x7684;&#x96C6;&#x5408;</a></li>
<li><a href="#distributed-application-bundle-dab-sheng-ming-liao-yi-ge-stack">Distributed Application Bundle (.dab) &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A; Stack</a></li>
<li><a href="#swarm-mode-is-optional">Swarm mode is optional</a></li>
<li><a href="#routing-mesh">Routing Mesh</a></li>
<li><a href="#security-by-default">Security by default</a></li>
<li><a href="#container-health-check-in-dockerfile">Container Health Check in <code>Dockerfile</code></a></li>
<li><a href="#new-plugin-subcommands">New Plugin Subcommands</a></li>
<li><a href="#orchestration-deep-dive-andrea-luzzardi">Orchestration Deep Dive - Andrea Luzzardi</a><ul>
<li><a href="#swarm-topology">Swarm Topology</a></li>
<li><a href="#docker-swarm-communication-internals">Docker Swarm Communication Internals</a></li>
<li><a href="#quorum-layer">Quorum Layer</a></li>
</ul>
</li>
<li><a href="#node-breakdown">Node Breakdown</a><ul>
<li><a href="#nei-zhi-fu-zai-jun-heng">&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li>
<li><a href="#ingress-fu-zai-jun-heng">Ingress &#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - What&#x2019;s New in Docker 1.12<br>by Mike Goelzer, Andrea Luzzardi from Docker</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/FgXJKw37po8" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=FgXJKw37po8" target="_blank" rel="external">https://www.youtube.com/watch?v=FgXJKw37po8</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0314l51xc7&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/b0314l51xc7.html" target="_blank" rel="external">http://v.qq.com/x/page/b0314l51xc7.html</a></p>
<h1 id="swarm-mode"><a href="#Swarm-Mode" class="headerlink" title="Swarm Mode"></a>Swarm Mode <a href="#swarm-mode" class="header-anchor">#</a></h1><p>&#x5728;Keynote &#x6F14;&#x8BB2;&#x65F6;&#xFF0C;&#x662F;3&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x6765;&#x505A;&#x7684;&#x6F14;&#x793A;&#x3002;</p>
<p>&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker swarm init</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x7B2C;&#x4E00;&#x53F0;<code>swarm</code>&#x4E3B;&#x673A;&#x5C31;&#x81EA;&#x52A8;&#x53D8;&#x4E3A; <code>manager</code>&#x3002;</p>
<p>&#x5728;&#x7B2C;&#x4E8C;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker swarm join &lt;ip of manager&gt;:2377</div></pre></td></tr></table></figure>
<p>&#x7B2C;&#x4E8C;&#x53F0;&#x4E3B;&#x673A;&#x5C31;&#x4F5C;&#x4E3A;&#x666E;&#x901A;&#x8282;&#x70B9;&#x52A0;&#x5165;&#x8FDB;&#x4E86;&#x8FD9;&#x4E2A; swarm&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#xFF0C;&#x52A0;&#x5165;&#x8FD9;&#x4E2A;swarm&#x3002;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x4E24;&#x6761;&#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x3002;</p>
<h1 id="services"><a href="#Services" class="headerlink" title="Services"></a>Services <a href="#services" class="header-anchor">#</a></h1><p>&#x521B;&#x5EFA;&#x670D;&#x52A1;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --replicas 3 \</div><div class="line">    --name frontend \</div><div class="line">    --network mynet \</div><div class="line">    --publish 80:80/tcp \</div><div class="line">    frontend_image:latest</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F; 1.12 &#x5F00;&#x59CB;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5728; swarm &#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x58F0;&#x660E;&#x670D;&#x52A1;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E; swarm &#x5F15;&#x64CE;&#x4F1A;&#x8D1F;&#x8D23;&#x7EF4;&#x62A4;&#x8C03;&#x5EA6;&#x6765;&#x4FDD;&#x6301;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x7B2C;&#x4E8C;&#x4E2A;&#x670D;&#x52A1;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x901A;&#x8BAF;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x8BE5;&#x670D;&#x52A1;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x4E2D;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --name redis \</div><div class="line">    --network mynet \</div><div class="line">    redis:latest</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&lt;&#x670D;&#x52A1;&#x540D;&gt;&#x6765;&#x4E92;&#x76F8;&#x901A;&#x8BAF;&#xFF0C;&#x901A;&#x8FC7;&#x7684;&#x662F;&#x5185;&#x7F6E;&#x7684;DNS&#x8FDB;&#x884C;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x3002;</p>
<h1 id="node-failure"><a href="#Node-Failure" class="headerlink" title="Node Failure"></a>Node Failure <a href="#node-failure" class="header-anchor">#</a></h1><p>Docker Swarm Mode &#x6CA1;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;</p>
<p>&#x5F53;swarm&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#x540E;&#xFF0C;&#x5176;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x6709;&#x5BB9;&#x5668;&#x5C31;&#x90FD;&#x6302;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x670D;&#x52A1;&#x7684;&#x5B9E;&#x9645;&#x72B6;&#x6001;&#x5C31;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x5F53;&#x521D;&#x8BBE;&#x5B9A;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6240;&#x6307;&#x5B9A;&#x7684;&#x72B6;&#x6001;&#xFF08;&#x6BD4;&#x5982;<code>--replicas=3</code>&#xFF09;&#x4E0D;&#x518D;&#x6EE1;&#x8DB3;&#xFF0C;&#x8FD9;&#x65F6; swarm engine &#x5C31;&#x4F1A;&#x4ECB;&#x5165;&#x8FDB;&#x6765;&#xFF0C;&#x8BD5;&#x56FE;&#x5728;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x4E0A;&#x542F;&#x52A8;&#x5BF9;&#x5E94;&#x5BB9;&#x5668;&#x6765;&#x6062;&#x590D;&#x670D;&#x52A1;&#x3002;</p>
<h1 id="scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling <a href="#scaling" class="header-anchor">#</a></h1><p>&#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x548C; <code>docker-compose scale</code> &#x7684;&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker service scale frontend=6</div></pre></td></tr></table></figure>
<h1 id="global-services"><a href="#Global-Services" class="headerlink" title="Global Services"></a>Global Services <a href="#global-services" class="header-anchor">#</a></h1><p>&#x8FD9;&#x662F; DockerCon16 &#x7684; keynote &#x4E2D;&#x6CA1;&#x6709;&#x6DB5;&#x76D6;&#x7684;&#x90E8;&#x5206;&#x3002;</p>
<p><code>Global Service</code> &#x662F;&#x8BF4;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x5E0C;&#x671B;&#x5728; <code>Swarm</code> &#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7EDF;&#x8BA1;&#x4E4B;&#x7C7B;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BB9;&#x5668;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5728;&#x6BCF;&#x4E00;&#x4E2A; Swarm &#x4E3B;&#x673A;&#x4E0A;&#x90FD;&#x8FD0;&#x884C;&#x3002;&#x521B;&#x5EFA; Global Service &#x7684;&#x65B9;&#x5F0F;&#x548C;&#x524D;&#x9762;&#x7684;&#x505A;&#x6CD5;&#x57FA;&#x672C;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x589E;&#x52A0; <code>--mode=global</code> &#x53C2;&#x6570;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --mode=global \</div><div class="line">    --name prometheus \</div><div class="line">    prom/prometheus</div></pre></td></tr></table></figure>
<h1 id="constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints <a href="#constraints" class="header-anchor">#</a></h1><p>&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x67D0;&#x4E9B;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x5728;&#x7279;&#x5B9A;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;&#x7684;&#x670D;&#x52A1;&#x5668;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8DD1;&#x5728;SSD&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x800C;&#x524D;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x8DD1;&#x5728;&#x6709;&#x516C;&#x7F51;IP&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x67D0;&#x4E9B;&#x670D;&#x52A1;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8DD1;&#x5728;&#x5185;&#x5B58;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x8FD9;&#x4E9B;&#x9700;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;docker daemon&#x7684;<code>label</code>&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker daemon &#x2014;label=com.mycompany.storage=&#x201C;ssd&#x201D;</div></pre></td></tr></table></figure>
<p>&#x5728;&#x5EFA;&#x7ACB;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--constraint</code> &#x53C2;&#x6570;&#x6765;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x8FD0;&#x884C;&#x7684;&#x8282;&#x70B9;&#x7684;<code>label</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">docker service create \</div><div class="line">    --replicas 3 \</div><div class="line">    --name frontend \</div><div class="line">    --network mynet \</div><div class="line">    --publish 80:80/tcp \</div><div class="line">    --constraint com.mycompany.storage=&#x201C;ssd&#x201D; \</div><div class="line">    frontend_image:latest</div></pre></td></tr></table></figure>
<h1 id="services-tasks-containers"><a href="#Services-&#x2192;-Tasks-&#x2192;-Containers" class="headerlink" title="Services &#x2192; Tasks &#x2192; Containers"></a><code>Services</code> &#x2192; <code>Tasks</code> &#x2192; <code>Containers</code> <a href="#services-tasks-containers" class="header-anchor">#</a></h1><p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>redis</code> &#x670D;&#x52A1;&#xFF1B;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x9700;&#x8981;3&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x8FD9;&#x5C31;&#x6709;3&#x4E2A;<code>Tasks</code>&#xFF1B;&#x800C;&#x6BCF;&#x4E2A;<code>Task</code>&#x5219;&#x53BB;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x4E09;&#x7EA7;&#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<p>&#x6700;&#x521D;&#x7684;&#x7406;&#x89E3;&#x53EF;&#x80FD;&#x4F1A;&#x8BA4;&#x4E3A;&#x670D;&#x52A1;&#x662F;&#x4E00;&#x7FA4;&#x5BB9;&#x5668;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x4E0D;&#x592A;&#x7406;&#x89E3;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6709;&#x4E2D;&#x95F4;&#x7684;Task&#x8FD9;&#x4E00;&#x5C42;&#x3002;&#x8FD9;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x6765;&#x7684;&#x6269;&#x5C55;&#x800C;&#x8003;&#x8651;&#x7684;&#xFF0C;&#x76EE;&#x524D;Task&#x53EA;&#x5305;&#x542B;&#x6709;&#x5BB9;&#x5668;&#x3002;&#x4F46;&#x662F;&#x5C06;&#x6765; <code>Task</code> &#x6216;&#x8BB8;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;<code>&#x5BB9;&#x5668;</code>&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x80FD;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;<code>Unikernel</code>&#xFF0C;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;<code>VM</code>&#x7B49;&#x7B49;&#x3002;</p>
<h1 id="stack-shi-service-de-ji-he"><a href="#Stack-&#x662F;-Service-&#x7684;&#x96C6;&#x5408;" class="headerlink" title="Stack &#x662F; Service &#x7684;&#x96C6;&#x5408;"></a><code>Stack</code> &#x662F; <code>Service</code> &#x7684;&#x96C6;&#x5408; <a href="#stack-shi-service-de-ji-he" class="header-anchor">#</a></h1><p>&#x4E00;&#x4E2A; <code>Stack</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A; <code>App</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x7531;&#x4E00;&#x7FA4;<code>&#x670D;&#x52A1;</code>&#x7EC4;&#x6210;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x6709;&#x4E2A; Web app&#xFF0C;&#x5FC5;&#x7136;&#x5305;&#x62EC;&#x524D;&#x7AEF; Web &#x670D;&#x52A1;&#x3001;&#x4E2D;&#x95F4;&#x4EF6;&#x670D;&#x52A1;&#x3001;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#xFF0C;&#x53EF;&#x80FD;&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x7684;&#x5982; <code>Redis</code> &#x4E4B;&#x7C7B;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x662F; <code>Stack</code>&#x3002;</p>
<h1 id="distributed-application-bundle-dab-sheng-ming-liao-yi-ge-stack"><a href="#Distributed-Application-Bundle-dab-&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;-Stack" class="headerlink" title="Distributed Application Bundle (.dab) &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A; Stack"></a>Distributed Application Bundle (.dab) &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A; Stack <a href="#distributed-application-bundle-dab-sheng-ming-liao-yi-ge-stack" class="header-anchor">#</a></h1><p>&#x73B0;&#x5728;&#x5904;&#x4E8E;&#x6BD4;&#x8F83;&#x524D;&#x6CBF;&#x7684;&#x8BD5;&#x9A8C;&#x9636;&#x6BB5;&#xFF0C;&#x9700;&#x8981;&#x793E;&#x533A;&#x7684;&#x5173;&#x6CE8;&#x548C;&#x53CD;&#x9988;&#x3002;&#x76EE;&#x524D;&#x5DF2;&#x7ECF;&#x96C6;&#x6210;&#x8FDB; <code>Docker 1.12</code> &#x4EE5;&#x53CA; <code>docker-compose</code>&#x4E2D;&#x3002;</p>
<h1 id="swarm-mode-is-optional"><a href="#Swarm-mode-is-optional" class="headerlink" title="Swarm mode is optional"></a>Swarm mode is optional <a href="#swarm-mode-is-optional" class="header-anchor">#</a></h1><p>&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x7528;&#x6216;&#x8005;&#x4E0D;&#x7528;&#xFF0C;<code>Docker 1.12</code> &#x5411;&#x540E;&#x517C;&#x5BB9;&#xFF0C;&#x8FC7;&#x53BB;&#x7684;&#x7528;&#x6CD5;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x53E6;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#x3002;</p>
<h1 id="routing-mesh"><a href="#Routing-Mesh" class="headerlink" title="Routing Mesh"></a>Routing Mesh <a href="#routing-mesh" class="header-anchor">#</a></h1><p>&#x8FD8;&#x662F;&#x4E4B;&#x524D;&#x7684;3&#x4E2A;&#x526F;&#x672C;&#x7684;&#x524D;&#x7AEF;&#x670D;&#x52A1;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x670D;&#x52A1;&#x8BBE;&#x5B9A;&#x7684;&#x662F;&#x76D1;&#x542C; <code>80</code> &#x7AEF;&#x53E3;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x58F0;&#x660E;&#x4F1A;&#x8BA9; <code>swarm</code> &#x4E2D;&#x6240;&#x6709;&#x7684;&#x8282;&#x70B9;&#xFF08;&#x5305;&#x62EC; <code>manager</code>&#xFF09;&#x90FD;&#x76D1;&#x542C;<code>80</code>&#x7AEF;&#x53E3;&#xFF08;<code>swarm-wide ingress port</code>&#xFF09;&#x3002;&#x800C;3&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x5047;&#x8BBE;<code>worker 1</code>&#x4E0A;&#x8DD1;&#x4E86;&#x4E00;&#x4E2A;&#xFF0C;<code>worker 2</code>&#x4E0A;&#x8DD1;&#x4E86;2&#x4E2A;&#xFF08;&#x90FD;&#x5B88;&#x62A4;80&#x7AEF;&#x53E3;&#x4E0D;&#x51B2;&#x7A81;&#x4E48;&#xFF1F;&#x4EE5;&#x524D;&#x7AEF;&#x53E3;&#x5C5E;&#x4E8E;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x6837;&#x58F0;&#x660E;&#x7684;&#x670D;&#x52A1;&#x5FC5;&#x7136;&#x4E0D;&#x4F1A;&#x5728;&#x4E00;&#x4E2A;<code>worker</code>&#x4E0A;&#xFF09;</p>
<p>&#x5047;&#x8BBE;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x4E86;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x670D;&#x52A1;&#x7136;&#x540E;&#x8F6C;&#x5230;&#x4E86; <code>worker 2</code> &#x7684;80&#x7AEF;&#x53E3;&#x4E0A;&#xFF0C;&#x6070;&#x597D; <code>worker 2</code> &#x4E0A;&#x6709;&#x4E24;&#x4E2A; <code>frontend</code> &#x5BB9;&#x5668;&#x3002; &#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x8BBF;&#x95EE;&#x80AF;&#x5B9A;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;&#x4F1A;&#x7531;<code>worker 2</code> &#x4E0A;&#x7684;&#x4E24;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x8D1F;&#x8D23;&#x5904;&#x7406;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x5982;&#x679C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5C06;&#x7528;&#x6237;&#x7684;&#x8BF7;&#x6C42;&#x8F6C;&#x79FB;&#x5230;&#x4E86; <code>worker 3</code> &#x5462;&#xFF1F;<code>worker 3</code> &#x4E0A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55; <code>frontend</code> &#x5BB9;&#x5668;&#x5728;&#x8FD0;&#x884C;&#x3002;&#x8FC7;&#x53BB;&#x8FD9;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x800C;&#x73B0;&#x5728;&#x6709;&#x4E86; <code>routing mesh</code> &#x540E;&#xFF0C; <code>worker 3</code> &#x4F1A;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;&#x62E5;&#x6709; <code>frontend</code> &#x7684;&#x5BB9;&#x5668;&#x7684; <code>worker 2</code> &#x8EAB;&#x4E0A;&#xFF0C;&#x4E8E;&#x662F;&#x8BF7;&#x6C42;&#x5F97;&#x5230;&#x4E86;&#x5904;&#x7406;&#x3002;</p>
<p>&#x662F;&#x7684;&#xFF0C;&#x8FD9;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x8DF3;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5185;&#x6838;&#x6280;&#x672F;(<code>IPVS</code>, <code>kernel space package routing</code>)&#xFF0C;&#x6548;&#x7387;&#x662F;&#x975E;&#x5E38;&#x9AD8;&#x7684;&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x7684;&#x505A;&#x6CD5;&#x4F1A;&#x6709;&#x4E00;&#x79CD;&#x6982;&#x5FF5;&#xFF0C;&#x8BA9;&#x6574;&#x4E2A;&#x7684; Swarm &#x96C6;&#x7FA4;&#x8868;&#x73B0;&#x7684;&#x50CF;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4E00;&#x6837;&#x662F;&#x4E2A;&#x6574;&#x4F53;&#x3002;</p>
<h1 id="security-by-default"><a href="#Security-by-default" class="headerlink" title="Security by default"></a>Security by default <a href="#security-by-default" class="header-anchor">#</a></h1><p>Cryptographic Node Identity</p>
<p>&#x6CA1;&#x6709; insecure mode&#xFF0C;&#x5728; 1.12 &#x7684; Swarm mode &#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6CA1;&#x6709;&#x5173;&#x95ED;&#x5B89;&#x5168;&#x7684;&#x9009;&#x9879;&#xFF0C;&#x8FD9;&#x662F;&#x6709;&#x610F;&#x5982;&#x6B64;&#x3002;Docker&#x7684;&#x7406;&#x5FF5;&#x662F;&#x5B89;&#x5168;&#x4E0D;&#x5E94;&#x8BE5;&#x662F;&#x7D2F;&#x8D58;&#xFF0C;&#x5E94;&#x8BE5;&#x7B80;&#x5355;&#x6613;&#x7528;&#xFF0C;&#x6CA1;&#x6709;&#x5173;&#x95ED;&#x7684;&#x5FC5;&#x8981;&#x6027;&#x3002;</p>
<ul>
<li>TLS &#x662F;&#x4E92;&#x76F8;&#x8BA4;&#x8BC1;</li>
<li>TLS &#x52A0;&#x5BC6;</li>
<li>Certificate rotation</li>
</ul>
<h1 id="container-health-check-in-dockerfile"><a href="#Container-Health-Check-in-Dockerfile" class="headerlink" title="Container Health Check in Dockerfile"></a>Container Health Check in <code>Dockerfile</code> <a href="#container-health-check-in-dockerfile" class="header-anchor">#</a></h1><p>&#x53EF;&#x4EE5;&#x5728; <code>Dockerfile</code> &#x4E2D;&#x6307;&#x5B9A;&#x5982;&#x4F55;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;&#x751F;&#x6210;&#x7684;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x63D0;&#x4F9B; Web &#x670D;&#x52A1;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x5176; <code>HEALTHCHECK</code> &#x547D;&#x4EE4;&#x53EF;&#x80FD;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HEALTHCHECK &#x2014;interval=5m &#x2014;timeout=3s &#x2014;retries 3 CMD curl <span class="_">-f</span> http://xxx || <span class="built_in">exit</span> 1</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x662F;&#x8BF4;&#x6BCF;&#x8FC7;5&#x5206;&#x949F;&#x770B;&#x4E00;&#x4E0B;&#x662F;&#x4E0D;&#x662F;&#x80FD;&#x591F;&#x901A;&#x8FC7;80&#x7AEF;&#x53E3;&#x53D6;&#x5F97; index &#x9875;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x8FDE;&#x7EED;3&#x6B21;&#x90FD;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x8BE5;&#x670D;&#x52A1;&#x51FA;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5C06;&#x5065;&#x5EB7;&#x72B6;&#x6001;&#x8BBE;&#x4E3A;<code>broken</code>&#xFF0C;&#x7136;&#x540E;&#x7531; <code>swarm</code> &#x4E4B;&#x7C7B;&#x7684;&#x4E0A;&#x5C42;&#x7F16;&#x6392;&#x5DE5;&#x5177;&#x8D1F;&#x8D23;&#x5220;&#x9664;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x3001;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x7B49;&#x8C03;&#x5EA6;&#x5DE5;&#x4F5C;&#x3002;</p>
<h1 id="new-plugin-subcommands"><a href="#New-Plugin-Subcommands" class="headerlink" title="New Plugin Subcommands"></a>New Plugin Subcommands <a href="#new-plugin-subcommands" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker plugin install mylovelyuser/no-remove</div><div class="line">docker plugin <span class="built_in">enable</span> no-remove</div><div class="line">docker plugin <span class="built_in">disable</span> no-remove</div></pre></td></tr></table></figure>
<p>Docker engine &#x5C06;&#x4F1A;&#x53BB; Docker Hub &#x53D6;&#x5F97;&#x5BF9;&#x5E94;&#x7684; plugin&#x3002;</p>
<p>&#x800C;&#x4E14; Plugin &#x6709;&#x4E00;&#x4E2A; manifest &#x6765;&#x6307;&#x5B9A;&#x5176;&#x6240;&#x9700;&#x7684;&#x6743;&#x9650;&#x3002;</p>
<p>&#x7528;&#x6237;&#x5B89;&#x88C5;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x4F1A;&#x63D0;&#x793A;&#x7528;&#x6237;&#x662F;&#x5426;&#x8D4B;&#x4E88;&#x8BE5; plugin &#x5BF9;&#x5E94;&#x6743;&#x9650;&#x3002;</p>
<h1 id="orchestration-deep-dive-andrea-luzzardi"><a href="#Orchestration-Deep-Dive-Andrea-Luzzardi" class="headerlink" title="Orchestration Deep Dive - Andrea Luzzardi"></a>Orchestration Deep Dive - Andrea Luzzardi <a href="#orchestration-deep-dive-andrea-luzzardi" class="header-anchor">#</a></h1><h2 id="swarm-topology"><a href="#Swarm-Topology" class="headerlink" title="Swarm Topology"></a>Swarm Topology <a href="#swarm-topology" class="header-anchor">#</a></h2><p>&#x5728;Swarm&#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x5BF9;&#x5F85;&#x7684;&#x3002;&#x8282;&#x70B9;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x89D2;&#x8272;&#xFF0C;<code>Manager</code> &#x548C; <code>Worker</code>&#x3002;&#x89D2;&#x8272;&#x52A8;&#x6001;&#x7684;&#xFF0C;&#x4E8C;&#x8005;&#x53EF;&#x4EE5;&#x4E92;&#x76F8;&#x8F6C;&#x6362;(<code>promote</code>/<code>demote</code>)&#x3002;</p>
<h2 id="docker-swarm-communication-internals"><a href="#Docker-Swarm-Communication-Internals" class="headerlink" title="Docker Swarm Communication Internals"></a>Docker Swarm Communication Internals <a href="#docker-swarm-communication-internals" class="header-anchor">#</a></h2><p><code>Manager</code> &#x548C; <code>Worker</code> &#x5C5E;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;<code>Manager</code> &#x5C5E;&#x4E8E;&#x4E00;&#x4E2A; <code>Raft consensus</code> &#x7EC4;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x901A;&#x8BAF;&#x7684;&#x7F51;&#x7EDC;&#x6E20;&#x9053;&#xFF1B;&#x800C; <code>Worker</code> &#x540C;&#x5C5E;&#x4E8E; <code>Gossip</code> &#x7F51;&#x7EDC;&#xFF0C;&#x4E8C;&#x8005;&#x4E4B;&#x95F4;&#x7528;<code>gRPC</code>&#x901A;&#x8BAF;&#x3002;</p>
<h2 id="quorum-layer"><a href="#Quorum-Layer" class="headerlink" title="Quorum Layer"></a>Quorum Layer <a href="#quorum-layer" class="header-anchor">#</a></h2><p>&#x5185;&#x7F6E;&#x4E86; <code>Datastore</code>&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x9700;&#x8981;&#x5916;&#x7F6E; <code>key-value store</code> (<code>etcd</code>, <code>consul</code>, <code>zookeeper</code>,&#x2026;)</p>
<h1 id="node-breakdown"><a href="#Node-Breakdown" class="headerlink" title="Node Breakdown"></a>Node Breakdown <a href="#node-breakdown" class="header-anchor">#</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">API</div><div class="line">Orchestrator: Check the difference of state</div><div class="line">Allocator</div><div class="line">Scheduler</div><div class="line">Dispatcher</div><div class="line">    &#x2B06;&#xFE0F;</div><div class="line">Worker</div><div class="line">Executor</div></pre></td></tr></table></figure>
<h2 id="nei-zhi-fu-zai-jun-heng"><a href="#&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>&#x5185;&#x7F6E;&#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#nei-zhi-fu-zai-jun-heng" class="header-anchor">#</a></h2><p>&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x90FD;&#x6709;&#x4E00;&#x4E2A; <code>Virtual IP</code>&#xFF0C;&#x5185;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x5C06;<code>&lt;&#x670D;&#x52A1;&#x540D;&gt;</code>&#x89E3;&#x6790;&#x4E3A; <code>Virtual IP</code>&#xFF0C;&#x800C; <code>IPVS</code> &#x5C06;&#x4F1A;&#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5230;&#x5BB9;&#x5668; <code>IP</code>&#x3002;</p>
<h2 id="ingress-fu-zai-jun-heng"><a href="#Ingress-&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="headerlink" title="Ingress &#x8D1F;&#x8F7D;&#x5747;&#x8861;"></a>Ingress &#x8D1F;&#x8F7D;&#x5747;&#x8861; <a href="#ingress-fu-zai-jun-heng" class="header-anchor">#</a></h2><p><code>ELB</code>, <code>HAProxy</code>, <code>Nginx</code>&#x62E5;&#x6709;<code>&#x516C;&#x5171;IP</code>&#xFF0C;&#x5E76;&#x5C06;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x4E3B;&#x673A;&#x5185;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x53D1;&#x73B0;&#x6307;&#x5411;&#x670D;&#x52A1;&#x7684;<code>Virtual IP</code>&#xFF0C;<code>IPVS</code> &#x5219;&#x5728;&#x8DE8;&#x5BBF;&#x4E3B;&#x7684; <code>Ingress Network</code> &#x4E0A;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5230;&#x5176;&#x5B83;&#x63D0;&#x4F9B;&#x8BE5;&#x670D;&#x52A1;&#x7684;&#x5BB9;&#x5668;&#x4E0A;&#x3002;</p>
<p>&#x6240;&#x6709;&#x8282;&#x70B9;&#x901A;&#x8BAF;&#x9ED8;&#x8BA4;&#x5B89;&#x5168;&#x5168;&#x90E8;&#x52A0;&#x5BC6;&#xFF0C;<code>manager</code>&#x5185;&#x7F6E;CA&#xFF0C;<code>certificate rotation</code>&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：对于 OpenStack 日志管理而言 Fluentd 和 Logstash 对比 - Masaki Matsushita</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-05-video-fluentd-vs-logstash-for-openstack-log-management.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-05-video-fluentd-vs-logstash-for-openstack-log-management.html</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#fluentd">Fluentd</a></li>
<li><a href="#logstash">Logstash</a></li>
<li><a href="#chu-li-fen-liu-ji-ju-he-ri-zhi">&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7;</a></li>
<li><a href="#cha-jian">&#x63D2;&#x4EF6;</a></li>
<li><a href="#chuan-shu-xie-yi">&#x4F20;&#x8F93;&#x534F;&#x8BAE;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Fluentd vs. Logstash for OpenStack Log Management<br>by Masaki Matsushita from NTT<br>(2015/10/28)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/1ye0-sityBw" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=1ye0-sityBw" target="_blank" rel="external">https://www.youtube.com/watch?v=1ye0-sityBw</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0314dpog04&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/b0314dpog04.html" target="_blank" rel="external">http://v.qq.com/x/page/b0314dpog04.html</a></p>
<h1 id="fluentd"><a href="#Fluentd" class="headerlink" title="Fluentd"></a>Fluentd <a href="#fluentd" class="header-anchor">#</a></h1><ul>
<li>Written in CRuby</li>
<li>Used in Kubernetes</li>
<li>by Treasure Data</li>
</ul>
<h1 id="logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash <a href="#logstash" class="header-anchor">#</a></h1><ul>
<li>Written in JRuby</li>
<li>by elastic.co</li>
</ul>
<h1 id="chu-li-fen-liu-ji-ju-he-ri-zhi"><a href="#&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7;" class="headerlink" title="&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7;"></a>&#x5904;&#x7406;&#x5206;&#x6D41;&#x53CA;&#x805A;&#x5408;&#x65E5;&#x5FD7; <a href="#chu-li-fen-liu-ji-ju-he-ri-zhi" class="header-anchor">#</a></h1><p>Fluentd&#x5728;<code>&lt;source&gt;</code>&#x4E2D;&#x4F1A;&#x6253;&#x4E0A;<code>tag</code>&#xFF0C;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x901A;&#x8FC7;<code>&lt;match &gt;</code>&#x5176;&#x4E2D;&#x7684;<code>tag</code>&#x6765;&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x6267;&#x884C;&#x3002;</p>
<p>Logstash &#x4E2D;&#x6CA1;&#x6709; <code>tag</code>&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x6709;&#x5728;&#x8F93;&#x51FA;&#x7684;&#x65F6;&#x5019;&#x901A;&#x8FC7;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x53BB;&#x51B3;&#x5B9A;&#x5E94;&#x8BE5;&#x9001;&#x7ED9;&#x8C01;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;Logstash &#x66F4;&#x9002;&#x5408;&#x9ED8;&#x8BA4;&#x805A;&#x5408;&#x7684;&#x6D41;&#xFF0C;&#x800C; Fluentd &#x66F4;&#x9002;&#x5408;&#x7075;&#x6D3B;&#x7684;&#x6D41;&#x3002;</p>
<h1 id="cha-jian"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6; <a href="#cha-jian" class="header-anchor">#</a></h1><ul>
<li>Fluentd: 300+</li>
<li>Logstash: 200+</li>
</ul>
<p>Logstash&#x7684;&#x5927;&#x591A;&#x6D41;&#x884C;&#x63D2;&#x4EF6;&#x7531; Logstash &#x9879;&#x76EE;&#x7EF4;&#x62A4;&#xFF0C;&#x96C6;&#x6210;&#x4E8E; logstash &#x4E2D;&#x3002;<br>&#x800C; Fluentd &#x53EA;&#x5305;&#x542B;&#x6700;&#x57FA;&#x672C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x63D2;&#x4EF6;&#x7531;&#x4E2A;&#x4EBA;&#x7EF4;&#x62A4;&#x3002;</p>
<h1 id="chuan-shu-xie-yi"><a href="#&#x4F20;&#x8F93;&#x534F;&#x8BAE;" class="headerlink" title="&#x4F20;&#x8F93;&#x534F;&#x8BAE;"></a>&#x4F20;&#x8F93;&#x534F;&#x8BAE; <a href="#chuan-shu-xie-yi" class="header-anchor">#</a></h1><p>Fluentd &#x4F7F;&#x7528; <code>forward</code> protocol&#xFF0C;&#x53EF;&#x4EE5;<code>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</code>(&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;<code>weight</code>)&#xFF0C;&#x6216;&#x8005;<code>active-standby</code><br>Logstash &#x4F7F;&#x7528; <code>Lumberjack</code> protocol&#xFF0C;&#x53EA;&#x53EF;&#x4EE5; <code>active-standby</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="fluentd" scheme="http://blog.lab99.org/tags/fluentd/"/>
    
      <category term="logstash" scheme="http://blog.lab99.org/tags/logstash/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 安全探究</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-05-video-docker-security-deep-dive.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-05-video-docker-security-deep-dive.html</id>
    <published>2016-07-04T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DockerCon 16 - Docker Security Deep Dive</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/tL4IYSKu7ZU" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=tL4IYSKu7ZU" target="_blank" rel="external">https://www.youtube.com/watch?v=tL4IYSKu7ZU</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=m0314drzxnd&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/m0314drzxnd.html" target="_blank" rel="external">http://v.qq.com/x/page/m0314drzxnd.html</a></p>
<p>Docker 1.12 &#x4E2D;&#x96C6;&#x6210;&#x7684; Swarm mode &#x96C6;&#x6210;&#x4E86;CA&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x52A8;&#x786E;&#x4FDD;&#x6240;&#x6709;&#x8BC1;&#x4E66;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x662F;&#x5B89;&#x5168;&#x7684;&#x3002;</p>
<p>Docker &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; Docker bench security &#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x81EA;&#x52A8;&#x6839;&#x636E; CIS Docker Benchmark &#x6765;&#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x5B89;&#x5168;&#x5206;&#x6790;&#x3002;</p>
<p><a href="https://github.com/docker/docker-bench-security" target="_blank" rel="external">https://github.com/docker/docker-bench-security</a></p>
<p>&#x53D7;&#x8FD9;&#x4E2A;&#x89C6;&#x9891;&#x7684;&#x542F;&#x53D1;&#xFF0C;Linux &#x7684;&#x5B89;&#x5168;&#x5BA1;&#x67E5;&#x5DE5;&#x5177;&#xFF1A; <a href="https://cisofy.com/lynis/" target="_blank" rel="external">https://cisofy.com/lynis/</a>  &#x7528;&#x4E8E;&#x4E3B;&#x673A;&#x5BA1;&#x67E5;&#x4E5F;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon16" scheme="http://blog.lab99.org/tags/dockercon16/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Fluentd 和 Docker 架构 2015 - Kiyoto Tamura</title>
    <link href="http://blog.lab99.org/post/docker-2016-07-04-video-fluentd-and-docker-infrastructure-2015.html"/>
    <id>http://blog.lab99.org/post/docker-2016-07-04-video-fluentd-and-docker-infrastructure-2015.html</id>
    <published>2016-07-03T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Fluentd and Docker Infrastructure 2015<br>by Kiyoto Tamura, Treasure Data (VP)<br>(2015/08/03)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/udUr0pB_x-U" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=udUr0pB_x-U" target="_blank" rel="external">https://www.youtube.com/watch?v=udUr0pB_x-U</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=y0314bwhvwk&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/y0314bwhvwk.html" target="_blank" rel="external">http://v.qq.com/x/page/y0314bwhvwk.html</a></p>
<p>&#x5728;Docker demo&#x4E2D;&#xFF0C;Kiyoto &#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x5B89;&#x88C5;&#x597D; Docker &#x548C; <code>td agents</code> &#x7684;&#x8BA1;&#x7B97;&#x673A;&#x3002;&#x5148;&#x7ED9;&#x5927;&#x5BB6;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E0B; <code>td-agent</code>&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4F4D;&#x4E8E; <code>/etc/td-agent/td-agent.conf</code>&#xFF1A;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">    type forward</div><div class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">match</span> <span class="attr">td.</span>*<span class="attr">.</span>*&gt;</span></div><div class="line">    type tdlog</div><div class="line">    apikey &#x2026;.</div><div class="line">    auto_create_table</div><div class="line">    buffer_type file</div><div class="line">    buffer_path /var/log/&#x2026;.</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">secondary</span>&gt;</span></div><div class="line">        type file</div><div class="line">        path /var/log/&#x2026;</div><div class="line">    <span class="tag">&lt;/<span class="name">secondary</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></div></pre></td></tr></table></figure>
<p>&#x91CD;&#x542F; <code>td-agent</code> &#x670D;&#x52A1;&#x540E;&#xFF0C;&#x5F00;&#x59CB;&#x8FD0;&#x884C; docker&#xFF0C;&#x5E76;&#x6307;&#x5B9A;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5230; <code>fluentd</code>&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker run -it --name <span class="built_in">test</span> \</div><div class="line">    --log-driver=fluentd \</div><div class="line">    --log-opt fluentd-tag=td.docker.{{.Name}} \</div><div class="line">    ubuntu /bin/bash</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#xFF1A;&#x53C2;&#x8003; fluentd logging driver &#x6587;&#x6863;&#xFF0C;&#x53EF;&#x80FD;&#x73B0;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x4E86;&#xFF0C;&#x5BB9;&#x5668;&#x540D;&#x4F1A;&#x81EA;&#x52A8;&#x4F5C;&#x4E3A;tag&#x8F93;&#x51FA;&#x3002;</p>
<p><a href="https://docs.docker.com/engine/admin/logging/fluentd/" target="_blank" rel="external">https://docs.docker.com/engine/admin/logging/fluentd/</a></p>
<p>fluentd&#x4F1A;&#x81EA;&#x52A8;&#x52A0;&#x4E0A; <code>container_id</code>, <code>container_name</code> &#x4EE5;&#x53CA; <code>source</code>&#x3002;</p>
<p>&#x5982;&#x679C;&#x50CF;&#x793A;&#x4F8B;&#x4E2D;&#x90A3;&#x6837;&#x4E0D;&#x6307;&#x5B9A; <code>fluentd-address</code> &#x53C2;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F1A;&#x8FDE;&#x63A5; <code>localhost:24224</code></p>
<p><code>--log-driver</code> &#x53EF;&#x4EE5;&#x52A0;&#x8F7D; <code>docker daemon</code> &#x540E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x52A0;&#x5728; <code>docker run</code> &#x540E;&#x4F7F;&#x7528;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55; docker daemon&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x5BB9;&#x5668;&#x65E5;&#x5FD7;&#x3002;</p>
<p>&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;Kiyoto &#x4F7F;&#x7528;&#x7684;&#x662F;&#x672C;&#x673A;&#x7684;<code>td-agents</code>&#xFF0C;&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x673A;&#x5B89;&#x88C5; fluentd&#xFF0C;&#x6216;&#x8005;&#x66F4;&#x597D;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5728;&#x672C;&#x673A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A; fluentd &#x7684; docker &#x5BB9;&#x5668;&#x6765;&#x8DD1;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x3002;</p>
<p><a href="https://hub.docker.com/r/fluent/fluentd/" target="_blank" rel="external">https://hub.docker.com/r/fluent/fluentd/</a></p>
<p>&#x6F14;&#x793A;&#x4E2D;&#x4E3A;&#x4E86;&#x6E05;&#x7A7A;&#x7F13;&#x5B58;&#xFF0C;&#x7528;kill&#x53D1;&#x9001;<code>--USR1</code>&#x4FE1;&#x53F7;&#x7ED9;<code>td-agent</code>&#x3002;&#x7136;&#x540E;&#x6253;&#x5F00;&#x4E86; <a href="https://console.treasuredata.com" target="_blank" rel="external">https://console.treasuredata.com</a> &#x4F7F;&#x7528;Web UI&#x6765;&#x770B;&#x65E5;&#x5FD7;&#x4E2D;&#x7684;&#x8BB0;&#x5F55;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="fluentd" scheme="http://blog.lab99.org/tags/fluentd/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：介绍 Raft 算法 (CoreOS Fest 2015) - Diego Ongaro</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-23-video-an-introduction-of-raft.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-23-video-an-introduction-of-raft.html</id>
    <published>2016-06-22T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#raft-consensus-algorithm-etcd-based-on-it">Raft Consensus Algorithm (etcd based on it)</a></li>
<li><a href="#mu-de">&#x76EE;&#x7684;</a></li>
<li><a href="#shi-me-shi-consensus">&#x4EC0;&#x4E48;&#x662F; Consensus</a></li>
<li><a href="#paxos-protocol">PAXOS Protocol</a></li>
<li><a href="#raft-overview">RAFT overview</a><ul>
<li><a href="#leader-election">Leader election</a></li>
<li><a href="#ri-zhi-fu-zhi">&#x65E5;&#x5FD7;&#x590D;&#x5236;</a></li>
</ul>
</li>
<li><a href="#raft-visualization">RAFT Visualization</a></li>
<li><a href="#zong-jie">&#x603B;&#x7ED3;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>An Introduction to Raft (CoreOS Fest 2015)<br>by Diego Ongaro, Stanford University (2015/05/27)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/6bBggO6KN_k" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=6bBggO6KN_k" target="_blank" rel="external">https://www.youtube.com/watch?v=6bBggO6KN_k</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=f0314bj1m5j&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/f0314bj1m5j.html" target="_blank" rel="external">http://v.qq.com/x/page/f0314bj1m5j.html</a></p>
<h1 id="raft-consensus-algorithm-etcd-based-on-it"><a href="#Raft-Consensus-Algorithm-etcd-based-on-it" class="headerlink" title="Raft Consensus Algorithm (etcd based on it)"></a>Raft Consensus Algorithm (etcd based on it) <a href="#raft-consensus-algorithm-etcd-based-on-it" class="header-anchor">#</a></h1><h1 id="mu-de"><a href="#&#x76EE;&#x7684;" class="headerlink" title="&#x76EE;&#x7684;"></a>&#x76EE;&#x7684; <a href="#mu-de" class="header-anchor">#</a></h1><p>&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x7684;&#x952E;&#x503C;Store&#xFF08;state machine&#xFF09;<br>&#x7B80;&#x5355;&#x5730;&#x529E;&#x6CD5;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x653E;&#x5230;&#x7F51;&#x7EDC;&#x4E0A;&#xFF0C;&#x597D;&#x5904;&#x662F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x7F3A;&#x70B9;&#x662F;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF1B;<br>&#x4F7F;&#x7528;Raft&#xFF0C;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5E94;&#x5BF9;&#x6545;&#x969C;</p>
<h1 id="shi-me-shi-consensus"><a href="#&#x4EC0;&#x4E48;&#x662F;-Consensus" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Consensus"></a>&#x4EC0;&#x4E48;&#x662F; Consensus <a href="#shi-me-shi-consensus" class="header-anchor">#</a></h1><p>Agreement on shared state<br>&#x81EA;&#x52A8;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x6545;&#x969C;&#x4E2D;&#x6062;&#x590D;&#xFF1A;&#x5C0F;&#x89C4;&#x6A21;&#x6545;&#x969C;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x8BDD;&#x5931;&#x53BB;&#x53EF;&#x7528;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x4F9D;&#x65E7;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x3002;</p>
<p>Replicated State Machines</p>
<p>Replicated log &#x9001;&#x7ED9; replicated state machine&#xFF0C;&#x8FD9;&#x6837;&#x6240;&#x6709;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x4F1A;&#x4EE5;&#x540C;&#x6837;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x3002;<br>Consensus &#x6A21;&#x5757;&#x786E;&#x4FDD;&#x6B63;&#x786E;&#x7684; log &#x590D;&#x5236;<br>System makes progress as long as any majority of servers up</p>
<h1 id="paxos-protocol"><a href="#PAXOS-Protocol" class="headerlink" title="PAXOS Protocol"></a>PAXOS Protocol <a href="#paxos-protocol" class="header-anchor">#</a></h1><p>by Leslie Lamppost, 1989</p>
<p>&#x8FC7;&#x4E8E;&#x590D;&#x6742;&#x3002;</p>
<p>RAFT &#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x5305;&#x62EC;&#x8981;&#x6613;&#x4E8E;&#x7406;&#x89E3;</p>
<h1 id="raft-overview"><a href="#RAFT-overview" class="headerlink" title="RAFT overview"></a>RAFT overview <a href="#raft-overview" class="header-anchor">#</a></h1><h2 id="leader-election"><a href="#Leader-election" class="headerlink" title="Leader election"></a>Leader election <a href="#leader-election" class="header-anchor">#</a></h2><ul>
<li>&#x4ECE;&#x4E00;&#x7FA4;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x9009;&#x51FA;&#x4E00;&#x4E2A;&#x4F5C;&#x4E3A; cluster leader</li>
<li>&#x76D1;&#x6D4B;&#x5B95;&#x673A;&#x5E76;&#x91CD;&#x65B0;&#x9009;&#x62E9;&#x65B0;&#x7684;leader</li>
</ul>
<h2 id="ri-zhi-fu-zhi"><a href="#&#x65E5;&#x5FD7;&#x590D;&#x5236;" class="headerlink" title="&#x65E5;&#x5FD7;&#x590D;&#x5236;"></a>&#x65E5;&#x5FD7;&#x590D;&#x5236; <a href="#ri-zhi-fu-zhi" class="header-anchor">#</a></h2><ul>
<li>leader&#x4ECE;client&#x63A5;&#x53D7;&#x547D;&#x4EE4;&#xFF0C;&#x5E76;&#x9644;&#x7740;&#x5230; log&#x4E0A;</li>
<li>leader &#x590D;&#x5236;&#x8FD9;&#x4E2A;log&#x5230;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x5668;&#x4E0A;</li>
</ul>
<p>##&#x5B89;&#x5168;</p>
<p>&#x53EA;&#x6709;&#x62E5;&#x6709;&#x6700;&#x65B0; log &#x7684;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x6210;&#x4E3A; leader</p>
<h1 id="raft-visualization"><a href="#RAFT-Visualization" class="headerlink" title="RAFT Visualization"></a>RAFT Visualization <a href="#raft-visualization" class="header-anchor">#</a></h1><p>&#x6709;5&#x4E2A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x671F;&#x671B;&#x5728;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x5185;&#x4F1A;&#x6536;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5FC3;&#x8DF3;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x9009;&#x4E3E;&#x65B0;&#x7684; leader&#x3002;</p>
<p><code>S3</code>&#x8D85;&#x65F6;&#x540E;&#xFF0C;&#x5B83;&#x81EA;&#x5DF1;&#x5347;&#x4E3A;<code>Term 3</code>&#xFF0C;&#x5E76;&#x4E14;&#x53D1;&#x51FA;<code>message&#xFF08;Request Vote RPC&#xFF09;</code>&#xFF1B;&#x800C;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x5668;&#x5C1A;&#x5904;&#x4E8E;&#x539F;&#x5148;&#x7684; <code>Term 2</code>&#x3002;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x6536;&#x5230; <code>T3</code> &#x7684;message&#x540E;&#xFF0C;&#x90FD;&#x4F1A;&#x66F4;&#x65B0;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x8FDB;&#x5165;<code>T3</code>&#xFF0C;&#x800C;&#x5347;&#x7EA7;&#x5230;<code>T3</code>&#x540E;&#xFF0C;&#x4ED6;&#x4EEC;&#x5C06;&#x4F1A;&#x62D2;&#x7EDD;&#x63A5;&#x53D7;T2&#x7684;&#x6D88;&#x606F;&#x3002;</p>
<p><code>Request Vote message</code>&#xFF0C;&#x73B0;&#x5728;&#x662F;<code>&#x5148;&#x5230;&#x5148;&#x5F97;</code>&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5148;&#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5148;&#x6210;&#x4E3A;Leader&#x3002;</p>
<p>&#x5982;&#x679C; <code>S1</code> &#x548C; <code>S5</code> &#x540C;&#x65F6;Time out&#xFF0C;&#x4ED6;&#x4EEC;&#x540C;&#x65F6;&#x53D1;&#x8D77;<code>request vote RPC</code>&#x3002;&#x5982;&#x679C;<code>s3</code>&#xFF0C;<code>s4</code> &#x5404;&#x9009;&#x62E9;&#x4E86;&#x4E00;&#x4E2A;leader&#xFF0C;&#x5219;<code>S1</code>&#x548C;<code>S5</code>&#x90FD;&#x65E0;&#x6CD5;&#x5F97;&#x5230;&#x5927;&#x591A;&#x6570;&#x9009;&#x7968;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x90FD;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x6210;&#x4E3A;leader&#x3002;</p>
<p>&#x8FD9;&#x65F6; <code>RAFT</code> &#x7684;&#x7B56;&#x7565;&#x662F;&#x5E72;&#x8106;&#x7B49;&#x5F85;&#x597D;&#x4E86;&#xFF0C;&#x8FDB;&#x5165;&#x7684;<code>Term 5</code>&#xFF0C;&#x770B;&#x4E4B;&#x540E;&#x8C01;&#x7B2C;&#x4E00;&#x4E2A;timeout&#xFF0C;&#x56E0;&#x4E3A;&#x4E0B;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;timeout&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x5927;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E0A;&#x9762;&#x540C;&#x65F6;&#x8D85;&#x65F6;&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x8D85;&#x65F6;&#x672C;&#x8EAB;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF09;&#x3002;&#x8FD9;&#x65F6;&#x67B6;&#x8BBE;<code>S3</code>&#x9996;&#x5148;&#x8D85;&#x65F6;&#xFF0C;&#x5F00;&#x59CB;&#x53D1;&#x8D77; <code>request vote RPC</code>&#xFF0C;&#x90A3;&#x4E48;s3&#x5C31;&#x6210;&#x4E3A;&#x4E86;<code>Term 5</code>&#x7684;leader&#x3002;</p>
<p>&#x53EA;&#x6709;&#x5728;&#x591A;&#x6570;&#x670D;&#x52A1;&#x5DE5;&#x4F5C;&#x65F6;&#xFF0C;&#x624D;&#x4F1A;&#x63A5;&#x53D7;&#x65B0;&#x7684;&#x65E5;&#x5FD7;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x5982;&#x679C;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x73B0;&#x65E5;&#x5FD7;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6216;&#x8005;&#x6B65;&#x8C03;&#x4E0D;&#x5BF9;&#xFF0C;&#x4F1A;&#x548C;&#x65B0;&#x7684;leader&#x8FDB;&#x884C;&#x4EA4;&#x6D41;&#xFF0C;&#x4E00;&#x6B65;&#x6B65;&#x540E;&#x9000;&#xFF0C;&#x9000;&#x5230;&#x4E4B;&#x524D;&#x53EF;&#x4EE5;&#x8FBE;&#x6210;&#x4E00;&#x76F4;&#x7684;index&#xFF0C;&#x7136;&#x540E;&#x518D;&#x524D;&#x8FDB;&#x5230;&#x5F53;&#x524D;index.</p>
<p>&#x5982;&#x679C;&#x4E4B;&#x524D;&#x5B95;&#x673A;&#x7684;leader&#x62E5;&#x6709;&#x66F4;&#x65B0;&#x7684;index&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6765;&#x7684;&#x53CA;&#x53D1;&#x7ED9;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x73B0;&#x5728;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x5668;&#x5DF2;&#x7ECF;&#x79FB;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;term&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x65E7;leader&#x4E0A;&#x7EBF;&#x540E;&#xFF0C;&#x5B83;&#x7684;index&#x4F1A;&#x88AB;&#x65B0;term&#x7684;index&#x6240;&#x8986;&#x76D6;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x7684;index&#x6BD4;&#x6240;&#x6709;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x65E7;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;<code>request vote RPC</code>&#xFF0C;&#x6240;&#x6709;&#x7684;&#x670D;&#x52A1;&#x5668;&#x90FD;&#x4E0D;&#x4F1A;&#x540C;&#x610F;&#xFF0C;&#x53EA;&#x6709;&#x62E5;&#x6709;&#x6700;&#x65B0;&#x7684;index&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x6210;&#x4E3A; leader&#x3002;</p>
<h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><ul>
<li>Consensus &#x6CE8;&#x91CD;&#x4E8E;&#x63A8;&#x5E7F;&#x800C;&#x4E0D;&#x662F;&#x590D;&#x6742;</li>
</ul>
<p>&#x8981;&#x5BB9;&#x6613;&#x5728;&#x5B66;&#x6821;&#x6559;&#xFF0C;&#x800C;&#x4E14;&#x5BB9;&#x6613;&#x66F4;&#x597D;&#x7684;&#x6784;&#x5EFA;&#x5B9E;&#x9645;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0;<br>&#x5B9E;&#x9645;&#x7CFB;&#x7EDF;&#x4E2D;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x90E8;&#x5206;&#xFF1A;</p>
<ul>
<li>&#x96C6;&#x7FA4;&#x6210;&#x5458;&#x7BA1;&#x7406;</li>
<li>&#x65E5;&#x5FD7;&#x538B;&#x7F29;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x4EA4;&#x4E92;</li>
<li>evaluation</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="coreos" scheme="http://blog.lab99.org/tags/coreos/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：为 Docker Swarm 设计的 DNS 服务发现 - Ahmet Alp Balkan</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-23-video-dns-service-discovery-for-docker-swarm-clusters.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-23-video-dns-service-discovery-for-docker-swarm-clusters.html</id>
    <published>2016-06-22T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.842Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#service-discovery">Service Discovery</a></li>
<li><a href="#tong-chang-fang-fa">&#x901A;&#x5E38;&#x65B9;&#x6CD5;</a></li>
<li><a href="#dns">DNS</a></li>
<li><a href="#mesos-dns">Mesos-DNS</a></li>
<li><a href="#skydns">SkyDNS</a></li>
<li><a href="#wagl">wagl</a></li>
<li><a href="#bu-shu-wagl">&#x90E8;&#x7F72; wagl</a></li>
<li><a href="#demo">demo</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>DNS Service Discovery for Docker Swarm Clusters<br>by Ahmet Alp Balkan, Microsoft<br>(2015/12/7)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/WXESsPqC8to" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=WXESsPqC8to" target="_blank" rel="external">https://www.youtube.com/watch?v=WXESsPqC8to</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b03149ny29m&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/b03149ny29m.html" target="_blank" rel="external">http://v.qq.com/x/page/b03149ny29m.html</a></p>
<h1 id="service-discovery"><a href="#Service-Discovery" class="headerlink" title="Service Discovery"></a>Service Discovery <a href="#service-discovery" class="header-anchor">#</a></h1><p>&#x5E2E;&#x52A9;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x627E;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;</p>
<p>&#x4E0D;&#x8FC7;&#x56E0;&#x4E3A;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#xFF0C;&#x5BFC;&#x81F4;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x7FA4;&#x5730;&#x5740;</p>
<p>&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x5730;&#x5740;&#x53EF;&#x80FD;&#x6709;&#x7684;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x6BD4;&#x5982;&#x5BF9;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x6302;&#x4E86;</p>
<h1 id="tong-chang-fang-fa"><a href="#&#x901A;&#x5E38;&#x65B9;&#x6CD5;" class="headerlink" title="&#x901A;&#x5E38;&#x65B9;&#x6CD5;"></a>&#x901A;&#x5E38;&#x65B9;&#x6CD5; <a href="#tong-chang-fang-fa" class="header-anchor">#</a></h1><p><code>Overlay Networks</code><br>&#x670D;&#x52A1;&#x53D1;&#x73B0; &#x2192; <code>/etc/hosts</code>&#xFF0C;&#x4F46;&#x8FD9;&#x4E0D;&#x662F;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;&#xFF08;<em>&#x6CE8;&#xFF1A;&#x8FD9;&#x4E2A;&#x8BB2;&#x5EA7;&#x662F;&#x53BB;&#x5E74;&#x7684;&#xFF0C;&#x8BB2;&#x7684;&#x662F;&#x5728;Docker 1.10&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x63D0;&#x51FA;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x800C;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x5185;&#x7F6E; DNS&#x4E86;</em>&#xFF09;</p>
<p>&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF1A;<code>HAProxy</code>, <code>Nginx</code>&#x3002;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3001;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#x3001;Connection draining&#x3002;&#x4F46;&#x662F;&#x6240;&#x6709;&#x7684;traffic&#x90FD;&#x4F1A;&#x7ECF;&#x8FC7;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF0C;&#x8FD9;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x5355;&#x70B9;&#x6545;&#x969C;&#xFF0C;&#x800C;&#x4E14;&#x4F1A;&#x589E;&#x52A0;&#x5EF6;&#x65F6;&#x3002;</p>
<p><code>Interlock</code>&#xFF0C;&#x901A;&#x8FC7;<code>Docker Events API</code>&#x6765;&#x76D1;&#x542C;&#x5BB9;&#x5668;&#x7684;&#x5EFA;&#x7ACB;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x65B0; <code>HAProxy</code>&#x3002;<br><code>Registrator</code>&#xFF0C;&#x4E5F;&#x4E00;&#x6837;&#x901A;&#x8FC7;<code>Events API</code>&#xFF0C;&#x7136;&#x540E;&#x4FDD;&#x5B58;&#x5230; <code>consul</code>&#xFF0C;&#x7136;&#x540E;&#x5229;&#x7528;<code>consul-template</code> &#x6765;&#x66F4;&#x65B0; <code>nginx</code>&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x3002;</p>
<p><code>kube-proxy</code> &#x5904;&#x7406; <code>kubenetes</code> &#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x505A;&#x7684;&#x662F;&#x6BD4;&#x8F83;&#x6B63;&#x786E;&#x7684;&#x3002;</p>
<h1 id="dns"><a href="#DNS" class="headerlink" title="DNS"></a>DNS <a href="#dns" class="header-anchor">#</a></h1><p>DNS&#x8BDE;&#x751F;&#x5C31;&#x662F;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x540D;&#x5B57;/&#x670D;&#x52A1;&#x5230;IP&#x7684;&#x89E3;&#x6790;</p>
<p><code>DNS A/AAAA</code>&#x8BB0;&#x5F55;&#x6CA1;&#x6709;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;&#x3002;<br><code>SRV</code>&#x8BB0;&#x5F55;&#xFF0C;&#x5982;&#x679C;&#x7ED9;&#x5B9A; <code>hostname</code>&#xFF0C;&#x4F1A;&#x8FD4;&#x56DE;<code>&lt;ip, port, weight&gt;</code></p>
<p>&#x95EE;&#x9898;&#x662F;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x7528;<code>SRV</code>&#x3002;</p>
<p>&#x4F7F;&#x7528;DNS&#x7684;&#x8BDD;&#xFF0C;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x90E8;&#x5206;&#xFF1B;<br>&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x7AEF;&#x53E3;&#x5206;&#x914D;&#x4E86;&#xFF08;<code>SRV</code>&#x7684;&#x95EE;&#x9898;&#xFF09;&#xFF1B;<br>&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x52A0;&#x8F7D;&#x65F6;&#x95F4;(<code>DNS TTL</code>)&#xFF1B;<br>&#x95EE;&#x9898;&#x662F;&#x6709;&#x4E9B;&#x4E1C;&#x897F;(&#x5982;<code>Java</code>)&#x4E0D;&#x9075;&#x5B88;<code>TTL</code>;<br>&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x5806;&#x6808;&#xFF1B;<br>&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x5065;&#x5EB7;&#x68C0;&#x67E5;&#xFF1B;<br>&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;shuffling ip&#x6765;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<h1 id="mesos-dns"><a href="#Mesos-DNS" class="headerlink" title="Mesos-DNS"></a>Mesos-DNS <a href="#mesos-dns" class="header-anchor">#</a></h1><p>&#x4E3A; Mesos &#x8BBE;&#x8BA1;&#x7684;&#xFF0C;&#x90E8;&#x7F72;&#x4E00;&#x6B21;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5FD8;&#x6389;&#x4ED6;&#x4E86;&#x3002;&#x8BBE;&#x8BA1;&#x975E;&#x5E38;&#x597D;&#x3002;</p>
<h1 id="skydns"><a href="#SkyDNS" class="headerlink" title="SkyDNS"></a>SkyDNS <a href="#skydns" class="header-anchor">#</a></h1><p>&#x975E;&#x5E38;&#x50CF; Mesos &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;kubenetes &#x9ED8;&#x8BA4;&#x7684; DNS</p>
<h1 id="wagl"><a href="#wagl" class="headerlink" title="wagl"></a>wagl <a href="#wagl" class="header-anchor">#</a></h1><p>&#x53D7; Mesos-DNS &#x542F;&#x53D1;&#xFF0C;&#x4F46;&#x662F;&#x4E3A; <code>Swarm</code> &#x8BBE;&#x8BA1;&#x3002;&#x800C;&#x4E14;&#x8FD8;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x3002;</p>
<p>&#x5EFA;&#x8BAE; <code>wagl</code> &#x5B89;&#x88C5;&#x5728;&#x6240;&#x6709;&#x7684;<code>master</code>&#x8EAB;&#x4E0A;&#x3002;</p>
<p>&#x5728; docker engine &#x4E2D;&#x52A0;&#x5165; <code>--dns master01 --dns master02 &#x2026;</code></p>
<h1 id="bu-shu-wagl"><a href="#&#x90E8;&#x7F72;-wagl" class="headerlink" title="&#x90E8;&#x7F72; wagl"></a>&#x90E8;&#x7F72; wagl <a href="#bu-shu-wagl" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker run <span class="_">-d</span> --restart=always --name=dns \</div><div class="line">    -p 53:53/udp \</div><div class="line">    --link=swarm-master:swarm \</div><div class="line">    ahmet/wagl \</div><div class="line">    wagl --swarm tcp://swarm:2375</div></pre></td></tr></table></figure>
<h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x5728;&#x4E09;&#x4E2A;<code>master</code>&#x4E0A;&#x8FD0;&#x884C;&#x4E86;<code>wagl</code></p>
<p>&#x7136;&#x540E;&#x5728;<code>swarm</code>&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</p>
<p>&#x8FD0;&#x884C;&#x4E86;3&#x4E2A; <code>nginx</code> &#x5BB9;&#x5668;&#x4F5C;&#x4E3A; <code>API</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run <span class="_">-d</span> -p 80:80 <span class="_">-l</span> dns.service=api nginx</div></pre></td></tr></table></figure>
<p>&#x5728;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6765;&#x8BD5;&#x56FE;&#x901A;&#x8BAF;api</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker run -it &#x2014;dns master01 busybox</div><div class="line"></div><div class="line">dig _api._tcp.swarm</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;IP&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x53CA;SRV&#x8BB0;&#x5F55;&#x4E2D;&#x7684;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;</p>
<p>&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;api</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -iv http://api.swarm/</div></pre></td></tr></table></figure>
<p>&#x901A;&#x8FC7;<code>-v</code>&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x6B21;&#x94FE;&#x63A5;&#x7684;&#x662F; <code>192.168.0.5</code>&#xFF0C;&#x5982;&#x679C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#xFF0C;&#x53EF;&#x80FD;&#x7ED3;&#x679C;&#x4F1A;&#x662F;&#x53E6;&#x4E00;&#x4E2A;ip&#xFF0C;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684;DNS TTL&#x662F;0&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x7ACB;&#x523B;&#x8FC7;&#x671F;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="http://blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：生产环境中使用 Docker 必需有一个很好地私有 Registry</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-22-video-running-docker-in-production.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-22-video-running-docker-in-production.html</id>
    <published>2016-06-21T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#gong-gong-registry">&#x516C;&#x5171;registry</a></li>
<li><a href="#qi-ye-xu-yao-yi-ge-private-registry-repository">&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A; Private Registry/Repository</a></li>
<li><a href="#yi-ge-jian-zhuang-de-private-registry-shi-bi-yao-de">&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684; private registry &#x662F;&#x5FC5;&#x8981;&#x7684;</a></li>
<li><a href="#nexus-3-docker-private-registry">Nexus 3 Docker Private Registry</a></li>
<li><a href="#xiang-guan-xin-xi">&#x76F8;&#x5173;&#x4FE1;&#x606F;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Running Docker in Production? A Premium Private Registry is a must!<br>by Sonatype, 2015/11/3</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/qlsGHSFJ2ss" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=qlsGHSFJ2ss" target="_blank" rel="external">https://www.youtube.com/watch?v=qlsGHSFJ2ss</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=c0314lz1iu6&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/c0314lz1iu6.html" target="_blank" rel="external">http://v.qq.com/x/page/c0314lz1iu6.html</a></p>
<h1 id="gong-gong-registry"><a href="#&#x516C;&#x5171;registry" class="headerlink" title="&#x516C;&#x5171;registry"></a>&#x516C;&#x5171;registry <a href="#gong-gong-registry" class="header-anchor">#</a></h1><p>&#x6CA1;&#x6709;&#x7BA1;&#x7406;&#xFF0C;&#x4E0D;&#x4FE1;&#x4EFB;image</p>
<p>&#x8F6F;&#x4EF6;&#x5F00;&#x53D1;&#x5E76;&#x4E0D;&#x65B0;&#x9C9C;&#xFF0C;&#x5F00;&#x53D1;&#x5C31;&#x662F;&#x751F;&#x4EA7;&#xFF0C;Docker Image &#x662F;&#x4F9B;&#x5E94;&#x94FE;&#x7684;&#x4E00;&#x4E2A;&#x73AF;&#x8282;&#x800C;&#x5DF2;&#x3002;</p>
<h1 id="qi-ye-xu-yao-yi-ge-private-registry-repository"><a href="#&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A;-Private-Registry-Repository" class="headerlink" title="&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A; Private Registry/Repository"></a>&#x4F01;&#x4E1A;&#x9700;&#x8981;&#x4E00;&#x4E2A; Private Registry/Repository <a href="#qi-ye-xu-yao-yi-ge-private-registry-repository" class="header-anchor">#</a></h1><p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker registry</code>&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x7528;&#x6237;&#x754C;&#x9762;&#x3002;<br>&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x4F60;&#x7684;&#x4F9B;&#x5E94;&#x94FE;&#x73AF;&#x5883;&#x8BBE;&#x8BA1;&#x7684;</p>
<h1 id="yi-ge-jian-zhuang-de-private-registry-shi-bi-yao-de"><a href="#&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684;-private-registry-&#x662F;&#x5FC5;&#x8981;&#x7684;" class="headerlink" title="&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684; private registry &#x662F;&#x5FC5;&#x8981;&#x7684;"></a>&#x4E00;&#x4E2A;&#x5065;&#x58EE;&#x7684; private registry &#x662F;&#x5FC5;&#x8981;&#x7684; <a href="#yi-ge-jian-zhuang-de-private-registry-shi-bi-yao-de" class="header-anchor">#</a></h1><ul>
<li>&#x53EF;&#x4EE5;&#x672C;&#x5730;&#x5E76;&#x4E14;&#x5171;&#x4EAB;</li>
<li>&#x5FC5;&#x987B;&#x4E00;&#x81F4;&#x6027;</li>
<li>&#x7BA1;&#x7406;&#x6027;&#xFF1A;&#x57FA;&#x4E8E;&#x89D2;&#x8272;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5141;&#x8BB8;&#x4FDD;&#x5B58;&#x79C1;&#x6709;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x907F;&#x514D;&#x91CD;&#x590D;</li>
<li>&#x96C6;&#x6210;&#x80FD;&#x529B;&#xFF1A;&#x76EE;&#x5F55;&#x670D;&#x52A1;&#x3001;&#x7F16;&#x6392;&#x3001;&#x53D1;&#x5E03;&#x81EA;&#x52A8;&#x5316;&#x3001;&#x5176;&#x5B83;registries</li>
</ul>
<h1 id="nexus-3-docker-private-registry"><a href="#Nexus-3-Docker-Private-Registry" class="headerlink" title="Nexus 3 Docker Private Registry"></a>Nexus 3 Docker Private Registry <a href="#nexus-3-docker-private-registry" class="header-anchor">#</a></h1><ul>
<li>Docker push/pull</li>
<li>browse, search</li>
<li>proxy of docker hub</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker search 192.168.1.4:18075/redis</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x641C;&#x7D22; Registry &#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x5728; Nexus &#x8BBE;&#x7F6E; Docker Hub proxy&#xFF0C;&#x8FD9;&#x6837;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x641C;&#x7D22; docker hub</p>
<h1 id="xiang-guan-xin-xi"><a href="#&#x76F8;&#x5173;&#x4FE1;&#x606F;" class="headerlink" title="&#x76F8;&#x5173;&#x4FE1;&#x606F;"></a>&#x76F8;&#x5173;&#x4FE1;&#x606F; <a href="#xiang-guan-xin-xi" class="header-anchor">#</a></h1><p><a href="http://www.sonatype.com/download-oss-sonatype" target="_blank" rel="external">http://www.sonatype.com/download-oss-sonatype</a><br><a href="http://bitly.com/nexusanddocker" target="_blank" rel="external">http://bitly.com/nexusanddocker</a><br><a href="https://hub.docker.com/r/sonatype/nexus/" target="_blank" rel="external">https://hub.docker.com/r/sonatype/nexus/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="Sonatype" scheme="http://blog.lab99.org/tags/Sonatype/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线交流会 28 - Docker Swarm 可以用于生产环境了 - Alexandre Beslic</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-22-video-docker-online-meetup-28-production-ready-docker-swarm.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-22-video-docker-online-meetup-28-production-ready-docker-swarm.html</id>
    <published>2016-06-21T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#duo-docker-engines-swarm">&#x591A; Docker Engines == Swarm</a></li>
<li><a href="#timeline">Timeline</a></li>
<li><a href="#swarm-in-general">Swarm in General</a></li>
<li><a href="#xin-ban-ben-te-dian">&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9;</a></li>
<li><a href="#duo-zhu-ji-wang-luo">&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;</a></li>
<li><a href="#docker-network"><code>docker network</code></a></li>
<li><a href="#demo">Demo</a><ul>
<li><a href="#docker-run"><code>docker run</code></a></li>
<li><a href="#docker-compose"><code>docker-compose</code></a></li>
<li><a href="#juan-guan-li">&#x5377;&#x7BA1;&#x7406;</a></li>
</ul>
</li>
<li><a href="#swarm-machine-compose"><code>swarm</code> + <code>machine</code> + <code>compose</code></a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup #28 - Production Ready Docker Swarm<br>  by Alexandre Beslic (2015/11/11)</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/3I6hWb24_qE" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=3I6hWb24_qE" target="_blank" rel="external">https://www.youtube.com/watch?v=3I6hWb24_qE</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=y0314wpg13e&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/y0314wpg13e.html" target="_blank" rel="external">http://v.qq.com/x/page/y0314wpg13e.html</a></p>
<h1 id="duo-docker-engines-swarm"><a href="#&#x591A;-Docker-Engines-Swarm" class="headerlink" title="&#x591A; Docker Engines == Swarm"></a>&#x591A; Docker Engines == Swarm <a href="#duo-docker-engines-swarm" class="header-anchor">#</a></h1><p>CLI &#x2192; Swarm (Managers) &#x2192; Agents (Docker Nodes)<br>Managers &#x2192; machine discovery (etcd, consul, zookeeper)</p>
<h1 id="timeline"><a href="#Timeline" class="headerlink" title="Timeline"></a>Timeline <a href="#timeline" class="header-anchor">#</a></h1><ul>
<li>2014&#x5E74;10&#x6708;  Proof of Concept</li>
<li>2015&#x5E74;1&#x6708;   First RC</li>
<li>2015&#x5E74;2&#x6708;   swarm beta</li>
<li>2015&#x5E74;4&#x6708;   0.2.0</li>
<li>2015&#x5E74;10&#x6708;  1.0.0 release (stable)</li>
</ul>
<h1 id="swarm-in-general"><a href="#Swarm-in-General" class="headerlink" title="Swarm in General"></a>Swarm in General <a href="#swarm-in-general" class="header-anchor">#</a></h1><p>&#x5C06;&#x4E00;&#x7FA4;Docker Engins&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x6C60;</p>
<p>&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684;Docker REST API<br>&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#xFF08;CPU&#x3001;&#x5185;&#x5B58;&#x3001;&#x7F51;&#x7EDC;&#xFF09;<br>Service Discovery (<code>etcd</code>, <code>consul</code>, <code>zookeeper</code>)<br>TLS<br>multi-tenancy</p>
<h1 id="xin-ban-ben-te-dian"><a href="#&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9;" class="headerlink" title="&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9;"></a>&#x65B0;&#x7248;&#x672C;&#x7279;&#x70B9; <a href="#xin-ban-ben-te-dian" class="header-anchor">#</a></h1><p>&#x6539;&#x8FDB;&#x8C03;&#x5EA6;&#x5668;&#x3001;&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x3001;&#x5377;&#x7BA1;&#x7406;&#x3001;&#x66F4;&#x597D;&#x7684;Compose&#x96C6;&#x6210;</p>
<p>1.1 &#x2192; container rebalancing, global scheduling</p>
<h1 id="duo-zhu-ji-wang-luo"><a href="#&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;" class="headerlink" title="&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;"></a>&#x591A;&#x4E3B;&#x673A;&#x7F51;&#x7EDC; <a href="#duo-zhu-ji-wang-luo" class="header-anchor">#</a></h1><p>DockerCon SF 2015 June &#x53D1;&#x5E03;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x7A33;&#x5B9A;&#x4E86;</p>
<p>&#x5141;&#x8BB8;&#x4F7F;&#x7528; <code>vxlan</code> &#x521B;&#x5EFA; <code>overlay</code> &#x7F51;&#x7EDC;</p>
<p>&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5230;&#x540C;&#x4E00;&#x4E2A;<code>overlay network</code>&#x7684;&#x4E3B;&#x673A;&#x90FD;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5BF9;&#x65B9;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BF9;&#x65B9;&#x540D;&#x5B57;&#x5B9A;&#x4F4D;&#x5230;&#x5BF9;&#x65B9;&#x3002;</p>
<h1 id="docker-network"><a href="#docker-network" class="headerlink" title="docker network"></a><code>docker network</code> <a href="#docker-network" class="header-anchor">#</a></h1><p>{<code>rm</code>, <code>create</code>, <code>connect</code>, <code>disconnect</code>, <code>inspect</code>, <code>ls</code>}</p>
<h1 id="demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo <a href="#demo" class="header-anchor">#</a></h1><p>&#x5728; GCE, Azure, EC2, 3&#x4E2A; Digital Ocean &#x603B;&#x5171;6&#x4E2A;&#x4E3B;&#x673A;</p>
<h2 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a><code>docker run</code> <a href="#docker-run" class="header-anchor">#</a></h2><p>&#x5148;&#x521B;&#x5EFA;<code>overlay</code>&#x7F51;&#x7EDC;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker network create <span class="_">-d</span> overlay overlay_test</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x5728;Swarm&#x4E0A;&#x8FD0;&#x884C;&#x4E09;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x90FD;&#x4F7F;&#x7528;overlay_test&#x7F51;&#x7EDC;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -it --name=app1 --net=overlay_test busybox</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x5728;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x90FD;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x540D;&#x5B57;<code>ping</code>&#x540C;&#x5BF9;&#x65B9;&#x3002;</p>
<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a><code>docker-compose</code> <a href="#docker-compose" class="header-anchor">#</a></h2><p><em>&#x8BE5;&#x7248;&#x672C;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>--x-networking</code> &#x6765;&#x542F;&#x7528;&#x5EFA;&#x7ACB;&#x7F51;&#x7EDC;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4E4B;&#x540E;&#x4E0D;&#x9700;&#x8981;&#x4E86;</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-compose --x-networking up <span class="_">-d</span></div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;demo&#x7684;python worker&#x4E2D;&#x6240;&#x5199;&#x7684;<code>redis</code>&#x4E3B;&#x673A;&#x540D;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x751F;&#x6210;&#x7684;&#x5BB9;&#x5668;&#x540D;&#xFF0C;<code>jobdoer_redis_1</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>&lt;&#x9879;&#x76EE;&#x540D;&gt;_&lt;&#x670D;&#x52A1;&#x540D;&gt;_&#x5E8F;&#x53F7;</code>&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x8FD9;&#x53EA;&#x662F;&#x94FE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x8981;&#x662F;redis&#x662F;&#x4E2A;&#x96C6;&#x7FA4;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x4F7F;&#x7528;<code>redis</code>&#x670D;&#x52A1;&#x540D;&#x5373;&#x53EF;&#x3002;</p>
<h2 id="juan-guan-li"><a href="#&#x5377;&#x7BA1;&#x7406;" class="headerlink" title="&#x5377;&#x7BA1;&#x7406;"></a>&#x5377;&#x7BA1;&#x7406; <a href="#juan-guan-li" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker volume {create, ls, inspect, rm}</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x9A71;&#x52A8;&#xFF0C;&#x6BD4;&#x5982;&#x4F7F;&#x7528;<code>Ceph</code>&#x96C6;&#x7FA4;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>Ceph</code>&#x4E0A;&#x7684;<code>volume</code>&#xFF0C;&#x7136;&#x540E;&#x5728;Docker&#x4E0A;&#x6302;&#x8F7D;&#x8FD9;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;<code>volume</code>&#x3002;</p>
<h1 id="swarm-machine-compose"><a href="#swarm-machine-compose" class="headerlink" title="swarm + machine + compose"></a><code>swarm</code> + <code>machine</code> + <code>compose</code> <a href="#swarm-machine-compose" class="header-anchor">#</a></h1>]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="http://blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：如何成功在生产环境中运行 Docker - John Fiedler</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-21-video-how-to-be-successful-running-docker-in-production.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-21-video-how-to-be-successful-running-docker-in-production.html</id>
    <published>2016-06-20T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#ding-yi-sheng-chan-huan-jing">&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883;</a></li>
<li><a href="#ding-yi-cheng-gong">&#x5B9A;&#x4E49;&#x6210;&#x529F;</a></li>
<li><a href="#fang-ru-rong-qi-de-dong-xi">&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A;</a></li>
<li><a href="#docker-hua-de-chang-jing">docker&#x5316;&#x7684;&#x573A;&#x666F;</a><ul>
<li><a href="#chuang-jian">&#x521B;&#x5EFA;</a></li>
<li><a href="#bu-shu">&#x90E8;&#x7F72;</a></li>
<li><a href="#yun-xing">&#x8FD0;&#x884C;</a></li>
<li><a href="#yun-wei">&#x8FD0;&#x7EF4;</a></li>
</ul>
</li>
<li><a href="#jing-yan">&#x7ECF;&#x9A8C;</a><ul>
<li><a href="#di-yi-ge-wen-ti">&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;</a></li>
<li><a href="#nei-he-ban-ben-hen-chong-yao">&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981;</a></li>
<li><a href="#zhao-ge-hao-de-registry">&#x627E;&#x4E2A;&#x597D;&#x7684;registry</a></li>
<li><a href="#zai-aws-bu-shu">&#x5728;AWS&#x90E8;&#x7F72;</a></li>
<li><a href="#mei-ge-zhu-ji-you-yue-shao-de-rong-qi-yue-hao">&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D;</a></li>
<li><a href="#ci-cd-with-docker">CI/CD with Docker</a></li>
<li><a href="#beanstalk-architecture">Beanstalk architecture</a></li>
<li><a href="#yi-nian-qian">&#x4E00;&#x5E74;&#x524D;</a></li>
</ul>
</li>
<li><a href="#zong-jie">&#x603B;&#x7ED3;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>How to be successful running Docker in Production<br>by John Fiedler<br>Senior Director of Engineering @ SalesforeceIQ</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/j6Ge4wP1yH0" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=j6Ge4wP1yH0" target="_blank" rel="external">https://www.youtube.com/watch?v=j6Ge4wP1yH0</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=f0314wy9h49&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/x/page/f0314wy9h49.html" target="_blank" rel="external">http://v.qq.com/x/page/f0314wy9h49.html</a></p>
<h1 id="ding-yi-sheng-chan-huan-jing"><a href="#&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883;" class="headerlink" title="&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883;"></a>&#x5B9A;&#x4E49;&#x751F;&#x4EA7;&#x73AF;&#x5883; <a href="#ding-yi-sheng-chan-huan-jing" class="header-anchor">#</a></h1><ul>
<li>Production != test dev</li>
<li>&#x8981;&#x8003;&#x8651;&#x9694;&#x79BB;&#x3001;&#x5B89;&#x5168;&#x3001;&#x6027;&#x80FD;&#x3001;&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x7B49;&#x7B49;</li>
<li>&#x8981;&#x6269;&#x5C55;&#x3001;&#x6A21;&#x677F;&#x3001;&#x81EA;&#x52A8;&#x5316;</li>
</ul>
<h1 id="ding-yi-cheng-gong"><a href="#&#x5B9A;&#x4E49;&#x6210;&#x529F;" class="headerlink" title="&#x5B9A;&#x4E49;&#x6210;&#x529F;"></a>&#x5B9A;&#x4E49;&#x6210;&#x529F; <a href="#ding-yi-cheng-gong" class="header-anchor">#</a></h1><ul>
<li><blockquote>
<p>99% uptime&#xFF1F;</p>
</blockquote>
</li>
<li>&#x5FEB;&#x901F;&#x4EE3;&#x7801;&#x90E8;&#x7F72;</li>
<li>0 &#x5B89;&#x5168;&#x4E8B;&#x4EF6;&#xFF1F;</li>
</ul>
<p>100% &#x7684;web infrastructure &#x4F7F;&#x7528;docker</p>
<h1 id="fang-ru-rong-qi-de-dong-xi"><a href="#&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A;" class="headerlink" title="&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A;"></a>&#x653E;&#x5165;&#x5BB9;&#x5668;&#x7684;&#x4E1C;&#x897F;&#xFF1A; <a href="#fang-ru-rong-qi-de-dong-xi" class="header-anchor">#</a></h1><ul>
<li><p>&#x8D8A;&#x591A;&#x4F9D;&#x8D56;&#x3001;&#x8D8A;&#x591A;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x5C31;&#x8D8A;&#x9002;&#x5408;</p>
<ul>
<li>&#x6BD4;&#x5982;Web&#x670D;&#x52A1;&#xFF0C;&#x5185;&#x5BB9;&#x7ED3;&#x6784;&#x4F1A;&#x7ECF;&#x5E38;&#x53D8;&#x5316;&#xFF0C;&#x800C;&#x4E14;&#x4F9D;&#x8D56;&#x975E;&#x5E38;&#x591A;&#xFF1B;</li>
<li>&#x800C;&#x6570;&#x636E;&#x5E93;&#x5219;&#x4E00;&#x65E6;&#x90E8;&#x7F72;&#x51E0;&#x5E74;&#x4E0D;&#x53D8;&#x52A8;&#xFF0C;&#x800C;&#x4E14;&#x4F9D;&#x8D56;&#x5F88;&#x5C11;&#xFF1B;</li>
</ul>
</li>
<li><p>&#x8D8A;&#x662F;&#x65E0;&#x72B6;&#x6001;(<code>stateless</code>)&#x3001;&#x8D8A;&#x77ED;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;</p>
</li>
</ul>
<h1 id="docker-hua-de-chang-jing"><a href="#docker&#x5316;&#x7684;&#x573A;&#x666F;" class="headerlink" title="docker&#x5316;&#x7684;&#x573A;&#x666F;"></a>docker&#x5316;&#x7684;&#x573A;&#x666F; <a href="#docker-hua-de-chang-jing" class="header-anchor">#</a></h1><h2 id="chuang-jian"><a href="#&#x521B;&#x5EFA;" class="headerlink" title="&#x521B;&#x5EFA;"></a>&#x521B;&#x5EFA; <a href="#chuang-jian" class="header-anchor">#</a></h2><ul>
<li>Dev/Ops&#x662F;&#x5B8C;&#x5168;Docker&#x5316;&#x7684;&#xFF1B;</li>
</ul>
<h2 id="bu-shu"><a href="#&#x90E8;&#x7F72;" class="headerlink" title="&#x90E8;&#x7F72;"></a>&#x90E8;&#x7F72; <a href="#bu-shu" class="header-anchor">#</a></h2><ul>
<li>CI/CD&#x662F;&#x90E8;&#x5206;Docker&#x5316;&#x7684;&#xFF1B;</li>
</ul>
<h2 id="yun-xing"><a href="#&#x8FD0;&#x884C;" class="headerlink" title="&#x8FD0;&#x884C;"></a>&#x8FD0;&#x884C; <a href="#yun-xing" class="header-anchor">#</a></h2><ul>
<li>Web&#x3001;&#x4E2D;&#x95F4;&#x4EF6;&#x3001;&#x4EFB;&#x52A1;&#x3001;&#x811A;&#x672C;&#x662F;&#x5B8C;&#x5168;Docker&#x5316;&#x7684;</li>
<li>&#x6279;&#x5904;&#x7406;&#x548C;&#x6D41;&#x5904;&#x7406;&#x662F;&#x90E8;&#x5206;Docker&#x5316;&#x7684;&#xFF1B;</li>
<li>&#x56FA;&#x5B9A;&#x5B58;&#x50A8;&#x5219;&#x4E0D;&#x662F;Docker&#x5316;&#x7684;&#x3002;</li>
</ul>
<h2 id="yun-wei"><a href="#&#x8FD0;&#x7EF4;" class="headerlink" title="&#x8FD0;&#x7EF4;"></a>&#x8FD0;&#x7EF4; <a href="#yun-wei" class="header-anchor">#</a></h2><ul>
<li>&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x3001;&#x5B89;&#x5168;&#x662F;&#x90E8;&#x5206;docker&#x5316;&#x7684;&#x3002;</li>
</ul>
<p>&#x66FE;&#x7ECF;&#x5C1D;&#x8BD5;&#x8FC7; Docker in Docker&#xFF0C;&#x4F46;&#x662F;&#x53D1;&#x73B0;&#x5F88;&#x60F3;&#x6269;&#x5C55;&#x80FD;&#x529B;&#x592A;&#x5DEE;&#x3002;</p>
<p>&#x73B0;&#x5728;70%&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5728;docker&#x91CC;&#x3002;</p>
<h1 id="jing-yan"><a href="#&#x7ECF;&#x9A8C;" class="headerlink" title="&#x7ECF;&#x9A8C;"></a>&#x7ECF;&#x9A8C; <a href="#jing-yan" class="header-anchor">#</a></h1><p>Docker &#x73B0;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7A33;&#x5B9A;&#x3002;&#x4F46;&#x662F;&#x5468;&#x8FB9;&#x7684;&#x5DE5;&#x5177;&#x4E0D;&#x4E00;&#x5B9A;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x53EF;&#x7528;&#xFF0C;&#x8981;&#x8C28;&#x614E;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x914D;&#x5408;docker&#x4F7F;&#x7528;<code>chef</code>, <code>ansible</code>, <code>saltstack</code>&#x7B49;&#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x4E00;&#x6837;&#x7528;&#xFF0C;&#x800C;&#x4E14;&#x914D;&#x5408;&#x7528;&#x8D77;&#x6765;&#x5F88;&#x597D;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x5728; AWS AMI &#x4E0A;&#x7528;<code>Chef</code>&#x6765;&#x8BBE;&#x7F6E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;web server&#xFF0C;&#x7528;<code>cron</code>&#x63A7;&#x5236;&#x811A;&#x672C;&#x6765;&#x7F16;&#x6392;&#x5BB9;&#x5668;&#x3002;</p>
<h2 id="di-yi-ge-wen-ti"><a href="#&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;" class="headerlink" title="&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;"></a>&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898; <a href="#di-yi-ge-wen-ti" class="header-anchor">#</a></h2><p>&#x4F60;&#x4E00;&#x5B9A;&#x4F1A;&#x78B0;&#x5230; disk/file system&#x95EE;&#x9898;</p>
<ul>
<li>&#x6700;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x7684; <code>aufs</code>&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5FEB;&#x5C31;&#x78B0;&#x5230;&#x4E86;42&#x5C42;&#x9650;&#x5236;</li>
<li>&#x7136;&#x540E;&#x6362;&#x5230;&#x4E86; <code>device mapper</code>&#xFF0C;&#x7ED3;&#x679C;&#x975E;&#x5E38;&#x60B2;&#x60E8;&#xFF0C;&#x56F4;&#x7ED5;&#x7740;<code>CentOS</code>&#x78B0;&#x5230;&#x4E86;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF1B;</li>
<li>&#x6362;&#x5230;ubuntu&#x597D;&#x4E00;&#x4E9B;&#xFF0C;&#x6362;&#x56DE; <code>aufs</code>&#xFF0C;&#x89E3;&#x9664;&#x4E86;42&#x5C42;&#x9650;&#x5236;&#xFF0C;&#x4F46;&#x8FD8;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x5206;&#x5C42;&#x3001;&#x7ED1;&#x5B9A;&#xFF1B;</li>
<li>&#x5347;&#x7EA7;&#x5230; <code>Docker 1.7</code> &#x540E;&#xFF0C;&#x6216;&#x8BB8;&#x4F1A;&#x6362;&#x56DE; CentOS &#x548C; Device mapper&#xFF0C;&#x56E0;&#x4E3A; dynamic binaries&#x3002;</li>
</ul>
<p>&#x63A8;&#x8350;&#x7406;&#x89E3;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x7684;&#x53EF;&#x89C6;&#x5316;&#x94FE;&#x63A5;&#xFF1A;<br><a href="http://merrigrove.blogspot.com/2015/10/visualizing-docker-containers-and-images.html?m=1" target="_blank" rel="external">http://merrigrove.blogspot.com/2015/10/visualizing-docker-containers-and-images.html?m=1</a></p>
<h2 id="nei-he-ban-ben-hen-chong-yao"><a href="#&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981;" class="headerlink" title="&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981;"></a>&#x5185;&#x6838;&#x7248;&#x672C;&#x5F88;&#x91CD;&#x8981; <a href="#nei-he-ban-ben-hen-chong-yao" class="header-anchor">#</a></h2><h2 id="zhao-ge-hao-de-registry"><a href="#&#x627E;&#x4E2A;&#x597D;&#x7684;registry" class="headerlink" title="&#x627E;&#x4E2A;&#x597D;&#x7684;registry"></a>&#x627E;&#x4E2A;&#x597D;&#x7684;registry <a href="#zhao-ge-hao-de-registry" class="header-anchor">#</a></h2><p>&#x6BD4;&#x5982;</p>
<ul>
<li><a href="https://hub.docker.com" target="_blank" rel="external">https://hub.docker.com</a></li>
<li><a href="https://quay.io" target="_blank" rel="external">https://quay.io</a></li>
<li>Docker Trusted Registry</li>
</ul>
<p>&#x6700;&#x5F00;&#x59CB;&#x5C1D;&#x8BD5;&#x4E86;<code>registry</code>&#xFF0C;&#x5F88;&#x591A;bug&#xFF0C;&#x5F88;&#x591A;fail pull/push<br>&#x7136;&#x540E;&#x5C1D;&#x8BD5;&#x4E86; <code>quay.io</code>&#xFF0C;happy&#x4F46;&#x662F;&#x5F88;&#x6162;(&#x6709;&#x4E9B;image&#x5F97;700&#x591A;MB)&#xFF0C;&#x800C;&#x4E14;&#x82B1;&#x94B1;&#x554A;&#x2026;&#x2026;<br>&#x540E;&#x6765;&#x53C8;&#x56DE;&#x5230;&#x4E86; <code>docker registry 0.9</code>&#xFF0C;&#x76EE;&#x524D;&#x7A33;&#x5B9A;&#x591A;&#x4E86;&#x3002;<br>&#x6A2A;&#x5411;&#x6269;&#x5C55;&#xFF0C;&#x975E;&#x5E38;&#x597D;&#xFF1B;<br>&#x76EE;&#x524D;&#x5728;&#x5347;&#x7EA7;&#x5230; <code>registry 2.1</code></p>
<h2 id="zai-aws-bu-shu"><a href="#&#x5728;AWS&#x90E8;&#x7F72;" class="headerlink" title="&#x5728;AWS&#x90E8;&#x7F72;"></a>&#x5728;AWS&#x90E8;&#x7F72; <a href="#zai-aws-bu-shu" class="header-anchor">#</a></h2><p>&#x7528;&#x7684;&#x662F;<code>Beanstalk</code>&#xFF0C; <code>ELB</code>&#x8FDB;&#x884C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#xFF0C;&#x4F7F;&#x7528;<code>Elasticcache(redis)</code>&#x505A;cache&#xFF0C;&#x7528;<code>S3</code>&#x505A;&#x5B58;&#x50A8;&#x3002;</p>
<h2 id="mei-ge-zhu-ji-you-yue-shao-de-rong-qi-yue-hao"><a href="#&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D;" class="headerlink" title="&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D;"></a>&#x6BCF;&#x4E2A;&#x4E3B;&#x673A;&#x6709;&#x8D8A;&#x5C11;&#x7684;&#x5BB9;&#x5668;&#x8D8A;&#x597D; <a href="#mei-ge-zhu-ji-you-yue-shao-de-rong-qi-yue-hao" class="header-anchor">#</a></h2><p>&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x5BB9;&#x5668;&#x7684;CPU, DISK IO&#xFF0C;&#x7F51;&#x7EDC;IO&#xFF0C;&#x5185;&#x5B58;&#x51FA;&#x73B0;&#x4E86;&#x4F7F;&#x7528;&#x5CF0;&#x503C;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x5BB9;&#x5668;&#x90FD;&#x4F1A;&#x88AB;&#x5E72;&#x6270;&#x3002;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</p>
<h2 id="ci-cd-with-docker"><a href="#CI-CD-with-Docker" class="headerlink" title="CI/CD with Docker"></a>CI/CD with Docker <a href="#ci-cd-with-docker" class="header-anchor">#</a></h2><p>huge ROI with docker</p>
<p>GitHub.com &#x2192; Teamcity &#x2192; agents &#x2192; Registry &#x2192; Server</p>
<p>&#x4ECE;&#x524D; agents &#x662F;&#x5728;docker&#x91CC;&#x7684;&#xFF0C;docker in docker&#xFF0C;&#x73B0;&#x5728;&#x662F;&#x4F7F;&#x7528;<code>chef</code>&#x548C;<code>packer</code>&#x3002;</p>
<p>&#x63A8;&#x8350;&#x6587;&#x7AE0;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x8981;&#x4F7F;&#x7528;Docker in docker&#xFF1A;<br><a href="https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/" target="_blank" rel="external">https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/</a></p>
<h2 id="beanstalk-architecture"><a href="#Beanstalk-architecture" class="headerlink" title="Beanstalk architecture"></a>Beanstalk architecture <a href="#beanstalk-architecture" class="header-anchor">#</a></h2><h2 id="yi-nian-qian"><a href="#&#x4E00;&#x5E74;&#x524D;" class="headerlink" title="&#x4E00;&#x5E74;&#x524D;"></a>&#x4E00;&#x5E74;&#x524D; <a href="#yi-nian-qian" class="header-anchor">#</a></h2><p>CoreOS&#x521A;&#x63A8;&#x51FA;&#xFF0C;&#x89C9;&#x5F97;&#x8D85;&#x9177;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x4E86;&#xFF0C;&#x7ED3;&#x679C;&#x5931;&#x8D25;&#x7684;&#x5F88;&#x60E8;</p>
<h1 id="zong-jie"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3; <a href="#zong-jie" class="header-anchor">#</a></h1><p>&#x521A;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x4F60;&#x719F;&#x6089;&#x7684;&#x5DE5;&#x5177;<br>&#x4F60;&#x9700;&#x8981;&#x8003;&#x8651;&#x6A2A;&#x5411;&#x6269;&#x5C55;<br>&#x5B89;&#x5168;&#x4E0D;&#x96BE;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x5B9A;&#x8981;&#x8003;&#x8651;<br>&#x8BB8;&#x591A;&#x8F6F;&#x4EF6;&#x4F9B;&#x5E94;&#x5546;&#x8FDB;&#x5165;&#x5230;&#x4E86;&#x5BB9;&#x5668;&#x9886;&#x57DF;<br>&#x5411; PaaS &#x7684;&#x65B9;&#x5411;&#x6784;&#x5EFA;<br>&#x8981;&#x77E5;&#x9053;&#x4F60;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-eu" scheme="http://blog.lab99.org/tags/dockercon15-eu/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线交流会 13 - 介绍 Machine, Swarm, Compose</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-21-video-docker-online-meetup-13-introducing-machine-swarm-compose.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-21-video-docker-online-meetup-13-introducing-machine-swarm-compose.html</id>
    <published>2016-06-19T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#docker-machine">Docker Machine</a></li>
<li><a href="#docker-compose">Docker Compose</a></li>
<li><a href="#docker-swarm">Docker Swarm</a></li>
<li><a href="#yan-shi">&#x6F14;&#x793A;</a></li>
</ul>
<!-- tocstop -->
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/H-fwxUeFZdQ" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=H-fwxUeFZdQ" target="_blank" rel="external">https://www.youtube.com/watch?v=H-fwxUeFZdQ</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=l03144vdr1m&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/page/l/1/m/l03144vdr1m.html" target="_blank" rel="external">http://v.qq.com/page/l/1/m/l03144vdr1m.html</a></p>
<h1 id="docker-machine"><a href="#Docker-Machine" class="headerlink" title="Docker Machine"></a>Docker Machine <a href="#docker-machine" class="header-anchor">#</a></h1><ul>
<li><code>docker-machine create -d virtualbox dev</code> &#x2192; &#x521B;&#x5EFA; virtualbox &#x865A;&#x62DF;&#x673A;&#x7684; docker host &#xFF0C;&#x547D;&#x540D;&#x4E3A; <code>dev</code></li>
<li><code>docker-machine ls</code> &#x2192; &#x5217;&#x51FA;&#x6240;&#x6709; docker-machine &#x5EFA;&#x7ACB;&#x7684;&#x4E3B;&#x673A;</li>
<li><code>eval $(docker-machine env dev)</code> &#x2192; &#x5F53;&#x524D;&#x73AF;&#x5883;&#x6362;&#x5230;&#x6307;&#x5B9A;&#x7684; docker host</li>
<li><code>docker ps</code> &#x2192; &#x8FD9;&#x6837;&#x5217;&#x51FA;&#x7684;&#x662F; <code>dev</code> &#x8FD9;&#x4E2A;&#x4E3B;&#x673A;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x8FD0;&#x884C;&#x5BB9;&#x5668;</li>
<li><code>docker-machine ssh dev</code> &#x2192; &#x8FDB;&#x5165;&#x8FD9;&#x4E2A; docker host&#x3002;</li>
</ul>
<h1 id="docker-compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose <a href="#docker-compose" class="header-anchor">#</a></h1><p>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x90FD;&#x5199;&#x5165; <code>docker-compose.yml</code></p>
<ul>
<li><code>docker-compose up -d</code> &#x2192; &#x6784;&#x5EFA;&#x3001;&#x542F;&#x52A8;&#x8FD9;&#x7EC4;&#x5BB9;&#x5668;</li>
<li><code>docker-compose ps</code> &#x2192; &#x5217;&#x51FA;&#x9879;&#x76EE;&#x5185;&#x7684;&#x5BB9;&#x5668;</li>
<li><code>docker-compose kill</code> &#x2192; &#x5220;&#x6389;&#x5BB9;&#x5668;</li>
<li><code>docker-compose run web python test.py</code> &#x2192; &#x6307;&#x5B9A;&#x8FD0;&#x884C;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x7684;&#x4E0D;&#x540C;&#x547D;&#x4EE4;&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x662F;&#x6D4B;&#x8BD5;&#x3002;</li>
</ul>
<h1 id="docker-swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm <a href="#docker-swarm" class="header-anchor">#</a></h1><p>docker swarm &#x662F; Docker host &#x96C6;&#x7FA4;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x7FA4;hosts&#x53D8;&#x6210;&#x4E00;&#x4E2A;docker host&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x8C03;&#x5EA6;&#x90E8;&#x7F72;&#x3002;</p>
<h1 id="yan-shi"><a href="#&#x6F14;&#x793A;" class="headerlink" title="&#x6F14;&#x793A;"></a>&#x6F14;&#x793A; <a href="#yan-shi" class="header-anchor">#</a></h1><p><code>docker run swarm create</code><br>&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;swarm id</p>
<p>&#x521B;&#x5EFA; swarm-master</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> digitalocean \</div><div class="line">    --swarm --swarm-master \</div><div class="line">    --swarm-discovery=token://xxxxx \</div><div class="line">    swarm-master</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;swarm&#x8282;&#x70B9;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> digitalocean \</div><div class="line">    --swarm \</div><div class="line">    --swarm-discovery=token://xxxxx \</div><div class="line">    swarm-01</div></pre></td></tr></table></figure>
<p>&#x7136;&#x540E;&#x628A;&#x73AF;&#x5883;&#x6362;&#x5230; swarm</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">eval</span> $(docker-machine env &#x2014;swarm swarm-master)</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837; <code>docker info</code>, <code>docker ps</code>, <code>docker run</code> &#x4E4B;&#x7C7B;&#x7684;&#x5C31;&#x662F;&#x76F4;&#x63A5;&#x5728;docker swarm&#x96C6;&#x7FA4;&#x4E0A;&#x8FD0;&#x884C;&#x4E86;&#x3002;</p>
<p>&#x800C;&#x4E14;&#x7531;&#x4E8E; <code>docker-compose</code> &#x4F7F;&#x7528;&#x7684;&#x662F;docker&#x6807;&#x51C6;API&#xFF0C;&#x6240;&#x4EE5;<code>docker-compose</code>&#x4F1A;&#x76F4;&#x63A5;&#x5728;swarm&#x4E0A;&#x6267;&#x884C;</p>
<p>&#x800C;&#x4E14;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>docker-compose scale worker=5</code> &#x6765;&#x6A2A;&#x5411;&#x6269;&#x5C55;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#docker-machine&quot;&gt;Docker Machine&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#docker-co
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="http://blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker Registry - Stephen Day</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-20-video-docker-registry-by-stephen-day.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-20-video-docker-registry-by-stephen-day.html</id>
    <published>2016-06-19T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-me-shi-docker">&#x4EC0;&#x4E48;&#x662F;Docker</a></li>
<li><a href="#li-shi">&#x5386;&#x53F2;</a></li>
<li><a href="#api-v1-de-wen-ti">API v1 &#x7684;&#x95EE;&#x9898;</a></li>
<li><a href="#api-v2-mu-biao">API v2 &#x76EE;&#x6807;</a><ul>
<li><a href="#v2-content-addressable">V2: Content Addressable</a></li>
<li><a href="#v2-manifests">V2: Manifests</a></li>
<li><a href="#content-addressable">Content-addressable</a></li>
<li><a href="#merkle-tree">Merkle Tree</a></li>
</ul>
</li>
<li><a href="#he-v1-api-bu-tong-de-di-fang">&#x548C;v1 API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;</a></li>
<li><a href="#docker-registry-2-0-gou-cheng">Docker Registry 2.0 &#x6784;&#x6210;</a></li>
<li><a href="#docker-registry-2-1">Docker Registry 2.1</a></li>
<li><a href="#docker-distribution">Docker Distribution</a></li>
</ul>
<!-- tocstop -->
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/RnO9JnEO8tY" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=RnO9JnEO8tY" target="_blank" rel="external">https://www.youtube.com/watch?v=RnO9JnEO8tY</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0314thmzhe&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/page/b/h/e/b0314thmzhe.html" target="_blank" rel="external">http://v.qq.com/page/b/h/e/b0314thmzhe.html</a></p>
<h1 id="shi-me-shi-docker"><a href="#&#x4EC0;&#x4E48;&#x662F;Docker" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;Docker"></a>&#x4EC0;&#x4E48;&#x662F;Docker <a href="#shi-me-shi-docker" class="header-anchor">#</a></h1><p>Container &#x662F; docker &#x7684;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x7531; image &#x521B;&#x5EFA;<br>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x6709;&#x591A;&#x4E2A;&#x5C42;&#x7EC4;&#x6210;&#xFF0C;&#x6BCF;&#x5C42;&#x53EA;&#x662F;&#x4E2A;tar&#x6587;&#x4EF6;&#x3002;&#x5C42;&#x53EF;&#x4EE5;&#x7531;&#x4E0D;&#x540C;&#x7684;image&#x5171;&#x4EAB;&#x3002;</p>
<p>&#x628A;&#x591A;&#x4E2A;&#x5C42;&#x653E;&#x5230;&#x4E00;&#x8D77;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x63CF;&#x8FF0;&#x5982;&#x4F55;&#x7EC4;&#x7EC7;&#x8FD9;&#x4E9B;&#x5C42;&#xFF0C;&#x5C31;&#x6210;&#x4E86;&#x955C;&#x50CF;&#x3002;</p>
<h1 id="li-shi"><a href="#&#x5386;&#x53F2;" class="headerlink" title="&#x5386;&#x53F2;"></a>&#x5386;&#x53F2; <a href="#li-shi" class="header-anchor">#</a></h1><p>Docker Registry API v1<br>&#x9762;&#x5411;&#x5C42;&#x7684;<br>&#x5C42;id&#x662F;&#x968F;&#x673A;&#x5206;&#x914D;&#x7684;<br>&#x4E00;&#x4E2A;JSON&#x8D1F;&#x8D23;&#x4E00;&#x4E2A;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x6307;&#x5411;&#x7236;&#x5C42;<br>&#x547D;&#x540D;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x9760;tag</p>
<h1 id="api-v1-de-wen-ti"><a href="#API-v1-&#x7684;&#x95EE;&#x9898;" class="headerlink" title="API v1 &#x7684;&#x95EE;&#x9898;"></a>API v1 &#x7684;&#x95EE;&#x9898; <a href="#api-v1-de-wen-ti" class="header-anchor">#</a></h1><ul>
<li>Abstraction &#x2192; &#x66B4;&#x9732;image&#x53D1;&#x5E03;&#x673A;&#x5236;&#xFF0C;&#x66B4;&#x9732;&#x5185;&#x90E8;&#x591A;&#x5C42;</li>
<li>Security &#x2192; Image ID &#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x79D8;&#x5BC6;&#xFF0C;&#x6CA1;&#x6709;&#x5BA1;&#x8BA1;&#x3001;&#x9A8C;&#x8BC1;&#xFF0C;&#x800C;&#x4E14;&#x8C01;&#x5206;&#x914D; layer id&#xFF1F;</li>
<li>Performance &#x2192; &#x6027;&#x80FD;&#x5F88;&#x6162;&#xFF0C;&#x53D6;&#x5F53;&#x524D;&#x5C42;&#xFF0C;&#x7136;&#x540E;&#x53D6;&#x7236;&#x5C42;&#xFF0C;&#x4E00;&#x6B65;&#x6B65;&#x5411;&#x4E0A;&#xFF0C;&#x65E0;&#x6CD5;&#x5E76;&#x884C;&#x3002;</li>
<li>&#x7528;Python&#x5B9E;&#x73B0; &#x2192; &#x4E0D;&#x6613;&#x4E8E;&#x90E8;&#x7F72;</li>
</ul>
<h1 id="api-v2-mu-biao"><a href="#API-v2-&#x76EE;&#x6807;" class="headerlink" title="API v2 &#x76EE;&#x6807;"></a>API v2 &#x76EE;&#x6807; <a href="#api-v2-mu-biao" class="header-anchor">#</a></h1><ul>
<li>&#x7B80;&#x5355;&#xFF1A;&#x6613;&#x4E8E;&#x90E8;&#x7F72;&#xFF0C;&#x9002;&#x4E8E;&#x9759;&#x6001;&#x4E3B;&#x673A;</li>
<li>&#x5B89;&#x5168;&#xFF1A;Image &#x53EF;&#x4EE5;&#x88AB;&#x9A8C;&#x8BC1;</li>
<li>&#x5206;&#x5E03;&#x5F0F;&#xFF1A;&#x5206;&#x79BB;&#x547D;&#x540D;&#x548C;&#x5185;&#x5BB9;&#x5730;&#x5740;</li>
<li>&#x6027;&#x80FD;&#xFF1A;&#x907F;&#x514D;&#x5355;&#x7EBF;&#x7A0B;&#x5904;&#x7406;</li>
<li>&#x5B9E;&#x73B0;&#xFF1A;&#x91C7;&#x7528; Go &#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x66F4;&#x591A;&#x7684;Docker Engine&#x7684;&#x4EE3;&#x7801;</li>
</ul>
<h2 id="v2-content-addressable"><a href="#V2-Content-Addressable" class="headerlink" title="V2: Content Addressable"></a>V2: Content Addressable <a href="#v2-content-addressable" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528;SHA256&#xFF0C;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x8BE5;&#x5C42;&#x53EF;&#x4EE5;&#x4ECE;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#x4E0B;&#x8F7D;&#xFF0C;&#x800C;&#x4E14;&#x786E;&#x4FDD;&#x5185;&#x5BB9;&#x4E00;&#x81F4;</p>
<h2 id="v2-manifests"><a href="#V2-Manifests" class="headerlink" title="V2: Manifests"></a>V2: Manifests <a href="#v2-manifests" class="header-anchor">#</a></h2><p>&#x63CF;&#x8FF0;&#x4E00;&#x4E2A;image&#x7684;&#x5404;&#x4E2A;&#x5C42;&#x7EC4;&#x4EF6;&#xFF0C;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#x5305;&#x542B;&#x6240;&#x6709;&#x4E1C;&#x897F;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">   &quot;name&quot;: &lt;name&gt;,</div><div class="line">   &quot;tag&quot;: &lt;tag&gt;,</div><div class="line">   &quot;fsLayers&quot;: [{&#x2026;}],</div><div class="line">    &#x2026;</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="content-addressable"><a href="#Content-addressable" class="headerlink" title="Content-addressable"></a>Content-addressable <a href="#content-addressable" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull ubuntu@sha256:xxxxxxxx</div></pre></td></tr></table></figure>
<h2 id="merkle-tree"><a href="#Merkle-Tree" class="headerlink" title="Merkle Tree"></a>Merkle Tree <a href="#merkle-tree" class="header-anchor">#</a></h2><p>&#x5229;&#x7528; Merkle Tree &#x6765;&#x7B7E;&#x540D;&#x5404;&#x4E2A;&#x5C42;&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x5404;&#x5C42;&#x5B8C;&#x6574;&#x6027;&#x3002;&#xFF08;&#x5F53;&#x5E74;&#x5728;&#x5927;&#x5B66;&#x7684;Advanced Computer Security&#x4E2D;&#x505A;&#x7684;presentation&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#xFF09;</p>
<p>&#x73B0;&#x5728;&#x6240;&#x6709;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x5C5E;&#x4E8E; named repository &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;image id&#x4E0D;&#x518D;&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x79D8;&#x5BC6;&#xFF1B;</p>
<p>&#x7B80;&#x5316;&#x8BA4;&#x8BC1;&#x6A21;&#x578B;&#xFF0C;&#x64CD;&#x4F5C;&#x7B80;&#x5316;&#x4E3A;push, pull&#xFF1B;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x63D0;&#x4F9B;&#x5185;&#x5BB9;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;repository&#x6765;&#x8BC1;&#x660E;&#x5185;&#x5BB9;&#x662F;&#x53EF;&#x7528;&#x7684;&#xFF0C;&#x4ECE;&#x800C;&#x8BC1;&#x660E;&#x81EA;&#x5DF1;&#x786E;&#x5B9E;&#x62E5;&#x6709;&#x5176;&#x5185;&#x5BB9;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x63D0;&#x4F9B;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;repository&#x800C;&#x53D6;&#x5F97;&#x4E0D;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;layer&#x3002;</p>
<p>v2&#x653E;&#x5F00;&#x4E86;&#x4E24;&#x90E8;&#x5206;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x9650;&#x5236;&#x4E8E; <code>&lt;user&gt;/&lt;image&gt;</code> &#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x591A;&#x5C42;&#x3002;</p>
<p>push/pull &#x5C06;&#x53EF;&#x4EE5;&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#xFF0C;&#x5C1A;&#x672A;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x8FC7;&#x5B9A;&#x4E49;&#x5728;api&#x4E86;&#x3002;</p>
<h1 id="he-v1-api-bu-tong-de-di-fang"><a href="#&#x548C;v1-API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;" class="headerlink" title="&#x548C;v1 API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;"></a>&#x548C;v1 API&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9; <a href="#he-v1-api-bu-tong-de-di-fang" class="header-anchor">#</a></h1><p>&#x591A;&#x6B65;&#x4E0A;&#x4F20;&#xFF1B;</p>
<p>&#x6CA1;&#x6709;Search API&#x3001;&#x6CA1;&#x6709;&#x663E;&#x5F0F;&#x7684;Tag API&#x3002;&#x8FD8;&#x5728;&#x601D;&#x8003;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x3002;</p>
<h1 id="docker-registry-2-0-gou-cheng"><a href="#Docker-Registry-2-0-&#x6784;&#x6210;" class="headerlink" title="Docker Registry 2.0 &#x6784;&#x6210;"></a>Docker Registry 2.0 &#x6784;&#x6210; <a href="#docker-registry-2-0-gou-cheng" class="header-anchor">#</a></h1><p>&#x4E0D;&#x5728;&#x4F7F;&#x7528; monolithic &#x6784;&#x67B6;</p>
<p>&#x53EF;&#x6269;&#x5C55;&#x7684;&#xFF0C;&#x8BA4;&#x8BC1;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#x3001;&#x7D22;&#x5F15;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#xFF0C;</p>
<p>&#x4F1A;&#x5728; Docker 1.6 &#x5F00;&#x59CB;&#x5B8C;&#x5168;&#x652F;&#x6301;&#xFF1B;</p>
<p>&#x5927;&#x591A;&#x6570;&#x6982;&#x5FF5;&#x90FD;&#x5DF2;&#x7ECF;&#x5728; 1.3&#x3001;1.4 &#x4E2D;&#x9A8C;&#x8BC1;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x66F4;&#x5FEB;&#x7684; pull &#x7684;&#x901F;&#x5EA6;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x5728; Hub &#x4E0A;&#x8FD0;&#x884C;&#xFF0C;S3 &#x5B58;&#x50A8;&#x540E;&#x7AEF;&#x3002;</p>
<p>&#x5BF9;&#x6BD4; v1</p>
<p>&#x5C11;&#x4E86; 80% &#x7684;Request<br>&#x5C11;&#x4E86; 60% &#x7684;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;</p>
<p>V1 vs V2 &#x9519;&#x8BEF;&#xFF0C;V2&#x9519;&#x8BEF;&#x5C11;&#x4E86;&#x5F88;&#x591A;&#x3002;</p>
<h1 id="docker-registry-2-1"><a href="#Docker-Registry-2-1" class="headerlink" title="Docker Registry 2.1"></a>Docker Registry 2.1 <a href="#docker-registry-2-1" class="header-anchor">#</a></h1><p>&#x6587;&#x6863;&#x3001;Pull through caching&#x3001;&#x8F6F;&#x5220;&#x9664;&#x3001;&#x57FA;&#x672C;&#x8BA4;&#x8BC1;&#x3001;Catalog API&#x3001;Storage Driver&#xFF0C;2015&#x5E74;7&#x6708;&#x4E2D;&#x65EC;&#x53D1;&#x5E03;&#x3002;</p>
<h1 id="docker-distribution"><a href="#Docker-Distribution" class="headerlink" title="Docker Distribution"></a>Docker Distribution <a href="#docker-distribution" class="header-anchor">#</a></h1><p>&#x76EE;&#x7684;&#xFF1A;</p>
<ul>
<li>&#x6539;&#x8FDB;image&#x5206;&#x53D1;</li>
<li>&#x6784;&#x5EFA;&#x5B89;&#x5168;&#x7A33;&#x56FA;&#x7684;&#x57FA;&#x7840;</li>
</ul>
<p>&#x5173;&#x6CE8;&#x7684;&#x7126;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x5B89;&#x5168;&#x3001;&#x53EF;&#x9760;&#x3001;&#x6027;&#x80FD;</li>
</ul>
<p>&#x91CA;&#x653E;&#x65B0;&#x7684;&#x5206;&#x53D1;&#x6A21;&#x578B;</p>
<ul>
<li>&#x96C6;&#x6210;&#x4FE1;&#x4EFB;&#x7CFB;&#x7EDF;(notary)</li>
<li>&#x70B9;&#x5BF9;&#x70B9;&#x5927;&#x89C4;&#x6A21;&#x5206;&#x53D1;</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-me-shi-docker&quot;&gt;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;Docker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="dockercon15-sf" scheme="http://blog.lab99.org/tags/dockercon15-sf/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 在线交流会 39 - Docker 安全 - Nathan McCauley</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-19-video-docker-online-meetup-39-docker-security.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-19-video-docker-online-meetup-39-docker-security.html</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#an-quan-sao-miao">&#x5B89;&#x5168;&#x626B;&#x63CF;</a></li>
<li><a href="#an-quan-ping-tai-nei-rong-fang-wen-kong-zhi">&#x5B89;&#x5168;&#x5E73;&#x53F0; + &#x5185;&#x5BB9; + &#x8BBF;&#x95EE;&#x63A7;&#x5236;</a><ul>
<li><a href="#docker-bench">Docker Bench</a></li>
<li><a href="#docker-security">Docker Security</a></li>
<li><a href="#secure-content">Secure Content</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Docker Online Meetup - 39 - Docker Security<br>by Nathan McCauley, Director Security<br>2016-05-26</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/Zotjwkg9gq8" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=Zotjwkg9gq8" target="_blank" rel="external">https://www.youtube.com/watch?v=Zotjwkg9gq8</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=p03145sky9y&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/page/o/8/j/p03145sky9y.html" target="_blank" rel="external">http://v.qq.com/page/o/8/j/p03145sky9y.html</a></p>
<h1 id="an-quan-sao-miao"><a href="#&#x5B89;&#x5168;&#x626B;&#x63CF;" class="headerlink" title="&#x5B89;&#x5168;&#x626B;&#x63CF;"></a>&#x5B89;&#x5168;&#x626B;&#x63CF; <a href="#an-quan-sao-miao" class="header-anchor">#</a></h1><p>&#x8FC7;&#x53BB; 6 &#x4E2A;&#x6708;&#x4E2D;&#xFF0C;&#x6709; 400M &#x4E2A;pull</p>
<h1 id="an-quan-ping-tai-nei-rong-fang-wen-kong-zhi"><a href="#&#x5B89;&#x5168;&#x5E73;&#x53F0;-&#x5185;&#x5BB9;-&#x8BBF;&#x95EE;&#x63A7;&#x5236;" class="headerlink" title="&#x5B89;&#x5168;&#x5E73;&#x53F0; + &#x5185;&#x5BB9; + &#x8BBF;&#x95EE;&#x63A7;&#x5236;"></a>&#x5B89;&#x5168;&#x5E73;&#x53F0; + &#x5185;&#x5BB9; + &#x8BBF;&#x95EE;&#x63A7;&#x5236; <a href="#an-quan-ping-tai-nei-rong-fang-wen-kong-zhi" class="header-anchor">#</a></h1><p>&#x9ED8;&#x8BA4;&#x5B89;&#x5168;</p>
<ol>
<li>&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x8981;&#x4FDD;&#x8BC1;&#x5B89;&#x5168;</li>
<li>&#x7EC6;&#x7C92;&#x5EA6;&#x63A7;&#x5236;</li>
</ol>
<h2 id="docker-bench"><a href="#Docker-Bench" class="headerlink" title="Docker Bench"></a>Docker Bench <a href="#docker-bench" class="header-anchor">#</a></h2><p>&#x786E;&#x4FDD;&#x5B89;&#x5168;&#x7684;&#x4E3B;&#x673A;&#x914D;&#x7F6E;</p>
<h2 id="docker-security"><a href="#Docker-Security" class="headerlink" title="Docker Security"></a>Docker Security <a href="#docker-security" class="header-anchor">#</a></h2><p>&#x68C0;&#x67E5;&#x6D89;&#x53CA; CVE &#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5B89;&#x5168;&#x6027;</p>
<h2 id="secure-content"><a href="#Secure-Content" class="headerlink" title="Secure Content"></a>Secure Content <a href="#secure-content" class="header-anchor">#</a></h2><p>&#x5185;&#x5BB9;&#x7B7E;&#x540D; + &#x5B89;&#x5168;&#x626B;&#x63CF;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
      <category term="meetup" scheme="http://blog.lab99.org/tags/meetup/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：使用 Node.js 和 Docker 构建微服务 - 第2讲 - Raziel Tabib</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-2.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-2.html</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#gou-jian-dockerfile">&#x6784;&#x5EFA; <code>Dockerfile</code></a><ul>
<li><a href="#mo-ren-ming-wei-dockerfile">&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A; <code>Dockerfile</code></a></li>
<li><a href="#gou-jian">&#x6784;&#x5EFA;</a></li>
<li><a href="#gou-jian-huan-cun-ji-zhi">&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236;</a></li>
<li><a href="#dockerfile-ying-dang-jin-ru-ban-ben-kong-zhi-de-repo-li">Dockerfile &#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684; repo &#x91CC;</a></li>
<li><a href="#huan-cun-ji-zhi-dui-npm-install-de-ying-xiang">&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9; <code>npm install</code> &#x7684;&#x5F71;&#x54CD;</a></li>
<li><a href="#chuang-jian-digital-ocean-de-docker-zhu-ji">&#x521B;&#x5EFA; Digital Ocean &#x7684; Docker &#x4E3B;&#x673A;</a></li>
<li><a href="#jiang-jing-xiang-fang-dao-zhu-ji-shang">&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A;</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Building a Microservice using Node.js and Docker #2<br>by Raziel Tabib<br>2015-08-15</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/lss2rZ3Ppuk" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=lss2rZ3Ppuk" target="_blank" rel="external">https://www.youtube.com/watch?v=lss2rZ3Ppuk</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=b0315jimm4y&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/page/o/8/j/b0315jimm4y.html" target="_blank" rel="external">http://v.qq.com/page/o/8/j/b0315jimm4y.html</a></p>
<ul>
<li><code>Dockerfile</code></li>
<li><code>Images</code></li>
<li><code>Container</code></li>
<li><code>Daemon</code></li>
<li><code>Client</code></li>
<li><code>Hub</code></li>
</ul>
<h1 id="gou-jian-dockerfile"><a href="#&#x6784;&#x5EFA;-Dockerfile" class="headerlink" title="&#x6784;&#x5EFA; Dockerfile"></a>&#x6784;&#x5EFA; <code>Dockerfile</code> <a href="#gou-jian-dockerfile" class="header-anchor">#</a></h1><h2 id="mo-ren-ming-wei-dockerfile"><a href="#&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A;-Dockerfile" class="headerlink" title="&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A; Dockerfile"></a>&#x9ED8;&#x8BA4;&#x540D;&#x4E3A;&#xFF1A; <code>Dockerfile</code> <a href="#mo-ren-ming-wei-dockerfile" class="header-anchor">#</a></h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> ubuntu:latest</div><div class="line"><span class="keyword">MAINTAINER</span> &#x59D3;&#x540D; &lt;&#x90AE;&#x4EF6;&#x5730;&#x5740;&gt;</div><div class="line"></div><div class="line"><span class="keyword">RUN</span><span class="bash"> ...</span></div></pre></td></tr></table></figure>
<h2 id="gou-jian"><a href="#&#x6784;&#x5EFA;" class="headerlink" title="&#x6784;&#x5EFA;"></a>&#x6784;&#x5EFA; <a href="#gou-jian" class="header-anchor">#</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t nodejs:0.1 .</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;&#x6700;&#x540E;&#x7684; <code>.</code>&#xFF0C;&#x8FD9;&#x662F;&#x4E0A;&#x4E0B;&#x6587;(context)&#x7684;&#x610F;&#x601D;&#xFF0C;&#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x5305;&#x542B;&#x7684;&#x662F;&#x6784;&#x5EFA;&#x6240;&#x9700;&#x7684;&#x6700;&#x5C0F;&#x5185;&#x5BB9;&#x3002;</p>
<h2 id="gou-jian-huan-cun-ji-zhi"><a href="#&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236;" class="headerlink" title="&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236;"></a>&#x6784;&#x5EFA;&#x7F13;&#x5B58;&#x673A;&#x5236; <a href="#gou-jian-huan-cun-ji-zhi" class="header-anchor">#</a></h2><ul>
<li>&#x5982;&#x679C;&#x5B58;&#x5728;&#x8BE5;&#x5C42;&#xFF0C;&#x5219;&#x7528;&#x7F13;&#x5B58;&#xFF0C;&#x6CA1;&#x6709;&#x5C31; rebuild</li>
<li>&#x5982;&#x679C;&#x67D0;&#x4E00;&#x5C42;&#x9700;&#x8981; rebuild&#xFF0C;&#x5176;&#x540E;&#x7684;&#x6240;&#x6709;&#x5C42;&#x90FD;&#x9700;&#x8981; rebuild</li>
<li><code>COPY</code>/<code>ADD</code> &#x4F1A;&#x68C0;&#x67E5;&#x5BF9;&#x5E94;&#x6587;&#x4EF6;&#x7684;&#x6821;&#x9A8C;&#x503C;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x6539;&#x53D8;&#xFF0C;&#x6821;&#x9A8C;&#x503C;&#x5373;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x6539;&#x53D8;&#x5C31;&#x4F1A; rebuild</li>
<li>&#x5176;&#x5B83;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x770B;&#x547D;&#x4EE4;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x5426;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x800C;&#x4E0D;&#x53BB;&#x67E5;&#x770B;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x53D8;&#x5316;&#x3002;&#xFF08;<strong>&#x8FD9;&#x70B9;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x6BD4;&#x5982; apt-get update&#xFF0C;&#x5176;&#x5B9E;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x56E0;&#x4E3A;&#x5176;&#x547D;&#x4EE4;&#x6CA1;&#x53D8;&#x5316;&#xFF0C;&#x5C31;&#x4E0D;&#x518D; rebuild &#x4E86;</strong>&#xFF09;</li>
</ul>
<h2 id="dockerfile-ying-dang-jin-ru-ban-ben-kong-zhi-de-repo-li"><a href="#Dockerfile-&#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684;-repo-&#x91CC;" class="headerlink" title="Dockerfile &#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684; repo &#x91CC;"></a>Dockerfile &#x5E94;&#x5F53;&#x8FDB;&#x5165;&#x7248;&#x672C;&#x63A7;&#x5236;&#x7684; repo &#x91CC; <a href="#dockerfile-ying-dang-jin-ru-ban-ben-kong-zhi-de-repo-li" class="header-anchor">#</a></h2><p>&#x8FD9;&#x6837;&#x955C;&#x50CF;&#x5BF9;&#x5E94;&#x7684;Dockerfile&#x4E5F;&#x4F1A;&#x5728;&#x7248;&#x672C;&#x63A7;&#x5236;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x67E5;&#x770B;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x53D8;&#x52A8;&#x60C5;&#x51B5;&#xFF0C;&#x4EE5;&#x53CA;&#x4FEE;&#x6B63;&#x539F;&#x56E0;&#x3002;</p>
<h2 id="huan-cun-ji-zhi-dui-npm-install-de-ying-xiang"><a href="#&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9;-npm-install-&#x7684;&#x5F71;&#x54CD;" class="headerlink" title="&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9; npm install &#x7684;&#x5F71;&#x54CD;"></a>&#x7F13;&#x5B58;&#x673A;&#x5236;&#x5BF9; <code>npm install</code> &#x7684;&#x5F71;&#x54CD; <a href="#huan-cun-ji-zhi-dui-npm-install-de-ying-xiang" class="header-anchor">#</a></h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">COPY</span><span class="bash"> . /src/</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></div></pre></td></tr></table></figure>
<p>&#x5982;&#x679C;&#x50CF;&#x8FD9;&#x6837;&#xFF0C;&#x5C06; <code>COPY</code> &#x7F6E;&#x4E8E; <code>RUN</code> &#x4E4B;&#x524D;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#xFF0C;&#x6BCF;&#x4E00;&#x6B21;&#x4EE3;&#x7801;&#x7684;&#x53D8;&#x52A8;&#xFF0C;&#x90FD;&#x4F1A;&#x89E6;&#x53D1; <code>npm install</code> &#x8FD9;&#x4E00;&#x5C42;&#x7684; rebuild&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x4F1A;&#x91CD;&#x590D;&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x3002;&#x56E0;&#x6B64;&#x6548;&#x7387;&#x5F88;&#x5DEE;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">COPY</span><span class="bash"> ./package.json /src/</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></div><div class="line"><span class="keyword">COPY</span><span class="bash"> . /src/</span></div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x5206;&#x4E3A;3&#x5C42;&#xFF0C;&#x53EA;&#x6709; <code>package.json</code> &#x53D8;&#x5316;&#xFF0C;&#x624D;&#x4F1A;&#x89E6;&#x53D1; <code>npm install</code>&#xFF0C;&#x800C; <code>/src</code> &#x4E2D;&#x7684;&#x5176;&#x5B83;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x5219;&#x53EA;&#x4F1A;&#x89E6;&#x53D1;&#x6700;&#x540E;&#x4E00;&#x5C42;&#x3002;</p>
<h2 id="chuang-jian-digital-ocean-de-docker-zhu-ji"><a href="#&#x521B;&#x5EFA;-Digital-Ocean-&#x7684;-Docker-&#x4E3B;&#x673A;" class="headerlink" title="&#x521B;&#x5EFA; Digital Ocean &#x7684; Docker &#x4E3B;&#x673A;"></a>&#x521B;&#x5EFA; Digital Ocean &#x7684; Docker &#x4E3B;&#x673A; <a href="#chuang-jian-digital-ocean-de-docker-zhu-ji" class="header-anchor">#</a></h2><p>&#x4F7F;&#x7528; <code>docker-machine</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker-machine create <span class="_">-d</span> digitalocean server</div></pre></td></tr></table></figure>
<h2 id="jiang-jing-xiang-fang-dao-zhu-ji-shang"><a href="#&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A;" class="headerlink" title="&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A;"></a>&#x5C06;&#x955C;&#x50CF;&#x653E;&#x5230;&#x4E3B;&#x673A;&#x4E0A; <a href="#jiang-jing-xiang-fang-dao-zhu-ji-shang" class="header-anchor">#</a></h2><p><strong>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>save</code>/<code>load</code>&#xFF0C;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x65B9;&#x6CD5;&#x5E94;&#x8BE5;&#x662F; <code>push</code> &#x5230; registry &#x4E0A;&#x3002;</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x5148;&#x4FDD;&#x5B58;&#x955C;&#x50CF;</span></div><div class="line">$ docker save -o &#x6587;&#x4EF6;&#x540D; &#x955C;&#x50CF;&#x540D;:tag</div><div class="line"></div><div class="line"><span class="comment"># &#x4F7F;&#x7528; Digital Ocean &#x7684; Docker &#x73AF;&#x5883;</span></div><div class="line">$ <span class="built_in">eval</span> $(docker-mahine env server)</div><div class="line"></div><div class="line"><span class="comment"># &#x52A0;&#x8F7D;&#x8BE5;&#x955C;&#x50CF;</span></div><div class="line">$ docker load -i &#x955C;&#x50CF;&#x6587;&#x4EF6;&#x540D;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="node.js" scheme="http://blog.lab99.org/tags/node-js/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：使用 Node.js 和 Docker 构建微服务 - 第1讲 - Raziel Tabib</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-1.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-19-video-building-a-microservice-using-node-js-and-docker-part-1.html</id>
    <published>2016-06-18T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#shi-pin-xin-xi">&#x89C6;&#x9891;&#x4FE1;&#x606F;</a></li>
<li><a href="#bu-zou">&#x6B65;&#x9AA4;</a></li>
<li><a href="#chuang-jian-ji-chu-jing-xiang">&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;</a></li>
<li><a href="#chuang-jian-express-js-wei-fu-wu">&#x521B;&#x5EFA; Express.js &#x5FAE;&#x670D;&#x52A1;</a></li>
</ul>
<!-- tocstop -->
<h1 id="shi-pin-xin-xi"><a href="#&#x89C6;&#x9891;&#x4FE1;&#x606F;" class="headerlink" title="&#x89C6;&#x9891;&#x4FE1;&#x606F;"></a>&#x89C6;&#x9891;&#x4FE1;&#x606F; <a href="#shi-pin-xin-xi" class="header-anchor">#</a></h1><p>Building a Microservice using Node.js and Docker #1<br>by Raziel Tabib<br>2015-07-15</p>
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/PJ95WY2DqXo" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=PJ95WY2DqXo" target="_blank" rel="external">https://www.youtube.com/watch?v=PJ95WY2DqXo</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=x031573jtih&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/page/o/8/j/x031573jtih.html" target="_blank" rel="external">http://v.qq.com/page/o/8/j/x031573jtih.html</a></p>
<h1 id="bu-zou"><a href="#&#x6B65;&#x9AA4;" class="headerlink" title="&#x6B65;&#x9AA4;"></a>&#x6B65;&#x9AA4; <a href="#bu-zou" class="header-anchor">#</a></h1><ol>
<li>&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;&#xFF1A; Ubuntu + Node.js</li>
<li>&#x521B;&#x5EFA;&#x5FAE;&#x670D;&#x52A1;&#x955C;&#x50CF;&#xFF1A; Base Image + Service</li>
</ol>
<p>(<strong>&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x5E74;&#x591A;&#x524D;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#x5236;&#x4F5C;&#x529E;&#x6CD5;&#xFF0C;&#x4E0D;&#x63A8;&#x8350;&#xFF0C;&#x73B0;&#x5728;&#x90FD;&#x7528; Dockerfile&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x6A21;&#x4EFF;</strong>)</p>
<h1 id="chuang-jian-ji-chu-jing-xiang"><a href="#&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;" class="headerlink" title="&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF;"></a>&#x521B;&#x5EFA;&#x57FA;&#x7840;&#x955C;&#x50CF; <a href="#chuang-jian-ji-chu-jing-xiang" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x5565;&#x672C;&#x5730;&#x955C;&#x50CF;</span></div><div class="line">$ docker images</div><div class="line"></div><div class="line"><span class="comment"># &#x5230; Docker Hub &#x4E0A;&#x641C;&#x7D22; Ubuntu image</span></div><div class="line">$ docker search ubuntu</div><div class="line"></div><div class="line"><span class="comment"># &#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x5F88;&#x591A;&#xFF0C;&#x9650;&#x5B9A;&#x4E00;&#x4E0B;&#x53EA;&#x8981; 1000 &#x661F;&#x4EE5;&#x4E0A;&#x7684;</span></div><div class="line">$ docker search <span class="_">-s</span> 1000 ubuntu</div><div class="line"></div><div class="line"><span class="comment"># &#x627E;&#x5230;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x955C;&#x50CF;</span></div><div class="line">$ docker run -it ubuntu</div><div class="line"></div><div class="line"><span class="comment"># &#x6CA1;&#x5565;&#x95EE;&#x9898;&#xFF0C;&#x8BD5;&#x8BD5;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;ubuntu &#x6301;&#x7EED;15&#x79D2;</span></div><div class="line">$ docker run <span class="_">-d</span> --name=my-container ubuntu sleep 15</div><div class="line"></div><div class="line"><span class="comment"># &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Ubuntu &#x7684;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;&#xFF0C;&#x8FDB;&#x53BB;&#x5B89;&#x88C5;&#x597D; node.js &#x7136;&#x540E;commit</span></div><div class="line">$ docker commit <span class="_">-a</span> razielt 22d ubuntu-node:1.0</div></pre></td></tr></table></figure>
<h1 id="chuang-jian-express-js-wei-fu-wu"><a href="#&#x521B;&#x5EFA;-Express-js-&#x5FAE;&#x670D;&#x52A1;" class="headerlink" title="&#x521B;&#x5EFA; Express.js &#x5FAE;&#x670D;&#x52A1;"></a>&#x521B;&#x5EFA; Express.js &#x5FAE;&#x670D;&#x52A1; <a href="#chuang-jian-express-js-wei-fu-wu" class="header-anchor">#</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x5B89;&#x88C5; express &#x751F;&#x6210;&#x5668;</span></div><div class="line">$ npm i -g express-generator</div><div class="line"></div><div class="line"><span class="comment"># &#x751F;&#x6210; express.js &#x5E94;&#x7528;&#x6A21;&#x677F;</span></div><div class="line">$ express my_microservice</div></pre></td></tr></table></figure>
<p>&#x7F16;&#x8F91; <code>routes/api.js</code> &#x6765;&#x5EFA;&#x7ACB;&#x6700;&#x7B80;&#x5355;&#x7684; API</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x4F7F;&#x7528;&#x5377;&#x7ED1;&#x5B9A;&#x6765;&#x96C6;&#x6210;&#x8FD9;&#x4E2A; express &#x5E94;&#x7528;</span></div><div class="line">$ docker run -it -v $(<span class="built_in">pwd</span>):/host -p 9000:3000 ubuntu-node:0.1 /bin/bash</div><div class="line"></div><div class="line"><span class="comment"># &#x7136;&#x540E;&#x5C06;&#x5F53;&#x524D;&#x4EE3;&#x7801;&#x590D;&#x5236;&#x5230;&#x5BF9;&#x5E94;&#x76EE;&#x5F55;&#xFF0C;commit &#x4E00;&#x4E2A;&#x9ED1;&#x7BB1;&#x955C;&#x50CF;</span></div><div class="line">$ docker commit <span class="_">-a</span> razielt b4e node-microservice:0.1</div><div class="line"></div><div class="line"><span class="comment"># &#x8FD0;&#x884C;&#x8BE5;&#x955C;&#x50CF;</span></div><div class="line">$ docker run <span class="_">-d</span> -w /microservice -p 9000:3000 node-microservice:0.1 npm start</div><div class="line"></div><div class="line"><span class="comment"># &#x7136;&#x540E;&#x9644;&#x7740;&#x5230;&#x8FD9;&#x4E2A;docker&#x8FDB;&#x7A0B;&#x4E0A;&#x89C2;&#x770B;&#x8F93;&#x51FA;</span></div><div class="line">$ docker attach 3d61</div></pre></td></tr></table></figure>
<p>&#x955C;&#x50CF;&#x5236;&#x4F5C;&#x597D;&#x540E;&#x53EF;&#x4EE5;&#x63A8;&#x9001;&#x5230; Docker Hub &#x4E0A;&#x3002;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># &#x767B;&#x5F55; Docker Hub</span></div><div class="line">$ docker login</div><div class="line">$ docker tag node-microservice:0.1 node-microservice:latest</div><div class="line">$ docker tag node-microservice razielt/node_microservice</div><div class="line">$ docker push</div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x6837;&#x955C;&#x50CF;&#x5C31;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x90E8;&#x7F72;&#x4E86;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#shi-pin-xin-xi&quot;&gt;&amp;#x89C6;&amp;#x9891;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="node.js" scheme="http://blog.lab99.org/tags/node-js/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
  </entry>
  
  <entry>
    <title>视频笔记：Docker 特性及其相关工具 - Tom Verelst</title>
    <link href="http://blog.lab99.org/post/docker-2016-06-17-video-docker-features-and-tools-by-tom-verelst.html"/>
    <id>http://blog.lab99.org/post/docker-2016-06-17-video-docker-features-and-tools-by-tom-verelst.html</id>
    <published>2016-06-16T16:00:00.000Z</published>
    <updated>2016-12-08T07:31:43.838Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="/style/owl.css"><!-- toc -->
<ul>
<li><a href="#ji-ben-jie-shao">&#x57FA;&#x672C;&#x4ECB;&#x7ECD;</a></li>
<li><a href="#dockerfile-docker-build-images-run"><code>Dockerfile</code>, <code>docker build</code>, <code>images</code>, <code>run</code></a></li>
<li><a href="#docker-li-shi">Docker &#x5386;&#x53F2;</a><ul>
<li><a href="#2007-nian-linux-fa-bu-nei-he-2-6-24">2007&#x5E74; Linux &#x53D1;&#x5E03;&#x5185;&#x6838; <code>2.6.24</code></a></li>
<li><a href="#2013-nian-2-yue-linux-fa-bu-liao-nei-he-3-8">2013&#x5E74;2&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.8</code></a></li>
<li><a href="#2014-nian-8-yue-linux-fa-bu-liao-nei-he-3-16">2014&#x5E74;8&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.16</code></a></li>
<li><a href="#2014-nian-12-yue-linux-fa-bu-liao-nei-he-3-18">2014&#x5E74;12&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.18</code></a></li>
<li><a href="#2015-nian-4-yue-linux-fa-bu-liao-nei-he-4-0">2015&#x5E74;4&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.0</code></a></li>
<li><a href="#2016-nian-linux-fa-bu-liao-nei-he-4-5">2016&#x5E74; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.5</code></a></li>
</ul>
</li>
<li><a href="#shi-yong-docker-de-hao-chu">&#x4F7F;&#x7528; Docker &#x7684;&#x597D;&#x5904;</a><ul>
<li><a href="#chi-xu-ji-cheng-continuous-integration">&#x6301;&#x7EED;&#x96C6;&#x6210;(Continuous Integration)</a></li>
<li><a href="#bian-pai-orchestration-gong-ju">&#x7F16;&#x6392;(Orchestration)&#x5DE5;&#x5177;</a><ul>
<li><a href="#compose">Compose</a></li>
<li><a href="#machine">Machine</a></li>
<li><a href="#swarm">Swarm</a></li>
<li><a href="#networking">Networking</a></li>
</ul>
</li>
<li><a href="#qi-ta-gong-ju">&#x5176;&#x5B83;&#x5DE5;&#x5177;</a><ul>
<li><a href="#docker-cloud-cloud-docker-com">Docker Cloud (cloud.docker.com)</a></li>
<li><a href="#kubernetes">Kubernetes</a></li>
<li><a href="#coreos">CoreOS</a></li>
<li><a href="#lattice">Lattice</a></li>
<li><a href="#flocker">Flocker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker-security">Docker Security</a><ul>
<li><a href="#container-security">Container Security</a></li>
<li><a href="#node-security">Node Security</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<div class="owl-media owl-video owl-youtube"><iframe src="//www.youtube.com/embed/heBI7oQvHZU" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
<p><a href="https://www.youtube.com/watch?v=heBI7oQvHZU" target="_blank" rel="external">https://www.youtube.com/watch?v=heBI7oQvHZU</a></p>
<div class="owl-media owl-video owl-tencent"><embed src="http://static.video.qq.com/TPout.swf?vid=o03134mlm8j&amp;auto=0" type="application/x-shockwave-flash" quality="high" allowfullscreen="true" align="middle" allowscriptaccess="always"></div>
<p><a href="http://v.qq.com/page/o/8/j/o03134mlm8j.html" target="_blank" rel="external">http://v.qq.com/page/o/8/j/o03134mlm8j.html</a></p>
<h1 id="ji-ben-jie-shao"><a href="#&#x57FA;&#x672C;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x57FA;&#x672C;&#x4ECB;&#x7ECD;"></a>&#x57FA;&#x672C;&#x4ECB;&#x7ECD; <a href="#ji-ben-jie-shao" class="header-anchor">#</a></h1><p>Docker &#x5F88;&#x50CF;(<strong>&#x4F46;&#x4E0D;&#x662F;</strong>)&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x7684;shell, namespace, network interface&#xFF0C;&#x53EF;&#x4EE5;&#x4EE5;root&#x8FD0;&#x884C;&#x4E1C;&#x897F;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x670D;&#x52A1;&#x548C;&#x8F6F;&#x4EF6;&#x5305;</p>
<p>&#x865A;&#x62DF;&#x673A;&#x6709;&#x865A;&#x62DF;&#x786C;&#x4EF6;&#x5C42;&#x548C;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x5176;&#x4E0A;&#x7684;&#x5B8C;&#x6574;&#x7CFB;&#x7EDF;&#x3002;&#x800C;&#x5BB9;&#x5668;&#x5219;&#x662F;&#x76F4;&#x63A5;&#x5C06;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x4E8E;&#x73B0;&#x6709;&#x5185;&#x6838;&#x4E0A;&#x3002;&#x6240;&#x4EE5;&#x542F;&#x52A8;Docker&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x542F;&#x52A8;&#x975E;&#x5E38;&#x5FEB;&#x901F;&#x3002;</p>
<p>Docker&#x7EC4;&#x6210;&#x90E8;&#x5206;&#xFF0C;&#x7B80;&#x5355;&#x6765;&#x770B;&#xFF0C;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x89D2;&#x8272;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x3001;docker &#x4E3B;&#x673A;&#x3001;docker registry&#x3002;<br>&#x5BA2;&#x6237;&#x7AEF;&#x8FD0;&#x884C; <code>docker run</code>, <code>build</code>, <code>pull</code>&#x7B49;&#x547D;&#x4EE4;&#xFF1B;<br><code>docker host</code> &#x5219;&#x6709;&#x4E00;&#x4E2A;<code>docker daemon</code> &#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x5B83;&#x7EF4;&#x62A4;&#x7740;&#x672C;&#x5730;&#x7684;container&#x548C;image&#xFF1B;<br><code>docker registry</code>&#x5219;&#x662F;&#x96C6;&#x4E2D;&#x7BA1;&#x7406;&#x6240;&#x6709;image&#x7684;&#x5730;&#x65B9;&#xFF0C;docker host&#x5C06;&#x4ECE;docker registry&#x53D6;&#x5F97;image&#x3002;</p>
<p>Docker &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5206;&#x5C42;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x57FA;&#x4E8E;Union FS&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5728;Ubuntu&#x4E0A;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>aufs</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x81EA;&#x7136;&#x7684;&#x652F;&#x6301;&#x8FD9;&#x79CD;&#x6982;&#x5FF5;&#x3002;&#x800C;&#x5728;CentOS/RHEL&#x4E0A;&#x5219;&#x53EA;&#x80FD;&#x4F7F;&#x7528;DeviceMapper&#x53BB;&#x6A21;&#x62DF;&#xFF0C;&#x6027;&#x80FD;&#x548C;&#x7A33;&#x5B9A;&#x6027;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;&#x5728; Linux 3.18 &#x4EE5;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Overlay FS&#xFF0C;&#x8FD9;&#x4E5F;&#x662F; Union FS &#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<p>Docker &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5206;&#x5C42;&#xFF0C;&#x6700;&#x5E95;&#x5C42;&#x662F; bootfs(kernel)&#xFF0C;&#x7136;&#x540E;&#x662F;&#x955C;&#x50CF;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x5C42;&#xFF0C;&#x6700;&#x540E;&#x662F;&#x8FD0;&#x884C;&#x671F;&#x7684;&#x5BB9;&#x5668;&#x7684;&#x5C42;&#x3002;&#x5BB9;&#x5668;&#x7684;&#x5B58;&#x50A8;&#x5C42;&#x5728;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x5373;&#x88AB;&#x5E9F;&#x5F03;&#x3002;</p>
<p>&#x4E25;&#x683C;&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x540E;&#x5C31;&#x88AB;&#x9500;&#x6BC1;&#x3002;&#x5BB9;&#x5668;&#x505C;&#x6B62;&#x540E;&#xFF0C;&#x5176;&#x5B58;&#x50A8;&#x5C42;&#x4F9D;&#x7136;&#x9644;&#x5C5E;&#x4E8E;&#x505C;&#x6B62;&#x6389;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x5982;&#x679C;&#x5229;&#x7528; docker start &#x5C06;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x5185;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x53D8;&#x52A8;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#x3002;&#x800C;&#x8FD9;&#x79CD;&#x5BB9;&#x5668;&#x5B58;&#x50A8;&#x5C42;&#x88AB;&#x5E9F;&#x5F03;&#x7684;&#x6982;&#x5FF5;&#x5219;&#x662F;&#x6307;&#x53E6;&#x4E00;&#x4E2A;&#x5C42;&#x9762;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p>
<p><strong>&#x5BB9;&#x5668;&#x5E94;&#x5F53;&#x88AB;&#x89C6;&#x4E3A; immutable &#x7684;</strong>&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x5668;&#x5185;&#x90E8;&#x7684;&#x53D8;&#x52A8;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x88AB;&#x629B;&#x5F03;&#xFF0C;&#x4E0D;&#x5E0C;&#x671B;&#x4E22;&#x5931;&#x7684;&#x53D8;&#x5316;&#x90E8;&#x5206;&#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x4E8E;&#x6302;&#x8F7D;&#x7684;&#x6570;&#x636E;&#x5377;&#x4E2D;&#x3002;</p>
<p>&#x6240;&#x4EE5;docker&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x662F; <code>docker run</code>, <code>stop</code>, <code>rm</code>, &#x518D;&#x6B21;<code>run</code>&#x3002;&#x6BCF;&#x4E00;&#x6B21;<code>run</code>&#x90FD;&#x662F;&#x4ECE;image&#x5EFA;&#x7ACB;&#x7684;&#x65B0;&#x9C9C;&#x7684;container&#xFF0C;&#x6240;&#x4EE5;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x6C38;&#x8FDC;&#x662F;image&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x4E0A;&#x4E00;&#x6B21;container&#x4E2D;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x6240;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E2A;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;&#x7406;&#x89E3;&#xFF0C;container&#x4E2D;&#x7684;&#x53D8;&#x52A8;&#x88AB;&#x5E9F;&#x5F03;&#x4E86;&#x3002;</p>
<p>Docker 1.10 &#x53D1;&#x5E03;&#x66F4;&#x65B0;&#x4E86;Layer&#x7684;ID&#x95EE;&#x9898;&#xFF0C;&#x66FE;&#x7ECF;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x968F;&#x673A;UUID&#xFF0C;&#x4F46;&#x662F;&#x53D1;&#x751F;&#x8FC7;&#x51B2;&#x7A81;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x96BE;&#x5224;&#x65AD;&#x76F8;&#x540C;UUID&#x7684;layer&#x5230;&#x5E95;&#x662F;&#x54EA;&#x4E2A;&#x3002;&#x6240;&#x4EE5;&#x4ECE;1.10&#x5F00;&#x59CB;&#xFF0C;&#x5C06;&#x5176;&#x5347;&#x7EA7;&#x4E3A;&#x5BC6;&#x7801;&#x5B66; Hash &#x503C;&#xFF0C;SHA256&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x5176;&#x5185;&#x5BB9;&#x7EDF;&#x4E00;&#xFF0C;&#x800C;&#x4E14;Image&#x5C06;&#x4F1A;&#x66F4;&#x5C0F;&#x3002;&#x5728; 1.10 &#x4EE5;&#x524D;&#xFF0C;Image &#x548C; Layer &#x57FA;&#x672C;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F; 1.10 &#x4E4B;&#x540E;&#xFF0C;&#x7531;&#x4E8E;&#x4F7F;&#x7528;&#x4E86; SHA256&#xFF0C;Image &#x548C; Layer &#x53EF;&#x4EE5;&#x5206;&#x5F00;&#x590D;&#x7528;&#x91CD;&#x590D;&#x7684;Layer&#xFF0C;&#x8FD9;&#x6837;Image&#x53EF;&#x4EE5;&#x66F4;&#x5C0F;&#x3002;&#x7531;&#x4E8E;&#x8FD9;&#x79CD;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#x679C;&#x4ECE; 1.10 &#x4EE5;&#x524D;&#x7684;&#x7248;&#x672C;&#x8FC7;&#x6765;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x5347;&#x7EA7;&#x6240;&#x6709; images&#x3002;</p>
<p>Docker &#x5BB9;&#x5668;&#x6587;&#x4EF6;&#x5C42;&#x4F1A;&#x5728;&#x505C;&#x6B62;&#x540E;&#x88AB;&#x5E9F;&#x5F03;&#xFF0C;&#x90A3;&#x4E48;&#x6570;&#x636E;&#x5E94;&#x8BE5;&#x5B58;&#x50A8;&#x4E8E;&#x6302;&#x8F7D;&#x7684;&#x5377;&#x4E2D;&#x3002;&#x800C;&#x6302;&#x8F7D;&#x5377;&#x53EF;&#x4EE5;&#x662F;&#x6570;&#x636E;&#x5377;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x672C;&#x5730;&#x6587;&#x4EF6;&#xFF0C;&#x6CE8;&#x610F;&#x662F;&#x201C;&#x672C;&#x5730;&#x201D;&#xFF0C;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;NFS, SMB&#x4E4B;&#x7C7B;&#x7684;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x6302;&#x8F7D;&#xFF0C;&#x8FD9;&#x6837;Docker&#x4F1A;&#x8BA4;&#x4E3A;&#x5176;&#x4E0D;&#x5B89;&#x5168;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x7C7B;&#x4F3C;&#x7684;&#x4E91;&#x5B58;&#x50A8;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;volume&#x7684;driver&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;AWS S3&#x4E4B;&#x7C7B;&#x7684;&#x5B58;&#x50A8;&#x3002;</p>
<p>docker run &#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49; EXPOSE &#x67D0;&#x4E9B;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x7AEF;&#x53E3;&#x662F;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x5916;&#x90E8;&#x8BBF;&#x95EE;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x8FD9;&#x4E9B;&#x7AEF;&#x53E3;&#x66B4;&#x9732;&#x4E8E;&#x5916;&#x90E8;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x7528; -p &#x6216; &#x2013;publish&#xFF0C;&#x5C06;&#x8BE5;&#x7AEF;&#x53E3;&#x53D1;&#x5E03;&#x4E8E;&#x5BBF;&#x4E3B;&#xFF0C;&#x53EF;&#x4EE5;&#x6620;&#x5C04;&#x4E0D;&#x540C;&#x7AEF;&#x53E3;&#x3002;</p>
<h1 id="dockerfile-docker-build-images-run"><a href="#Dockerfile-docker-build-images-run" class="headerlink" title="Dockerfile, docker build, images, run"></a><code>Dockerfile</code>, <code>docker build</code>, <code>images</code>, <code>run</code> <a href="#dockerfile-docker-build-images-run" class="header-anchor">#</a></h1><p><code>Dockerfile</code> &#x662F;&#x5206;&#x6B65;&#x9AA4;&#x7684;&#xFF0C;&#x800C;&#x6BCF;&#x4E00;&#x6B65;&#x90FD;&#x4F1A;&#x88AB;&#x7F13;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x975E;&#x5E38;&#x5FEB;&#x3002;</p>
<p><code>ENTRYPOINT</code> &#x548C; <code>CMD</code> &#x4E0D;&#x540C;&#xFF0C;&#x4E00;&#x822C; <code>ENTRYPOINT</code> &#x662F;&#x8981;&#x8FD0;&#x884C;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x800C; <code>CMD</code> &#x5219;&#x662F;&#x53C2;&#x6570;&#xFF0C;<code>docker run</code> &#x540E;&#x9762;&#x6240;&#x8DDF;&#x968F;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x662F; <code>CMD</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53C2;&#x6570;&#x3002;&#x6709;&#x4E9B;&#x955C;&#x50CF;&#x628A; <code>ENTRYPOINT</code> &#x8BBE;&#x4E3A;&#x4E86; <code>sh -c</code>&#xFF0C;&#x8FD9;&#x6837; <code>CMD</code> &#x53EF;&#x4EE5;&#x8DDF; bash &#x547D;&#x4EE4;&#x548C;&#x811A;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E9B;&#x4EBA;&#x8BEF;&#x4EE5;&#x4E3A; <code>CMD</code> &#x5C31;&#x662F;&#x547D;&#x4EE4;&#x3002;&#x5176;&#x5B9E;&#x5B83;&#x4EEC;&#x53EA;&#x662F;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x9001;&#x7ED9;&#x4E86; <code>ENTRYPOINT</code> &#x4E2D;&#x6307;&#x5B9A;&#x7684; <code>sh -c</code>&#x3002;</p>
<p>&#x57FA;&#x672C;&#x547D;&#x4EE4;&#xFF1A;<code>build</code>, <code>run</code>, <code>stop</code>, <code>start</code>, <code>ps</code>, <code>ps -a</code>, <code>images</code>, <code>rmi</code><br>&#x5C06;&#x955C;&#x50CF;<code>push</code>&#x5230;registry&#xFF0C;<code>docker login</code>, <code>docker push</code></p>
<h1 id="docker-li-shi"><a href="#Docker-&#x5386;&#x53F2;" class="headerlink" title="Docker &#x5386;&#x53F2;"></a>Docker &#x5386;&#x53F2; <a href="#docker-li-shi" class="header-anchor">#</a></h1><p>Docker &#x7684;&#x5386;&#x53F2;&#x662F;&#x548C; Linux &#x5185;&#x6838;&#x53D1;&#x5E03;&#x5386;&#x53F2;&#x7D27;&#x5BC6;&#x76F8;&#x5173;&#x7684;&#x3002;</p>
<h2 id="2007-nian-linux-fa-bu-nei-he-2-6-24"><a href="#2007&#x5E74;-Linux-&#x53D1;&#x5E03;&#x5185;&#x6838;-2-6-24" class="headerlink" title="2007&#x5E74; Linux &#x53D1;&#x5E03;&#x5185;&#x6838; 2.6.24"></a>2007&#x5E74; Linux &#x53D1;&#x5E03;&#x5185;&#x6838; <code>2.6.24</code> <a href="#2007-nian-linux-fa-bu-nei-he-2-6-24" class="header-anchor">#</a></h2><p>&#x6709;&#x4E2A;&#x7279;&#x6027;&#x88AB;&#x6DFB;&#x52A0;&#x8FDB;&#x6765;&#xFF0C;Control Groups(<code>cgroups</code>)&#x3002;&#x968F;&#x540E;&#xFF0C;&#x4F7F;&#x7528; <code>cgroups</code> &#x7684; Linux Containers (<code>lxc</code>) &#x53D1;&#x5E03;&#x3002;<code>cgroups</code> &#x662F;&#x4ECA;&#x5929; Docker &#x7684;&#x57FA;&#x7840;&#x3002;</p>
<p><code>cgroups</code> &#xFF0C;&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#xFF0C;&#x8BBE;&#x7F6E;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x4F1A;&#x8BA1;&#xFF0C;&#x63A7;&#x5236;&#x3002;</p>
<p>&#x8DDD;&#x6F14;&#x8BB2;&#x8005;&#x8BF4;&#xFF0C;Linux &#x4E2D;&#x7684; <code>nice</code>&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x4F7F;&#x7528; <code>cgroups</code> &#x4E2D;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x529F;&#x80FD;&#x3002;<br><a href="https://en.wikipedia.org/wiki/Nice_(Unix)" target="_blank" rel="external">https://en.wikipedia.org/wiki/Nice_(Unix)</a><br>&#x4E0D;&#x8FC7;&#x5E94;&#x8BE5;&#x4E0D;&#x662F;&#x3002;</p>
<p>&#x63A7;&#x5236;&#x7684;&#x90E8;&#x5206;&#x5305;&#x62EC;<code>freeze</code>&#x548C;<code>restart</code>&#x3002;</p>
<p>(<em>&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5BB9;&#x6F14;&#x8BB2;&#x8005;&#x8BB2;&#x7684;&#x6709;&#x4E9B;&#x9519;&#x8BEF;&#xFF0C;&#x6211;&#x67E5;&#x8BE2;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x8FDB;&#x884C;&#x4FEE;&#x6B63;&#x3002;</em>&#xFF09;</p>
<h2 id="2013-nian-2-yue-linux-fa-bu-liao-nei-he-3-8"><a href="#2013&#x5E74;2&#x6708;-Linux-&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-3-8" class="headerlink" title="2013&#x5E74;2&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 3.8"></a>2013&#x5E74;2&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.8</code> <a href="#2013-nian-2-yue-linux-fa-bu-liao-nei-he-3-8" class="header-anchor">#</a></h2><p><a href="http://kernelnewbies.org/Linux_3.8#head-fc2604c967c200a26f336942caee2440a2a4099c" target="_blank" rel="external">http://kernelnewbies.org/Linux_3.8#head-fc2604c967c200a26f336942caee2440a2a4099c</a></p>
<p>&#x8FD9;&#x6B21;&#x5B8C;&#x6574;&#x7684;&#x5B9E;&#x73B0;&#x4E86; namespace &#x7684;&#x9694;&#x79BB;&#xFF0C;&#x5305;&#x62EC;&#x4E86; pid, network, hostname, mount pic, user &#x7684;namespace&#x3002;</p>
<p>&#x6B63;&#x662F;&#x8FD9;&#x6B21;&#x53D1;&#x5E03;&#x6784;&#x6210;&#x4E86;Docker&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x540C;&#x5E74;3&#x6708;&#x4EFD; Docker &#x9879;&#x76EE;&#x6B63;&#x5F0F;&#x6210;&#x4E3A;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x3002;&#x6700;&#x5F00;&#x59CB;&#x57FA;&#x4E8E; <code>lxc</code>&#xFF0C;&#x73B0;&#x5728;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x4E86; <code>libcontainer</code>&#xFF0C;&#x7EDF;&#x4E00;&#x63A5;&#x53E3;&#xFF0C;&#x4E0B;&#x9762;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x79CD;&#x5BB9;&#x5668;&#x7EC4;&#x5408;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>runC</code>&#xFF0C;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x6362;&#x3002;</p>
<h2 id="2014-nian-8-yue-linux-fa-bu-liao-nei-he-3-16"><a href="#2014&#x5E74;8&#x6708;-Linux-&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-3-16" class="headerlink" title="2014&#x5E74;8&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 3.16"></a>2014&#x5E74;8&#x6708; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.16</code> <a href="#2014-nian-8-yue-linux-fa-bu-liao-nei-he-3-16" class="header-anchor">#</a></h2><p>&#x5BF9; <code>cgroups</code> &#x8FDB;&#x884C;&#x4E86;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x3002; <a href="http://lwn.net/Articles/601840/" target="_blank" rel="external">http://lwn.net/Articles/601840/</a></p>
<p>Docker Networking &#x4E2D;&#x7684; <code>overlay network</code> &#x6240;&#x4F9D;&#x8D56;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x6B21;&#x5185;&#x6838;&#x7684;&#x6539;&#x8FDB;&#x3002;</p>
<h2 id="2014-nian-12-yue-linux-fa-bu-liao-nei-he-3-18"><a href="#2014&#x5E74;12&#x6708;-Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-3-18" class="headerlink" title="2014&#x5E74;12&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 3.18"></a>2014&#x5E74;12&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>3.18</code> <a href="#2014-nian-12-yue-linux-fa-bu-liao-nei-he-3-18" class="header-anchor">#</a></h2><p>&#x7ECF;&#x8FC7;&#x591A;&#x5E74;&#x7684;&#x52AA;&#x529B;&#xFF0C;&#x8FD9;&#x6B21;&#x7EC8;&#x4E8E;&#x7B2C;&#x4E00;&#x6B21;&#x5728;&#x5185;&#x6838;&#x4E2D;&#x52A0;&#x5165;&#x4E86; Union FS&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x6B21;&#x662F; <code>Overlay fs</code>&#x3002;&#xFF08;Ubuntu&#x4E2D;&#x7684;<code>aufs</code>&#x4E89;&#x53D6;&#x4E86;&#x597D;&#x591A;&#x5E74;&#xFF0C;&#x6700;&#x540E;&#x4F5C;&#x8005;&#x61D2;&#x5F97;&#x4E89;&#x53D6;&#x4E86;&#xFF0C;&#x653E;&#x5F03;&#x4E86;&#xFF09;&#x3002;&#x8FD9;&#x6837;&#x5BF9;&#x4E8E;&#x7EA2;&#x5E3D;&#x7CFB;&#x5C06;&#x6765;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E5F;&#x5C31;&#x7EC8;&#x4E8E;&#x6709;&#x53EF;&#x80FD;&#x6709;Union FS&#x53EF;&#x7528;&#x4E86;&#x3002;&#x4EE5;&#x524D;&#x53EA;&#x80FD;&#x51D1;&#x5408;&#x7528; Device Mapper&#xFF0C;&#x800C;&#x4E14;&#x672C;&#x5730;loop&#x8FD8;&#x662F;&#x4E0D;&#x9002;&#x5408;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4F7F;&#x7528;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8981;&#x4F7F;&#x7528; <code>overlay</code> &#x5B58;&#x50A8;&#x5C42;&#xFF0C;&#x9700;&#x8981;&#x5185;&#x6838;&#x5728; <code>3.18</code> &#x4EE5;&#x4E0A;&#x3002;</p>
<h2 id="2015-nian-4-yue-linux-fa-bu-liao-nei-he-4-0"><a href="#2015&#x5E74;4&#x6708;-Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-4-0" class="headerlink" title="2015&#x5E74;4&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 4.0"></a>2015&#x5E74;4&#x6708; Linux&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.0</code> <a href="#2015-nian-4-yue-linux-fa-bu-liao-nei-he-4-0" class="header-anchor">#</a></h2><p>docker 1.12 &#x4E2D;&#x7684; <code>overlay2</code> &#x5B58;&#x50A8;&#x5C42;&#x5C31;&#x4F9D;&#x8D56;&#x7684;&#x662F;&#x8FD9;&#x6B21;&#x7684;&#x5185;&#x6838;&#x5BF9; <code>overlay</code> &#x9A71;&#x52A8;&#x7684;&#x6539;&#x8FDB;&#x3002;</p>
<h2 id="2016-nian-linux-fa-bu-liao-nei-he-4-5"><a href="#2016&#x5E74;-Linux-&#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838;-4-5" class="headerlink" title="2016&#x5E74; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; 4.5"></a>2016&#x5E74; Linux &#x53D1;&#x5E03;&#x4E86;&#x5185;&#x6838; <code>4.5</code> <a href="#2016-nian-linux-fa-bu-liao-nei-he-4-5" class="header-anchor">#</a></h2><p>&#x66F4;&#x52A0;&#x5F7B;&#x5E95;&#x7684;&#x6539;&#x9020;&#x4E86; <code>cgroups</code>&#xFF0C;&#x79F0;&#x4E3A; <code>cgroups2</code>&#xFF0C;&#x5E76;&#x4E14;&#x8BA4;&#x53EF;&#x5176;&#x5DF2;&#x7ECF;&#x7A33;&#x5B9A;&#x3002;<br><a href="http://kernelnewbies.org/Linux_4.5#head-621383bcd8bc104aed825c9ebc08a0b986690f8a" target="_blank" rel="external">http://kernelnewbies.org/Linux_4.5#head-621383bcd8bc104aed825c9ebc08a0b986690f8a</a></p>
<h1 id="shi-yong-docker-de-hao-chu"><a href="#&#x4F7F;&#x7528;-Docker-&#x7684;&#x597D;&#x5904;" class="headerlink" title="&#x4F7F;&#x7528; Docker &#x7684;&#x597D;&#x5904;"></a>&#x4F7F;&#x7528; Docker &#x7684;&#x597D;&#x5904; <a href="#shi-yong-docker-de-hao-chu" class="header-anchor">#</a></h1><p>&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x6269;&#x5C55;&#xFF0C;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x4E1C;&#x897F;&#x90FD;&#x6253;&#x5305;&#x5728;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x91CC;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x90E8;&#x7F72;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x9002;&#x5408;&#x6269;&#x5C55;&#x3002;</p>
<p>Docker &#x5BB9;&#x5668;&#x662F; <code>immutable</code> &#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x89C6;&#x4E3A;&#x4E50;&#x9AD8;&#x79EF;&#x6728;&#xFF0C;&#x5982;&#x679C;&#x54EA;&#x4E2A;&#x574F;&#x4E86;&#xFF0C;&#x6254;&#x4E86;&#x6362;&#x4E2A;&#x65B0;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x65E7;&#x7684;&#x4E0A;&#x9762;&#x4FEE;&#x4FEE;&#x8865;&#x8865;&#x3002;</p>
<p>DevOps&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;(Dev)&#x53EA;&#x9700;&#x8981;&#x8003;&#x8651;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x4E1C;&#x897F;&#x5373;&#x53EF;&#xFF0C;&#x800C;&#x8FD0;&#x8425;&#x4EBA;&#x5458;(Ops)&#x5219;&#x53EA;&#x9700;&#x8D1F;&#x8D23;&#x5BB9;&#x5668;&#x5916;&#x90E8;&#x5373;&#x53EF;&#x3002;</p>
<h2 id="chi-xu-ji-cheng-continuous-integration"><a href="#&#x6301;&#x7EED;&#x96C6;&#x6210;-Continuous-Integration" class="headerlink" title="&#x6301;&#x7EED;&#x96C6;&#x6210;(Continuous Integration)"></a>&#x6301;&#x7EED;&#x96C6;&#x6210;(Continuous Integration) <a href="#chi-xu-ji-cheng-continuous-integration" class="header-anchor">#</a></h2><p>&#x786E;&#x4FDD;&#x6240;&#x6709;&#x73AF;&#x5883;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#xFF0C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x201C;&#x6211;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x6CA1;&#x95EE;&#x9898;&#x554A;&#x201D;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#x8FD0;&#x884C;&#x3001;&#x6D4B;&#x8BD5;&#x90FD;&#x5728;&#x5BB9;&#x5668;&#x5185;&#x3002;</p>
<h2 id="bian-pai-orchestration-gong-ju"><a href="#&#x7F16;&#x6392;-Orchestration-&#x5DE5;&#x5177;" class="headerlink" title="&#x7F16;&#x6392;(Orchestration)&#x5DE5;&#x5177;"></a>&#x7F16;&#x6392;(Orchestration)&#x5DE5;&#x5177; <a href="#bian-pai-orchestration-gong-ju" class="header-anchor">#</a></h2><p>Compose, Machine, Swarm, Networking</p>
<h3 id="compose"><a href="#Compose" class="headerlink" title="Compose"></a>Compose <a href="#compose" class="header-anchor">#</a></h3><p>&#x5B9A;&#x4E49;&#x8FD0;&#x884C;&#x591A;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#xFF0C;&#x5355;&#x673A;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x591A;&#x4E3B;&#x673A;&#x8FD8;&#x5728;&#x8BD5;&#x9A8C;&#x4E2D;&#x3002;</p>
<p>&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x4ED6;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x3002;<code>docker-compose.yml</code> &#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x76EE;&#x5F55;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x76EE;&#x5F55;&#x4E0B;&#x5B58;&#x5728; <code>Dockerfile</code>&#x3002;&#x8FD9;&#x79CD;&#x611F;&#x89C9;&#x66F4;&#x5E72;&#x51C0;&#x3002;&#xFF08;&#x6216;&#x8BB8;&#x5728;LNMP&#x793A;&#x4F8B;&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x6211;&#x4E0D;&#x5E94;&#x8BE5;&#x628A;<code>conf</code>&#x90FD;&#x5B58;&#x5728;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x800C;&#x662F;&#x5E94;&#x8BE5;&#x5206;&#x5E94;&#x7528;&#x5EFA;&#x7ACB;&#x76EE;&#x5F55;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x914D;&#x7F6E;&#x653E;&#x5728;&#x5404;&#x81EA;&#x76EE;&#x5F55;&#x4E0B;&#x3002;&#xFF09;</p>
<p>&#x53E6;&#x5916;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x4EC5;&#x6709;&#x51E0;&#x53F0;&#x7684;&#x5E94;&#x7528;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x4ED6;&#x4F9D;&#x7136;&#x5B9A;&#x4E49;&#x4E86;&#x524D;&#x7AEF;&#x7F51;&#x7EDC;&#x548C;&#x540E;&#x7AEF;&#x7F51;&#x7EDC;&#xFF0C;&#x8BA9;&#x4E24;&#x4E2A;&#x7F51;&#x7EDC;&#x72EC;&#x7ACB;&#x3002;</p>
<p>&#x5728;&#x542F;&#x52A8;&#x793A;&#x4F8B;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;Tom Vereist &#x63D0;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5199;&#x7684;&#x4E0D;&#x597D;&#x7684;&#x4E00;&#x70B9;&#xFF0C;&#x5728; worker &#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x5B83;&#x5728;&#x5BB9;&#x5668;&#x91CC;&#x4F7F;&#x7528; maven &#x5BF9;&#x9879;&#x76EE;&#x8FDB;&#x884C;&#x4E86;&#x6784;&#x5EFA;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;maven&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x7F16;&#x8BD1;&#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x7684;&#x5B89;&#x88C5;&#x3001;&#x4F9D;&#x8D56;&#x7684;&#x5B89;&#x88C5;&#x7B49;&#x7B49;&#xFF0C;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5927;&#x7684;&#x955C;&#x50CF;&#x3002;&#x5EFA;&#x8BAE;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x6784;&#x5EFA;&#xFF0C;&#x628A;&#x6784;&#x5EFA;&#x540E;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#x62FF;&#x5230;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x5B89;&#x88C5;&#x4F7F;&#x7528;&#x5373;&#x53EF;&#xFF0C;&#x907F;&#x514D;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x5B58;&#x5728;&#x4E8E;&#x5BB9;&#x5668;&#x4E2D;&#x3002;</p>
<h3 id="machine"><a href="#Machine" class="headerlink" title="Machine"></a>Machine <a href="#machine" class="header-anchor">#</a></h3><p>&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x3001;&#x7BA1;&#x7406; docker host&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x79CD;&#x4E91;&#x5E73;&#x53F0;&#xFF0C;&#x63D0;&#x4F9B;&#x7EDF;&#x4E00;&#x7684;&#x8BBF;&#x95EE;&#x63A5;&#x53E3;&#x3002;</p>
<h3 id="swarm"><a href="#Swarm" class="headerlink" title="Swarm"></a>Swarm <a href="#swarm" class="header-anchor">#</a></h3><p>docker &#x96C6;&#x7FA4;&#x5DE5;&#x5177;&#xFF0C;&#x591A;&#x5BBF;&#x4E3B;&#x7BA1;&#x7406;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x5B9A;&#x4E49; docker host &#x7684; label&#x3002;&#x901A;&#x8FC7; docker daemon &#x7684; <code>--label</code> &#x8BBE;&#x7F6E;&#xFF1B;&#x901A;&#x8FC7; <code>docker-machine --engine-label</code>, <code>--label</code> &#x8BBE;&#x7F6E;&#xFF1B;&#x5C06; docker host &#x8BBE;&#x7F6E;&#x4E0A;&#x6807;&#x7B7E;&#x3002;&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EA6;&#x675F;&#x6807;&#x7B7E;&#xFF0C;&#x6765;&#x51B3;&#x5B9A;&#x8BE5;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x4E8E;&#x90A3;&#x4E9B; docker host &#x4E0A;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x5305;&#x62EC;&#x4E24;&#x5927;&#x7C7B;&#xFF0C;&#x8282;&#x70B9;(Node)&#x6216;&#x5BB9;&#x5668;(Container)&#x3002;&#x8282;&#x70B9;&#x53EF;&#x80FD;&#x662F;&#x7EA6;&#x675F;&#x3001;&#x5065;&#x5EB7;&#x7A0B;&#x5EA6;&#x7B49;&#xFF1B;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x662F;&#x7AEF;&#x53E3;&#x3001;&#x4F9D;&#x8D56;&#x7B49;&#x3002;</p>
<h3 id="networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking <a href="#networking" class="header-anchor">#</a></h3><p>&#x521B;&#x5EFA; <code>Overlay network</code>&#x3002;&#x66FF;&#x4EE3; <code>link</code> (bridge)&#xFF0C;<code>link</code>&#x5728;&#x4E00;&#x4E9B;&#x52A8;&#x6001;&#x73AF;&#x5883;&#x4E0B;&#x4F7F;&#x7528;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;&#x6BD4;&#x5982;&#x4E00;&#x7FA4;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#xFF0C;<code>link</code>&#x7684;&#x67D0;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x65B0;&#x7684;ip&#xFF0C;&#x800C;&#x8FD8;&#x5728;&#x8FD0;&#x884C;&#x7684;docker&#x4F7F;&#x7528;&#x7684;&#x8FD8;&#x662F;&#x65E7;&#x7684;ip&#x53BB;&#x8054;&#x7CFB;&#x8BE5;&#x8282;&#x70B9;&#xFF0C;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x3002;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x591F;&#x628A;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;down&#x6389;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x5C1D;&#x8BD5;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x4E24;&#x4E2A;&#x6CA1;&#x6709;<code>link</code>&#x5173;&#x7CFB;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5BB9;&#x5668;IP&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x3002;&#x6240;&#x4EE5; <code>link</code> &#x662F;&#x5EFA;&#x7ACB;&#x4E00;&#x79CD;&#x8BC6;&#x522B;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B89;&#x5168;&#x4E0A;&#x7684;&#x5EFA;&#x7ACB;&#x901A;&#x9053;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#x6587;&#x6863;&#xFF0C;&#x63D0;&#x5230;&#x4E86; <code>--icc=false</code> &#x7684;&#x53C2;&#x6570;&#x6765;&#x521B;&#x5EFA;&#x7F51;&#x7EDC;&#x9694;&#x79BB;&#x3002;<br><a href="https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks" target="_blank" rel="external">https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks</a></p>
<p><code>link</code> (bridge)&#x4F7F;&#x7528;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x7ED9;&#x5BBF;&#x4E3B;&#x5176;link&#x7684;&#x4E3B;&#x673A;&#x4F4D;&#x7F6E;&#xFF0C;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x548C;<code>/etc/hosts</code>&#x6587;&#x4EF6;&#x3002;<br><a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#communication-across-links" target="_blank" rel="external">https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/#communication-across-links</a></p>
<p>&#x800C;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; docker network &#x521B;&#x5EFA; <code>overlay network</code>&#xFF0C;&#x4F7F;&#x7528;<code>link</code>&#x94FE;&#x63A5;&#x4E3B;&#x673A;&#xFF0C;&#x5219;&#x4F1A;<strong>&#x6709;&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x7684;DNS&#x8FDB;&#x884C;&#x540D;&#x5B57;&#x7684;&#x52A8;&#x6001;&#x7EF4;&#x62A4;</strong>&#xFF0C;&#x4E0D;&#x518D;&#x4F7F;&#x7528; <code>/etc/hosts</code>&#x3002;</p>
<p>&#x5728;Tom &#x6F14;&#x793A; docker swarm &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x53D1;&#x73B0;&#x4ED6;&#x548C;&#x6211;&#x4E00;&#x6837;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x4E2A; bash &#x811A;&#x672C;&#x6765;&#x542F;&#x52A8;&#x5EFA;&#x7ACB; docker host&#x3002;&#x6211;&#x89C9;&#x5F97;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x505A;&#x4E2A;&#x5DE5;&#x5177;&#x4F7F;&#x7528; yaml &#x63CF;&#x8FF0;&#x6587;&#x4EF6;&#x6765;&#x5EFA;&#x7ACB; docker-machine&#xFF0C;&#x5C31;&#x50CF; docker-compose&#x505A;&#x7684;&#x90A3;&#x6837;&#x3002;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x6709;&#x592A;&#x591A;&#x7684;&#x91CD;&#x590D;&#x4FE1;&#x606F;&#x4E86;&#x3002;</p>
<p>&#x811A;&#x672C;&#x6700;&#x540E;&#x662F;&#x4F7F;&#x7528; docker network &#x521B;&#x5EFA; <code>overlay</code> &#x7F51;&#x7EDC;&#xFF0C;Tom &#x63D0;&#x5230;&#x4E00;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A;  <code>--subnet</code> &#xFF0C;&#x5426;&#x5219;&#x5C06;&#x65E0;&#x6CD5;&#x8FDE;&#x901A;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x8DE8;&#x4E3B;&#x673A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6709;&#x7684;&#x7248;&#x672C;&#x6709;bug&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x4E0D;&#x4E00;&#x5B9A;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x6BB5;IP&#x5730;&#x5740;&#x3002;&#x4E0D;&#x8FC7;&#x73B0;&#x5728;&#x8FD9;&#x4E2A;bug&#x5DF2;&#x7ECF;&#x4FEE;&#x590D;&#x4E86;&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x8DE8;&#x4E3B;&#x673A;&#x6CA1;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x6F14;&#x793A; swarm &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x78B0;&#x5230;&#x4E86;&#x548C;&#x6211;&#x78B0;&#x5230;&#x7684;&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5728;&#x5355;&#x673A;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x5728; docker compose &#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>build</code> &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3002;&#x4F46;&#x662F;&#x5728; swarm &#x7684;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x5BFC;&#x81F4;&#x6240;&#x6709;&#x7684; service &#x4F1A;&#x6254;&#x5230;&#x540C;&#x4E00;&#x4E2A; docker host &#x4E2D;&#x53BB;&#xFF0C;&#x800C;&#x5982;&#x679C;&#x6253;&#x7B97;&#x4F7F;&#x7528;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#xFF08;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7528;swarm &#x7684;&#x521D;&#x8877;&#xFF09;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x4F7F;&#x7528; registry &#x4E2D;&#x7684; image&#x3002;&#x8FD9;&#x6837;&#x5BBF;&#x4E3B;&#x53EF;&#x4EE5;&#x4E3B;&#x52A8;&#x53BB; registry &#x4E0B;&#x8F7D; image&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; docker hub &#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x81EA;&#x5DF1;&#x67B6;&#x8BBE; registry&#x3002;</p>
<p>&#x5E76;&#x4E14;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>link</code> &#x4E86;&#xFF0C;&#x800C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>&#x81EA;&#x5B9A;&#x4E49;network</code>&#x3002;Tom &#x8BF4;&#x8FD9;&#x662F;&#x7531;&#x4E8E;&#x4E00;&#x4E2A; <code>link</code> &#x7684;bug&#xFF0C;&#x73B0;&#x5728;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x8BD5;&#x9A8C;&#x3002;</p>
<p>&#x901A;&#x8FC7; <code>environment:&quot;constraint:type==frontend&quot;</code> &#x7684;&#x5F62;&#x5F0F;&#x6765;&#x6307;&#x5B9A;&#x7EA6;&#x675F;&#x3002;</p>
<p>Tom &#x4E0D;&#x63A8;&#x8350;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528; compose + swarm&#xFF0C;&#x56E0;&#x4E3A;&#x78B0;&#x5230;&#x4E86;&#x592A;&#x591A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4ED6;&#x751A;&#x81F3;&#x81EA;&#x5DF1;&#x8FD8;&#x62A5;&#x544A;&#x4E86;&#x4E00;&#x4E2A;bug #2866&#x3002;</p>
<h2 id="qi-ta-gong-ju"><a href="#&#x5176;&#x5B83;&#x5DE5;&#x5177;" class="headerlink" title="&#x5176;&#x5B83;&#x5DE5;&#x5177;"></a>&#x5176;&#x5B83;&#x5DE5;&#x5177; <a href="#qi-ta-gong-ju" class="header-anchor">#</a></h2><h3 id="docker-cloud-cloud-docker-com"><a href="#Docker-Cloud-cloud-docker-com" class="headerlink" title="Docker Cloud (cloud.docker.com)"></a>Docker Cloud (cloud.docker.com) <a href="#docker-cloud-cloud-docker-com" class="header-anchor">#</a></h3><p>&#x521B;&#x5EFA; node clusters&#xFF0C;&#x53EF;&#x4EE5;&#x9009;&#x62E9;AWS, Digital Ocean, Azure&#xFF0C;Softlayer&#x7B49;&#x51E0;&#x5927;&#x4E91;&#x670D;&#x52A1;&#x5546;&#x3002;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;docker hub&#x4E0A;&#x7684;&#x955C;&#x50CF;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#x3002;&#x5EFA;&#x7ACB; Stack &#x9700;&#x8981;&#x811A;&#x672C;&#xFF0C;&#x5F88;&#x50CF;compose&#xFF0C;&#x5176;&#x5B9E;&#x4ED6;&#x4EEC;&#x5E94;&#x8BE5;&#x652F;&#x6301;compose&#x811A;&#x672C;&#x66F4;&#x5408;&#x9002;&#xFF0C;&#x5EFA;&#x7ACB;service&#x3002;</p>
<p>Docker Cloud &#x9002;&#x5408;&#x5C0F;&#x89C4;&#x6A21;&#x4E91;&#x7684;&#x90E8;&#x7F72;&#x3002;</p>
<h3 id="kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes <a href="#kubernetes" class="header-anchor">#</a></h3><p>&#x7531; Google &#x5F00;&#x53D1;&#xFF0C;&#x7528; Go &#x8BED;&#x8A00;&#x5199;&#x7684;&#x3002;Google &#x6BCF;&#x5468;&#x7528;&#x8FD9;&#x4E2A;&#x8FD0;&#x884C;2&#x767E;&#x4E07;&#x4E2A;containers&#x3002;</p>
<p>&#x4E00;&#x4E2A; kubernetes &#x96C6;&#x7FA4;&#x7531; master &#x548C; minions &#x7EC4;&#x6210;&#x3002;master &#x542B;&#x6709; etcd&#x3001;scheduler&#xFF1B;&#x800C;&#x6BCF;&#x4E2A; minon &#x542B;&#x6709; kubelet&#xFF0C;proxy &#x548C;&#x4E00;&#x7FA4; pod&#x3002;</p>
<h3 id="coreos"><a href="#CoreOS" class="headerlink" title="CoreOS"></a>CoreOS <a href="#coreos" class="header-anchor">#</a></h3><p>&#x4E0D;&#x9700;&#x8981;&#x5B89;&#x88C5; docker&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E86; linux container&#x3002;&#x5B83;&#x4E5F;&#x4F7F;&#x7528; etcd&#xFF0C;&#x6240;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x6BCF;&#x4E00;&#x4E2A; host&#x90FD;&#x8FD0;&#x884C;etcd&#xFF0C;&#x8FD9;&#x6837;&#x907F;&#x514D;&#x4E86;&#x5355;&#x70B9;&#x6545;&#x969C;&#x3002;<code>fleetd</code>&#xFF0C;&#x5F88;&#x50CF;&#x662F;&#x7F51;&#x7EDC;&#x591A;&#x5BBF;&#x4E3B;&#x73AF;&#x5883;&#x4E0B;&#x7684; <code>systemd</code>&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x5F00;&#x542F;&#x505C;&#x6B62;&#x5206;&#x5E03;&#x5728;&#x5BBF;&#x4E3B;&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x3002;</p>
<h3 id="lattice"><a href="#Lattice" class="headerlink" title="Lattice"></a>Lattice <a href="#lattice" class="header-anchor">#</a></h3><h3 id="flocker"><a href="#Flocker" class="headerlink" title="Flocker"></a>Flocker <a href="#flocker" class="header-anchor">#</a></h3><h1 id="docker-security"><a href="#Docker-Security" class="headerlink" title="Docker Security"></a>Docker Security <a href="#docker-security" class="header-anchor">#</a></h1><h2 id="container-security"><a href="#Container-Security" class="headerlink" title="Container Security"></a>Container Security <a href="#container-security" class="header-anchor">#</a></h2><p>container &#x672C;&#x8EAB;&#x5F88;&#x5B89;&#x5168;&#xFF0C;&#x7531;&#x4E8E; isolation&#xFF0C;&#x53EA;&#x4F7F;&#x7528;&#x5FC5;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x3002;<br>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>--security-opt sec comp:xxx.json</code>&#xFF0C;&#x6765;&#x6307;&#x5B9A;&#x5B89;&#x5168;&#x7B56;&#x7565;&#x3002;<br>Unikernel&#xFF0C;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x7075;&#x6D3B;&#x5B9A;&#x5236;&#x7684;&#x5185;&#x6838;&#xFF0C;&#x53EA;&#x9009;&#x62E9;&#x6240;&#x5FC5;&#x987B;&#x7684;&#x7EC4;&#x4EF6;&#x4F7F;&#x7528;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x90FD;&#x629B;&#x5F03;&#xFF0C;&#x4FE1;&#x4EFB;&#x57DF;&#x66F4;&#x5C0F;&#x3002;</p>
<h2 id="node-security"><a href="#Node-Security" class="headerlink" title="Node Security"></a>Node Security <a href="#node-security" class="header-anchor">#</a></h2><p>&#x73B0;&#x5728; docker daemon &#x5FC5;&#x987B;&#x4EE5; root &#x8FD0;&#x884C;&#x3002;&#x73B0;&#x5728;&#x7684;&#x6388;&#x6743;&#x673A;&#x5236;&#x662F; all or nothing&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x7BA1;&#x7406;&#x6240;&#x6709; docker&#xFF0C;&#x6216;&#x8005;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x3002;&#x8FD9;&#x70B9;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;/style/owl.css&quot;&gt;&lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#ji-ben-jie-shao&quot;&gt;&amp;#x57FA;&amp;#x672C;&amp;#x4ECB;&amp;#x7ECD;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
    
    </summary>
    
      <category term="docker" scheme="http://blog.lab99.org/categories/docker/"/>
    
    
      <category term="docker" scheme="http://blog.lab99.org/tags/docker/"/>
    
      <category term="youtube" scheme="http://blog.lab99.org/tags/youtube/"/>
    
      <category term="notes" scheme="http://blog.lab99.org/tags/notes/"/>
    
  </entry>
  
</feed>
